#### `Scrapy Selector` 选择器

```html
<div data-v-7f856186="" class="el-card item">
    <div class="el-card__body">
        <div data-v-7f856186="" class="el-row">
            <div data-v-7f856186="" class="el-col el-col-24">
                <a data-v-7f856186="" href="/detail/1" class="">
                    <img data-v-7f856186="" src="https://p0.net/472.jpg" class="cover">
                </a>
            </div>
            <div data-v-7f856186="" class="p-h el-col el-col-24">
                <a data-v-7f856186="" href="/detail/1" class="name">
                    <h2 data-v-7f856186="" class="m-b-sm">霸王别姬 - Farewell My Concubine</h2>
                </a>
                <div data-v-7f856186="" class="categories">
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>剧情</span>
                    </button>
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>爱情</span>
                    </button>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">中国内地、中国香港</span>
                    <span data-v-7f856186=""> / </span>
                    <span data-v-7f856186="">171 分钟</span>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">1993-07-26 上映</span>
                </div>
            </div>
            <div data-v-7f856186="" class="el-col el-col-24">
                <p data-v-7f856186="" class="score m-t-md m-b-n-sm">
                    9.5</p>
           	</div>
            
        </div>
    </div>
</div>
<div data-v-7f856186="" class="el-card item" >
	<div class="el-card__body">
        <div data-v-7f856186="" class="el-row">
            <div data-v-7f856186="" class="el-col el-col-24">
                <a data-v-7f856186="" href="/detail/2" class="">
                    <img data-v-7f856186="" src="https://p0.net/473.jpg" class="cover">
                </a>
            </div>
            <div data-v-7f856186="" class="p-h el-col el-col-24">
                <a data-v-7f856186="" href="/detail/2" class="name">
                    <h2 data-v-7f856186="" class="m-b-sm">这个杀手不太冷 - Léon</h2>
                </a>
                <div data-v-7f856186="" class="categories">
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>剧情</span>
                    </button>
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>动作</span>
                    </button>

                    <button data-v-7f856186="" type="button" class="el-button category">
                       	<span>犯罪</span>
                    </button>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">法国</span>
                    <span data-v-7f856186=""> / </span>
                    <span data-v-7f856186="">110 分钟</span>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">1994-09-14 上映</span>
                </div>
            </div>
            <div data-v-7f856186="" class="el-col el-col-24">
                <p data-v-7f856186="" class="score m-t-md m-b-n-sm">
                    9.5</p>
            </div>
        </div>
    </div>
</div>
```

##### 1.1 初始化选择器

```python
from scrapy import Selector
# html就是上述文本 以下所有示例基于以上html文本
response = Selector(text = html)
```

##### 1.2 将每部电影的选择器取出来

```python
movie = response.xpath('//div[@class="el-card item"]')
# 结果如下 一共两部电影 故有两个选择器
[<Selector xpath='//div[@class="el-card item"]' data='<div data-v-7f856186="" class="el-car...'>,
 <Selector xpath='//div[@class="el-card item"]' data='<div data-v-7f856186="" class="el-car...'>]
```

##### 1.3 将每部电影的信息提取出来

```python
for movie_data in movie:
	title = movie_data.css('.m-b-sm::text').getall()
	tags = movie_data.css('.categories span::text').getall()
	area = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[1]/text()').getall()
	time = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[3]/text()').getall()
	era = movie_data.xpath('.//div[@class="m-v-sm info"][2]/span/text()').getall()
	score = movie_data.xpath('normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())').getall()
	img = movie_data.css('.cover::attr(src)').getall()
	detail_url = movie_data.xpath('.//img[@class="cover"]/../@href').getall()
	movie_data = {'title': title, 'tags': tags, 'area': area, 'time': time, 'era': era, 'score': score, 'img': img, 'detail_url': detail_url}
	print(title, tags, area, time, era, score, img, detail_url)

# 结果如下
['霸王别姬 - Farewell My Concubine'] ['剧情', '爱情'] ['中国内地、中国香港'] ['171 分钟'] ['1993-07-26 上映'] ['9.5'] ['https://p0.net/472.jpg'] ['/detail/1']
['这个杀手不太冷 - Léon'] ['剧情', '动作', '犯罪'] ['法国'] ['110 分钟'] ['1994-09-14 上映'] ['9.5'] ['https://p0.net/473.jpg'] ['/detail/2']
```

###### 1.3.1 注意点

```markdown
1. xpath只想取出当前选择器下的某个标签的内容的话 使用. 例如 './/div[@class="m-v-sm info"][1]/span[1]/text()'
2. xpath去除空格或者回车 使用 normalize-space方法 例如 'normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())'
3. css取标签属性 使用::attr 例如 '.cover::attr(src)'
4. xpath取父标签的属性 使用 .. 例如 './/img[@class="cover"]/../@href'
```

#### 保存数据

##### 1.1 将数据保存成字典

````python
data = [] # 声明一个列表

for movie_data in movie:
	title = movie_data.css('.m-b-sm::text').getall()
	tags = movie_data.css('.categories span::text').getall()
	area = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[1]/text()').getall()
	time = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[3]/text()').getall()
	era = movie_data.xpath('.//div[@class="m-v-sm info"][2]/span/text()').getall()
	score = movie_data.xpath('normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())').getall()
	img = movie_data.css('.cover::attr(src)').getall()
	detail_url = movie_data.xpath('.//img[@class="cover"]/../@href').getall()
	movie_data = {'title': title, 'tags': tags, 'area': area, 'time': time, 'era': era, 'score': score, 'img': img, 'detail_url': detail_url}
	data.append(movie_data)

# 结果如下
[{'title': ['霸王别姬 - Farewell My Concubine'],
  'tags': ['剧情', '爱情'],
  'area': ['中国内地、中国香港'],
  'time': ['171 分钟'],
  'era': ['1993-07-26 上映'],
  'score': ['9.5'],
  'img': ['https://p0.net/472.jpg'],
  'detail_url': ['/detail/1']},
 {'title': ['这个杀手不太冷 - Léon'],
  'tags': ['剧情', '动作', '犯罪'],
  'area': ['法国'],
  'time': ['110 分钟'],
  'era': ['1994-09-14 上映'],
  'score': ['9.5'],
  'img': ['https://p0.net/473.jpg'],
  'detail_url': ['/detail/2']}]
````

#### 多线程

#### 乱码问题

##### 错误一

**错误描述**

> `UnicodeDecodeError: 'utf-8' codec can't decode byte 0xbc in position 32: invalid start byte`

**错误原因**

> 不能使用 `utf-8` 进行解码，网站不是使用 `utf-8` 进行编码的，因此，使用 `utf-8` 解码出现问题也在情理之中

**解决方法**

![WX20220121-192717@2x](https://gitee.com/peter95535/image-bed/raw/master/img/WX20220121-192717@2x.png)

> 1. 找到元素选项卡，搜索 `charset` ，查看编码方式，解码即可
> 2. 解码代码 `.content.decode('编码方式')`
>    + 如 `.content.decode('gbk')` 即可

#### 函数辨析

##### `content` 和 `text`

**联系**

> 1. 都可以接收网页对象

**区别**

> 1. `content` 返回的是 `byte` 型的数据，需要手动进行解码
> 2. `text` 返回的是解码之后的文本，但是，有时候会因为解码方式不对，而产生乱码问题
> 3. 一般来说，`content` 返回非文本信息（视频、图片等）多一些，而 `text` 返回文本类型数据多一些

#### 语法问题

##### 数字前方补 `0` 问题

**问题描述**

> 1. 生成具有规律的多个 `URL` 字符串 `https://www.booktxt.net/8_8455/3222xxx.html`
> 2. `xxx` 的范围从 `069~156` ，因此，当数字不满 `3` 位数的时候，需要补前置 `0`

**解决方案**

```python
# "%03d" 表示数字占据3个字符位置，如果不满3个，前方补0即可
[f'https://www.booktxt.net/8_8455/3222{"%03d" % i}.html' for i in range(69, 157)]
```

##### 拼接 `URL` 问题

**问题描述**

> 1. 凭借的 `URL` 含有重复部分的问题，例如 `url = 'https://www.booktxt.net/8_8455/'`，`chapter_url = '/8_8455/595700902.html'`
> 2. 将两者拼接起来，希望是 `https://www.booktxt.net/8_8455/595700902.html` 而不是 `https://www.booktxt.net/8_8455//8_8455/595700902.html`，<font style="color: red">**注意两个 `URL` 的区别**</font>

**解决方案**

```python
# 导入相关库
from urllib.parse import urljoin

url = 'https://www.booktxt.net/8_8455/'
chapter_url = '/8_8455/595700902.html'
chapter_url = urljoin(url, chapter_url)
```

##### 列表问题

###### 修改列表元素问题

**问题描述**

> 列表 `list` 中有元素如下 `list = [1, 2, 3]`，现在需要更改其中的元素的值，使其变成 `list = [1, 4, 9]`

**解决方案**

```python
# 使用下标修改值，不要使用迭代器即可
for i in range(len(list)):
    list[i] = list[i] * list[i]
```

###### 列表删除问题

**问题描述**

> 列表 list = [1, 4, 9]，删除前面一个数字和最后一个数字

**解决方案**

```python
# 左闭右开
list = list[2: -1]
```

#### end
