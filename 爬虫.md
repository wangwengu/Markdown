#### `Scrapy Selector` 选择器

```html
<div data-v-7f856186="" class="el-card item">
    <div class="el-card__body">
        <div data-v-7f856186="" class="el-row">
            <div data-v-7f856186="" class="el-col el-col-24">
                <a data-v-7f856186="" href="/detail/1" class="">
                    <img data-v-7f856186="" src="https://p0.net/472.jpg" class="cover">
                </a>
            </div>
            <div data-v-7f856186="" class="p-h el-col el-col-24">
                <a data-v-7f856186="" href="/detail/1" class="name">
                    <h2 data-v-7f856186="" class="m-b-sm">霸王别姬 - Farewell My Concubine</h2>
                </a>
                <div data-v-7f856186="" class="categories">
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>剧情</span>
                    </button>
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>爱情</span>
                    </button>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">中国内地、中国香港</span>
                    <span data-v-7f856186=""> / </span>
                    <span data-v-7f856186="">171 分钟</span>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">1993-07-26 上映</span>
                </div>
            </div>
            <div data-v-7f856186="" class="el-col el-col-24">
                <p data-v-7f856186="" class="score m-t-md m-b-n-sm">
                    9.5</p>
           	</div>
            
        </div>
    </div>
</div>
<div data-v-7f856186="" class="el-card item" >
	<div class="el-card__body">
        <div data-v-7f856186="" class="el-row">
            <div data-v-7f856186="" class="el-col el-col-24">
                <a data-v-7f856186="" href="/detail/2" class="">
                    <img data-v-7f856186="" src="https://p0.net/473.jpg" class="cover">
                </a>
            </div>
            <div data-v-7f856186="" class="p-h el-col el-col-24">
                <a data-v-7f856186="" href="/detail/2" class="name">
                    <h2 data-v-7f856186="" class="m-b-sm">这个杀手不太冷 - Léon</h2>
                </a>
                <div data-v-7f856186="" class="categories">
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>剧情</span>
                    </button>
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>动作</span>
                    </button>

                    <button data-v-7f856186="" type="button" class="el-button category">
                       	<span>犯罪</span>
                    </button>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">法国</span>
                    <span data-v-7f856186=""> / </span>
                    <span data-v-7f856186="">110 分钟</span>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">1994-09-14 上映</span>
                </div>
            </div>
            <div data-v-7f856186="" class="el-col el-col-24">
                <p data-v-7f856186="" class="score m-t-md m-b-n-sm">
                    9.5</p>
            </div>
        </div>
    </div>
</div>
```

##### 1.1 初始化选择器

```python
from scrapy import Selector
# html就是上述文本 以下所有示例基于以上html文本
response = Selector(text = html)
```

##### 1.2 将每部电影的选择器取出来

```python
movie = response.xpath('//div[@class="el-card item"]')
# 结果如下 一共两部电影 故有两个选择器
[<Selector xpath='//div[@class="el-card item"]' data='<div data-v-7f856186="" class="el-car...'>,
 <Selector xpath='//div[@class="el-card item"]' data='<div data-v-7f856186="" class="el-car...'>]
```

##### 1.3 将每部电影的信息提取出来

```python
for movie_data in movie:
	title = movie_data.css('.m-b-sm::text').getall()
	tags = movie_data.css('.categories span::text').getall()
	area = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[1]/text()').getall()
	time = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[3]/text()').getall()
	era = movie_data.xpath('.//div[@class="m-v-sm info"][2]/span/text()').getall()
	score = movie_data.xpath('normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())').getall()
	img = movie_data.css('.cover::attr(src)').getall()
	detail_url = movie_data.xpath('.//img[@class="cover"]/../@href').getall()
    # xpath使用id [@id="名称"]
    # xpath使用class [@class="名称"]
	movie_data = {'title': title, 'tags': tags, 'area': area, 'time': time, 'era': era, 'score': score, 'img': img, 'detail_url': detail_url}
	print(title, tags, area, time, era, score, img, detail_url)

# 结果如下
['霸王别姬 - Farewell My Concubine'] ['剧情', '爱情'] ['中国内地、中国香港'] ['171 分钟'] ['1993-07-26 上映'] ['9.5'] ['https://p0.net/472.jpg'] ['/detail/1']
['这个杀手不太冷 - Léon'] ['剧情', '动作', '犯罪'] ['法国'] ['110 分钟'] ['1994-09-14 上映'] ['9.5'] ['https://p0.net/473.jpg'] ['/detail/2']
```

###### 1.3.1 注意点

```markdown
1. xpath只想取出当前选择器下的某个标签的内容的话 使用. 例如 './/div[@class="m-v-sm info"][1]/span[1]/text()'
2. xpath去除空格或者回车 使用 normalize-space方法 例如 'normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())'
3. css取标签属性 使用::attr 例如 '.cover::attr(src)'
4. xpath取父标签的属性 使用 .. 例如 './/img[@class="cover"]/../@href'
```

#### 保存数据

##### 1.1 将数据保存成字典

````python
data = [] # 声明一个列表

for movie_data in movie:
	title = movie_data.css('.m-b-sm::text').getall()
	tags = movie_data.css('.categories span::text').getall()
	area = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[1]/text()').getall()
	time = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[3]/text()').getall()
	era = movie_data.xpath('.//div[@class="m-v-sm info"][2]/span/text()').getall()
	score = movie_data.xpath('normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())').getall()
	img = movie_data.css('.cover::attr(src)').getall()
	detail_url = movie_data.xpath('.//img[@class="cover"]/../@href').getall()
	movie_data = {'title': title, 'tags': tags, 'area': area, 'time': time, 'era': era, 'score': score, 'img': img, 'detail_url': detail_url}
	data.append(movie_data)

# 结果如下
[{'title': ['霸王别姬 - Farewell My Concubine'],
  'tags': ['剧情', '爱情'],
  'area': ['中国内地、中国香港'],
  'time': ['171 分钟'],
  'era': ['1993-07-26 上映'],
  'score': ['9.5'],
  'img': ['https://p0.net/472.jpg'],
  'detail_url': ['/detail/1']},
 {'title': ['这个杀手不太冷 - Léon'],
  'tags': ['剧情', '动作', '犯罪'],
  'area': ['法国'],
  'time': ['110 分钟'],
  'era': ['1994-09-14 上映'],
  'score': ['9.5'],
  'img': ['https://p0.net/473.jpg'],
  'detail_url': ['/detail/2']}]
````

#### 多线程

#### `PlayWright` 的使用

##### 安装

> 1. 在 `Terminal` 输入命令【<font style="color: red">**注意 `python` 的使用环境，默认使用  `base` 环境，可自行修改环境**</font>】
>
>    ```bash
>    # 升级pip
>    pip install --upgrade pip
>    # 安装playwright
>    pip install playwright
>    # 使用playwright安装相关信息【一定不能忘】
>    playwright install
>    ```

##### 教程

> 1. 打开 `Terminal`【记得切换回安装 `playwright` 的 `python` 环境】，输入命令
>
>    ```bash
>    # 注意!后面有空格
>    ! python3 -m playwright codegen
>    ```
>
> 2. 在弹出的浏览器中进行响应的操作即可
>
> 3. 在 `Playwright Inspector` 查看所操作的 `python` 代码，可进行相对应的代码转换
>
>    ![2121005](https://gitee.com/peter95535/image-bed/raw/master/img/2121005.png)
>    
> 4. 代码

#### 乱码问题

##### 错误一

**错误描述**

> `UnicodeDecodeError: 'utf-8' codec can't decode byte 0xbc in position 32: invalid start byte`

**错误原因**

> 不能使用 `utf-8` 进行解码，网站不是使用 `utf-8` 进行编码的，因此，使用 `utf-8` 解码出现问题也在情理之中

**解决方法**

![WX20220121-192717@2x](https://gitee.com/peter95535/image-bed/raw/master/img/WX20220121-192717@2x.png)

> 1. 找到元素选项卡，搜索 `charset` ，查看编码方式，解码即可
> 2. 解码代码 `.content.decode('编码方式')`
>    + 如 `.content.decode('gbk')` 即可

#### 函数辨析

##### `content` 和 `text`

**联系**

> 1. 都可以接收网页对象

**区别**

> 1. `content` 返回的是 `byte` 型的数据，需要手动进行解码
> 2. `text` 返回的是解码之后的文本，但是，有时候会因为解码方式不对，而产生乱码问题
> 3. 一般来说，`content` 返回非文本信息（视频、图片等）多一些，而 `text` 返回文本类型数据多一些

#### 语法问题

##### 数字前方补 `0` 问题

**问题描述**

> 1. 生成具有规律的多个 `URL` 字符串 `https://www.booktxt.net/8_8455/3222xxx.html`
> 2. `xxx` 的范围从 `069~156` ，因此，当数字不满 `3` 位数的时候，需要补前置 `0`

**解决方案**

```python
# "%03d" 表示数字占据3个字符位置，如果不满3个，前方补0即可
[f'https://www.booktxt.net/8_8455/3222{"%03d" % i}.html' for i in range(69, 157)]
```

##### 拼接 `URL` 问题

**问题描述**

> 1. 凭借的 `URL` 含有重复部分的问题，例如 `url = 'https://www.booktxt.net/8_8455/'`，`chapter_url = '/8_8455/595700902.html'`
> 2. 将两者拼接起来，希望是 `https://www.booktxt.net/8_8455/595700902.html` 而不是 `https://www.booktxt.net/8_8455//8_8455/595700902.html`，<font style="color: red">**注意两个 `URL` 的区别**</font>

**解决方案**

```python
# 导入相关库
from urllib.parse import urljoin

url = 'https://www.booktxt.net/8_8455/'
chapter_url = '/8_8455/595700902.html'
chapter_url = urljoin(url, chapter_url)
```

##### 列表问题

###### 修改列表元素问题

**问题描述**

> 列表 `list` 中有元素如下 `list = [1, 2, 3]`，现在需要更改其中的元素的值，使其变成 `list = [1, 4, 9]`

**解决方案**

```python
# 使用下标修改值，不要使用迭代器即可
for i in range(len(list)):
    list[i] = list[i] * list[i]
```

###### 列表删除问题

**问题描述**

> 列表 list = [1, 4, 9]，删除前面一个数字和最后一个数字

**解决方案**

```python
# 左闭右开
list = list[2: -1]
```

###### 列表添加前后缀问题

**问题描述**

> 针对三个列表 `a = [2022]`，列表 `b = [2]`，列表 `c = ['1', '2', '3']`，将其变成列表 `d = [2022-02-01, 2022-02-02, 2022-02-03]`

**解决方案**

```python
# 保险起见，统一转换成int类型
d = ['%04d-%02d-%02d' % (int(a), int(b), int(i)) for i in c]
```

##### 压缩问题

**问题描述**

> 针对列表 `a = [1, 2, 3]`，列表 `b = [a, b, c]`，将其压缩成字典 `dist = {a: 1, b: 2, c: 3}`

**解决方案**

```python
# 定义名称的时候，不要使用dict作为变量，否则，python会认为dict不是一个函数而是一个变量
d = dict(zip(a, b))
```

##### 定时器

**问题描述**

> 爬虫分为 `3` 个步骤，前两个步骤已经完成，第三个步骤需要某一个特定的时间去完成，并且在等待第三个步骤的时候，第一个和第二个步骤仍然在运行

**解决方案**

**方案一**

```python
# 导入时间模块
import datetime
# 获取当前的时间并将其格式转变
# 注意strptime和strftime函数的不同
# 这两个函数名称非常相近
start_time = datetime.datetime.strptime(datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S'), '%Y-%m-%d %H:%M:%S')
# 设定未来某一天的时间并将其格式转变
end_time = datetime.datetime.strptime('2022-02-13 13:05:00', '%Y-%m-%d %H:%M:%S')
# 计算两者相差的秒数
seconds = (end_time - start_time).seconds
# 循环即可
```

##### 日期问题

**问题描述**

> 针对列表 `a = ['2022-02-13', '2022-02-14']`，判断 `a` 中的每一个日期是星期几并使用列表 `d` 来接收

**解决方案**

```python
# 1. %w表示星期几【小写w】
# 2. 注意星期天的话返回为0
d = [int(datetime.datetime.strptime(i, '%Y-%m-%d').strftime('%w')) for i in a]
# 3. %W表示第几周【大写W并且表示的是今年的第几周】
# 4. 周数下标从0开始，因此，真正的周数需要➕1
d = [int(datetime.datetime.strptime(i, '%Y-%m-%d').strftime('%W')) + 1 for i in a]
```

#### 配置问题

##### `Chromium`

###### 错误一

**错误描述**

> `chromium` 缺少 `Google API` 密钥，因此 `chromium` 的部分功能将无法使用

**错误原因**

> 没有配置 `Google API` 密钥

**解决办法**

> 1. 申请 `Google API` 密钥【<font style="color: red">**记住第三步生成的密钥**</font>】
>
>    + 打开[链接](https://console.cloud.google.com/home/dashboard?project=oauth2-341016)
>
>    + 第一步
>
>      ![2120821](https://gitee.com/peter95535/image-bed/raw/master/img/2120821.png)
>
>    + 第二步
>
>      ![2120824](https://gitee.com/peter95535/image-bed/raw/master/img/2120824.png)
>
>    + 第三步
>
>      ![2120825](https://gitee.com/peter95535/image-bed/raw/master/img/2120825.png)
>
> 2. 申请 `OAuth 2.0 Client` 账号【<font style="color: red">**记住第四步生成的客户端账号和密码**</font>】
>
>    + 打开[链接](https://console.cloud.google.com/home/dashboard?project=oauth2-341016)
>
>    + 第一步
>
>      ![2120832](https://gitee.com/peter95535/image-bed/raw/master/img/2120832.png)
>
>    + 第二步
>
>      ![2120834](https://gitee.com/peter95535/image-bed/raw/master/img/2120834.png)
>
>    + 第三步
>
>      ![2120837](https://gitee.com/peter95535/image-bed/raw/master/img/2120837.png)
>
>    + 第四步
>
>      ![2120838](https://gitee.com/peter95535/image-bed/raw/master/img/2120838.png)
>
> 3. 在配置 Macos 的终端输入命令
>
>    + 第一步
>
>      ```bash
>      mv /Applications/Chromium.app/Contents/MacOS/Chromium /Applications/Chromium.app/Contents/MacOS/Chromium_bin
>      ```
>
>    + 第二步
>
>      + 输入命令 `vi /Applications/Chromium.app/Contents/MacOS/Chromium`，输入命令，保存
>
>        ```bash
>        #!/bin/bash
>                  
>        # Set up environment variables
>        export GOOGLE_API_KEY="API密钥"
>        export GOOGLE_DEFAULT_CLIENT_ID="OAuth2客户端账号"
>        export GOOGLE_DEFAULT_CLIENT_SECRET="OAuth2客户端密码"
>                  
>        # Launch Chromium
>        /Applications/Chromium.app/Contents/MacOS/Chromium_bin
>        ```
>
>    + 第三步
>
>      ```bash
>      # 添加可执行权限
>      chmod +x /Applications/Chromium.app/Contents/MacOS/Chromium
>      ```
>
> 4. 重启 `Chromium` 浏览器即可

#### python 环境

##### Conda

###### 安装

> 1. 选择版本安装 `wget 版本地址` [仓库地址](https://repo.anaconda.com/archive/)
> 2. 添加可执行权限 `chmod +x 名称`
> 3. 执行安装命令 `./名称`

###### 基本使用

> 1. 创建环境 `conda create -n 虚拟环境名称 python=版本号`
> 2. 激活环境 `conda activate 名称`
> 3. 查看环境 `conda info -e`
> 4. 退出环境 `conda deactivate`
> 5. 删除环境 `conda remove -n 环境名 --all`
> 6. 取消自动进入环境 `conda config --set auto_activate_base false`
> 7. 指定 `Python` 运行环境【第一行】 `#!/路径/bin/python`
>    + 例如 `#!/home/ubuntu/anaconda3/envs/spider/bin/python3`

#### end
