### 目录

#### 第一章 Scrapy Selector 选择器

```html
<div data-v-7f856186="" class="el-card item">
    <div class="el-card__body">
        <div data-v-7f856186="" class="el-row">
            <div data-v-7f856186="" class="el-col el-col-24">
                <a data-v-7f856186="" href="/detail/1" class="">
                    <img data-v-7f856186="" src="https://p0.net/472.jpg" class="cover">
                </a>
            </div>
            <div data-v-7f856186="" class="p-h el-col el-col-24">
                <a data-v-7f856186="" href="/detail/1" class="name">
                    <h2 data-v-7f856186="" class="m-b-sm">霸王别姬 - Farewell My Concubine</h2>
                </a>
                <div data-v-7f856186="" class="categories">
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>剧情</span>
                    </button>
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>爱情</span>
                    </button>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">中国内地、中国香港</span>
                    <span data-v-7f856186=""> / </span>
                    <span data-v-7f856186="">171 分钟</span>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">1993-07-26 上映</span>
                </div>
            </div>
            <div data-v-7f856186="" class="el-col el-col-24">
                <p data-v-7f856186="" class="score m-t-md m-b-n-sm">
                    9.5</p>
           	</div>
            
        </div>
    </div>
</div>
<div data-v-7f856186="" class="el-card item" >
	<div class="el-card__body">
        <div data-v-7f856186="" class="el-row">
            <div data-v-7f856186="" class="el-col el-col-24">
                <a data-v-7f856186="" href="/detail/2" class="">
                    <img data-v-7f856186="" src="https://p0.net/473.jpg" class="cover">
                </a>
            </div>
            <div data-v-7f856186="" class="p-h el-col el-col-24">
                <a data-v-7f856186="" href="/detail/2" class="name">
                    <h2 data-v-7f856186="" class="m-b-sm">这个杀手不太冷 - Léon</h2>
                </a>
                <div data-v-7f856186="" class="categories">
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>剧情</span>
                    </button>
                    <button data-v-7f856186="" type="button" class="el-button category">
                        <span>动作</span>
                    </button>

                    <button data-v-7f856186="" type="button" class="el-button category">
                       	<span>犯罪</span>
                    </button>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">法国</span>
                    <span data-v-7f856186=""> / </span>
                    <span data-v-7f856186="">110 分钟</span>
                </div>
                <div data-v-7f856186="" class="m-v-sm info">
                    <span data-v-7f856186="">1994-09-14 上映</span>
                </div>
            </div>
            <div data-v-7f856186="" class="el-col el-col-24">
                <p data-v-7f856186="" class="score m-t-md m-b-n-sm">
                    9.5</p>
            </div>
        </div>
    </div>
</div>
```

##### 1.1 初始化选择器

```python
from scrapy import Selector
# html就是上述文本 以下所有示例基于以上html文本
response = Selector(text = html)
```

##### 1.2 将每部电影的选择器取出来

```python
movie = response.xpath('//div[@class="el-card item"]')
# 结果如下 一共两部电影 故有两个选择器
[<Selector xpath='//div[@class="el-card item"]' data='<div data-v-7f856186="" class="el-car...'>,
 <Selector xpath='//div[@class="el-card item"]' data='<div data-v-7f856186="" class="el-car...'>]
```

##### 1.3 将每部电影的信息提取出来

```python
for movie_data in movie:
	title = movie_data.css('.m-b-sm::text').getall()
	tags = movie_data.css('.categories span::text').getall()
	area = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[1]/text()').getall()
	time = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[3]/text()').getall()
	era = movie_data.xpath('.//div[@class="m-v-sm info"][2]/span/text()').getall()
	score = movie_data.xpath('normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())').getall()
	img = movie_data.css('.cover::attr(src)').getall()
	detail_url = movie_data.xpath('.//img[@class="cover"]/../@href').getall()
	movie_data = {'title': title, 'tags': tags, 'area': area, 'time': time, 'era': era, 'score': score, 'img': img, 'detail_url': detail_url}
	print(title, tags, area, time, era, score, img, detail_url)

# 结果如下
['霸王别姬 - Farewell My Concubine'] ['剧情', '爱情'] ['中国内地、中国香港'] ['171 分钟'] ['1993-07-26 上映'] ['9.5'] ['https://p0.net/472.jpg'] ['/detail/1']
['这个杀手不太冷 - Léon'] ['剧情', '动作', '犯罪'] ['法国'] ['110 分钟'] ['1994-09-14 上映'] ['9.5'] ['https://p0.net/473.jpg'] ['/detail/2']
```

###### 1.3.1 注意点

```markdown
1. xpath只想取出当前选择器下的某个标签的内容的话 使用. 例如 './/div[@class="m-v-sm info"][1]/span[1]/text()'
2. xpath去除空格或者回车 使用 normalize-space方法 例如 'normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())'
3. css取标签属性 使用::attr 例如 '.cover::attr(src)'
4. xpath取父标签的属性 使用 .. 例如 './/img[@class="cover"]/../@href'
```

##### 1.4 将数据保存成字典

````python
data = [] # 声明一个列表

for movie_data in movie:
	title = movie_data.css('.m-b-sm::text').getall()
	tags = movie_data.css('.categories span::text').getall()
	area = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[1]/text()').getall()
	time = movie_data.xpath('.//div[@class="m-v-sm info"][1]/span[3]/text()').getall()
	era = movie_data.xpath('.//div[@class="m-v-sm info"][2]/span/text()').getall()
	score = movie_data.xpath('normalize-space(.//p[@class="score m-t-md m-b-n-sm"]/text())').getall()
	img = movie_data.css('.cover::attr(src)').getall()
	detail_url = movie_data.xpath('.//img[@class="cover"]/../@href').getall()
	movie_data = {'title': title, 'tags': tags, 'area': area, 'time': time, 'era': era, 'score': score, 'img': img, 'detail_url': detail_url}
	data.append(movie_data)

# 结果如下
[{'title': ['霸王别姬 - Farewell My Concubine'],
  'tags': ['剧情', '爱情'],
  'area': ['中国内地、中国香港'],
  'time': ['171 分钟'],
  'era': ['1993-07-26 上映'],
  'score': ['9.5'],
  'img': ['https://p0.net/472.jpg'],
  'detail_url': ['/detail/1']},
 {'title': ['这个杀手不太冷 - Léon'],
  'tags': ['剧情', '动作', '犯罪'],
  'area': ['法国'],
  'time': ['110 分钟'],
  'era': ['1994-09-14 上映'],
  'score': ['9.5'],
  'img': ['https://p0.net/473.jpg'],
  'detail_url': ['/detail/2']}]
````



