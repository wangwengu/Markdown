

# åŸºç¡€ç®—æ³•



## æ’åº

### å¿«æ’

#### [AcWing 786. ç¬¬kä¸ªæ•°](https://www.acwing.com/problem/content/description/788/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•´æ•°æ•°åˆ—ï¼Œä»¥åŠä¸€ä¸ªæ•´æ•° `k`ï¼Œè¯·ç”¨å¿«é€Ÿé€‰æ‹©ç®—æ³•æ±‚å‡ºæ•°åˆ—ä»å°åˆ°å¤§æ’åºåçš„ç¬¬ `k` ä¸ªæ•°ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `k`ã€‚
>
> ç¬¬äºŒè¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼ˆæ‰€æœ‰æ•´æ•°å‡åœ¨ $1âˆ¼10^9$ èŒƒå›´å†…ï¼‰ï¼Œè¡¨ç¤ºæ•´æ•°æ•°åˆ—ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•°åˆ—çš„ç¬¬ `k` å°æ•°ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤nâ‰¤100000$,
> + $1â‰¤kâ‰¤n$

**è¾“å…¥æ ·ä¾‹**

```c++
5 3
2 4 1 5 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![2220937](img/2220937.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int n, k;
int g[N];
int quick_sort(int g[], int l, int r, int k) {
    if (l == r) return g[l];
    int x = g[l];
    int i = l - 1, j = r + 1;
    while (i < j) {
        // ä¸ºå•¥ä¸èƒ½å†™ç­‰å·ï¼Œå¦‚æœå…¨éƒ¨éƒ½æ˜¯ç›¸åŒå€¼ä¼šè¶Šç•Œ
        do i ++ ; while(g[i] < x);
        do j -- ; while(g[j] > x);
        if (i < j) swap(g[i], g[j]);
    }
    // ç»Ÿè®¡å·¦è¾¹å°äºç­‰äºxçš„æ•°ç›®
    int sl = j - l + 1;
    // é€’å½’å·¦åŒºé—´
    if (k <= sl) return quick_sort(g, l, j, k);
    // é€’å½’å³åŒºé—´
    return quick_sort(g, j + 1, r, k - sl);
}
int main() {
    scanf("%d%d", &n, &k);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &g[i]);
    cout << quick_sort(g, 1, n, k) << endl;
    return 0;
}
```

**æ ‡ç­¾**

`å¿«é€Ÿæ’åº`ã€`å¿«é€Ÿé€‰æ‹©ç®—æ³•`

#### [LeetCode 324. æ‘†åŠ¨æ’åº II](https://leetcode-cn.com/problems/wiggle-sort-ii/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œå°†å®ƒé‡æ–°æ’åˆ—æˆ `nums[0] < nums[1] > nums[2] < nums[3]...` çš„é¡ºåºã€‚
>
> ä½ å¯ä»¥å‡è®¾æ‰€æœ‰è¾“å…¥æ•°ç»„éƒ½å¯ä»¥å¾—åˆ°æ»¡è¶³é¢˜ç›®è¦æ±‚çš„ç»“æœã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`nums = [1,5,1,1,6,4]`
> è¾“å‡ºï¼š`[1,6,1,5,1,4]`
> è§£é‡Šï¼š`[1,4,1,5,1,6]` åŒæ ·æ˜¯ç¬¦åˆé¢˜ç›®è¦æ±‚çš„ç»“æœï¼Œå¯ä»¥è¢«åˆ¤é¢˜ç¨‹åºæ¥å—ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`nums = [1,3,2,2,3,1]`
> è¾“å‡ºï¼š`[2,3,1,3,1,2]`

**æç¤º**

> + $1 <= nums.length <= 5 * 10^4$
> + $0 <= nums[i] <= 5000$
> + $é¢˜ç›®æ•°æ®ä¿è¯ï¼Œå¯¹äºç»™å®šçš„è¾“å…¥ nums ï¼Œæ€»èƒ½äº§ç”Ÿæ»¡è¶³é¢˜ç›®è¦æ±‚çš„ç»“æœ$

**è¿›é˜¶**

> ä½ èƒ½ç”¨ `O(n)` æ—¶é—´å¤æ‚åº¦å’Œ / æˆ–åŸåœ° `O(1)` é¢å¤–ç©ºé—´æ¥å®ç°å—ï¼Ÿ

**æ‰‹å†™ç¨¿**

![311119](img/311119.png)

**ä»£ç **

```c++
class Solution {
public:
    void wiggleSort(vector<int>& nums) {
        int n = nums.size();
        // æ‰¾åˆ°ä¸­ä½æ•°çš„è¿­ä»£å™¨
        auto midptr = nums.begin() + n / 2;
        nth_element(nums.begin(), midptr, nums.end());
        int mid = *midptr;
        // ä¸‰æ•°æ’åºï¼ŒåŒLeetCode75é¢˜
        for (int i = 0, j = 0, k = n - 1; i <= k; ) {
            if (nums[i] < mid) swap(nums[i ++ ], nums[j ++ ]);
            else if (nums[i] == mid) i ++;
            else swap(nums[i], nums[k --]);
        }
        if (n & 1) ++ midptr;
        auto left = vector<int>(nums.begin(), midptr);
        // é€†åº
        reverse(left.begin(), left.end());
        auto right = vector<int>(midptr, nums.end());
        // é€†åº
        reverse(right.begin(), right.end());
        // å°†å‰åŠéƒ¨åˆ†æ”¾ç½®åœ¨å¶æ•°ä½ç½®
        for (int i = 0; i < left.size(); i ++ ) nums[i * 2] = left[i];
        // å°†ååŠéƒ¨åˆ†æ”¾ç½®åœ¨å¥‡æ•°ä½ç½®
        for (int i = 0; i < right.size(); i ++ ) nums[i * 2 + 1] = right[i];
        return;
    }
};
```

**æ ‡ç­¾**

`å¿«é€Ÿé€‰æ‹©æ’åº`

### è®¡æ•°æ’åº

#### åŸç†

**ç®€ä»‹**

>   è®¡æ•°æ’åºä¸æ˜¯åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œå…¶æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚

**åŠ¨å›¾æ¼”ç¤º**

![v2-3c7ddb59df2d21b287e42a7b908409cb_b](img/v2-3c7ddb59df2d21b287e42a7b908409cb_b.gif)

#### [LeetCode 347. å‰ K ä¸ªé«˜é¢‘å…ƒç´ ](https://leetcode-cn.com/problems/top-k-frequent-elements/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `k` ï¼Œè¯·ä½ è¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ `k` é«˜çš„å…ƒç´ ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `nums = [1,1,1,2,2,3], k = 2`
>   è¾“å‡º: `[1,2]`

**ç¤ºä¾‹ 2**

>   è¾“å…¥: `nums = [1], k = 1`
>   è¾“å‡º: `[1]`

**æç¤º**

>   +   $1 <= nums.length <= 10^5$
>   +   $k çš„å–å€¼èŒƒå›´æ˜¯ [1, æ•°ç»„ä¸­ä¸ç›¸åŒçš„å…ƒç´ çš„ä¸ªæ•°]$
>   +   $é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆå”¯ä¸€ï¼Œæ¢å¥è¯è¯´ï¼Œæ•°ç»„ä¸­å‰ k ä¸ªé«˜é¢‘å…ƒç´ çš„é›†åˆæ˜¯å”¯ä¸€çš„$

**è¿›é˜¶**

>   ä½ æ‰€è®¾è®¡ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ å¿…é¡» ä¼˜äº `O(n log n)` ï¼Œå…¶ä¸­ `n` æ˜¯æ•°ç»„å¤§å°ã€‚

**æ‰‹å†™ç¨¿**

![340943](img/340943.png)

**ä»£ç **

```c++
class Solution {
public:
    vector<int> topKFrequent(vector<int>& nums, int k) {
        unordered_map<int, int> cnt;
        int n = nums.size();
        // ç»Ÿè®¡æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°
        for (auto& num : nums) cnt[num] ++;
        vector<int> s(n + 1);
        for (auto [x, c] : cnt) s[c] ++;
        int i = n, t = 0;
        while (t < k) t += s[i --];
        vector<int> res;
        for (auto [x, c] : cnt)
            if (c > i) res.push_back(x);
        return res;
    }
};
```

**æ ‡ç­¾**

`è®¡æ•°æ’åº`

### å½’å¹¶æ’åº

#### å¤šè·¯å½’å¹¶

##### [LeetCode 355. è®¾è®¡æ¨ç‰¹](https://leetcode-cn.com/problems/design-twitter/)

**é¢˜ç›®æè¿°**

>   è®¾è®¡ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ¨ç‰¹`(Twitter)`ï¼Œå¯ä»¥è®©ç”¨æˆ·å®ç°å‘é€æ¨æ–‡ï¼Œå…³æ³¨/å–æ¶ˆå…³æ³¨å…¶ä»–ç”¨æˆ·ï¼Œèƒ½å¤Ÿçœ‹è§å…³æ³¨äººï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰çš„æœ€è¿‘ `10` æ¡æ¨æ–‡ã€‚
>
>   å®ç° `Twitter` ç±»ï¼š
>
>   +   `Twitter()` åˆå§‹åŒ–ç®€æ˜“ç‰ˆæ¨ç‰¹å¯¹è±¡
>   +   `void postTweet(int userId, int tweetId)` æ ¹æ®ç»™å®šçš„ `tweetId` å’Œ `userId` åˆ›å»ºä¸€æ¡æ–°æ¨æ–‡ã€‚æ¯æ¬¡è°ƒç”¨æ­¤å‡½æ•°éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ `tweetId` ã€‚
>   +   `List<Integer> getNewsFeed(int userId)` æ£€ç´¢å½“å‰ç”¨æˆ·æ–°é—»æ¨é€ä¸­æœ€è¿‘  `10` æ¡æ¨æ–‡çš„ `ID` ã€‚æ–°é—»æ¨é€ä¸­çš„æ¯ä¸€é¡¹éƒ½å¿…é¡»æ˜¯ç”±ç”¨æˆ·å…³æ³¨çš„äººæˆ–è€…æ˜¯ç”¨æˆ·è‡ªå·±å‘å¸ƒçš„æ¨æ–‡ã€‚æ¨æ–‡å¿…é¡» æŒ‰ç…§æ—¶é—´é¡ºåºç”±æœ€è¿‘åˆ°æœ€è¿œæ’åº ã€‚
>   +   `void follow(int followerId, int followeeId)` `ID` ä¸º `followerId` çš„ç”¨æˆ·å¼€å§‹å…³æ³¨ `ID` ä¸º `followeeId` çš„ç”¨æˆ·ã€‚
>   +   `void unfollow(int followerId, int followeeId)` `ID` ä¸º `followerId` çš„ç”¨æˆ·ä¸å†å…³æ³¨ `ID` ä¸º `followeeId` çš„ç”¨æˆ·ã€‚

**ç¤ºä¾‹**

>   è¾“å…¥
>   `["Twitter", "postTweet", "getNewsFeed", "follow", "postTweet", "getNewsFeed", "unfollow", "getNewsFeed"]
>   [[], [1, 5], [1], [1, 2], [2, 6], [1], [1, 2], [1]]`
>   è¾“å‡º
>   `[null, null, [5], null, null, [6, 5], null, [5]]`
>
>   è§£é‡Š
>   `Twitter twitter = new Twitter();`
>   `twitter.postTweet(1, 5);` // ç”¨æˆ· `1` å‘é€äº†ä¸€æ¡æ–°æ¨æ–‡ (ç”¨æˆ· `id = 1`, æ¨æ–‡ `id = 5`)
>   `twitter.getNewsFeed(1);`  // ç”¨æˆ· `1` çš„è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª `id` ä¸º `5` çš„æ¨æ–‡
>   `twitter.follow(1, 2);`    // ç”¨æˆ· `1` å…³æ³¨äº†ç”¨æˆ· `2`
>   `twitter.postTweet(2, 6);` // ç”¨æˆ· `2` å‘é€äº†ä¸€ä¸ªæ–°æ¨æ–‡ (æ¨æ–‡ `id = 6`)
>   `twitter.getNewsFeed(1);`  // ç”¨æˆ· `1` çš„è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæ¨æ–‡ï¼Œ`id` åˆ†åˆ«ä¸º `-> [6, 5] `ã€‚æ¨æ–‡ `id 6` åº”å½“åœ¨æ¨æ–‡ `id 5` ä¹‹å‰ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ `5` ä¹‹åå‘é€çš„
>   `twitter.unfollow(1, 2);`  // ç”¨æˆ· `1` å–æ¶ˆå…³æ³¨äº†ç”¨æˆ· `2`
>   `twitter.getNewsFeed(1);`  // ç”¨æˆ· `1` è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª `id` ä¸º `5` çš„æ¨æ–‡ã€‚å› ä¸ºç”¨æˆ· `1` å·²ç»ä¸å†å…³æ³¨ç”¨æˆ· `2`

**æç¤º**

>   +   $1 <= userId, followerId, followeeId <= 500$
>   +   $0 <= tweetId <= 10^4$
>   +   $æ‰€æœ‰æ¨ç‰¹çš„ ID éƒ½äº’ä¸ç›¸åŒ$
>   +   $postTweetã€getNewsFeedã€follow å’Œ unfollow æ–¹æ³•æœ€å¤šè°ƒç”¨ 3 * 10^4 æ¬¡$

**æ‰‹å†™ç¨¿**

![342158](img/342158.png)

**ä»£ç **

```c++
typedef pair<int, int> PII;
#define x first
#define y second
class Twitter {
public:
    // å­˜å‚¨å‘å¸ƒæ¨æ–‡ä¿¡æ¯
    unordered_map<int, vector<PII>> tweets;
    // å­˜å‚¨ç”¨æˆ·çš„å…³æ³¨åˆ—è¡¨
    unordered_map<int, unordered_set<int>> followers;
    // æ—¶é—´æˆ³
    int ts;
    Twitter() {
        ts = 0;
    }
    
    void postTweet(int userId, int tweetId) {
        tweets[userId].push_back({ts ++ , tweetId});
        return;
    }
    
    vector<int> getNewsFeed(int u) {
        // å¤šè·¯å½’å¹¶
        priority_queue<vector<int>> heap;
        followers[u].insert(u);
        // éå†uçš„æ‰€æœ‰å…³æ³¨è€…ã€åŒ…æ‹¬è‡ªå·±ã€‘ï¼Œå…¶åŸå› æ˜¯å› ä¸ºè‡ªå·±çš„æ¨æ–‡ä¹Ÿç®—åœ¨æœ€æ–°çš„10æ¡æ¨æ–‡å†…
        for (auto user : followers[u]) {
            // è·å–å½“å‰ç”¨æˆ·æ‰€æœ‰æ¨æ–‡
            auto& ts = tweets[user];
            // å¦‚æœå½“å‰ç”¨æˆ·è¿˜æœ‰å‰©ä½™çš„æ¨æ–‡
            if (ts.size()) {
                // æ‰¾åˆ°å½“å‰ç”¨æˆ·çš„ã€æœ€æ–°å‘å¸ƒã€‘çš„æ¨æ–‡çš„ä½ç½®ã€æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡ã€‘
                int i = ts.size() - 1;
                // ã€æ¨æ–‡å‘å¸ƒçš„æ—¶é—´ï¼Œæ¨æ–‡ç¼–å·ï¼Œæ¨æ–‡çš„ä½ç½®ï¼Œæ‰€å±ç”¨æˆ·ã€‘
                heap.push({ts[i].x, ts[i].y, i, user});
            }
        }
        vector<int> res;
        for (int i = 0; i < 10 && heap.size(); i ++ ) { // æœ€è¿‘çš„10æ¡æ¨æ–‡
            auto t = heap.top(); heap.pop();
            // è·å–æ¨æ–‡çš„ç¼–å·
            res.push_back(t[1]);
            // è·å–å½“å‰æ¨æ–‡æ‰€å±çš„ä¸‹æ ‡ä½ç½®
            int j = t[2];
            // å¦‚æœè¿˜æœ‰æ¨æ–‡
            if (j) {
                // å¤šè·¯å½’å¹¶çš„æŒ‡é’ˆå‰ç§»
                j -- ;
                // è·å–å½“å‰æ¨æ–‡æ‰€å±çš„ç”¨æˆ·
                auto& user = t[3];
                // è·å–ç”¨æˆ·çš„æ‰€æœ‰æ¨æ–‡
                auto& ts = tweets[user];
                // ä¿å­˜å½“å‰æŒ‡é’ˆå¯¹åº”çš„æ¨æ–‡çš„ä¿¡æ¯
                // ã€æ¨æ–‡å‘å¸ƒçš„æ—¶é—´ï¼Œæ¨æ–‡ç¼–å·ï¼Œæ¨æ–‡çš„ä½ç½®ï¼Œæ‰€å±ç”¨æˆ·ã€‘
                heap.push({ts[j].x, ts[j].y, j, user});
            }
        }
        return res;
    }
    
    void follow(int followerId, int followeeId) {
        followers[followerId].insert(followeeId);
        return;
    }
    
    void unfollow(int followerId, int followeeId) {
        followers[followerId].erase(followeeId);
        return;
    }
};

/**
 * Your Twitter object will be instantiated and called as such:
 * Twitter* obj = new Twitter();
 * obj->postTweet(userId,tweetId);
 * vector<int> param_2 = obj->getNewsFeed(userId);
 * obj->follow(followerId,followeeId);
 * obj->unfollow(followerId,followeeId);
 */
```

**æ ‡ç­¾**

`å¤šè·¯å½’å¹¶`

##### [LeetCode 373. æŸ¥æ‰¾å’Œæœ€å°çš„ K å¯¹æ•°å­—](https://leetcode-cn.com/problems/find-k-pairs-with-smallest-sums/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªä»¥ å‡åºæ’åˆ— çš„æ•´æ•°æ•°ç»„ `nums1` å’Œ `nums2` , ä»¥åŠä¸€ä¸ªæ•´æ•° `k` ã€‚
>
>   å®šä¹‰ä¸€å¯¹å€¼ `(u,v)`ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ¥è‡ª `nums1`ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ¥è‡ª `nums2` ã€‚
>
>   è¯·æ‰¾åˆ°å’Œæœ€å°çš„ `k` ä¸ªæ•°å¯¹ $(u_1,v_1),  (u_2,v_2)  ...  (u_k,v_k)$ ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `nums1 = [1,7,11], nums2 = [2,4,6], k = 3`
>   è¾“å‡º: `[1,2],[1,4],[1,6]`
>   è§£é‡Š: è¿”å›åºåˆ—ä¸­çš„å‰ `3` å¯¹æ•°ï¼š
>    `[1,2],[1,4],[1,6],[7,2],[7,4],[11,2],[7,6],[11,4],[11,6]`

**ç¤ºä¾‹ 2**

>   è¾“å…¥: `nums1 = [1,1,2], nums2 = [1,2,3], k = 2`
>   è¾“å‡º: `[1,1],[1,1]`
>   è§£é‡Š: è¿”å›åºåˆ—ä¸­çš„å‰ `2` å¯¹æ•°ï¼š
>    `[1,1],[1,1],[1,2],[2,1],[1,2],[2,2],[1,3],[1,3],[2,3]`

**ç¤ºä¾‹ 3**

>   è¾“å…¥: `nums1 = [1,2], nums2 = [3], k = 3`
>   è¾“å‡º: `[1,3],[2,3]`
>   è§£é‡Š: ä¹Ÿå¯èƒ½åºåˆ—ä¸­æ‰€æœ‰çš„æ•°å¯¹éƒ½è¢«è¿”å›:`[1,3],[2,3]`

**æç¤º**

>   +   $1 <= nums1.length, nums2.length <= 10^5$
>   +   $-10^9 <= nums1[i], nums2[i] <= 10^9$
>   +   $nums1 å’Œ nums2 å‡ä¸ºå‡åºæ’åˆ—$
>   +   $1 <= k <= 1000$

**æ‰‹å†™ç¨¿**

![361957](img/361957.png)

**ä»£ç **

```c++
class Solution {
public:
    vector<vector<int>> kSmallestPairs(vector<int>& a, vector<int>& b, int k) {
        if (a.empty() || b.empty()) return {};
        priority_queue<vector<int>, vector<vector<int>>, greater<vector<int>>> heap;
        int n = a.size(), m = b.size();
        for (int i = 0; i < n; i ++ ) heap.push({a[i] + b[0], i, 0});
        vector<vector<int>> res;
        // kè·¯å½’å¹¶
        while (k -- && heap.size()) {
            auto t = heap.top(); heap.pop();
            res.push_back({a[t[1]], b[t[2]]});
            // å¦‚æœå…¶ä¸­çš„æŸä¸ªæ•°ç»„å·²ç»åˆ°è¾¾æœ«å°¾ï¼Œåˆ™ã€è¯¥æ•°ç»„ã€‘ä¸éœ€è¦ç»§ç»­åç§»
            // ä½†æ˜¯ï¼Œå¯ä¸èƒ½ã€é€€å‡ºã€‘ï¼ŒåŸå› åœ¨ã€æ‰‹å†™ç¨¿ã€‘ä¸­
            if (t[2] + 1 < m)
                heap.push({a[t[1]] + b[t[2] + 1], t[1], t[2] + 1});
        }
        return res;
    }
};
```

**æ ‡ç­¾**

`ä¼˜å…ˆé˜Ÿåˆ—`ã€`Kè·¯å½’å¹¶`

### æ¡¶æ’åº

#### [LeetCode 164. æœ€å¤§é—´è·](https://leetcode-cn.com/problems/maximum-gap/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªæ— åºçš„æ•°ç»„ `nums`ï¼Œè¿”å› æ•°ç»„åœ¨æ’åºä¹‹åï¼Œç›¸é‚»å…ƒç´ ä¹‹é—´æœ€å¤§çš„å·®å€¼ ã€‚å¦‚æœæ•°ç»„å…ƒç´ ä¸ªæ•°å°äº `2`ï¼Œåˆ™è¿”å› `0` ã€‚
>
>   æ‚¨å¿…é¡»ç¼–å†™ä¸€ä¸ªåœ¨ã€Œçº¿æ€§æ—¶é—´ã€å†…è¿è¡Œå¹¶ä½¿ç”¨ã€Œçº¿æ€§é¢å¤–ç©ºé—´ã€çš„ç®—æ³•ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `nums = [3,6,9,1]`
>   è¾“å‡º: `3`
>   è§£é‡Š: æ’åºåçš„æ•°ç»„æ˜¯ `[1,3,6,9]`, å…¶ä¸­ç›¸é‚»å…ƒç´  `(3,6)` å’Œ `(6,9)` ä¹‹é—´éƒ½å­˜åœ¨æœ€å¤§å·®å€¼ `3`ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥: `nums = [10]`
>   è¾“å‡º: `0`
>   è§£é‡Š: æ•°ç»„å…ƒç´ ä¸ªæ•°å°äº `2`ï¼Œå› æ­¤è¿”å› `0`ã€‚

**æç¤º**

>   +   $1 <= nums.length <= 10^5$
>   +   $0 <= nums[i] <= 10^9$

**æ‰‹å†™ç¨¿**

![482113](img/482113.png)

**ä»£ç **

```c++
#define x first
#define y second
class Solution {
public:
    typedef pair<int, int> PII;
    int maximumGap(vector<int>& nums) {
        int n = nums.size();
        if (n < 2) return 0;
        int Max = INT_MIN, Min = INT_MAX;
        for (int i = 0; i < n; i ++ ) {
            Max = max(Max, nums[i]);
            Min = min(Min, nums[i]);
        }
        // æ•°ç»„çš„å€¼éƒ½ç›¸åŒ
        if (Max == Min) return 0;
        // æ¡¶çš„ä¸ªæ•°[æ‰‹å†™ç¨¿]
        int bk_num = n + 5;
        vector<PII> buckets(bk_num, {INT_MAX, INT_MIN});
        // æ¡¶çš„å®¹é‡[æ‰‹å†™ç¨¿]
        int bk_size = (Max - Min + bk_num - 1) / bk_num;
        // æšä¸¾æ¯ä¸ªæ•°åº”è¯¥æ”¾åœ¨å“ªä¸ªæ¡¶
        for (int i = 0; i < n; i ++ ) {
            // æŸ¥çœ‹å½“å‰æ•°å­—åº”è¯¥æ”¾å“ªä¸ªæ¡¶
            int k = (nums[i] - Min) / bk_size;
            buckets[k].x = min(buckets[k].x, nums[i]);
            buckets[k].y = max(buckets[k].y, nums[i]);
        }
        int res = -1;
        // æšä¸¾æ¯ä¸ªæ¡¶
        for (int i = 0, last = -1; i <= bk_num; i ++ ) {
            // å¦‚æœå½“å‰æ¡¶æ²¡æœ‰è¢«ç”¨è¿‡, åˆ™ç›´æ¥è·³è¿‡å³å¯
            if (buckets[i] == PII{INT_MAX, INT_MIN})
                continue;
           	// è®°å½•ä¸Šä¸€ä¸ªæ¡¶çš„ä½ç½®
            if (last != -1)
                res = max(res, buckets[i].x - buckets[last].y);
            last = i;
        }
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`ğŸª£æ’åº`ã€`æ¡¶æ’åº`

**ç¼åˆæ€ª**





## äºŒåˆ†

### æ•´æ•°äºŒåˆ†

#### æ¨¡æ¿

>   ```c++
>   bool check(int x) {/* ... */} // æ£€æŸ¥xæ˜¯å¦æ»¡è¶³æŸç§æ€§è´¨
>   
>   // æ³¨æ„ï¼ï¼ã€åŒºé—´çš„åˆ’åˆ†ã€‘ï¼ï¼
>   // åŒºé—´[l, r]è¢«åˆ’åˆ†æˆ[l, mid]å’Œ[mid + 1, r]æ—¶ä½¿ç”¨ï¼š
>   int bsearch_1(int l, int r) {
>   while (l < r) {
>       int mid = l + r >> 1;
>       if (check(mid)) r = mid;    // check()åˆ¤æ–­midæ˜¯å¦æ»¡è¶³æ€§è´¨
>       else l = mid + 1;
>   }
>   return l;
>   }
>   
>   // åŒºé—´[l, r]è¢«åˆ’åˆ†æˆ[l, mid - 1]å’Œ[mid, r]æ—¶ä½¿ç”¨ï¼š
>   int bsearch_2(int l, int r) {
>   while (l < r) {
>       int mid = l + r + 1 >> 1;
>       if (check(mid)) l = mid;
>       else r = mid - 1;
>   }
>   return l;
>   }
>   ```

#### [AcWing 789. æ•°çš„èŒƒå›´](https://www.acwing.com/problem/content/791/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„é•¿åº¦ä¸º `n` çš„æ•´æ•°æ•°ç»„ï¼Œä»¥åŠ `q` ä¸ªæŸ¥è¯¢ã€‚
>
>   å¯¹äºæ¯ä¸ªæŸ¥è¯¢ï¼Œè¿”å›ä¸€ä¸ªå…ƒç´  `k` çš„èµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®ï¼ˆä½ç½®ä» `0` å¼€å§‹è®¡æ•°ï¼‰ã€‚
>
>   å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› `-1 -1`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n` å’Œ `q`ï¼Œè¡¨ç¤ºæ•°ç»„é•¿åº¦å’Œè¯¢é—®ä¸ªæ•°ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼ˆå‡åœ¨ `1âˆ¼10000` èŒƒå›´å†…ï¼‰ï¼Œè¡¨ç¤ºå®Œæ•´æ•°ç»„ã€‚
>
>   æ¥ä¸‹æ¥ `q` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `k`ï¼Œè¡¨ç¤ºä¸€ä¸ªè¯¢é—®å…ƒç´ ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…± `q` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€æ±‚å…ƒç´ çš„èµ·å§‹ä½ç½®å’Œç»ˆæ­¢ä½ç½®ã€‚
>
>   å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› `-1 -1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100000$
>   +   $1â‰¤qâ‰¤10000$
>   +   $1â‰¤kâ‰¤10000$

**è¾“å…¥æ ·ä¾‹**

```c++
6 3
1 2 2 3 3 4
3
4
5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3 4
5 5
-1 -1
```

**æ‰‹å†™ç¨¿**

![3171148](img/3171148.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int n, m;
int g[N];
int main(){
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n; i ++ ) scanf("%d", &g[i]);
    while (m -- ) {
        int x;
        scanf("%d", &x);
        // å¯»æ‰¾å·¦ç«¯ç‚¹
        int l = 0, r = n - 1;
        int L, R;
        while (l < r) {
            int mid = l + r >> 1;
            // å¯»æ‰¾å¤§äºç­‰äºxçš„æœ€å°å€¼
            if (g[mid] >= x) r = mid;
            else l = mid + 1;
        }
        if (g[l] != x) cout << -1 << " " << -1 << endl;
        else {
            // å¯»æ‰¾å³ç«¯ç‚¹
            L = l;
            l = 0, r = n - 1;
            while (l < r) {
                int mid = l + r + 1 >> 1;
                // å¯»æ‰¾å°äºç­‰äºxçš„æœ€å¤§å€¼
                if (g[mid] <= x) l = mid;
                else r = mid - 1;
            }
            R = r;
            cout << L << " " << R << endl;
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`äºŒåˆ†`ã€`æ•´æ•°äºŒåˆ†`

**ç¼åˆæ€ª**



#### [LeetCode 378. æœ‰åºçŸ©é˜µä¸­ç¬¬ K å°çš„å…ƒç´ ](https://leetcode-cn.com/problems/kth-smallest-element-in-a-sorted-matrix/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ª `n x n` çŸ©é˜µ `matrix` ï¼Œå…¶ä¸­æ¯è¡Œå’Œæ¯åˆ—å…ƒç´ å‡æŒ‰å‡åºæ’åºï¼Œæ‰¾åˆ°çŸ©é˜µä¸­ç¬¬ `k` å°çš„å…ƒç´ ã€‚
>   è¯·æ³¨æ„ï¼Œå®ƒæ˜¯ æ’åºå çš„ç¬¬ `k` å°å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ `k` ä¸ª ä¸åŒ çš„å…ƒç´ ã€‚
>
>   ä½ å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªå†…å­˜å¤æ‚åº¦ä¼˜äº $O(n^2)$ çš„è§£å†³æ–¹æ¡ˆã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`matrix = [[1,5,9],[10,11,13],[12,13,15]], k = 8`
>   è¾“å‡ºï¼š`13`
>   è§£é‡Šï¼šçŸ©é˜µä¸­çš„å…ƒç´ ä¸º `[1,5,9,10,11,12,13,13,15]`ï¼Œç¬¬ `8` å°å…ƒç´ æ˜¯ `13`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`matrix = [[-5]], k = 1`
>   è¾“å‡ºï¼š`-5`

**æç¤º**

>   +   $n == matrix.length$
>   +   $n == matrix[i].length$
>   +   $1 <= n <= 300$
>   +   $-10^9 <= matrix[i][j] <= 10^9$
>   +   $é¢˜ç›®æ•°æ® ä¿è¯ matrix ä¸­çš„æ‰€æœ‰è¡Œå’Œåˆ—éƒ½æŒ‰ éé€’å‡é¡ºåº æ’åˆ—$
>   +   $1 <= k <= n^2$

**è¿›é˜¶**

>   ä½ èƒ½å¦ç”¨ä¸€ä¸ªæ’å®šçš„å†…å­˜(å³ `O(1)` å†…å­˜å¤æ‚åº¦)æ¥è§£å†³è¿™ä¸ªé—®é¢˜?
>   ä½ èƒ½åœ¨ `O(n)` çš„æ—¶é—´å¤æ‚åº¦ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜å—?è¿™ä¸ªæ–¹æ³•å¯¹äºé¢è¯•æ¥è¯´å¯èƒ½å¤ªè¶…å‰äº†ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼ˆ [this paper](http://www.cse.yorku.ca/~andy/pubs/X+Y.pdf) ï¼‰å¾ˆæœ‰è¶£ã€‚

**æ‰‹å†™ç¨¿**

![3171341](img/3171341.png)

**ä»£ç **

```c++
typedef long long LL;
class Solution {
public:
    int kthSmallest(vector<vector<int>>& g, int k) {
        // äºŒåˆ†çš„ä¸æ˜¯ä¸‹æ ‡ï¼Œè€Œæ˜¯ç­”æ¡ˆ
        int l = INT_MIN, r = INT_MAX;
        while (l < r) {
            int mid = (LL)l + r >> 1;
            // jä»æœ€åä¸€ä¸ªæ•°å¼€å§‹æšä¸¾
            // cntè¡¨ç¤ºå°äºç­‰äºmidçš„ä¸ªæ•°
            int j = g[0].size() - 1, cnt = 0;
            // æšä¸¾æ¯ä¸€è¡Œ
            for (int i = 0; i < g.size(); i ++ ) {
                // å¦‚æœå½“å‰å€¼å¤§äºmidï¼Œåˆ™j--
                while (j >= 0 && g[i][j] > mid) j --;
                // å°äºç­‰äºmidçš„ä¸ªæ•°ä¸ºj + 1ä¸ª
                cnt += j + 1;
            }
            if (cnt >= k) r = mid;
            else l = mid + 1;
        }
        return l;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`äºŒåˆ†`

**ç¼åˆæ€ª**



### å®æ•°äºŒåˆ†

#### æ¨¡æ¿

>   ```c++
>   bool check(double x) {/* ... */} // æ£€æŸ¥xæ˜¯å¦æ»¡è¶³æŸç§æ€§è´¨
>   
>   double bsearch_3(double l, double r) {
>   const double eps = 1e-6;   // eps è¡¨ç¤ºç²¾åº¦ï¼Œå–å†³äºé¢˜ç›®å¯¹ç²¾åº¦çš„è¦æ±‚
>   while (r - l > eps) {
>       double mid = (l + r) / 2;
>       if (check(mid)) r = mid;
>       else l = mid;
>   }
>   return l;
>   }
>   ```

#### [AcWing 790. æ•°çš„ä¸‰æ¬¡æ–¹æ ¹](https://www.acwing.com/problem/content/792/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªæµ®ç‚¹æ•° `n`ï¼Œæ±‚å®ƒçš„ä¸‰æ¬¡æ–¹æ ¹ã€‚

**è¾“å…¥æ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæµ®ç‚¹æ•° `n`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œè¡¨ç¤ºé—®é¢˜çš„è§£ã€‚
>
>   æ³¨æ„ï¼Œç»“æœä¿ç•™ `6` ä½å°æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $âˆ’10000â‰¤nâ‰¤10000$

**è¾“å…¥æ ·ä¾‹**

```c++
1000.00
```

**è¾“å‡ºæ ·ä¾‹**

```c++
10.000000
```

**æ‰‹å†™ç¨¿**

>   1.   [å®æ•°äºŒåˆ†](#å®æ•°äºŒåˆ†)

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
using namespace std;
const double eps = 1e-8;
double n;
int main() {
    scanf("%lf", &n);
    // æ³¨æ„ï¼šä¸èƒ½å†™æˆl = 0, r = n
    // å¦‚æœè®¾ç½®æˆl = 0, r = nï¼Œåˆ™æ— è®ºå¦‚ä½•ä¹Ÿæ‰¾ä¸åˆ°å…¶ä¸‰æ¬¡æ–¹æ ¹
    // åŸå› ï¼š0.001ï¼Œå…¶ä¸‰æ¬¡æ–¹æ ¹0.1æ˜¯æ¯”æœ¬èº«å¤§çš„
    double l = -100, r = 100;
    while (fabs(l - r) > eps) {
        double mid = (l + r) / 2;
        if (mid * mid * mid >= n) r = mid;
        else l = mid;
    }
    printf("%.6lf\n", l);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(log_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`å®æ•°äºŒåˆ†`

**ç¼åˆæ€ª**



## å‰ç¼€å’Œ

### ä¸€ç»´å‰ç¼€å’Œ

#### [AcWing 795. å‰ç¼€å’Œ](https://www.acwing.com/problem/content/797/)

>   è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•´æ•°åºåˆ—ã€‚
>
>   æ¥ä¸‹æ¥å†è¾“å…¥ `m` ä¸ªè¯¢é—®ï¼Œæ¯ä¸ªè¯¢é—®è¾“å…¥ä¸€å¯¹ `l,r`ã€‚
>
>   å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºåŸåºåˆ—ä¸­ä»ç¬¬ `l` ä¸ªæ•°åˆ°ç¬¬ `r` ä¸ªæ•°çš„å’Œã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•´æ•°æ•°åˆ—ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `l` å’Œ `r`ï¼Œè¡¨ç¤ºä¸€ä¸ªè¯¢é—®çš„åŒºé—´èŒƒå›´ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…± `m` è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªè¯¢é—®çš„ç»“æœã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤lâ‰¤râ‰¤n,$
>   +   $1â‰¤n,mâ‰¤100000,$
>   +   $âˆ’1000â‰¤æ•°åˆ—ä¸­å…ƒç´ çš„å€¼â‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 3
2 1 3 6 4
1 2
1 3
2 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
6
10
```

**æ‰‹å†™ç¨¿**

>   1.   `sum[i]` è¡¨ç¤ºåŒºé—´ `[1, i]` çš„å’Œ
>   2.   å¦‚æœè¦è®¡ç®—åŒºé—´ `[l, r]` çš„å’Œï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®
>        +   $sum[r] = a_1 + a_2 + ... + a_{r - 1} + a_r$
>        +   $sum[l] = a_1 + a_2 + ... + a_{l - 1} + a_l$
>        +   ä¸¤è€…ç›¸å‡å³å¯

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int n, m;
int sum[N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1, x; i <= n; i ++ ) {
        scanf("%d", &x);
        sum[i] = x + sum[i - 1];
    }
    while (m -- ) {
        int l, r;
        scanf("%d%d", &l, &r);
        printf("%d\n", sum[r] - sum[l - 1]);
    }
    return 0;
}
```

**æ ‡ç­¾**

`å‰ç¼€å’Œ`

### äºŒç»´å‰ç¼€å’Œ

#### [AcWing 796. å­çŸ©é˜µçš„å’Œ](https://www.acwing.com/problem/content/798/)

>   è¾“å…¥ä¸€ä¸ª `n` è¡Œ `m` åˆ—çš„æ•´æ•°çŸ©é˜µï¼Œå†è¾“å…¥ `q` ä¸ªè¯¢é—®ï¼Œæ¯ä¸ªè¯¢é—®åŒ…å«å››ä¸ªæ•´æ•° `x1,y1,x2,y2`ï¼Œè¡¨ç¤ºä¸€ä¸ªå­çŸ©é˜µçš„å·¦ä¸Šè§’åæ ‡å’Œå³ä¸‹è§’åæ ‡ã€‚
>
>   å¯¹äºæ¯ä¸ªè¯¢é—®è¾“å‡ºå­çŸ©é˜µä¸­æ‰€æœ‰æ•°çš„å’Œã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `nï¼Œmï¼Œq`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å« `m` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•´æ•°çŸ©é˜µã€‚
>
>   æ¥ä¸‹æ¥ `q` è¡Œï¼Œæ¯è¡ŒåŒ…å«å››ä¸ªæ•´æ•° `x1,y1,x2,y2`ï¼Œè¡¨ç¤ºä¸€ç»„è¯¢é—®ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…± `q` è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªè¯¢é—®çš„ç»“æœã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤1000,$
>   +   $1â‰¤qâ‰¤200000,$
>   +   $1â‰¤x1â‰¤x2â‰¤n,$
>   +   $1â‰¤y1â‰¤y2â‰¤m,$
>   +   $âˆ’1000â‰¤çŸ©é˜µå†…å…ƒç´ çš„å€¼â‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
3 4 3
1 7 2 4
3 6 2 8
2 1 2 3
1 1 2 2
2 1 3 4
1 3 3 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
17
27
21
```

**æ‰‹å†™ç¨¿**

>   ![20201217174700577](img/20201217174700577.png)
>
>   ç´«è‰²é¢ç§¯æ˜¯æŒ‡ `(1,1)` å·¦ä¸Šè§’åˆ° `(i,j-1)` å³ä¸‹è§’çš„çŸ©å½¢é¢ç§¯, ç»¿è‰²é¢ç§¯æ˜¯æŒ‡ `(1,1)` å·¦ä¸Šè§’åˆ° `(i-1, j )` å³ä¸‹è§’çš„çŸ©å½¢é¢ç§¯ã€‚æ¯ä¸€ä¸ªé¢œè‰²çš„çŸ©å½¢é¢ç§¯éƒ½ä»£è¡¨äº†å®ƒæ‰€åŒ…å›´å…ƒç´ çš„å’Œã€‚
>
>   ![20201216215336857](img/20201216215336857.png)
>
>   ä»å›¾ä¸­æˆ‘ä»¬å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œæ•´ä¸ªå¤–å›´è“è‰²çŸ©å½¢é¢ç§¯`s[i][j]` = ç»¿è‰²é¢ç§¯`s[i-1][j]` + ç´«è‰²é¢ç§¯`s[i][j-1]` - é‡å¤åŠ çš„çº¢è‰²çš„é¢ç§¯`s[i-1][j-1]` `+`å°æ–¹å—çš„é¢ç§¯`a[i][j]`;
>
>   å› æ­¤å¾—å‡ºäºŒç»´å‰ç¼€å’Œé¢„å¤„ç†å…¬å¼
>
>   `s[i] [j] = s[i-1][j] + s[i][j-1 ] + a[i] [j] - s[i-1][ j-1]`
>
>   æ¥ä¸‹æ¥å›å½’é—®é¢˜å»æ±‚ä»¥ `(x1,y1)` ä¸ºå·¦ä¸Šè§’å’Œä»¥ `(x2,y2)` ä¸ºå³ä¸‹è§’çš„çŸ©é˜µçš„å…ƒç´ çš„å’Œã€‚
>
>   åŒæ ·çš„é“ç†ã€<font style= "color: red">**ä½ è¿™é¢˜ç›®ä¸€æ¬¡ä¸€æ¬¡æ¢äº†å¤šå°‘ä¸ªï¼Œæ”¹è¿‡ä¸å•¦ï¼Œæ¢æ±¤ä¸æ¢è¯å•Š**</font>ã€‘

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, m, q;
int g[N][N], sum[N][N];
int main() {
    scanf("%d%d%d", &n, &m, &q);
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= m; j ++ ) {
            scanf("%d", &g[i][j]);
            sum[i][j] = g[i][j] + sum[i - 1][j] + sum[i][j - 1] - sum[i - 1][j - 1];
        }
    while (q -- ) {
        int x1, y1, x2, y2;
        scanf("%d%d%d%d", &x1, &y1, &x2, &y2);
        cout << sum[x2][y2] - sum[x2][y1 - 1] - sum[x1 - 1][y2] + sum[x1 - 1][y1 - 1] << endl;
    }
    return 0;
}
```

**æ ‡ç­¾**

`å‰ç¼€å’Œ`ã€`äºŒç»´å‰ç¼€å’Œ`

## å·®åˆ†

### ä¸€ç»´å·®åˆ†

#### [AcWing 797. å·®åˆ†](https://www.acwing.com/problem/content/799/)

>   è¾“å…¥ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•´æ•°åºåˆ—ã€‚
>
>   æ¥ä¸‹æ¥è¾“å…¥ `m` ä¸ªæ“ä½œï¼Œæ¯ä¸ªæ“ä½œåŒ…å«ä¸‰ä¸ªæ•´æ•° `l,r,c`ï¼Œè¡¨ç¤ºå°†åºåˆ—ä¸­ `[l,r]` ä¹‹é—´çš„æ¯ä¸ªæ•°åŠ ä¸Š `c`ã€‚
>
>   è¯·ä½ è¾“å‡ºè¿›è¡Œå®Œæ‰€æœ‰æ“ä½œåçš„åºåˆ—ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•´æ•°åºåˆ—ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `lï¼Œrï¼Œc`ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€ç»ˆåºåˆ—ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤100000,$
>   +   $1â‰¤lâ‰¤râ‰¤n,$
>   +   $âˆ’1000â‰¤câ‰¤1000,$
>   +   $âˆ’1000â‰¤æ•´æ•°åºåˆ—ä¸­å…ƒç´ çš„å€¼â‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
6 3
1 2 2 1 2 1
1 3 1
3 5 1
1 6 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3 4 5 3 4 2
```

**æ‰‹å†™ç¨¿**

![3131310](img/3131310.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int n, m;
int g[N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1, a = 0, b = 0; i <= n; i ++ ) {
        scanf("%d", &a);
        g[i] = a - b;
        b = a;
    }
    while (m -- ) {
        int l, r, c;
        scanf("%d%d%d", &l, &r, &c);
        g[l] += c;
        g[r + 1] -= c;
    }
    for (int i = 1, x; i <= n; i ++ ) {
        x += g[i];
        cout << x << " ";
    }
    return 0;
}
```

**æ ‡ç­¾**

`å·®åˆ†`ã€`ä¸€ç»´å·®åˆ†`

#### [AcWing 4195. çº¿æ®µè¦†ç›–](https://www.acwing.com/problem/content/4198/)

>   åœ¨ä¸€ä¸ªåæ ‡è½´ä¸Šæœ‰ `n` æ¡çº¿æ®µã€‚
>
>   æ¯æ¡çº¿æ®µçš„æ¯ä¸ªç«¯ç‚¹çš„åæ ‡éƒ½ä¸ºæ•´æ•°ã€‚
>
>   å¯èƒ½å­˜åœ¨é€€åŒ–æˆç‚¹çš„çº¿æ®µã€‚
>
>   çº¿æ®µä¹‹é—´å¯ä»¥ç›¸äº’äº¤å‰ã€åµŒå¥—ç”šè‡³é‡åˆã€‚
>
>   è¯·ä½ è®¡ç®—ï¼Œå¯¹äºæ¯ä¸ª `kâˆˆ{1,2,â€¦,n}`ï¼Œåæ ‡è½´ä¸­å…±æœ‰å¤šå°‘ä¸ª**æ•´æ•°åæ ‡**çš„ç‚¹æ»¡è¶³æ°å¥½è¢« `k` æ¡çº¿æ®µè¦†ç›–ã€‚
>
>   æ³¨æ„ï¼Œå·¦å³ç«¯ç‚¹åˆ†åˆ«ä¸º $l_i,r_i$ çš„çº¿æ®µè¦†ç›–ç‚¹ `x` å½“ä¸”ä»…å½“ $l_iâ‰¤xâ‰¤r_i$ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $l_i,r_i$ï¼Œè¡¨ç¤ºä¸€æ¡çº¿æ®µçš„å·¦å³ç«¯ç‚¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€è¡Œ `n` ä¸ªæ•´æ•°ï¼Œå…¶ä¸­ç¬¬ `i` ä¸ªæ•´æ•°è¡¨ç¤ºåæ ‡è½´ä¸­æ»¡è¶³æ°å¥½è¢« `i` æ¡çº¿æ®µè¦†ç›–çš„**æ•´æ•°åæ ‡**çš„ç‚¹çš„æ•°é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $å‰ä¸‰ä¸ªæµ‹è¯•ç‚¹æ»¡è¶³ 1â‰¤nâ‰¤3ã€‚$
>   +   $æ‰€æœ‰æµ‹è¯•ç‚¹æ»¡è¶³ 1â‰¤nâ‰¤2Ã—10^5ï¼Œ0â‰¤liâ‰¤riâ‰¤10^{18}ã€‚$

**è¾“å…¥æ ·ä¾‹1**

```c++
3
0 3
1 3
3 8
```

**è¾“å‡ºæ ·ä¾‹1**

```c++
6 2 1
```

**è¾“å…¥æ ·ä¾‹2**

```c++
3
1 3
2 4
5 7
```

**è¾“å‡ºæ ·ä¾‹2**

```c++
5 2 0
```

**æ‰‹å†™ç¨¿**

![3131829](img/3131829.png)

**ä»£ç **

```c++
#include <iostream>
#include <map>
using namespace std;
typedef long long LL;
const int N = 200010;
int n;
LL ans[N];
// å·®åˆ†æ•°ç»„
map<LL, LL> q;
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) {
        LL l, r;
        scanf("%lld%lld", &l, &r);
        q[l] += 1;
        q[r + 1] -= 1;
    }
    // lastè¡¨ç¤ºä¸Šä¸€ä¸ªä½ç½®ï¼Œsumè¡¨ç¤ºå‰ç¼€å’Œ
    LL last = -1, sum = 0;
    for (auto& [x, c] : q) {
        ans[sum] += x - last;
        last = x;
        sum += c;
    }
    for (int i = 1; i <= n; i ++ ) cout << ans[i] << " ";
    return 0;
}
```

**æ ‡ç­¾**

`ç¦»æ•£åŒ–`ã€`å·®åˆ†`

### äºŒç»´å·®åˆ†

#### [AcWing 798. å·®åˆ†çŸ©é˜µ](https://www.acwing.com/problem/content/800/)

>   è¾“å…¥ä¸€ä¸ª `n` è¡Œ `m` åˆ—çš„æ•´æ•°çŸ©é˜µï¼Œå†è¾“å…¥ `q` ä¸ªæ“ä½œï¼Œæ¯ä¸ªæ“ä½œåŒ…å«äº”ä¸ªæ•´æ•° `x1,y1,x2,y2,c`ï¼Œå…¶ä¸­ `(x1,y1)` å’Œ `(x2,y2)` è¡¨ç¤ºä¸€ä¸ªå­çŸ©é˜µçš„å·¦ä¸Šè§’åæ ‡å’Œå³ä¸‹è§’åæ ‡ã€‚
>
>   æ¯ä¸ªæ“ä½œéƒ½è¦å°†é€‰ä¸­çš„å­çŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´ çš„å€¼åŠ ä¸Š `c`ã€‚
>
>   è¯·ä½ å°†è¿›è¡Œå®Œæ‰€æœ‰æ“ä½œåçš„çŸ©é˜µè¾“å‡ºã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n,m,q`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å« `m` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ•´æ•°çŸ©é˜µã€‚
>
>   æ¥ä¸‹æ¥ `q` è¡Œï¼Œæ¯è¡ŒåŒ…å« `5` ä¸ªæ•´æ•° `x1,y1,x2,y2,c`ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œã€‚

**è¾“å‡ºæ ¼å¼**

>   å…± `n` è¡Œï¼Œæ¯è¡Œ `m` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€æœ‰æ“ä½œè¿›è¡Œå®Œæ¯•åçš„æœ€ç»ˆçŸ©é˜µã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤1000,$
>   +   $1â‰¤qâ‰¤100000,$
>   +   $1â‰¤x1â‰¤x2â‰¤n,$
>   +   $1â‰¤y1â‰¤y2â‰¤m,$
>   +   $âˆ’1000â‰¤câ‰¤1000,$
>   +   $âˆ’1000â‰¤çŸ©é˜µå†…å…ƒç´ çš„å€¼â‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
3 4 3
1 2 2 1
3 2 2 1
1 1 1 1
1 1 2 2 1
1 3 2 3 2
3 1 3 4 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2 3 4 1
4 3 4 1
2 2 2 2
```

**æ‰‹å†™ç¨¿**

![3131937](img/3131937.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, m, q;
int g[N][N], b[N][N];
int main() {
    scanf("%d%d%d",&n, &m, &q);
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= m; j ++ ) {
            scanf("%d", &g[i][j]);
            // æ„å»ºå·®åˆ†çŸ©é˜µ
            b[i][j] = g[i][j] - g[i - 1][j] - g[i][j - 1] + g[i - 1][j - 1];
            
        }
    while (q -- ) {
        int x1, y1, x2, y2, c;
        scanf("%d%d%d%d%d", &x1, &y1, &x2, &y2, &c);
        // å·®åˆ†çŸ©é˜µå…¬å¼
        b[x1][y1] += c;
        b[x2 + 1][y1] -= c;
        b[x1][y2 + 1] -= c;
        b[x2 + 1][y2 + 1] += c;
    }
    for (int i = 1; i <= n; i ++ ) {
        for (int j = 1; j <= m; j ++ ) {
            // æ±‚å‰ç¼€å’Œ
            b[i][j] = b[i][j] + b[i - 1][j] + b[i][j - 1] - b[i - 1][j - 1];
            cout << b[i][j] << " ";
        }
        cout << endl;
    }
    return 0;
}
```

**æ ‡ç­¾**

`å·®åˆ†`ã€`äºŒç»´å·®åˆ†`

## å¤šæŒ‡é’ˆä¸“é¢˜

### åŒæŒ‡é’ˆ

#### å¿«æ…¢æŒ‡é’ˆ

##### [LeetCode 141. ç¯å½¢é“¾è¡¨](https://leetcode-cn.com/problems/linked-list-cycle/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ `head` ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚
>
> å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª `next` æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° `pos` æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» `0` å¼€å§‹ï¼‰ã€‚å¦‚æœ `pos` æ˜¯ `-1`ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼š`pos` ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚
>
> å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯ï¼Œåˆ™è¿”å› `true` ã€‚ å¦åˆ™ï¼Œè¿”å› `false` ã€‚ 

**ç¤ºä¾‹ 1**

![ç¯çŠ¶é“¾è¡¨ å›¾1](img/%E7%8E%AF%E7%8A%B6%E9%93%BE%E8%A1%A8%20%E5%9B%BE1.png)

> è¾“å…¥ï¼š`head = [3,2,0,-4], pos = 1`
> è¾“å‡ºï¼š`true`
> è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚

**ç¤ºä¾‹ 2**

![ç¯å½¢é“¾è¡¨ å›¾2](img/%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%20%E5%9B%BE2.png)

> è¾“å…¥ï¼š`head = [1,2], pos = 0`
> è¾“å‡ºï¼š`true`
> è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚

**ç¤ºä¾‹ 3**

![ç¯å½¢é“¾è¡¨ å›¾3](img/%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%20%E5%9B%BE3.png)

> è¾“å…¥ï¼š`head = [1], pos = -1`
> è¾“å‡ºï¼š`false`
> è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚

**æç¤º**

> é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ $[0, 10^4]$
> $-10^5 <= Node.val <= 10^5$
> `pos` ä¸º `-1` æˆ–è€…é“¾è¡¨ä¸­çš„ä¸€ä¸ª æœ‰æ•ˆç´¢å¼• ã€‚
>
>
> è¿›é˜¶ï¼šä½ èƒ½ç”¨ O(1)ï¼ˆå³ï¼Œå¸¸é‡ï¼‰å†…å­˜è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ

**é¢˜è§£**

> 1. è®¾ç½® `fast` å’Œ `slow` ä¸¤ä¸ªæŒ‡é’ˆ
> 2. `fast` ä¸€æ¬¡èµ°ä¸¤æ­¥ï¼Œ`slow` ä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š
>     + `fast` èµ°åˆ°ç©ºæŒ‡é’ˆï¼Œè¯´æ˜æ— ç¯
>     + `fast` å’Œ `slow` ç›¸ç­‰ï¼Œè¯´æ˜æœ‰ç¯

**ä»£ç **

```c++
class Solution {
public:
    bool hasCycle(ListNode *head) {
        if (!head) return false;
        auto fast = head, slow = head;
        do {
            fast = fast -> next;
            slow = slow -> next;
            if (fast) fast = fast -> next;
            else return false;
            if (fast == slow) return true;
        } while (fast);
        return false;
    }
};
```

**æ ‡ç­¾**

`åŒæŒ‡é’ˆ`ã€`å¿«æ…¢æŒ‡é’ˆ`ã€`ç¯`

##### [LeetCode 142. ç¯å½¢é“¾è¡¨ II](https://leetcode-cn.com/problems/linked-list-cycle-ii/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªé“¾è¡¨ï¼Œè¿”å›é“¾è¡¨å¼€å§‹å…¥ç¯çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ å¦‚æœé“¾è¡¨æ— ç¯ï¼Œåˆ™è¿”å› `null`ã€‚
>
> å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª `next` æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° `pos` æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» `0` å¼€å§‹ï¼‰ã€‚å¦‚æœ `pos` æ˜¯ `-1`ï¼Œåˆ™åœ¨è¯¥é“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚æ³¨æ„ï¼š`pos` ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ï¼Œä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚
>
> ä¸å…è®¸ä¿®æ”¹ é“¾è¡¨ã€‚

**ç¤ºä¾‹ 1**

![ç¯å½¢é“¾è¡¨ II å›¾1](img/%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%20II%20%E5%9B%BE1.png)

> è¾“å…¥ï¼š`head = [3,2,0,-4], pos = 1`
> è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º `1` çš„é“¾è¡¨èŠ‚ç‚¹
> è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚

**ç¤ºä¾‹ 2**

![ç¯å½¢é“¾è¡¨ II å›¾ 2](img/%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%20II%20%E5%9B%BE%202.png)

> è¾“å…¥ï¼š`head = [1,2], pos = 0`
> è¾“å‡ºï¼šè¿”å›ç´¢å¼•ä¸º `0` çš„é“¾è¡¨èŠ‚ç‚¹
> è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚

**ç¤ºä¾‹ 3**

![ç¯å½¢é“¾è¡¨ II å›¾3](img/%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%20II%20%E5%9B%BE3.png)

> è¾“å…¥ï¼š`head = [1], pos = -1`
> è¾“å‡ºï¼šè¿”å› `null`
> è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚

**æç¤º**

> + é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´åœ¨èŒƒå›´ $[0, 10^4]$ å†…
> + $-10^5 <= Node.val <= 10^5$
> + `pos` çš„å€¼ä¸º `-1` æˆ–è€…é“¾è¡¨ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•

**è¿›é˜¶**

> ä½ æ˜¯å¦å¯ä»¥ä½¿ç”¨ `O(1)` ç©ºé—´è§£å†³æ­¤é¢˜ï¼Ÿ

**é¢˜è§£**

> 1. è®¾ç½® `fast` å’Œ `slow` æŒ‡é’ˆ
> 2. `fast` æŒ‡é’ˆä¸€æ¬¡èµ°ä¸¤æ­¥ï¼Œ`slow` æŒ‡é’ˆä¸€æ¬¡èµ°ä¸€æ­¥ï¼Œåˆ†ä¸¤ç§æƒ…å†µè®¨è®º
>     + å¦‚æœ `fast` æŒ‡é’ˆä¸ºç©ºï¼Œè¯´æ˜æ— ç¯
>     + å¦‚æœ `fast == slow`ï¼Œåˆ™è®© `fast == head`ï¼Œç„¶åè®© `fast` å’Œ `slow` æŒ‡é’ˆåŒæ—¶èµ°ï¼Œå½“ä¸¤è€…ç›¸é‡æ—¶ï¼Œå³ä¸ºç¯çš„å…¥å£

**æ­£ç¡®æ€§è¯æ˜**

> 
>
> è¯æ˜å¦‚ä¸‹
> $$
> å½“fastæŒ‡é’ˆå’ŒslowæŒ‡é’ˆä¸¤è€…ç›¸é‡çš„æ—¶å€™ï¼Œæ»¡è¶³l_{fast}\;=\;2\;*\;l_{slow}\;\;(1) \\
> l_{fast}\;=\;l_{ab}\;+\;n\;*\;l_{åœ†}\;+\;l_{bc}\;\;(2) \\
> l_{slow}\;=\;l_{ab}\;+\;l_{bc}\;\;(3)ï¼Œç»“åˆ(1)(2)(3)å¼ï¼Œæœ‰ \\
> \begin{align*}
> l_{ab}\;+\;l_{bc}&=\;n\;*\;l_{åœ†} \\
> &= (n\;-\;1)\;*\;l_{åœ†}\;+\;l_{bc}\;+\;l_{cb}ï¼Œä»è€Œæœ‰
> \end{align*}
> \\
> l_{ab} = (n\;-\;1)\;*\;l_{åœ†}\;+\;l_{cb}
> $$

**ä»£ç **

 ```c++
class Solution {
public:
    ListNode *detectCycle(ListNode *head) {
        if (!head) return NULL;
        auto fast = head, slow = head;
        do {
            fast = fast -> next;
            slow = slow -> next;
            if (fast) fast = fast -> next;
            if (!fast) return NULL;
        } while (fast != slow);
        fast = head;
        while (fast != slow) {
            fast = fast -> next;
            slow = slow -> next;
        }
        return fast;
    }
};
 ```

**æ ‡ç­¾**

`åŒæŒ‡é’ˆ`ã€`å¿«æ…¢æŒ‡é’ˆ`ã€`ç¯`

##### [LeetCode 287. å¯»æ‰¾é‡å¤æ•°](https://leetcode-cn.com/problems/find-the-duplicate-number/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªåŒ…å« `n + 1` ä¸ªæ•´æ•°çš„æ•°ç»„ `nums` ï¼Œå…¶æ•°å­—éƒ½åœ¨ `1` åˆ° `n` ä¹‹é—´ï¼ˆåŒ…æ‹¬ `1` å’Œ `n`ï¼‰ï¼Œå¯çŸ¥è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•´æ•°ã€‚
>
> å‡è®¾ `nums` åªæœ‰ ä¸€ä¸ªé‡å¤çš„æ•´æ•° ï¼Œæ‰¾å‡º è¿™ä¸ªé‡å¤çš„æ•° ã€‚
>
> ä½ è®¾è®¡çš„è§£å†³æ–¹æ¡ˆå¿…é¡»ä¸ä¿®æ”¹æ•°ç»„ `nums` ä¸”åªç”¨å¸¸é‡çº§ `O(1)` çš„é¢å¤–ç©ºé—´ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`nums = [1,3,4,2,2]`
> è¾“å‡ºï¼š`2`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`nums = [3,1,3,4,2]`
> è¾“å‡ºï¼š`3`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`nums = [1,1]`
> è¾“å‡ºï¼š`1`

**ç¤ºä¾‹ 4**

> è¾“å…¥ï¼š`nums = [1,1,2]`
> è¾“å‡ºï¼š`1`

**æç¤º**

> + $1 <= n <= 10^5$
> + $nums.length == n + 1$
> + $1 <= nums[i] <= n$
> + `nums` ä¸­ åªæœ‰ä¸€ä¸ªæ•´æ•° å‡ºç° ä¸¤æ¬¡æˆ–å¤šæ¬¡ ï¼Œå…¶ä½™æ•´æ•°å‡åªå‡ºç° ä¸€æ¬¡

**è¿›é˜¶**

> å¦‚ä½•è¯æ˜ `nums` ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªé‡å¤çš„æ•°å­—?
> ä½ å¯ä»¥è®¾è®¡ä¸€ä¸ªçº¿æ€§çº§æ—¶é—´å¤æ‚åº¦ `O(n)` çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ

**é¢˜è§£**

> 1. `n + 1` ä¸ªæ•´æ•°ï¼Œä¸”æ•°å­—éƒ½åœ¨ `1 ï½ n` ä¹‹é—´ï¼Œå› æ­¤ï¼Œä¸€å®šæœ‰ä¸€ä¸ªæ•°å­—è¢«æŒ‡å‘ä¸¤æ¬¡ï¼Œä»¥ä¸‹æ ‡å’Œä¸‹æ ‡å¯¹åº”çš„æ•°å­—è¿æ¥ä¸€æ¡æœ‰å‘è¾¹çš„è¯ï¼Œåˆ™é—®é¢˜è½¬åŒ–ä¸ºå¯»æ‰¾ç¯çš„å…¥å£çš„é—®é¢˜ï¼Œå¿«æ…¢æŒ‡é’ˆåšå³å¯

**ä»£ç **

```c++
class Solution {
public:
    int findDuplicate(vector<int>& nums) {
        int fast = 0, slow = 0;
        do {
            fast = nums[nums[fast]];
            slow = nums[slow];
        } while (fast != slow);
        fast = 0;
        while (fast != slow) {
            fast = nums[fast];
            slow = nums[slow];
        }
        return fast;
    }
};
```

**æ ‡ç­¾**

`åŒæŒ‡é’ˆ`ã€`å¿«æ…¢æŒ‡é’ˆ`ã€`ç¯`

### ä¸‰æŒ‡é’ˆ

#### [LeetCode 75. é¢œè‰²åˆ†ç±»](https://leetcode-cn.com/problems/sort-colors/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªåŒ…å«çº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€å…± `n` ä¸ªå…ƒç´ çš„æ•°ç»„ `nums` ï¼ŒåŸåœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œä½¿å¾—ç›¸åŒé¢œè‰²çš„å…ƒç´ ç›¸é‚»ï¼Œå¹¶æŒ‰ç…§çº¢è‰²ã€ç™½è‰²ã€è“è‰²é¡ºåºæ’åˆ—ã€‚
>
> æˆ‘ä»¬ä½¿ç”¨æ•´æ•° `0ã€ 1` å’Œ `2` åˆ†åˆ«è¡¨ç¤ºçº¢è‰²ã€ç™½è‰²å’Œè“è‰²ã€‚
>
> å¿…é¡»åœ¨ä¸ä½¿ç”¨åº“çš„ `sort` å‡½æ•°çš„æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`nums = [2,0,2,1,1,0]`
> è¾“å‡ºï¼š`[0,0,1,1,2,2]`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`nums = [2,0,1]`
> è¾“å‡ºï¼š`[0,1,2]`

**æç¤º**

> + $n == nums.length$
> + $1 <= n <= 300$
> + $nums[i] ä¸º 0ã€1 æˆ– 2$

**è¿›é˜¶**

> ä½ å¯ä»¥ä¸ä½¿ç”¨ä»£ç åº“ä¸­çš„æ’åºå‡½æ•°æ¥è§£å†³è¿™é“é¢˜å—ï¼Ÿ
> ä½ èƒ½æƒ³å‡ºä¸€ä¸ªä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´çš„ä¸€è¶Ÿæ‰«æç®—æ³•å—ï¼Ÿ

**æ‰‹å†™ç¨¿**

> ![2260822](img/2260822.png)
>
> 1. `0 ~ j - 1` æ˜¯çº¢è‰²ï¼Œ`j ~ i - 1` æ˜¯ç™½è‰²ï¼Œ`k +1 ~ n` æ˜¯è“è‰²ï¼Œ`i ~ k` æ˜¯å¾…åˆ†é…åŒºåŸŸ
> 2. é’ˆå¯¹ `nums[i]` çš„å–å€¼åˆ†ä¸‰ç§æƒ…å†µï¼š
>     + `nums[i]`  å–å€¼ä¸º `0`ï¼Œåˆ™äº¤æ¢ `nums[i ++]` å’Œ `nums[j ++]` çš„å€¼
>     + `nums[i]` å–å€¼ä¸º `1`ï¼Œåˆ™ç›´æ¥ `i ++`
>     + `nums[i]`  å–å€¼ä¸º `2`ï¼Œåˆ™äº¤æ¢ `nums[i]` å’Œ `nums[k -- ]` çš„å€¼
>         + ä¸ºå•¥ä¸æ˜¯ `i ++` ï¼Œå› ä¸º `i` åˆ° `k` éƒ½æ˜¯å¾…åˆ†é…åŒºåŸŸï¼Œæ— æ³•åˆ¤åˆ« `nums[i]` æ˜¯ `0ï¼Œ1` æˆ–è€… `2`ï¼Œæ‰€ä»¥ï¼Œä¸èƒ½ `++`

**ä»£ç **

```c++
class Solution {
public:
    void sortColors(vector<int>& nums) {
        for (int i = 0, j = 0, k = nums.size() - 1; i <= k;) {
            if (nums[i] == 0) swap(nums[j ++], nums[i ++]);
            else if (nums[i] == 1) i ++;
            else swap(nums[i], nums[k --]);
        }
        return;
    }
};
```

**æ ‡ç­¾**

`ä¸‰æŒ‡é’ˆ`ã€`è·å…°å›½æ——`

## ä½è¿ç®—

### æ™®é€šä½è¿ç®—

#### [LeetCode 260. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— III](https://leetcode-cn.com/problems/single-number-iii/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œå…¶ä¸­æ°å¥½æœ‰ä¸¤ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œå…¶ä½™æ‰€æœ‰å…ƒç´ å‡å‡ºç°ä¸¤æ¬¡ã€‚ æ‰¾å‡ºåªå‡ºç°ä¸€æ¬¡çš„é‚£ä¸¤ä¸ªå…ƒç´ ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚
>
> è¿›é˜¶ï¼šä½ çš„ç®—æ³•åº”è¯¥å…·æœ‰çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚ä½ èƒ½å¦ä»…ä½¿ç”¨å¸¸æ•°ç©ºé—´å¤æ‚åº¦æ¥å®ç°ï¼Ÿ

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`nums = [1,2,1,3,2,5]`
> è¾“å‡ºï¼š`[3,5]`
> è§£é‡Šï¼š`[5, 3]` ä¹Ÿæ˜¯æœ‰æ•ˆçš„ç­”æ¡ˆã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`nums = [-1,0]`
> è¾“å‡ºï¼š`[-1,0]`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`nums = [0,1]`
> è¾“å‡ºï¼š`[1,0]`

**æç¤º**

> + $2\;\leq\;nums.length\;\leq\;3\;*\;10^4$
> + $-2^{31}\;\leq\;nums[i]\;\leq\;2^{31}\;-\;1$
> + é™¤ä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•´æ•°å¤–ï¼Œnums ä¸­çš„å…¶ä»–æ•°å­—éƒ½å‡ºç°ä¸¤æ¬¡

**é¢˜è§£**

> 1. å°†æ‰€æœ‰æ•°å­—è¿›è¡Œå¼‚æˆ–ä¹‹åå¾—åˆ°çš„å€¼ `ab` å³ä¸ºåªå‡ºç°ä¸€æ¬¡çš„é‚£ä¸¤ä¸ªå…ƒç´  `a` å’Œ `b` çš„å¼‚æˆ–å€¼
> 2. ç”±å¼‚æˆ–çš„æ€§è´¨å¯çŸ¥ `ab` çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æŸä¸€ä½ `k`ä¸Šçš„å€¼ä¸º `1` ï¼Œè¯´æ˜å…ƒç´  `a` å’Œ å…ƒç´  `b` åœ¨ `k` ä¸Šçš„äºŒè¿›åˆ¶æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼Œå¯ä»¥æ ¹æ®ç¬¬ `k` ä½è¿›è¡Œåˆ’åˆ†ï¼Œå°†æ•´ä¸ªæ•°ç»„åˆ’åˆ†æˆä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†è¡¨ç¤ºç¬¬ `k` ä½çš„å€¼ä¸º `1` ï¼Œå¦ä¸€éƒ¨åˆ†è¡¨ç¤ºç¬¬ `k` ä½çš„å€¼ä¸º `0`ï¼Œæ­¤æ—¶é—®é¢˜å˜æˆåœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ•°å‡ºç°ä¸€æ¬¡ï¼Œå…¶ä»–æ•°å‡ºç°ä¸¤æ¬¡ï¼Œå¯è§£

**ä»£ç **

```c++
class Solution {
public:
    int get(vector<int>& nums, int k, int u) {
        int res = 0;
        for (auto& num : nums)
            if ((num >> k & 1) == u) res ^= num;
        return res;
    }
    vector<int> singleNumber(vector<int>& nums) {
        int ab = 0;
        for (auto& num : nums) ab ^= num;
        int k = 0;
        while ((ab >> k & 1) == 0) k ++;
        return {get(nums, k, 1), get(nums, k, 0)};
    }
};
```

**æ ‡ç­¾**

`ä½è¿ç®—`

#### [LeetCode 338. æ¯”ç‰¹ä½è®¡æ•°](https://leetcode-cn.com/problems/counting-bits/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•´æ•° `n` ï¼Œå¯¹äº `0 <= i <= n` ä¸­çš„æ¯ä¸ª `i` ï¼Œè®¡ç®—å…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ `1` çš„ä¸ªæ•° ï¼Œè¿”å›ä¸€ä¸ªé•¿åº¦ä¸º `n + 1` çš„æ•°ç»„ `ans` ä½œä¸ºç­”æ¡ˆã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 2`
> è¾“å‡ºï¼š`[0,1,1]`
> è§£é‡Šï¼š
> `0 --> 0`
> `1 --> 1`
> `2 --> 10`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 5`
> è¾“å‡ºï¼š`[0,1,1,2,1,2]`
> è§£é‡Šï¼š
> `0 --> 0`
> `1 --> 1`
> `2 --> 10`
> `3 --> 11`
> `4 --> 100`
> `5 --> 101`

**æç¤º**

> + $0 <= n <= 10^5$

**è¿›é˜¶**

> å¾ˆå®¹æ˜“å°±èƒ½å®ç°æ—¶é—´å¤æ‚åº¦ä¸º `O(n log n)` çš„è§£å†³æ–¹æ¡ˆï¼Œä½ å¯ä»¥åœ¨çº¿æ€§æ—¶é—´å¤æ‚åº¦ `O(n)` å†…ç”¨ä¸€è¶Ÿæ‰«æè§£å†³æ­¤é—®é¢˜å—ï¼Ÿ
> ä½ èƒ½ä¸ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°è§£å†³æ­¤é—®é¢˜å—ï¼Ÿï¼ˆå¦‚ï¼Œ`C++` ä¸­çš„ `__builtin_popcount` ï¼‰

**æ–¹æ³•ä¸€ï¼šæšä¸¾ + ä½è¿ç®—**

**æ­¥éª¤**

> 1. éå†æ¯ä¸€ä¸ªæ•°å­—ï¼Œæ£€æŸ¥æ¯ä¸€ä¸ªæ•°å­—çš„äºŒè¿›åˆ¶ä½ä¸­å«æœ‰çš„ `1` çš„ä¸ªæ•°å³å¯
> 2. ä½¿ç”¨ `lowbit` å‡½æ•°è¿›è¡Œæ£€æŸ¥ `1` çš„æ•°é‡
>     + `lowbit` å‡½æ•° `x & -x` å¯ä»¥å–å¾— `x` çš„æœ€åä¸€ä½ `1`

**ä»£ç **

```c++
class Solution {
public:
    int get(int x) {
        int res = 0;
        while (x) {
            x -= x & -x;
            res ++;
        }
        return res;
    }
    vector<int> countBits(int n) {
        vector<int> res;
        for (int i = 0; i <= n; i ++ ) res.push_back(get(i));
        return res;
    }
};
```

**æ–¹æ³•äºŒï¼šåŠ¨æ€è§„åˆ’ + ä½è¿ç®—**

**æ‰‹å†™ç¨¿**

![WX20220122-134731@2x](img/WX20220122-134731@2x.png)

**ä»£ç **

```c++
class Solution {
public:
    vector<int> countBits(int n) {
        vector<int> f(n + 1);
        for (int i = 0; i <= n; i ++ ) f[i] = f[i >> 1] + (i & 1);
        return f;
    }
};
```

**æ ‡ç­¾**

` åŠ¨æ€è§„åˆ’`ã€`ä½è¿ç®—`

#### [AcWing 318. æœ€å¤§å•è¯é•¿åº¦ä¹˜ç§¯](https://leetcode-cn.com/problems/maximum-product-of-word-lengths/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ `words` ï¼Œæ‰¾å‡ºå¹¶è¿”å› `length(words[i]) * length(words[j])` çš„æœ€å¤§å€¼ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªå•è¯ä¸å«æœ‰å…¬å…±å­—æ¯ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„ä¸¤ä¸ªå•è¯ï¼Œè¿”å› `0` ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`words = ["abcw","baz","foo","bar","xtfn","abcdef"]`
> è¾“å‡ºï¼š`16`
> è§£é‡Šï¼šè¿™ä¸¤ä¸ªå•è¯ä¸º `"abcw", "xtfn"`ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`words = ["a","ab","abc","d","cd","bcd","abcd"]`
> è¾“å‡ºï¼š`4` 
> è§£é‡Šï¼šè¿™ä¸¤ä¸ªå•è¯ä¸º `"ab", "cd"`ã€‚

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`words = ["a","aa","aaa","aaaa"]`
> è¾“å‡ºï¼š`0`
> è§£é‡Šï¼šä¸å­˜åœ¨è¿™æ ·çš„ä¸¤ä¸ªå•è¯ã€‚

**æç¤º**

> + $2 <= words.length <= 1000$
> + $1 <= words[i].length <= 1000$
> + $words[i]$ ä»…åŒ…å«å°å†™å­—æ¯

**æ‰‹å†™ç¨¿**

![2181145](img/2181145.png)

**ä»£ç **

```c++
class Solution {
public:
    int maxProduct(vector<string>& words) {
        vector<int> state;
        for (auto& word : words) {
            int s = 0;
            // 26ä½äºŒè¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´a, aa, aaaå®é™…ä¸Šæ˜ å°„çš„éƒ½æ˜¯åŒä¸€ä¸ªæ•°å­—
            // æ³¨æ„ä½“ä¼š
            for (auto& c : word) s |= 1 << (c - 'a');
            state.push_back(s);
        }
        int res = 0;
        for (int i = 0; i < words.size(); i ++ )
            for (int j = i + 1; j < words.size(); j ++ )
                if (!(state[i] & state[j]))
                    res = max(res, (int)(words[i].size() * words[j].size()));
        return res;
    }
};
```

**æ ‡ç­¾**

`ä½è¿ç®—`

#### [LeetCode 371. ä¸¤æ•´æ•°ä¹‹å’Œ](https://leetcode-cn.com/problems/sum-of-two-integers/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸¤ä¸ªæ•´æ•° `a` å’Œ `b` ï¼Œä¸ä½¿ç”¨ è¿ç®—ç¬¦ `+` å’Œ `-` ï¼Œè®¡ç®—å¹¶è¿”å›ä¸¤æ•´æ•°ä¹‹å’Œã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`a = 1, b = 2`
>   è¾“å‡ºï¼š`3`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`a = 2, b = 3`
>   è¾“å‡ºï¼š`5`

**æç¤º**

>   +   $-1000 <= a, b <= 1000$

**æ‰‹å†™ç¨¿**

![361125](img/361125.png)

**ä»£ç **

```c++
class Solution {
public:
    int getSum(int a, int b) {
        if (!b) return a;
        int sum = a ^ b, carry = (unsigned)(a & b) << 1;
        return getSum(sum, carry);
    }
};
```

**æ ‡ç­¾**

`ä½è¿ç®—`

#### [LeetCode 29. ä¸¤æ•°ç›¸é™¤](https://leetcode-cn.com/problems/divide-two-integers/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªæ•´æ•°ï¼Œè¢«é™¤æ•° `dividend` å’Œé™¤æ•° `divisor`ã€‚å°†ä¸¤æ•°ç›¸é™¤ï¼Œè¦æ±‚ä¸ä½¿ç”¨ä¹˜æ³•ã€é™¤æ³•å’Œ `mod` è¿ç®—ç¬¦ã€‚
>
>   è¿”å›è¢«é™¤æ•° `dividend` é™¤ä»¥é™¤æ•° `divisor` å¾—åˆ°çš„å•†ã€‚
>
>   æ•´æ•°é™¤æ³•çš„ç»“æœåº”å½“æˆªå»ï¼ˆ`truncate`ï¼‰å…¶å°æ•°éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼š`truncate(8.345) = 8` ä»¥åŠ `truncate(-2.7335) = -2`

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `dividend = 10, divisor = 3`
>   è¾“å‡º: `3`
>   è§£é‡Š: `10/3 = truncate(3.33333..) = truncate(3) = 3`

**ç¤ºä¾‹ 2**

>   è¾“å…¥: `dividend = 7, divisor = -3`
>   è¾“å‡º: `-2`
>   è§£é‡Š: `7/-3 = truncate(-2.33333..) = -2`

**æç¤º**

>   è¢«é™¤æ•°å’Œé™¤æ•°å‡ä¸º `32` ä½æœ‰ç¬¦å·æ•´æ•°ã€‚
>   é™¤æ•°ä¸ä¸º `0`ã€‚
>   å‡è®¾æˆ‘ä»¬çš„ç¯å¢ƒåªèƒ½å­˜å‚¨ `32` ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œå…¶æ•°å€¼èŒƒå›´æ˜¯ $[âˆ’2^{31},  2^{31} âˆ’ 1]$ã€‚æœ¬é¢˜ä¸­ï¼Œå¦‚æœé™¤æ³•ç»“æœæº¢å‡ºï¼Œåˆ™è¿”å› $2^{31} âˆ’ 1$ã€‚

**æ‰‹å†™ç¨¿**

![4102110](img/4102110.png)

**ä»£ç **

```c++
#define x first
#define y second
typedef pair<int, int> PII;
class Solution {
public:
    int divide(int a, int b) {
        int sign = (a < 0) ^ (b < 0);
        if (a > 0) a = 0 - a;
        if (b > 0) b = 0 - b;
        vector<PII> nums; // ç¬¬äºŒç»´è®°å½•-1 << i
        for (int i = 0, bia = b, t = -1; i < 32; i ++ ) {
            nums.push_back({bia, t});
            // è¶Šç•Œ, åˆ™ç›´æ¥è¿”å›å³å¯
            if (bia < a / 2) break;
            bia += bia;
            t += t;
        }
        int res = 0;
        for (int i = nums.size() - 1; i >= 0; i -- )
            if (a <= nums[i].x) {
                res += nums[i].y;
                a -= nums[i].x;
            }
        // å¦‚æœåŒå·
        if (!sign) {
            // å¦‚æœç­‰äºæœ€å°å€¼, åˆ™å–åä¹‹åä¸€å®šä¼šè¶Šç•Œ, æ•…, è¿”å›æœ€å¤§å€¼å³å¯
            if (res == INT_MIN) res = INT_MAX;
            // å¦åˆ™, å–åå³å¯
            else res = 0 - res;
        }
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(log_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(log_n)$

**æ ‡ç­¾**

`ä½è¿ç®—`

**ç¼åˆæ€ª**



### å¿«é€Ÿå¹‚

#### æ•´æ•°å¿«é€Ÿå¹‚

##### [AcWing 875. å¿«é€Ÿå¹‚](https://www.acwing.com/problem/content/877/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` ç»„ $a_i, b_i, p_i$ï¼Œå¯¹äºæ¯ç»„æ•°æ®ï¼Œæ±‚å‡º $a_i^{b_i} mod p_i$ çš„å€¼ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $a_i, b_i, p_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ç»„æ•°æ®ï¼Œè¾“å‡ºä¸€ä¸ªç»“æœï¼Œè¡¨ç¤º $a_i^{b_i} mod p_i$ çš„å€¼ã€‚
>
>   æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 100000,$
>   +   $1 â‰¤ a_i, b_i, p_i â‰¤ 2 Ã— 10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
2
3 2 5
4 3 9
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
1
```

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ¿é¢˜

**ä»£ç **

```c++
#include <iostream>
using namespace std;
typedef long long LL;
int n;
int qmi(int a, int b, int p) {
    int res = 1;
    while (b) {
        // è½¬æˆlong longç±»å‹, ä¹˜ç§¯å¯èƒ½ä¼šçˆ†intç±»å‹
        if (b & 1) res = (LL)res * a % p;
        // è½¬æˆlong longç±»å‹, ä¹˜ç§¯å¯èƒ½ä¼šçˆ†intç±»å‹
        a = (LL)a * a % p;
        b >>= 1;
    }
    return res;
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ ) {
        int a, b, p;
        scanf("%d%d%d", &a, &b, &p);
        cout << qmi(a, b, p) << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_b)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`å¿«é€Ÿå¹‚`

**ç¼åˆæ€ª**



#### çŸ©é˜µå¿«é€Ÿå¹‚

#### [T103763 ã€æ¨¡æ¿ã€‘çŸ©é˜µä¹˜æ³•](https://www.luogu.com.cn/problem/T103763)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªçŸ©é˜µ`aã€b`ï¼Œæ±‚çŸ©é˜µ`c = a * b`ã€‚

**è¾“å…¥æ ¼å¼**

>   $x_1, y_1, x_2, y_2$åˆ†åˆ«ä¸ºçŸ©é˜µ `1` å’ŒçŸ©é˜µ `2` çš„åˆ—æ•°å’Œè¡Œæ•°ã€‚
>
>   ç¬¬ `1` è¡Œï¼š$x_1 y_1 x_2 y_2$
>
>   ç¬¬ $2 \sim 2 + y_1$ è¡Œï¼šçŸ©é˜µ`1`
>
>   ç¬¬ $3 + y_1 \sim 3 + y_1 + y_2$ è¡Œï¼šçŸ©é˜µ`2`
>
>   ï¼ˆæ•°æ®ä¿è¯$x_1 = y_2$ï¼‰

**è¾“å‡ºæ ¼å¼**

>   å…± $x_1$ è¡Œï¼Œæ¯è¡Œè¾“å‡ºçŸ©é˜µ `c` åœ¨è¯¥è¡Œçš„æ¯ä¸ªå€¼

**è¾“å…¥æ ·ä¾‹1**

```c++
2 2 2 2
2 2
2 2
2 2
2 2
```

**è¾“å‡ºæ ·ä¾‹1**

```c++
8 8
8 8
```

**è¾“å…¥æ ·ä¾‹2**

```c++
2 2 2 2
1 2
3 1
2 5
1 7
```

**è¾“å‡ºæ ·ä¾‹2**

```c++
4 19
7 22
```

**è¯´æ˜/æç¤º**

>   $å¯¹äº 100\% çš„æ•°æ®ï¼Œ1 <= x_1, y_1, x_2, y_2 <= 100ï¼Œ1 <= çŸ©é˜µa, bä¸­çš„æ¯ä¸ªå€¼ <= 100$

**æ‰‹å†™ç¨¿**

![4201432](img/4201432.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 110;
int x1, y1, x2, y2;
int a[N][N], b[N][N], res[N][N];
int main() {
    // å°å°çš„æ³¨æ„ç‚¹: å…ˆè¾“å…¥åˆ—æ•°, å†è¾“å…¥è¡Œæ•°
    scanf("%d%d%d%d", &y1, &x1, &y2, &x2);
    for (int i = 0; i < x1; i ++ )
        for (int j = 0; j < y1; j ++ )
            scanf("%d", &a[i][j]);
    for (int i = 0; i < x2; i ++ )
        for (int j = 0; j < y2; j ++ )
            scanf("%d", &b[i][j]);
    // æšä¸¾åˆ—
    for (int k = 0; k < x2; k ++ )
        // æšä¸¾æ¨ªåæ ‡
        for (int i = 0; i < x1; i ++ )
            // æšä¸¾çºµåæ ‡
            for (int j = 0; j < y2; j ++ )
                res[i][j] += a[i][k] * b[k][j];
    for (int i = 0; i < x1; i ++ ) {
        for (int j = 0; j < y2; j ++ )
            cout << res[i][j] << " ";
        cout << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(x_1x_2y_2)$

**ç©ºé—´å¤æ‚åº¦**

$O(max(x_1 * y_1, x_2 * y_ 2))$

**æ ‡ç­¾**

`çŸ©é˜µä¹˜æ³•`

**ç¼åˆæ€ª**



##### [P3390 ã€æ¨¡æ¿ã€‘çŸ©é˜µå¿«é€Ÿå¹‚](https://www.luogu.com.cn/problem/P3390)

**é¢˜ç›®æè¿°**

>   ç»™å®š $n\times n$ çš„çŸ©é˜µ `A`ï¼Œæ±‚ $A^k$ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `n, k` æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡Œ `n` ä¸ªæ•´æ•°ï¼Œç¬¬ `i` è¡Œçš„ç¬¬ `j` çš„æ•°è¡¨ç¤º $A_{i,j}$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡º$ A^k$
>
>   å…± `n` è¡Œï¼Œæ¯è¡Œ `n` ä¸ªæ•°ï¼Œç¬¬ `i` è¡Œç¬¬ `j` ä¸ªæ•°è¡¨ç¤º $(A^k)_{i,j}$ï¼Œæ¯ä¸ªå…ƒç´ å¯¹ $10^9 + 7$ å–æ¨¡ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
2 1
1 1
1 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 1
1 1
```

**è¯´æ˜/æç¤º**

>   ã€æ•°æ®èŒƒå›´ã€‘
>   å¯¹äº $100\%$ çš„æ•°æ®ï¼š$1\le n \le 100ï¼Œ0 \le k \le 10^{12}, |A_{i,j}| \le 1000$

**æ‰‹å†™ç¨¿**

>   1.   çŸ©é˜µä¸­çš„å•ä½ `â€œ1â€` è¢«ç§°ä½œå•ä½çŸ©é˜µ
>
>   2.   `4` é˜¶å•ä½çŸ©é˜µ, ä¸»å¯¹è§’çº¿ä¸º `1`, å…¶ä»–ä¸º `0`
>        $$
>        A=\begin{bmatrix}
>        1 & 0 & 0 & 0 \\
>        0 & 1 & 0 & 0 \\
>        0 & 0 & 1 & 0 \\
>        0 & 0 & 0 & 1 \\
>        \end{bmatrix}_{4 \times 4}
>        $$

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
typedef long long LL;
const int N = 100, mod = 1e9 + 7;
LL n, k;
LL g[N][N], res[N][N];
void mul(LL c[][N], LL a[][N], LL b[][N]) {
    static LL tmp[N][N];
    // åˆå§‹åŒ–ä¸º0
    memset(tmp, 0, sizeof tmp);
    for (int k = 0; k < n; k ++ )
        for (int i = 0; i < n; i ++ )
            for (int j = 0; j < n; j ++ )
                // ä¸å¯å†™æˆ +=
                tmp[i][j] = (tmp[i][j] + (a[i][k] * b[k][j] % mod)) % mod;
    memcpy(c, tmp, sizeof tmp);
    return;
}
void qmi() {
    // åˆå§‹åŒ–ä¸ºå•ä½çŸ©é˜µ
    for (int i = 0; i < n; i ++ ) res[i][i] = 1;
    while (k) {
        if (k & 1) mul(res, res, g);
        mul(g, g, g);
        k >>= 1;
    }
    return;
}
int main() {
    // æ³¨æ„: ä½¿ç”¨long longç±»å‹
    scanf("%lld%lld", &n, &k);
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            scanf("%lld", &g[i][j]);
    qmi();
    for (int i = 0; i < n; i ++ ) {
        for (int j = 0; j < n; j ++ )
            cout << res[i][j] << " ";
        cout << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2logk)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`çŸ©é˜µå¿«é€Ÿå¹‚`

**ç¼åˆæ€ª**



## ç¦»æ•£åŒ–

### [AcWing 802. åŒºé—´å’Œ](https://www.acwing.com/problem/content/804/)

**é¢˜ç›®æè¿°**

>   å‡å®šæœ‰ä¸€ä¸ªæ— é™é•¿çš„æ•°è½´ï¼Œæ•°è½´ä¸Šæ¯ä¸ªåæ ‡ä¸Šçš„æ•°éƒ½æ˜¯ `0`ã€‚
>
>   ç°åœ¨ï¼Œæˆ‘ä»¬é¦–å…ˆè¿›è¡Œ `n` æ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œå°†æŸä¸€ä½ç½® `x` ä¸Šçš„æ•°åŠ  `c`ã€‚
>
>   æ¥ä¸‹æ¥ï¼Œè¿›è¡Œ `m` æ¬¡è¯¢é—®ï¼Œæ¯ä¸ªè¯¢é—®åŒ…å«ä¸¤ä¸ªæ•´æ•° `l` å’Œ `r`ï¼Œä½ éœ€è¦æ±‚å‡ºåœ¨åŒºé—´ `[l,r]` ä¹‹é—´çš„æ‰€æœ‰æ•°çš„å’Œã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `x` å’Œ `c`ã€‚
>
>   å†æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `l` å’Œ `r`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…± `m` è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªè¯¢é—®ä¸­æ‰€æ±‚çš„åŒºé—´å†…æ•°å­—å’Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $âˆ’10^9â‰¤xâ‰¤10^9,$
>   +   $1â‰¤n,mâ‰¤10^5,$
>   +   $âˆ’10^9â‰¤lâ‰¤râ‰¤10^9,$
>   +   $âˆ’10000â‰¤câ‰¤10000$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2
3 6
7 5
1 3
4 6
7 8
```

**è¾“å‡ºæ ·ä¾‹**

```c++
8
0
5
```

**æ‰‹å†™ç¨¿**

>   1.   æ³¨æ„ç‚¹: å¼€ä¸‰å€ç©ºé—´

**ä»£ç **

```c++
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
typedef pair<int, int> PII;
// æ³¨æ„: å¯èƒ½æ‰€æœ‰è¾¹(x, l, r)éƒ½ä¸ç›¸ç­‰, æ•…, éœ€è¦å¼€ä¸‰å€ç©ºé—´
const int N = 300010;
int n, m;
int sum[N], g[N];
vector<int> points;
vector<PII> oper, query;
int get(int x) {
    int l = 0, r = points.size() - 1;
    while (l < r) {
        int mid = l + r >> 1;
        if (points[mid] >= x) r = mid;
        else l = mid + 1;
    }
    // ä¸‹æ ‡ä»1å¼€å§‹
    return l + 1;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n; i ++ ) {
        int x, c;
        scanf("%d%d", &x, &c);
        // ç»Ÿè®¡æ‰€æœ‰ç‚¹
        points.push_back(x);
        // ä¿å­˜æ¯ä¸ªæ·»åŠ æ“ä½œ
        oper.push_back({x, c});
    }
    for (int i = 0; i < m; i ++ ) {
        int l, r;
        scanf("%d%d", &l, &r);
        // ä¿å­˜æ¯ä¸ªæŸ¥è¯¢
        query.push_back({l, r});
        // ç»Ÿè®¡æ‰€æœ‰ç‚¹
        points.push_back(l);
        // ç»Ÿè®¡æ¯ä¸ªç‚¹
        points.push_back(r);
    }
    // æ’åº
    sort(points.begin(), points.end());
    // å»æ‰é‡å¤å…ƒç´ 
    points.erase(unique(points.begin(), points.end()), points.end());
    // ç¦»æ•£åŒ–ä¹‹åè¿›è¡Œæ·»åŠ æ•°æ“ä½œ
    for (auto [x, c] : oper) g[get(x)] += c;
    // æ±‚å‰ç¼€å’Œ
    for (int i = 1; i <= points.size(); i ++ ) sum[i] = g[i] + sum[i - 1];
    // æ±‚åŒºé—´å’Œ
    for (auto [l, r] : query) cout << sum[get(r)] - sum[get(l) - 1] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`ç¦»æ•£åŒ–`

**ç¼åˆæ€ª**



# åŠ¨æ€è§„åˆ’



## ç®€å• `DP`

### [LeetCode 221. æœ€å¤§æ­£æ–¹å½¢](https://leetcode-cn.com/problems/maximal-square/)

**é¢˜ç›®æè¿°**

> åœ¨ä¸€ä¸ªç”± `'0'` å’Œ `'1'` ç»„æˆçš„äºŒç»´çŸ©é˜µå†…ï¼Œæ‰¾åˆ°åªåŒ…å« `'1'` çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚

**ç¤ºä¾‹ 1**

![æœ€å¤§æ­£æ–¹å½¢ å›¾1](img/%E6%9C%80%E5%A4%A7%E6%AD%A3%E6%96%B9%E5%BD%A2%20%E5%9B%BE1.jpeg)

> è¾“å…¥ï¼š`matrix = [["1","0","1","0","0"],["1","0","1","1","1"],["1","1","1","1","1"],["1","0","0","1","0"]]`
> è¾“å‡ºï¼š`4`

**ç¤ºä¾‹ 2**

![æœ€å¤§æ­£æ–¹å½¢ å›¾2](img/%E6%9C%80%E5%A4%A7%E6%AD%A3%E6%96%B9%E5%BD%A2%20%E5%9B%BE2.jpeg)

> è¾“å…¥ï¼š`matrix = [["0","1"],["1","0"]]`
> è¾“å‡ºï¼š`1`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`matrix = [["0"]]`
> è¾“å‡ºï¼š`0`

**æç¤º**

> `m == matrix.length`
> `n == matrix[i].length`
> `1 <= m, n <= 300`
> `matrix[i][j] ä¸º '0' æˆ– '1'`

**æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’**

![æœ€å¤§æ­£æ–¹å½¢ åŠ¨æ€è§„åˆ’](img/%E6%9C%80%E5%A4%A7%E6%AD%A3%E6%96%B9%E5%BD%A2%20%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.png)

**ä»£ç ä¸€ï¼šäºŒç»´æ•°ç»„**

```c++
class Solution {
public:
    int maximalSquare(vector<vector<char>>& g) {
        int n = g.size(), m = g[0].size();
        vector<vector<int>> f(n + 5, vector<int>(m + 5));
        int res = -1;
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= m; j ++ ) {
                if (g[i - 1][j - 1] == '0') f[i][j] = 0;
                else f[i][j] = min(f[i - 1][j], min(f[i][j - 1], f[i - 1][j - 1])) + 1;
                res = max(res, f[i][j] * f[i][j]);
            }
        return res;
    }
};
```

**ä»£ç äºŒï¼šæ»šåŠ¨æ•°ç»„ä¼˜åŒ–**

```c++
class Solution {
public:
    int maximalSquare(vector<vector<char>>& g) {
        int n = g.size(), m = g[0].size();
        vector<vector<int>> f(2, vector<int>(m + 5));
        int res = -1;
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= m; j ++ ) {
                if (g[i - 1][j - 1] == '0') f[i & 1][j] = 0;
                else f[i & 1][j] = min(f[i - 1 & 1][j], min(f[i & 1][j - 1], f[i - 1 & 1][j - 1])) + 1;
                res = max(res, f[i & 1][j] * f[i & 1][j]);
            }
        return res;
    }
};
```

**æ³•äºŒï¼šå•è°ƒæ ˆ**

![æœ€å¤§æ­£æ–¹å½¢ å•è°ƒæ ˆ](img/%E6%9C%80%E5%A4%A7%E6%AD%A3%E6%96%B9%E5%BD%A2%20%E5%8D%95%E8%B0%83%E6%A0%88.png)

**ä»£ç **

```c++
class Solution {
public:
    int maximalSquare(vector<vector<char>>& g) {
        int n = g.size(), m = g[0].size();
        vector<vector<int>> f(n + 5, vector<int>(m + 5));
        for (int i = 0; i < m; i ++ ) f[0][i] = g[0][i] - '0';
        for (int i = 1; i < n; i ++ )
            for (int j = 0; j < m; j ++ )
                if (g[i][j] == '1') f[i][j] = f[i - 1][j] + 1;
        int res = -1;
        for (int i = 0; i < n; i ++ ) {
            stack<int> sk;
            vector<int> left(m + 5), right(m + 5);
            for (int j = 0; j < m; j ++ ) {
                while (sk.size() && f[i][j] <= f[i][sk.top()]) sk.pop();
                if (sk.empty()) left[j] = -1;
                else left[j] = sk.top();
                sk.push(j);
            }
            sk = stack<int>();
            for (int j = m - 1; j >= 0; j -- ) {
                while (sk.size() && f[i][j] <= f[i][sk.top()]) sk.pop();
                if (sk.empty()) right[j] = m;
                else right[j] = sk.top();
                sk.push(j);
            }
            for (int j = 0; j < m; j ++ )
                if (right[j] - left[j] - 1 >= f[i][j])
                    res = max(res, f[i][j] * f[i][j]);
        }
        return res;
    }
};
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`

## æ•°å­—ä¸‰è§’å½¢æ¨¡å‹

### [AcWing 898. æ•°å­—ä¸‰è§’å½¢](https://www.acwing.com/problem/content/900/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ•°å­—ä¸‰è§’å½¢ï¼Œä»é¡¶éƒ¨å‡ºå‘ï¼Œåœ¨æ¯ä¸€ç»“ç‚¹å¯ä»¥é€‰æ‹©ç§»åŠ¨è‡³å…¶å·¦ä¸‹æ–¹çš„ç»“ç‚¹æˆ–ç§»åŠ¨è‡³å…¶å³ä¸‹æ–¹çš„ç»“ç‚¹ï¼Œä¸€ç›´èµ°åˆ°åº•å±‚ï¼Œè¦æ±‚æ‰¾å‡ºä¸€æ¡è·¯å¾„ï¼Œä½¿è·¯å¾„ä¸Šçš„æ•°å­—çš„å’Œæœ€å¤§ã€‚
>
>   ```c++
>           7
>         3   8
>       8   1   0
>     2   7   4   4
>   4   5   2   6   5
>   ```

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ï¼Œè¡¨ç¤ºæ•°å­—ä¸‰è§’å½¢çš„å±‚æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«è‹¥å¹²æ•´æ•°ï¼Œå…¶ä¸­ç¬¬ `i` è¡Œè¡¨ç¤ºæ•°å­—ä¸‰è§’å½¢ç¬¬ `i` å±‚åŒ…å«çš„æ•´æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§çš„è·¯å¾„æ•°å­—å’Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤500,$
>   +   $âˆ’10000â‰¤ä¸‰è§’å½¢ä¸­çš„æ•´æ•°â‰¤10000$

**è¾“å…¥æ ·ä¾‹**

```c++
5
7
3 8
8 1 0 
2 7 4 4
4 5 2 6 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
30
```

**æ‰‹å†™ç¨¿**



**ä»£ç ä¸€:ä»ä¸Šå¾€ä¸‹**

```c++
#include <iostream>
using namespace std;
const int N = 510, INF = 0x3f3f3f3f;
int n;
int g[N][N], f[N][N];
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= i; j ++ )
            scanf("%d", &g[i][j]);
    f[1][1] = g[1][1];
    for (int i = 2; i <= n; i ++ )
        for (int j = 1; j <= i; j ++ )
            // æ³¨æ„: è¾¹ç•Œå¤„ç†
            if (j == 1) f[i][j] = f[i - 1][j] + g[i][j];
            else if (j == i) f[i][j] = f[i - 1][j - 1] + g[i][j];
            else f[i][j] = max(f[i - 1][j], f[i - 1][j - 1]) + g[i][j];
    int res = -INF;
    // å¾ªç¯ä¸€é, å¯»æ‰¾æœ€å¤§å€¼
    for (int i = 1; i <= n; i ++ ) res = max(res, f[n][i]);
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n ^ 2)$

**ä»£ç äºŒ:ä»ä¸‹å¾€ä¸Š**



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



### [AcWing 1015. æ‘˜èŠ±ç”Ÿ](https://www.acwing.com/problem/content/1017/)

**é¢˜ç›®æè¿°**

>   `Hello Kitty` æƒ³æ‘˜ç‚¹èŠ±ç”Ÿé€ç»™å¥¹å–œæ¬¢çš„ç±³è€é¼ ã€‚
>
>   å¥¹æ¥åˆ°ä¸€ç‰‡æœ‰ç½‘æ ¼çŠ¶é“è·¯çš„çŸ©å½¢èŠ±ç”Ÿåœ°(å¦‚ä¸‹å›¾)ï¼Œä»è¥¿åŒ—è§’è¿›å»ï¼Œä¸œå—è§’å‡ºæ¥ã€‚
>
>   åœ°é‡Œæ¯ä¸ªé“è·¯çš„äº¤å‰ç‚¹ä¸Šéƒ½æœ‰ç§ç€ä¸€æ ªèŠ±ç”Ÿè‹—ï¼Œä¸Šé¢æœ‰è‹¥å¹²é¢—èŠ±ç”Ÿï¼Œç»è¿‡ä¸€æ ªèŠ±ç”Ÿè‹—å°±èƒ½æ‘˜èµ°è¯¥å®ƒä¸Šé¢æ‰€æœ‰çš„èŠ±ç”Ÿã€‚
>
>   `Hello Kitty` åªèƒ½å‘ä¸œæˆ–å‘å—èµ°ï¼Œä¸èƒ½å‘è¥¿æˆ–å‘åŒ—èµ°ã€‚
>
>   é—® `Hello Kitty` æœ€å¤šèƒ½å¤Ÿæ‘˜åˆ°å¤šå°‘é¢—èŠ±ç”Ÿã€‚
>
>   ![1.gif](img/19_a8509f26d5-1.gif)

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•° `T`ï¼Œä»£è¡¨ä¸€å…±æœ‰å¤šå°‘ç»„æ•°æ®ã€‚
>
>   æ¥ä¸‹æ¥æ˜¯ `T` ç»„æ•°æ®ã€‚
>
>   æ¯ç»„æ•°æ®çš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«ä»£è¡¨èŠ±ç”Ÿè‹—çš„è¡Œæ•° `R` å’Œåˆ—æ•° `C`ã€‚
>
>   æ¯ç»„æ•°æ®çš„æ¥ä¸‹æ¥ `R` è¡Œæ•°æ®ï¼Œä»åŒ—å‘å—ä¾æ¬¡æè¿°æ¯è¡ŒèŠ±ç”Ÿè‹—çš„æƒ…å†µã€‚æ¯è¡Œæ•°æ®æœ‰ `C` ä¸ªæ•´æ•°ï¼ŒæŒ‰ä»è¥¿å‘ä¸œçš„é¡ºåºæè¿°äº†è¯¥è¡Œæ¯æ ªèŠ±ç”Ÿè‹—ä¸Šçš„èŠ±ç”Ÿæ•°ç›® `M`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹æ¯ç»„è¾“å…¥æ•°æ®ï¼Œè¾“å‡ºä¸€è¡Œï¼Œå†…å®¹ä¸º `Hello Kitty` èƒ½æ‘˜åˆ°å¾—æœ€å¤šçš„èŠ±ç”Ÿé¢—æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ T â‰¤ 100,$
>   +   $1 â‰¤ R, C â‰¤ 100,$
>   +   $0 â‰¤ M â‰¤ 1000$

**è¾“å…¥æ ·ä¾‹**

```c++
2
2 2
1 1
3 4
2 3
2 3 4
1 6 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
8
16
```

**æ‰‹å†™ç¨¿**

![4172205](img/4172205.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110;
int n, m, T;
int g[N][N], f[N][N];
int main() {
    scanf("%d", &T);
    while (T -- ) {
        memset(g, 0, sizeof g);
        memset(f, 0, sizeof f);
        scanf("%d%d", &n, &m);
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= m; j ++ )
                scanf("%d", &g[i][j]);
        // DP
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= m; j ++ )
                f[i][j] = max(f[i - 1][j], f[i][j - 1]) + g[i][j];
        cout << f[n][m] << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(nm)$

**æ ‡ç­¾**

`DP`ã€`åŠ¨æ€è§„åˆ’`

**ç¼åˆæ€ª**



### [AcWing 1018. æœ€ä½é€šè¡Œè´¹](https://www.acwing.com/problem/content/1020/)

**é¢˜ç›®æè¿°**

>   ä¸€ä¸ªå•†äººç©¿è¿‡ä¸€ä¸ª `N Ã— N` çš„æ­£æ–¹å½¢çš„ç½‘æ ¼ï¼Œå»å‚åŠ ä¸€ä¸ªéå¸¸é‡è¦çš„å•†åŠ¡æ´»åŠ¨ã€‚
>
>   ä»–è¦ä»ç½‘æ ¼çš„å·¦ä¸Šè§’è¿›ï¼Œå³ä¸‹è§’å‡ºã€‚
>
>   æ¯ç©¿è¶Šä¸­é—´ `1` ä¸ªå°æ–¹æ ¼ï¼Œéƒ½è¦èŠ±è´¹ `1` ä¸ªå•ä½æ—¶é—´ã€‚
>
>   å•†äººå¿…é¡»åœ¨ `(2N âˆ’ 1)` ä¸ªå•ä½æ—¶é—´ç©¿è¶Šå‡ºå»ã€‚
>
>   è€Œåœ¨ç»è¿‡ä¸­é—´çš„æ¯ä¸ªå°æ–¹æ ¼æ—¶ï¼Œéƒ½éœ€è¦ç¼´çº³ä¸€å®šçš„è´¹ç”¨ã€‚
>
>   è¿™ä¸ªå•†äººæœŸæœ›åœ¨è§„å®šæ—¶é—´å†…ç”¨æœ€å°‘è´¹ç”¨ç©¿è¶Šå‡ºå»ã€‚
>
>   è¯·é—®è‡³å°‘éœ€è¦å¤šå°‘è´¹ç”¨ï¼Ÿ
>
>   æ³¨æ„ï¼šä¸èƒ½å¯¹è§’ç©¿è¶Šå„ä¸ªå°æ–¹æ ¼ï¼ˆå³ï¼Œåªèƒ½å‘ä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ç§»åŠ¨ä¸”ä¸èƒ½ç¦»å¼€ç½‘æ ¼ï¼‰ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ­£æ–¹å½¢çš„å®½åº¦ `N`ã€‚
>
>   åé¢ `N` è¡Œï¼Œæ¯è¡Œ `N` ä¸ªä¸å¤§äº `100` çš„æ­£æ•´æ•°ï¼Œä¸ºç½‘æ ¼ä¸Šæ¯ä¸ªå°æ–¹æ ¼çš„è´¹ç”¨ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè‡³å°‘éœ€è¦çš„è´¹ç”¨ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 100$

**è¾“å…¥æ ·ä¾‹**

```c++
5
1  4  6  8  10
2  5  7  15 17
6  8  9  18 20
10 11 12 19 21
20 23 25 29 33
```

**è¾“å‡ºæ ·ä¾‹**

```c++
109
```

**æ ·ä¾‹è§£é‡Š**

>   æ ·ä¾‹ä¸­ï¼Œæœ€å°å€¼ä¸º `109=1+2+5+7+9+12+19+21+33`ã€‚

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



### [AcWing 1027. æ–¹æ ¼å–æ•°](https://www.acwing.com/problem/content/1029/)

**é¢˜ç›®æè¿°**

>   è®¾æœ‰ `NÃ—N` çš„æ–¹æ ¼å›¾ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­çš„æŸäº›æ–¹æ ¼ä¸­å¡«å…¥æ­£æ•´æ•°ï¼Œè€Œå…¶å®ƒçš„æ–¹æ ¼ä¸­åˆ™æ”¾å…¥æ•°å­—`0`ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
>
>   ![2.gif](img/19_764ece6ed5-2.gif)
>
>   æŸäººä»å›¾ä¸­çš„å·¦ä¸Šè§’ `A` å‡ºå‘ï¼Œå¯ä»¥å‘ä¸‹è¡Œèµ°ï¼Œä¹Ÿå¯ä»¥å‘å³è¡Œèµ°ï¼Œç›´åˆ°åˆ°è¾¾å³ä¸‹è§’çš„ `B` ç‚¹ã€‚
>
>   åœ¨èµ°è¿‡çš„è·¯ä¸Šï¼Œä»–å¯ä»¥å–èµ°æ–¹æ ¼ä¸­çš„æ•°ï¼ˆå–èµ°åçš„æ–¹æ ¼ä¸­å°†å˜ä¸ºæ•°å­—`0`ï¼‰ã€‚
>
>   æ­¤äººä» `A` ç‚¹åˆ° `B` ç‚¹å…±èµ°äº†ä¸¤æ¬¡ï¼Œè¯•æ‰¾å‡ºä¸¤æ¡è¿™æ ·çš„è·¯å¾„ï¼Œä½¿å¾—å–å¾—çš„æ•°å­—å’Œä¸ºæœ€å¤§ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ•´æ•°`N`ï¼Œè¡¨ç¤º `NÃ—N` çš„æ–¹æ ¼å›¾ã€‚
>
>   æ¥ä¸‹æ¥çš„æ¯è¡Œæœ‰ä¸‰ä¸ªæ•´æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºè¡Œå·æ•°ï¼Œç¬¬äºŒä¸ªä¸ºåˆ—å·æ•°ï¼Œç¬¬ä¸‰ä¸ªä¸ºåœ¨è¯¥è¡Œã€è¯¥åˆ—ä¸Šæ‰€æ”¾çš„æ•°ã€‚
>
>   è¡Œå’Œåˆ—ç¼–å·ä» `1` å¼€å§‹ã€‚
>
>   ä¸€è¡Œâ€œ`0 0 0`â€è¡¨ç¤ºç»“æŸã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸¤æ¡è·¯å¾„ä¸Šå–å¾—çš„æœ€å¤§çš„å’Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $N â‰¤ 10$

**è¾“å…¥æ ·ä¾‹**

```c++
8
2 3 13
2 6 6
3 5 7
4 4 14
5 2 21
5 6 4
6 3 15
7 2 14
0 0 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
67
```

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



### [AcWing 275. ä¼ çº¸æ¡](https://www.acwing.com/problem/content/277/)

**é¢˜ç›®æè¿°**

>   å°æ¸Šå’Œå°è½©æ˜¯å¥½æœ‹å‹ä¹Ÿæ˜¯åŒç­åŒå­¦ï¼Œä»–ä»¬åœ¨ä¸€èµ·æ€»æœ‰è°ˆä¸å®Œçš„è¯é¢˜ã€‚
>
>   ä¸€æ¬¡ç´ è´¨æ‹“å±•æ´»åŠ¨ä¸­ï¼Œç­ä¸ŠåŒå­¦å®‰æ’åæˆä¸€ä¸ª `m` è¡Œ `n` åˆ—çš„çŸ©é˜µï¼Œè€Œå°æ¸Šå’Œå°è½©è¢«å®‰æ’åœ¨çŸ©é˜µå¯¹è§’çº¿çš„ä¸¤ç«¯ï¼Œå› æ­¤ï¼Œä»–ä»¬å°±æ— æ³•ç›´æ¥äº¤è°ˆäº†ã€‚
>
>   å¹¸è¿çš„æ˜¯ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡ä¼ çº¸æ¡æ¥è¿›è¡Œäº¤æµã€‚
>
>   çº¸æ¡è¦ç»ç”±è®¸å¤šåŒå­¦ä¼ åˆ°å¯¹æ–¹æ‰‹é‡Œï¼Œå°æ¸Šååœ¨çŸ©é˜µçš„å·¦ä¸Šè§’ï¼Œåæ ‡ `(1,1)`ï¼Œå°è½©ååœ¨çŸ©é˜µçš„å³ä¸‹è§’ï¼Œåæ ‡ `(m,n)`ã€‚
>
>   ä»å°æ¸Šä¼ åˆ°å°è½©çš„çº¸æ¡åªå¯ä»¥å‘ä¸‹æˆ–è€…å‘å³ä¼ é€’ï¼Œä»å°è½©ä¼ ç»™å°æ¸Šçš„çº¸æ¡åªå¯ä»¥å‘ä¸Šæˆ–è€…å‘å·¦ä¼ é€’ã€‚â€‚
>
>   åœ¨æ´»åŠ¨è¿›è¡Œä¸­ï¼Œå°æ¸Šå¸Œæœ›ç»™å°è½©ä¼ é€’ä¸€å¼ çº¸æ¡ï¼ŒåŒæ—¶å¸Œæœ›å°è½©ç»™ä»–å›å¤ã€‚
>
>   ç­é‡Œæ¯ä¸ªåŒå­¦éƒ½å¯ä»¥å¸®ä»–ä»¬ä¼ é€’ï¼Œä½†åªä¼šå¸®ä»–ä»¬ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæ­¤äººåœ¨å°æ¸Šé€’ç»™å°è½©çº¸æ¡çš„æ—¶å€™å¸®å¿™ï¼Œé‚£ä¹ˆåœ¨å°è½©é€’ç»™å°æ¸Šçš„æ—¶å€™å°±ä¸ä¼šå†å¸®å¿™ï¼Œåä¹‹äº¦ç„¶ã€‚â€‚
>
>   è¿˜æœ‰ä¸€ä»¶äº‹æƒ…éœ€è¦æ³¨æ„ï¼Œå…¨ç­æ¯ä¸ªåŒå­¦æ„¿æ„å¸®å¿™çš„å¥½æ„Ÿåº¦æœ‰é«˜æœ‰ä½ï¼ˆæ³¨æ„ï¼šå°æ¸Šå’Œå°è½©çš„å¥½å¿ƒç¨‹åº¦æ²¡æœ‰å®šä¹‰ï¼Œè¾“å…¥æ—¶ç”¨ `0` è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥ç”¨ä¸€ä¸ª `0âˆ¼100` çš„è‡ªç„¶æ•°æ¥è¡¨ç¤ºï¼Œæ•°è¶Šå¤§è¡¨ç¤ºè¶Šå¥½å¿ƒã€‚
>
>   å°æ¸Šå’Œå°è½©å¸Œæœ›å°½å¯èƒ½æ‰¾å¥½å¿ƒç¨‹åº¦é«˜çš„åŒå­¦æ¥å¸®å¿™ä¼ çº¸æ¡ï¼Œå³æ‰¾åˆ°æ¥å›ä¸¤æ¡ä¼ é€’è·¯å¾„ï¼Œä½¿å¾—è¿™ä¸¤æ¡è·¯å¾„ä¸ŠåŒå­¦çš„å¥½å¿ƒç¨‹åº¦ä¹‹å’Œæœ€å¤§ã€‚
>
>   ç°åœ¨ï¼Œè¯·ä½ å¸®åŠ©å°æ¸Šå’Œå°è½©æ‰¾åˆ°è¿™æ ·çš„ä¸¤æ¡è·¯å¾„ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæœ‰ ``2`` ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ•´æ•° `m` å’Œ `n`ï¼Œè¡¨ç¤ºå­¦ç”ŸçŸ©é˜µæœ‰ `m` è¡Œ `n` åˆ—ã€‚
>
>   æ¥ä¸‹æ¥çš„ `m` è¡Œæ˜¯ä¸€ä¸ª `mÃ—n` çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­ç¬¬ `i` è¡Œ `j` åˆ—çš„æ•´æ•°è¡¨ç¤ºååœ¨ç¬¬ `i` è¡Œ `j` åˆ—çš„å­¦ç”Ÿçš„å¥½å¿ƒç¨‹åº¦ï¼Œæ¯è¡Œçš„ `n` ä¸ªæ•´æ•°ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ¥å›ä¸¤æ¡è·¯ä¸Šå‚ä¸ä¼ é€’çº¸æ¡çš„å­¦ç”Ÿçš„å¥½å¿ƒç¨‹åº¦ä¹‹å’Œçš„æœ€å¤§å€¼ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤50$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
0 3 9
2 8 5
5 7 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
34
```

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



## çº¿æ€§ `DP`

### [AcWing 897. æœ€é•¿å…¬å…±å­åºåˆ—](https://www.acwing.com/problem/content/899/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªé•¿åº¦åˆ†åˆ«ä¸º `N` å’Œ `M` çš„å­—ç¬¦ä¸² `A` å’Œ `B`ï¼Œæ±‚æ—¢æ˜¯ `A` çš„å­åºåˆ—åˆæ˜¯ `B` çš„å­åºåˆ—çš„å­—ç¬¦ä¸²é•¿åº¦æœ€é•¿æ˜¯å¤šå°‘ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å«ä¸€ä¸ªé•¿åº¦ä¸º `N` çš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸² `A`ã€‚
>
>   ç¬¬ä¸‰è¡ŒåŒ…å«ä¸€ä¸ªé•¿åº¦ä¸º `M` çš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸² `B`ã€‚
>
>   å­—ç¬¦ä¸²å‡ç”±å°å†™å­—æ¯æ„æˆã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§é•¿åº¦ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N, M â‰¤ 1000$

**è¾“å…¥æ ·ä¾‹**

```c++
4 5
acbd
abedc
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![4132130](img/4132130.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, m;
char A[N], B[N];
int f[N][N];
int main() {
    scanf("%d%d%s%s", &n, &m, A + 1, B + 1);
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= m; j ++ )
            if (A[i] == B[j])
                f[i][j] = max(f[i][j], f[i - 1][j - 1] + 1);
            else
                f[i][j] = max(f[i][j], max(f[i - 1][j], f[i][j - 1]));
    cout << f[n][m] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(nm)$

**æ ‡ç­¾**

`çº¿æ€§DP`

**ç¼åˆæ€ª**



## æ ‘å½¢`DP`

### æ ‘çš„ç›´å¾„ç»å…¸æ±‚æ³•

**å‰ææ¡ä»¶**

![2091531](img/2091531.png)

**å®šç†**

> ä»»æ„å¯»æ‰¾æ ‘ä¸­çš„æŸä¸€ç‚¹ï¼Œå¯»æ‰¾æ ‘ä¸­è·ç¦»å½“å‰èŠ‚ç‚¹æœ€è¿œçš„ç‚¹ `u`ï¼Œå†å¯»æ‰¾è·ç¦» `u` æœ€è¿œçš„ç‚¹ `v`ï¼Œåˆ™æ ‘çš„ç›´å¾„å³ä¸º `u` åˆ° `v` ç»è¿‡çš„èŠ‚ç‚¹æ•°ç›®

**è¯æ˜**

![2091538](img/2091538.png)

### [AcWing 1072. æ ‘çš„æœ€é•¿è·¯å¾„](https://www.acwing.com/problem/content/1074/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€æ£µæ ‘ï¼Œæ ‘ä¸­åŒ…å« `n` ä¸ªç»“ç‚¹ï¼ˆç¼–å·`1~n`ï¼‰å’Œ `nâˆ’1` æ¡æ— å‘è¾¹ï¼Œæ¯æ¡è¾¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼ã€‚
>
> ç°åœ¨è¯·ä½ æ‰¾åˆ°æ ‘ä¸­çš„ä¸€æ¡æœ€é•¿è·¯å¾„ã€‚
>
> æ¢å¥è¯è¯´ï¼Œè¦æ‰¾åˆ°ä¸€æ¡è·¯å¾„ï¼Œä½¿å¾—ä½¿å¾—è·¯å¾„ä¸¤ç«¯çš„ç‚¹çš„è·ç¦»æœ€è¿œã€‚
>
> æ³¨æ„ï¼šè·¯å¾„ä¸­å¯ä»¥åªåŒ…å«ä¸€ä¸ªç‚¹ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
> æ¥ä¸‹æ¥ `nâˆ’1` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $a_i,b_i,c_i$ï¼Œè¡¨ç¤ºç‚¹ $a_i$ å’Œ $b_i$ ä¹‹é—´å­˜åœ¨ä¸€æ¡æƒå€¼ä¸º $c_i$ çš„è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ ‘çš„æœ€é•¿è·¯å¾„çš„é•¿åº¦ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤nâ‰¤10000,$
> + $1â‰¤a_i,b_iâ‰¤n,$
> + $âˆ’10^5â‰¤c_iâ‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
6
5 1 6
1 4 5
6 3 9
2 6 8
6 1 7
```

**è¾“å‡ºæ ·ä¾‹**

```c++
22
```

**æ‰‹å†™ç¨¿**

![2101347](img/2101347.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 10010, M = N << 1;
int n, idx, ans;
int h[N], e[M], w[M], ne[M];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++ ;
    return;
}
// è¿”å›ä»¥uä¸ºæ ¹ç»“ç‚¹çš„æœ€å¤§æƒå€¼å’Œ
int dfs(int u, int father) {
    // d1è¡¨ç¤ºæœ€å¤§å€¼ï¼Œd2è¡¨ç¤ºæ¬¡å¤§å€¼
    int d1 = 0, d2 = 0;
    // ä»¥uä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘çš„æœ€å¤§æƒå€¼å’Œ
    int dist = 0;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (j == father) continue; // åŸå› åœ¨é¢˜è§£ä¸­å·²ç»è§£é‡Š
        int d = dfs(j, u) + w[i];
        dist = max(dist, d);
        if (d >= d1) d2 = d1, d1 = d;
        else if (d >= d2) d2 = d;
    }
    ans = max(ans, d1 + d2);
    return dist;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 0; i < n - 1; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    dfs(1, -1);
    cout << ans << endl;
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘å½¢DP`

### [AcWing 846. æ ‘çš„é‡å¿ƒ](https://www.acwing.com/problem/content/description/848/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€é¢—æ ‘ï¼Œæ ‘ä¸­åŒ…å« `n` ä¸ªç»“ç‚¹ï¼ˆç¼–å· `1âˆ¼n`ï¼‰å’Œ `nâˆ’1` æ¡æ— å‘è¾¹ã€‚
>
> è¯·ä½ æ‰¾åˆ°æ ‘çš„é‡å¿ƒï¼Œå¹¶è¾“å‡ºå°†é‡å¿ƒåˆ é™¤åï¼Œå‰©ä½™å„ä¸ªè¿é€šå—ä¸­ç‚¹æ•°çš„æœ€å¤§å€¼ã€‚
>
> é‡å¿ƒå®šä¹‰ï¼šé‡å¿ƒæ˜¯æŒ‡æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œå¦‚æœå°†è¿™ä¸ªç‚¹åˆ é™¤åï¼Œå‰©ä½™å„ä¸ªè¿é€šå—ä¸­ç‚¹æ•°çš„æœ€å¤§å€¼æœ€å°ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹è¢«ç§°ä¸ºæ ‘çš„é‡å¿ƒã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ï¼Œè¡¨ç¤ºæ ‘çš„ç»“ç‚¹æ•°ã€‚
>
> æ¥ä¸‹æ¥ `nâˆ’1` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `a` å’Œ `b`ï¼Œè¡¨ç¤ºç‚¹ `a` å’Œç‚¹ `b` ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•° `m`ï¼Œè¡¨ç¤ºå°†é‡å¿ƒåˆ é™¤åï¼Œå‰©ä½™å„ä¸ªè¿é€šå—ä¸­ç‚¹æ•°çš„æœ€å¤§å€¼ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤nâ‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
9
1 2
1 7
1 4
2 8
2 5
4 3
3 9
4 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
```

**æ‰‹å†™ç¨¿**

![2092103](img/2092103.png)

**æ³¨æ„äº‹é¡¹**

> 1. ä¸ºå•¥ `dfs(int u, int father)` è¦å®šä¹‰ä¸€ä¸ª `father` å˜é‡ï¼Œä»¥é˜²æ­¢ `åœˆ2` æ“ä½œï¼Œä»è€Œå¯¼è‡´æ— é™å¾ªç¯
>
>     ![2092107](img/2092107.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010, M = N << 1;
int n, idx, ans = 1e9;
int h[N], e[M], ne[M];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
int dfs(int u, int father) { // ä»¥uä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°
    int res = 0; // ä»¥uä¸ºæ ¹ç»“ç‚¹çš„æ ‘ä¸­çš„èŠ‚ç‚¹ä¸ªæ•°çš„æœ€å¤§å€¼
    int num = 1; // å„ä¸ªå­æ ‘çš„èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œè‡³å°‘åŒ…å«å½“å‰çš„èŠ‚ç‚¹ï¼Œæ•…åˆå§‹å€¼ä¸º1
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœå½“å‰éå†çš„ç‚¹æ˜¯å…¶çˆ¶äº²èŠ‚ç‚¹ï¼Œåˆ™è¿”å›ï¼Œé˜²æ­¢äº§ç”Ÿæ­»å¾ªç¯ï¼ŒåŸå› å·²è§£é‡Š
        if (j == father) continue;
        int d = dfs(j, u);
        num += d;
        res = max(res, d);
    }
    ans = min(ans, max(res, n - num));
    return num;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 0; i < n - 1; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        // æ— å‘å›¾
        add(a, b);
        add(b, a);
    }
    dfs(1, -1);
    cout << ans << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`ã€`æ ‘å½¢DP`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

### [AcWing 1073. æ ‘çš„ä¸­å¿ƒ](https://www.acwing.com/problem/content/1075/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€æ£µæ ‘ï¼Œæ ‘ä¸­åŒ…å« `n` ä¸ªç»“ç‚¹ï¼ˆç¼–å·`1~n`ï¼‰å’Œ `nâˆ’1` æ¡æ— å‘è¾¹ï¼Œæ¯æ¡è¾¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼ã€‚
>
> è¯·ä½ åœ¨æ ‘ä¸­æ‰¾åˆ°ä¸€ä¸ªç‚¹ï¼Œä½¿å¾—è¯¥ç‚¹åˆ°æ ‘ä¸­å…¶ä»–ç»“ç‚¹çš„æœ€è¿œè·ç¦»æœ€è¿‘ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
> æ¥ä¸‹æ¥ `nâˆ’1` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $a_i,b_i,c_i$ï¼Œè¡¨ç¤ºç‚¹ $a_i$ å’Œ $b_i$ ä¹‹é—´å­˜åœ¨ä¸€æ¡æƒå€¼ä¸º $c_i$ çš„è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€æ±‚ç‚¹åˆ°æ ‘ä¸­å…¶ä»–ç»“ç‚¹çš„æœ€è¿œè·ç¦»ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤nâ‰¤10000,$
> + $1â‰¤a_i,b_iâ‰¤n,$
> + $1â‰¤c_iâ‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
5 
2 1 1 
3 2 1 
4 3 1 
5 1 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
```

**æ‰‹å†™ç¨¿**

![2171435](img/2171435.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 10010, M = N << 1, INF = 0x3f3f3f3f;
int n, idx;
// d1[u]å’Œd2[u]åˆ†åˆ«è¡¨ç¤ºæ ¹ä¸ºuçš„æœ€é•¿è·¯å¾„å’Œæ¬¡é•¿è·¯å¾„
// up[u]è¡¨ç¤ºå‘uçš„ä¸Šæ–¹æœç´¢çš„æœ€é•¿è·¯å¾„
// p1[u]è¡¨ç¤ºuçš„æœ€å¤§å€¼æ¥è‡ªäºçˆ¶èŠ‚ç‚¹è¿˜æ˜¯å­èŠ‚ç‚¹
int h[N], e[M], w[M], ne[M], d1[N], d2[N], up[N], p1[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// å‘ä¸‹æœç´¢
int dfs_d(int u, int father) { // dfs_dè¿”å›èŠ‚ç‚¹uçš„æ‰€æœ‰ã€å­æ ‘ã€‘çš„æœ€å¤§è·¯å¾„å’Œ
    // åˆå§‹åŒ–èŠ‚ç‚¹çš„æœ€å¤§è·¯å¾„å’Œæ¬¡å¤§è·¯å¾„ä¸ºè´Ÿæ— ç©·
    d1[u] = d2[u] = -INF;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœå½“å‰èŠ‚ç‚¹jæ˜¯uçš„çˆ¶äº²ï¼Œåˆ™è¿”å›ï¼ŒåŸå› åœ¨æ¥¼ä¸Šçš„ä¸€é“é¢˜é‡Œé¢å·²ç»æè¿°è¿‡
        if (j == father) continue;
        // è®°å¾—åŠ ä¸Šå½“å‰æƒå€¼w[i]
        int d = dfs_d(j, u) + w[i];
        // æ›´æ–°æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼ï¼ŒåŒæ—¶è¦è®°å¾—æ›´æ–°uçš„æœ€å¤§å€¼æ¥è‡ªçš„è·¯å¾„ï¼Œåªéœ€è¦è®°æœ€å¤§å€¼å³å¯
        if (d >= d1[u]) d2[u] = d1[u], d1[u] = d, p1[u] = j;
        else if (d >= d2[u]) d2[u] = d;
    }
    // å¦‚æœd1å’Œd2æ²¡æœ‰è¢«æ›´æ–°ï¼Œåˆ™è¯´æ˜æ˜¯å¶èŠ‚ç‚¹ï¼Œåˆ™å°†å…¶æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼éƒ½åˆå§‹åŒ–ä¸º0å³å¯
    if (d1[u] == -INF) d1[u] = d2[u] = 0;
    // è¿”å›èŠ‚ç‚¹uæœ€å¤§å€¼
    return d1[u];
}
// å‘ä¸Šæœç´¢
void dfs_u(int u, int father) {
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (j == father) continue;
        // æ³¨æ„æ˜¯up[j]å’Œup[u]çš„ä½ç½®
        // æ³¨æ„w[i]æ˜¯åŠ åœ¨maxçš„å¤–é¢çš„
        if (p1[u] == j) up[j] = max(up[u], d2[u]) + w[i];
        else up[j] = max(up[u], d1[u]) + w[i];
        dfs_u(j, u);
    }
    return;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 0; i < n - 1; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    // æ ‘çš„å‘ä¸‹å¯»æ‰¾ã€ç”¨å­èŠ‚ç‚¹æ›´æ–°çˆ¶èŠ‚ç‚¹ã€‘
    dfs_d(1, -1);
    // æ ‘çš„å‘ä¸Šå¯»æ‰¾ã€ç”¨çˆ¶èŠ‚ç‚¹æ›´æ–°å­èŠ‚ç‚¹ã€‘
    dfs_u(1, -1);
    int res = INF;
    for (int i = 1; i <= n; i ++ ) res = min(res, max(d1[i], up[i]));
    cout << res << endl;
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘å½¢DP`ã€`æ¢æ ¹DP`

### [AcWing 1075. æ•°å­—è½¬æ¢](https://www.acwing.com/problem/content/1077/)

**é¢˜ç›®æè¿°**

> å¦‚æœä¸€ä¸ªæ•° `x` çš„çº¦æ•°ä¹‹å’Œ `y`ï¼ˆä¸åŒ…æ‹¬ä»–æœ¬èº«ï¼‰æ¯”ä»–æœ¬èº«å°ï¼Œé‚£ä¹ˆ `x` å¯ä»¥å˜æˆ `y`ï¼Œ`y` ä¹Ÿå¯ä»¥å˜æˆ `x`ã€‚
>
> ä¾‹å¦‚ï¼Œ`4` å¯ä»¥å˜ä¸º `3`ï¼Œ`1` å¯ä»¥å˜ä¸º `7`ã€‚
>
> é™å®šæ‰€æœ‰æ•°å­—å˜æ¢åœ¨ä¸è¶…è¿‡ `n` çš„æ­£æ•´æ•°èŒƒå›´å†…è¿›è¡Œï¼Œæ±‚ä¸æ–­è¿›è¡Œæ•°å­—å˜æ¢ä¸”ä¸å‡ºç°é‡å¤æ•°å­—çš„æœ€å¤šå˜æ¢æ­¥æ•°ã€‚

**è¾“å…¥æ ¼å¼**

> è¾“å…¥ä¸€ä¸ªæ­£æ•´æ•° `n`ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸æ–­è¿›è¡Œæ•°å­—å˜æ¢ä¸”ä¸å‡ºç°é‡å¤æ•°å­—çš„æœ€å¤šå˜æ¢æ­¥æ•°ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤nâ‰¤50000$

**è¾“å…¥æ ·ä¾‹**

```c++
7
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ ·ä¾‹è§£é‡Š**

> ä¸€ç§æ–¹æ¡ˆä¸ºï¼š`4â†’3â†’1â†’74â†’3â†’1â†’7`ã€‚

**æ‰‹å†™ç¨¿**

![2111129](img/2111129.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 50010;
int n, idx, ans;
int h[N], e[N], ne[N], st[N], sum[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
int dfs(int u) {
    int d1 = 0, d2 = 0;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        int d = dfs(j) + 1;
        if (d >= d1) d2 = d1, d1 = d;
        else if (d >= d2) d2 = d;
    }
    ans = max(ans, d1 + d2);
    return d1;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ )
        // ä½¿ç”¨iå»æ›´æ–°i*jï¼Œå…¶ä¸­iå°±æ˜¯çº¦æ•°
        for (int j = 2; j <= n / i; j ++ )
            sum[i * j] += i;
    for (int i = 2; i <= n; i ++ )
        // å¦‚æœiçš„çº¦æ•°ä¹‹å’Œsum[i]ç¬¦åˆè¦æ±‚
        if (i > sum[i]) {
            // æ³¨æ„è¾¹çš„é¡ºåºï¼Œè¦æ±‚sum[i] -> iï¼Œå› æ­¤ï¼Œå› ä¸ºadd(sum[i], i)è€Œä¸æ˜¯add(i, add[i])
            add(sum[i], i);
            // å› ä¸ºå¯èƒ½ä¼šæœ‰å¤šæ£µæ ‘ï¼Œå› æ­¤ï¼Œéœ€è¦è®°å½•ä¸‹æ ‘çš„å“ªäº›èŠ‚ç‚¹è¢«è®¿é—®è¿‡
            st[i] = true;
        }
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰è¢«è®¿é—®è¿‡ï¼Œåˆ™è®¿é—®ï¼Œå³è®¿é—®æ£®æ—ä¸­çš„ä¸‹ä¸€æ£µæ ‘
        if (!st[i]) dfs(i);
    cout << ans << endl;
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘å½¢DP`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

### [AcWing 285. æ²¡æœ‰ä¸Šå¸çš„èˆä¼š](https://www.acwing.com/problem/content/287/)

**é¢˜ç›®æè¿°**

> `Ural` å¤§å­¦æœ‰ `N` åèŒå‘˜ï¼Œç¼–å·ä¸º `1âˆ¼N`ã€‚
>
> ä»–ä»¬çš„å…³ç³»å°±åƒä¸€æ£µä»¥æ ¡é•¿ä¸ºæ ¹çš„æ ‘ï¼Œçˆ¶èŠ‚ç‚¹å°±æ˜¯å­èŠ‚ç‚¹çš„ç›´æ¥ä¸Šå¸ã€‚
>
> æ¯ä¸ªèŒå‘˜æœ‰ä¸€ä¸ªå¿«ä¹æŒ‡æ•°ï¼Œç”¨æ•´æ•° $H_i$ ç»™å‡ºï¼Œå…¶ä¸­ $1â‰¤iâ‰¤N$ã€‚
>
> ç°åœ¨è¦å¬å¼€ä¸€åœºå‘¨å¹´åº†å®´ä¼šï¼Œä¸è¿‡ï¼Œæ²¡æœ‰èŒå‘˜æ„¿æ„å’Œç›´æ¥ä¸Šå¸ä¸€èµ·å‚ä¼šã€‚
>
> åœ¨æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„å‰æä¸‹ï¼Œä¸»åŠæ–¹å¸Œæœ›é‚€è¯·ä¸€éƒ¨åˆ†èŒå‘˜å‚ä¼šï¼Œä½¿å¾—æ‰€æœ‰å‚ä¼šèŒå‘˜çš„å¿«ä¹æŒ‡æ•°æ€»å’Œæœ€å¤§ï¼Œæ±‚è¿™ä¸ªæœ€å¤§å€¼ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸€ä¸ªæ•´æ•° `N`ã€‚
>
> æ¥ä¸‹æ¥ `N` è¡Œï¼Œç¬¬ `i` è¡Œè¡¨ç¤º `i` å·èŒå‘˜çš„å¿«ä¹æŒ‡æ•° $H_i$ã€‚
>
> æ¥ä¸‹æ¥ `Nâˆ’1` è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸€å¯¹æ•´æ•° `L,K`ï¼Œè¡¨ç¤º `K` æ˜¯ `L` çš„ç›´æ¥ä¸Šå¸ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºæœ€å¤§çš„å¿«ä¹æŒ‡æ•°ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤Nâ‰¤6000$,
> + $âˆ’128â‰¤Hiâ‰¤127$

**è¾“å…¥æ ·ä¾‹**

```c++
7
1
1
1
1
1
1
1
1 3
2 3
6 4
7 4
4 5
3 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
5
```

**æ‰‹å†™ç¨¿**

![2150818](img/2150818.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 6010;
int n, idx;
int happy[N], h[N], e[N], ne[N], is_root[N];
int f[N][2];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u) {
    // å¦‚æœç¡®å®šé€‰æ‹©å½“å‰èŠ‚ç‚¹ï¼Œåˆ™å…ˆå°†å½“å‰èŠ‚ç‚¹çš„å¿«ä¹å€¼â•
    f[u][1] = happy[u];
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å…ˆé€’å½’å­æ ‘
        dfs(j);
        // å¦‚æœä¸é€‰æ‹©æ ¹èŠ‚ç‚¹ï¼Œåˆ™å­æ ‘æ—¢å¯ä»¥é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥ä¸é€‰æ‹©
        f[u][0] += max(f[j][0], f[j][1]);
        // å¦‚æœé€‰æ‹©æ ¹èŠ‚ç‚¹ï¼Œåˆ™å­æ ‘åªèƒ½ä¸é€‰æ‹©
        f[u][1] += f[j][0];
    }
    return;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    memset(is_root, true, sizeof is_root);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &happy[i]);
    for (int i = 1; i <= n - 1; i ++ ) {
        int u, v;
        scanf("%d%d", &u, &v);
        add(v, u);
        is_root[u] = false;
    }
    // å¯»æ‰¾æ ¹èŠ‚ç‚¹
    int root = 0;
    for (int i = 1; i <= n; i ++ )
        if (is_root[i]) {
            root = i;
            break;
        }
    dfs(root);
    cout << max(f[root][0], f[root][1]) << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`ã€`æ ‘å½¢DP`

### [LeetCode 337. æ‰“å®¶åŠ«èˆ III](https://leetcode-cn.com/problems/house-robber-iii/)

**é¢˜ç›®æè¿°**

>   å°å·åˆå‘ç°äº†ä¸€ä¸ªæ–°çš„å¯è¡Œçªƒçš„åœ°åŒºã€‚è¿™ä¸ªåœ°åŒºåªæœ‰ä¸€ä¸ªå…¥å£ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º `root` ã€‚
>
>   é™¤äº† `root` ä¹‹å¤–ï¼Œæ¯æ ‹æˆ¿å­æœ‰ä¸”åªæœ‰ä¸€ä¸ªâ€œçˆ¶â€œæˆ¿å­ä¸ä¹‹ç›¸è¿ã€‚ä¸€ç•ªä¾¦å¯Ÿä¹‹åï¼Œèªæ˜çš„å°å·æ„è¯†åˆ°â€œè¿™ä¸ªåœ°æ–¹çš„æ‰€æœ‰æˆ¿å±‹çš„æ’åˆ—ç±»ä¼¼äºä¸€æ£µäºŒå‰æ ‘â€ã€‚ å¦‚æœ ä¸¤ä¸ªç›´æ¥ç›¸è¿çš„æˆ¿å­åœ¨åŒä¸€å¤©æ™šä¸Šè¢«æ‰“åŠ« ï¼Œæˆ¿å±‹å°†è‡ªåŠ¨æŠ¥è­¦ã€‚
>
>   ç»™å®šäºŒå‰æ ‘çš„ `root` ã€‚è¿”å› åœ¨ä¸è§¦åŠ¨è­¦æŠ¥çš„æƒ…å†µä¸‹ ï¼Œå°å·èƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ ã€‚

**ç¤ºä¾‹ 1**

![img](img/rob1-tree.jpg)

>   è¾“å…¥: `root = [3,2,3,null,3,null,1]`
>   è¾“å‡º: `7` 
>   è§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ `3 + 3 + 1 = 7`

**ç¤ºä¾‹ 2**

![img](img/rob2-tree.jpg)

>   è¾“å…¥: `root = [3,4,5,1,3,null,1]`
>   è¾“å‡º: `9`
>   è§£é‡Š: å°å·ä¸€æ™šèƒ½å¤Ÿç›—å–çš„æœ€é«˜é‡‘é¢ `4 + 5 = 9`

**æç¤º**

>   +   $æ ‘çš„èŠ‚ç‚¹æ•°åœ¨ [1, 10^4] èŒƒå›´å†…$
>   +   $0 <= Node.val <= 10^4$

**æ‰‹å†™ç¨¿**

![321848](img/321848.png)

**ä»£ç **

```c++
/**
 * Definition for a binary tree node.
 * struct TreeNode {
 *     int val;
 *     TreeNode *left;
 *     TreeNode *right;
 *     TreeNode() : val(0), left(nullptr), right(nullptr) {}
 *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}
 *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}
 * };
 */
class Solution {
public:
    // dfsçš„è¿”å›å€¼{é€‰u, ä¸é€‰u}ï¼Œå³å¯¹åº”ç€f[u][0]å’Œf[u][1]
    vector<int> dfs(TreeNode* u) {
        if (!u) return {0, 0};
        auto l = dfs(u -> left), r = dfs(u -> right);
        // {ä¸é€‰u, é€‰u}
        return {max(l[0], l[1]) + max(r[0], r[1]), l[0] + r[0] + u -> val};
    }
    int rob(TreeNode* u) {
        vector<int> f = dfs(u);
        return max(f[0], f[1]);
    }
};
```

**æ ‡ç­¾**

`æ ‘å½¢DP`

### [AcWing 310. æœ€å°é«˜åº¦æ ‘](https://leetcode-cn.com/problems/minimum-height-trees/)

**é¢˜ç›®æè¿°**

> æ ‘æ˜¯ä¸€ä¸ªæ— å‘å›¾ï¼Œå…¶ä¸­ä»»ä½•ä¸¤ä¸ªé¡¶ç‚¹åªé€šè¿‡ä¸€æ¡è·¯å¾„è¿æ¥ã€‚ æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªä»»ä½•æ²¡æœ‰ç®€å•ç¯è·¯çš„è¿é€šå›¾éƒ½æ˜¯ä¸€æ£µæ ‘ã€‚
>
> ç»™ä½ ä¸€æ£µåŒ…å« `n` ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œæ ‡è®°ä¸º `0` åˆ° `n - 1` ã€‚ç»™å®šæ•°å­— `n` å’Œä¸€ä¸ªæœ‰ `n - 1` æ¡æ— å‘è¾¹çš„ `edges` åˆ—è¡¨ï¼ˆæ¯ä¸€ä¸ªè¾¹éƒ½æ˜¯ä¸€å¯¹æ ‡ç­¾ï¼‰ï¼Œå…¶ä¸­ $edges[i] = [a_i, b_i]$ è¡¨ç¤ºæ ‘ä¸­èŠ‚ç‚¹ $a_i$ å’Œ $b_i$ ä¹‹é—´å­˜åœ¨ä¸€æ¡æ— å‘è¾¹ã€‚
>
> å¯é€‰æ‹©æ ‘ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ ¹ã€‚å½“é€‰æ‹©èŠ‚ç‚¹ `x` ä½œä¸ºæ ¹èŠ‚ç‚¹æ—¶ï¼Œè®¾ç»“æœæ ‘çš„é«˜åº¦ä¸º `h` ã€‚åœ¨æ‰€æœ‰å¯èƒ½çš„æ ‘ä¸­ï¼Œå…·æœ‰æœ€å°é«˜åº¦çš„æ ‘ï¼ˆå³ï¼Œ`min(h)`ï¼‰è¢«ç§°ä¸º æœ€å°é«˜åº¦æ ‘ ã€‚
>
> è¯·ä½ æ‰¾åˆ°æ‰€æœ‰çš„ æœ€å°é«˜åº¦æ ‘ å¹¶æŒ‰ ä»»æ„é¡ºåº è¿”å›å®ƒä»¬çš„æ ¹èŠ‚ç‚¹æ ‡ç­¾åˆ—è¡¨ã€‚
>
> æ ‘çš„ é«˜åº¦ æ˜¯æŒ‡æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ä¹‹é—´æœ€é•¿å‘ä¸‹è·¯å¾„ä¸Šè¾¹çš„æ•°é‡ã€‚

**ç¤ºä¾‹ 1**

![img](img/e1.jpg)

> è¾“å…¥ï¼š`n = 4, edges = [[1,0],[1,2],[1,3]]`
> è¾“å‡ºï¼š`[1]`
> è§£é‡Šï¼šå¦‚å›¾æ‰€ç¤ºï¼Œå½“æ ¹æ˜¯æ ‡ç­¾ä¸º `1` çš„èŠ‚ç‚¹æ—¶ï¼Œæ ‘çš„é«˜åº¦æ˜¯ `1` ï¼Œè¿™æ˜¯å”¯ä¸€çš„æœ€å°é«˜åº¦æ ‘ã€‚

**ç¤ºä¾‹ 2**

![img](img/e2.jpg)

> è¾“å…¥ï¼š`n = 6, edges = [[3,0],[3,1],[3,2],[3,4],[5,4]]`
> è¾“å‡ºï¼š`[3,4]`

**æç¤º**

> + $1 <= n <= 2 * 10^4$
> + $edges.length == n - 1$
> + $0 <= a_i, b_i < n$
> + $a_i != b_i$
> + $æ‰€æœ‰ (a_i, b_i) äº’ä¸ç›¸åŒ$
> + $ç»™å®šçš„è¾“å…¥ ä¿è¯ æ˜¯ä¸€æ£µæ ‘ï¼Œå¹¶ä¸” ä¸ä¼šæœ‰é‡å¤çš„è¾¹$

**è§£é¢˜æ­¥éª¤**

> 1. å¯¹äºæ¯ä¸€ä¸ªç‚¹ `u` æ¥è¯´ï¼Œå°†å…¶å½“ä½œæ ¹èŠ‚ç‚¹ï¼Œç„¶åè®¡ç®—ä»¥ `u` ä¸ºæ ¹çš„æ ‘çš„é«˜åº¦ï¼Œç»Ÿè®¡å‡ºæ¥æ‰€æœ‰çš„é«˜åº¦ä»¥åï¼Œå¾ªç¯æ±‚è§£å³å¯
>
> 2. è®¡ç®—æ ‘çš„é«˜åº¦ï¼Œä½¿ç”¨æ ‘å½¢ `DP` æ¥è®¡ç®—
>
>     ![2171514](img/2171514.png)

**ä»£ç **

```c++
class Solution {
public:
    vector<vector<int>> g;
    vector<int> d1, d2, up, p;
    // å‘ä¸‹å¯»æ‰¾
    int dfs_d(int u, int father) {
        for (auto& j : g[u]) {
            if (j == father) continue;
            int d = dfs_d(j, u) + 1;
            if (d >= d1[u]) d2[u] = d1[u], d1[u] = d, p[u] = j;
            else if (d >= d2[u]) d2[u] = d;
        }
        return d1[u];
    }
    // å‘ä¸Šå¯»æ‰¾
    void dfs_u(int u, int father) {
        for (auto& j : g[u]) {
            if (j == father) continue;
            if (p[u] == j) up[j] = max(up[u], d2[u]) + 1;
            else up[j] = max(up[u], d1[u]) + 1;
            dfs_u(j, u);
        }
        return;
    }
    vector<int> findMinHeightTrees(int n, vector<vector<int>>& edges) {
        g.resize(n + 5);
        d1 = d2 = p = up = vector<int>(n + 5);
        // å»ºå›¾
        for (auto& edge : edges) {
            int a = edge[0], b = edge[1];
            g[a].push_back(b);
            g[b].push_back(a);
        }
        // å‘ä¸‹å¯»æ‰¾
        dfs_d(0, -1);
        // å‘ä¸Šå¯»æ‰¾
        dfs_u(0, -1);
        // æ‰¾æœ€å°å€¼
        int Min = 1e9;
        for (int i = 0; i < n; i ++ ) Min = min(Min, max(up[i], d1[i]));
        // æ‰¾ç­”æ¡ˆ
        vector<int> res;
        for (int i = 0; i < n; i ++ ) 
            if (max(up[i], d1[i]) == Min) res.push_back(i);
        return res;
    }
};
```

**æ ‡ç­¾**

`æ ‘å½¢DP`ã€`æ ‘çš„æ·±åº¦ä¼˜å…ˆæœç´¢`

### [AcWing 1074. äºŒå‰è‹¹æœæ ‘](https://www.acwing.com/problem/content/1076/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸€æ£µäºŒå‰è‹¹æœæ ‘ï¼Œå¦‚æœæ ‘ææœ‰åˆ†å‰ï¼Œä¸€å®šæ˜¯åˆ†ä¸¤å‰ï¼Œå³æ²¡æœ‰åªæœ‰ä¸€ä¸ªå„¿å­çš„èŠ‚ç‚¹ã€‚
>
>   è¿™æ£µæ ‘å…± `N` ä¸ªèŠ‚ç‚¹ï¼Œç¼–å·ä¸º `1` è‡³ `N`ï¼Œæ ‘æ ¹ç¼–å·ä¸€å®šä¸º `1`ã€‚
>
>   æˆ‘ä»¬ç”¨ä¸€æ ¹æ ‘æä¸¤ç«¯è¿æ¥çš„èŠ‚ç‚¹ç¼–å·æè¿°ä¸€æ ¹æ ‘æçš„ä½ç½®ã€‚
>
>   ä¸€æ£µè‹¹æœæ ‘çš„æ ‘æå¤ªå¤šäº†ï¼Œéœ€è¦å‰ªæã€‚ä½†æ˜¯ä¸€äº›æ ‘æä¸Šé•¿æœ‰è‹¹æœï¼Œç»™å®šéœ€è¦ä¿ç•™çš„æ ‘ææ•°é‡ï¼Œæ±‚æœ€å¤šèƒ½ç•™ä½å¤šå°‘è‹¹æœã€‚
>
>   è¿™é‡Œçš„ä¿ç•™æ˜¯æŒ‡æœ€ç»ˆä¸`1`å·ç‚¹è¿é€šã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `Q`ï¼Œåˆ†åˆ«è¡¨ç¤ºæ ‘çš„èŠ‚ç‚¹æ•°ä»¥åŠè¦ä¿ç•™çš„æ ‘ææ•°é‡ã€‚
>
>   æ¥ä¸‹æ¥ `Nâˆ’1` è¡Œæè¿°æ ‘æä¿¡æ¯ï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•°ï¼Œå‰ä¸¤ä¸ªæ˜¯å®ƒè¿æ¥çš„èŠ‚ç‚¹çš„ç¼–å·ï¼Œç¬¬ä¸‰ä¸ªæ•°æ˜¯è¿™æ ¹æ ‘æä¸Šè‹¹æœæ•°é‡ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä»…ä¸€è¡Œï¼Œè¡¨ç¤ºæœ€å¤šèƒ½ç•™ä½çš„è‹¹æœçš„æ•°é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Q<Nâ‰¤100.$
>   +   $Nâ‰ 1,$
>   +   $æ¯æ ¹æ ‘æä¸Šè‹¹æœä¸è¶…è¿‡ 30000ä¸ªã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
5 2
1 3 1
1 4 10
2 3 20
3 5 20
```

**è¾“å‡ºæ ·ä¾‹**

```c++
21
```

**æ‰‹å†™ç¨¿**

![3140926](img/3140926.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110, M = 210;
int n, m, idx;
int h[N], w[M], e[M], ne[M];
int f[N][N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u, int father) {
    for (int i = h[u]; i != -1; i = ne[i]) {
        // å¦‚æœå·²ç»è®¿é—®è¿‡ï¼Œç›´æ¥è¿”å›
        if (e[i] == father) continue;
        dfs(e[i], u);
        // æšä¸¾ã€ä»¥uä¸ºæ ¹ã€‘çš„å­æ ‘æ‰€åˆ†å¾—çš„æ ‘æçš„æ•°é‡
        for (int j = m; j >= 0; j -- )
            // æšä¸¾ã€uçš„æ¯æ£µå­æ ‘ã€‘æ‰€åˆ†å¾—çš„æ ‘æçš„æ•°é‡
            for (int k = 0; k < j; k ++ )
                f[u][j] = max(f[u][j], f[e[i]][k] + f[u][j - k - 1] + w[i]);
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < n - 1; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    dfs(1, -1);
    cout << f[1][m] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘å½¢DP`

**ç¼åˆæ€ª**

[AcWing 10. æœ‰ä¾èµ–çš„èƒŒåŒ…é—®é¢˜](#AcWing 10. æœ‰ä¾èµ–çš„èƒŒåŒ…é—®é¢˜)

### [AcWing 323. æˆ˜ç•¥æ¸¸æˆ](https://www.acwing.com/problem/content/325/)

**é¢˜ç›®æè¿°**

>   é²å‹ƒå–œæ¬¢ç©ç”µè„‘æ¸¸æˆï¼Œç‰¹åˆ«æ˜¯æˆ˜ç•¥æ¸¸æˆï¼Œä½†æœ‰æ—¶ä»–æ‰¾ä¸åˆ°è§£å†³é—®é¢˜çš„æ–¹æ³•ï¼Œè¿™è®©ä»–å¾ˆä¼¤å¿ƒã€‚
>
>   ç°åœ¨ä»–æœ‰ä»¥ä¸‹é—®é¢˜ã€‚
>
>   ä»–å¿…é¡»ä¿æŠ¤ä¸€åº§ä¸­ä¸–çºªåŸå¸‚ï¼Œè¿™æ¡åŸå¸‚çš„é“è·¯æ„æˆäº†ä¸€æ£µæ ‘ã€‚
>
>   æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å£«å…µå¯ä»¥è§‚å¯Ÿåˆ°æ‰€æœ‰å’Œè¿™ä¸ªç‚¹ç›¸è¿çš„è¾¹ã€‚
>
>   ä»–å¿…é¡»åœ¨èŠ‚ç‚¹ä¸Šæ”¾ç½®æœ€å°‘æ•°é‡çš„å£«å…µï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ‰€æœ‰çš„è¾¹ã€‚
>
>   ä½ èƒ½å¸®åŠ©ä»–å—ï¼Ÿ
>
>   ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ ‘ï¼š
>
>   ![1463_1.jpg.gif](img/19_0f47f44029-1463_1.jpg.gif)
>
>   åªéœ€è¦æ”¾ç½® `1` åå£«å…µï¼ˆåœ¨èŠ‚ç‚¹ `1` å¤„ï¼‰ï¼Œå°±å¯è§‚å¯Ÿåˆ°æ‰€æœ‰çš„è¾¹ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ï¼Œæ¯ç»„æµ‹è¯•æ•°æ®ç”¨ä»¥æè¿°ä¸€æ£µæ ‘ã€‚
>
>   å¯¹äºæ¯ç»„æµ‹è¯•æ•°æ®ï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `N`ï¼Œè¡¨ç¤ºæ ‘çš„èŠ‚ç‚¹æ•°ç›®ã€‚
>
>   æ¥ä¸‹æ¥ `N` è¡Œï¼Œæ¯è¡ŒæŒ‰å¦‚ä¸‹æ–¹æ³•æè¿°ä¸€ä¸ªèŠ‚ç‚¹ã€‚
>
>   èŠ‚ç‚¹ç¼–å·ï¼š(å­èŠ‚ç‚¹æ•°ç›®) å­èŠ‚ç‚¹ å­èŠ‚ç‚¹ â€¦
>
>   èŠ‚ç‚¹ç¼–å·ä» `0` åˆ° `Nâˆ’1`ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°é‡å‡ä¸è¶…è¿‡ `10`ï¼Œæ¯ä¸ªè¾¹åœ¨è¾“å…¥æ•°æ®ä¸­åªå‡ºç°ä¸€æ¬¡ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ç»„æµ‹è¯•æ•°æ®ï¼Œè¾“å‡ºä¸€ä¸ªå æ®ä¸€è¡Œçš„ç»“æœï¼Œè¡¨ç¤ºæœ€å°‘éœ€è¦çš„å£«å…µæ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $0<Nâ‰¤1500,$
>   +   $ä¸€ä¸ªæµ‹è¯•ç‚¹æ‰€æœ‰ N ç›¸åŠ ä¹‹å’Œä¸è¶…è¿‡ 300650ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
4
0:(1) 1
1:(2) 2 3
2:(0)
3:(0)
5
3:(3) 1 4 2
1:(1) 0
2:(0)
0:(0)
4:(0)
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
2
```

**æ‰‹å†™ç¨¿**

![3141121](img/3141121.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1510;
int n, idx;
int h[N], e[N], ne[N], st[N];
int f[N][2];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u) {
    // å¦‚æœé€‰æ‹©æ ¹èŠ‚ç‚¹ï¼Œå£«å…µæ•°é‡ä¸º1
    f[u][1] = 1;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        dfs(j);
        // é€‰æ‹©æ ¹èŠ‚ç‚¹
        f[u][0] += f[j][1];
        // ä¸é€‰æ ¹èŠ‚ç‚¹
        f[u][1] += min(f[j][0], f[j][1]);
    }
    return;
}
int main() {
    while (scanf("%d", &n) != -1) {
        int id, cnt;
        // å¤šç»„è¾“å…¥ï¼Œæ•…éƒ½éœ€è¦è¿›è¡Œåˆå§‹åŒ–
        memset(h, -1, sizeof h);
        memset(f, 0, sizeof f);
        memset(st, 0, sizeof st);
        idx = 0;
        for (int i = 0; i < n; i ++ ) {
            scanf("%d:(%d)", &id, &cnt);
            for (int j = 0, son; j < cnt; j ++ ) {
                scanf("%d", &son);
                st[son] = true;
                add(id, son);
            }
        }
        // å¯»æ‰¾æ ¹èŠ‚ç‚¹
        int root = 0;
        for (int i = 0; i < n; i ++ )
            if (!st[i]) {
                root = i;
                break;
            }
        dfs(root);
        cout << min(f[root][0], f[root][1]) << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ ‘å½¢DP`ã€`çŠ¶æ€æœº`

**ç¼åˆæ€ª**

[AcWing 285. æ²¡æœ‰ä¸Šå¸çš„èˆä¼š](#AcWing 285. æ²¡æœ‰ä¸Šå¸çš„èˆä¼š)

### [AcWing 1077. çš‡å®«çœ‹å®ˆ](https://www.acwing.com/problem/content/description/1079/)

>   å¤ªå¹³ç‹ä¸–å­äº‹ä»¶åï¼Œé™†å°å‡¤æˆäº†çš‡ä¸Šç‰¹è˜çš„å¾¡å‰ä¸€å“ä¾å«ã€‚
>
>   çš‡å®«å„ä¸ªå®«æ®¿çš„åˆ†å¸ƒï¼Œå‘ˆä¸€æ£µæ ‘çš„å½¢çŠ¶ï¼Œå®«æ®¿å¯è§†ä¸ºæ ‘ä¸­ç»“ç‚¹ï¼Œä¸¤ä¸ªå®«æ®¿ä¹‹é—´å¦‚æœå­˜åœ¨é“è·¯ç›´æ¥ç›¸è¿ï¼Œåˆ™è¯¥é“è·¯è§†ä¸ºæ ‘ä¸­çš„ä¸€æ¡è¾¹ã€‚
>
>   å·²çŸ¥ï¼Œåœ¨ä¸€ä¸ªå®«æ®¿é•‡å®ˆçš„å®ˆå«ä¸ä»…èƒ½å¤Ÿè§‚å¯Ÿåˆ°æœ¬å®«æ®¿çš„çŠ¶å†µï¼Œè¿˜èƒ½è§‚å¯Ÿåˆ°ä¸è¯¥å®«æ®¿ç›´æ¥å­˜åœ¨é“è·¯ç›¸è¿çš„å…¶ä»–å®«æ®¿çš„çŠ¶å†µã€‚
>
>   å¤§å†…ä¿å«æ£®ä¸¥ï¼Œä¸‰æ­¥ä¸€å²—ï¼Œäº”æ­¥ä¸€å“¨ï¼Œæ¯ä¸ªå®«æ®¿éƒ½è¦æœ‰äººå…¨å¤©å€™çœ‹å®ˆï¼Œåœ¨ä¸åŒçš„å®«æ®¿å®‰æ’çœ‹å®ˆæ‰€éœ€çš„è´¹ç”¨ä¸åŒã€‚
>
>   å¯æ˜¯é™†å°å‡¤æ‰‹ä¸Šçš„ç»è´¹ä¸è¶³ï¼Œæ— è®ºå¦‚ä½•ä¹Ÿæ²¡æ³•åœ¨æ¯ä¸ªå®«æ®¿éƒ½å®‰ç½®ç•™å®ˆä¾å«ã€‚
>
>   å¸®åŠ©é™†å°å‡¤å¸ƒç½®ä¾å«ï¼Œåœ¨çœ‹å®ˆå…¨éƒ¨å®«æ®¿çš„å‰æä¸‹ï¼Œä½¿å¾—èŠ±è´¹çš„ç»è´¹æœ€å°‘ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥ä¸­æ•°æ®æè¿°ä¸€æ£µæ ‘ï¼Œæè¿°å¦‚ä¸‹ï¼š
>
>   ç¬¬ä¸€è¡Œ `n`ï¼Œè¡¨ç¤ºæ ‘ä¸­ç»“ç‚¹çš„æ•°ç›®ã€‚
>
>   ç¬¬äºŒè¡Œè‡³ç¬¬ `n+1` è¡Œï¼Œæ¯è¡Œæè¿°æ¯ä¸ªå®«æ®¿ç»“ç‚¹ä¿¡æ¯ï¼Œä¾æ¬¡ä¸ºï¼šè¯¥å®«æ®¿ç»“ç‚¹æ ‡å· `i`ï¼Œåœ¨è¯¥å®«æ®¿å®‰ç½®ä¾å«æ‰€éœ€çš„ç»è´¹ `k`ï¼Œè¯¥ç»“ç‚¹çš„å­ç»“ç‚¹æ•° `m`ï¼Œæ¥ä¸‹æ¥ `m` ä¸ªæ•°ï¼Œåˆ†åˆ«æ˜¯è¿™ä¸ªç»“ç‚¹çš„ `m` ä¸ªå­ç»“ç‚¹çš„æ ‡å· $r_1,r_2,â€¦,r_m$ã€‚
>
>   å¯¹äºä¸€ä¸ª `n` ä¸ªç»“ç‚¹çš„æ ‘ï¼Œç»“ç‚¹æ ‡å·åœ¨ `1` åˆ° `n` ä¹‹é—´ï¼Œä¸”æ ‡å·ä¸é‡å¤ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°‘çš„ç»è´¹ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤1500$

**è¾“å…¥æ ·ä¾‹**

```c++
6
1 30 3 2 3 4
2 16 2 5 6
3 5 0
4 4 0
5 11 0
6 5 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
25
```

**æ ·ä¾‹è§£é‡Š**

>   åœ¨`2ã€3ã€4`ç»“ç‚¹å®‰æ’æŠ¤å«ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å…¨éƒ¨å®«æ®¿ï¼Œæ‰€éœ€ç»è´¹æœ€å°‘ï¼Œä¸º `16 + 5 + 4 = 25`ã€‚

**æ‰‹å†™ç¨¿**

>   ![3150903](img/3150903.png)
>
>   æœ¬é¢˜å’Œ `AcWing 323. æˆ˜ç•¥æ¸¸æˆ` çš„åŒºåˆ«åœ¨äºï¼š
>
>   +   æˆ˜ç•¥æ¸¸æˆè¯´çš„æ˜¯è¾¹ï¼Œå¯¹äºè¾¹æ¥è¯´ï¼Œèƒ½ç®¡ä½çš„å°±åªæœ‰ä¸¤å¤´çš„é¡¶ç‚¹
>   +   æœ¬é¢˜è¯´çš„æ˜¯ç‚¹ï¼Œå¯¹äºä¸€ä¸ªç‚¹æ¥è¯´ï¼Œèƒ½ç®¡ä½çš„å°±åªæœ‰å…¶æœ¬èº«ï¼Œçˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯ä¸ºå•¥ä¸Šä¸€é¢˜éœ€è¦ä¸¤ä¸ªçŠ¶æ€å°±å¯ä»¥äº†ï¼Œè€Œæœ¬é¢˜éœ€è¦ä¸‰ä¸ªçŠ¶æ€çš„æ ¸å¿ƒåŸå› æ‰€åœ¨

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1510;
int n, idx;
int h[N], e[N], w[N], ne[N], st[N];
int f[N][3];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u) {
    f[u][2] = w[u];
    // è®°å½•min(f[j][1], f[j][2])çš„æ€»å’Œ
    // ä¾¿äºè®¡ç®—f[u][1]ï¼Œå…·ä½“çœ‹æ‰‹å†™ç¨¿
    int sum = 0;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        dfs(j);
        f[u][0] += min(f[j][1], f[j][2]);
        f[u][2] += min(f[j][0], min(f[j][1], f[j][2]));
        sum += min(f[j][1], f[j][2]);
    }
    f[u][1] = 1e9;
    // å¾ªç¯æŸ¥æ‰¾
    for (int i = h[u]; i != -1; i = ne[i]) {
        int k = e[i];
        // sum - min(f[k][1], f[k][2])å°±æ˜¯é™¤äº†kä¹‹å¤–çš„æ‰€æœ‰çš„æ•°æ€»å’Œ
        f[u][1] = min(f[u][1], f[k][2] + sum - min(f[k][1], f[k][2]));
    }
    return;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) {
        int id, cost, m;
        scanf("%d%d%d", &id, &cost, &m);
        w[id] = cost;
        for (int j = 1, k; j <= m; j ++ ) {
            scanf("%d", &k);
            add(id, k);
            st[k] = true;
        }
    }
    // å¯»æ‰¾æ ¹èŠ‚ç‚¹
    int root = 1;
    while (st[root]) root ++;
    dfs(root);
    cout << min(f[root][1], f[root][2]) << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`çŠ¶æ€æœº`ã€`æ ‘å½¢DP`

**ç¼åˆæ€ª**



### [PTA L2-038 ç—…æ¯’æº¯æº](https://pintia.cn/problem-sets/994805046380707840/problems/1386335159927652361)

**é¢˜ç›®æè¿°**

>   ![V.JPG](img/19836809-3b79-48c6-91d0-e7ff8501b708.jpeg)
>
>   ç—…æ¯’å®¹æ˜“å‘ç”Ÿå˜å¼‚ã€‚æŸç§ç—…æ¯’å¯ä»¥é€šè¿‡çªå˜äº§ç”Ÿè‹¥å¹²å˜å¼‚çš„æ¯’æ ªï¼Œè€Œè¿™äº›å˜å¼‚çš„ç—…æ¯’åˆå¯èƒ½è¢«è¯±å‘çªå˜äº§ç”Ÿç¬¬äºŒä»£å˜å¼‚ï¼Œå¦‚æ­¤ç»§ç»­ä¸æ–­å˜åŒ–ã€‚
>
>   ç°ç»™å®šä¸€äº›ç—…æ¯’ä¹‹é—´çš„å˜å¼‚å…³ç³»ï¼Œè¦æ±‚ä½ æ‰¾å‡ºå…¶ä¸­æœ€é•¿çš„ä¸€æ¡å˜å¼‚é“¾ã€‚
>
>   åœ¨æ­¤å‡è®¾ç»™å‡ºçš„å˜å¼‚éƒ½æ˜¯ç”±çªå˜å¼•èµ·çš„ï¼Œä¸è€ƒè™‘å¤æ‚çš„åŸºå› é‡ç»„å˜å¼‚é—®é¢˜ â€”â€” å³æ¯ä¸€ç§ç—…æ¯’éƒ½æ˜¯ç”±å”¯ä¸€çš„ä¸€ç§ç—…æ¯’çªå˜è€Œæ¥ï¼Œå¹¶ä¸”ä¸å­˜åœ¨å¾ªç¯å˜å¼‚çš„æƒ…å†µã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åœ¨ç¬¬ä¸€è¡Œä¸­ç»™å‡ºä¸€ä¸ªæ­£æ•´æ•° `N`ï¼ˆ$â‰¤ 10^4$ï¼‰ï¼Œå³ç—…æ¯’ç§ç±»çš„æ€»æ•°ã€‚äºæ˜¯æˆ‘ä»¬å°†æ‰€æœ‰ç—…æ¯’ä» `0` åˆ° `N âˆ’ 1` è¿›è¡Œç¼–å·ã€‚
>
>   éšå `N` è¡Œï¼Œæ¯è¡ŒæŒ‰ä»¥ä¸‹æ ¼å¼æè¿°ä¸€ç§ç—…æ¯’çš„å˜å¼‚æƒ…å†µï¼š
>
>   ```c++
>   k å˜å¼‚æ ª1 â€¦â€¦ å˜å¼‚æ ªk
>   ```
>
>   å…¶ä¸­ `k` æ˜¯è¯¥ç—…æ¯’äº§ç”Ÿçš„å˜å¼‚æ¯’æ ªçš„ç§ç±»æ•°ï¼Œåé¢è·Ÿç€æ¯ç§å˜å¼‚æ ªçš„ç¼–å·ã€‚ç¬¬ `i` è¡Œå¯¹åº”ç¼–å·ä¸º `i` çš„ç—…æ¯’ï¼ˆ`0 â‰¤ i < N`ï¼‰ã€‚é¢˜ç›®ä¿è¯ç—…æ¯’æºå¤´æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªã€‚

**è¾“å‡ºæ ¼å¼**

>   é¦–å…ˆè¾“å‡ºä»æºå¤´å¼€å§‹æœ€é•¿å˜å¼‚é“¾çš„é•¿åº¦ã€‚
>
>   åœ¨ç¬¬äºŒè¡Œä¸­è¾“å‡ºä»æºå¤´å¼€å§‹æœ€é•¿çš„ä¸€æ¡å˜å¼‚é“¾ï¼Œç¼–å·é—´ä»¥ `1` ä¸ªç©ºæ ¼åˆ†éš”ï¼Œè¡Œé¦–å°¾ä¸å¾—æœ‰å¤šä½™ç©ºæ ¼ã€‚å¦‚æœæœ€é•¿é“¾ä¸å”¯ä¸€ï¼Œåˆ™è¾“å‡ºæœ€å°åºåˆ—ã€‚
>
>   æ³¨ï¼šæˆ‘ä»¬ç§°åºåˆ— ${a_1, â‹¯ ,a_n }$ æ¯”åºåˆ— ${b_1, â‹¯ ,b_n}$ â€œå°â€ï¼Œå¦‚æœå­˜åœ¨ `1 â‰¤ k â‰¤ n` æ»¡è¶³ $a_i=b_i$ å¯¹æ‰€æœ‰ `i < k` æˆç«‹ï¼Œä¸” $a_k < b_k$ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
10
3 6 4 8
0
0
0
2 5 9
0
1 7
1 2
0
2 3 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
0 4 9 1
```

**æ‰‹å†™ç¨¿**

![511408](img/511408.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
const int N = 1e4 + 10;
int n, idx, cnt;
int h[N], e[N], ne[N], st[N], f[N], path[N], g[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
int dp(int u) {
    // æ¯ä¸ªèŠ‚ç‚¹é«˜åº¦éƒ½ä¸º1
    f[u] = 1;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        int d = dp(j);
        // å–æœ€å¤§å€¼
        f[u] = max(f[u], d + 1);
    }
    return f[u];
}
void dfs(int u) {
    path[cnt ++ ] = u;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // æ‰¾åˆ°æ¡ä»¶çš„è¯, éå†ç»“æŸä¹‹å, ç›´æ¥è¿”å›å³å¯
        // åŸå› : å½“å‰ä¸€å®šå°±æ˜¯å­—å…¸åºæœ€å°çš„ä¸”æœ€é•¿çš„
        if (f[j] + 1 == f[u]) {
            dfs(j);
            return;
        }
    }
    return;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 0; i < n; i ++ ) {
        int k;
        scanf("%d", &k);
        for (int j = 0, x; j < k; j ++ ) scanf("%d", &g[j]);
        // ä»å¤§åˆ°å°è¿›è¡Œæ’åº
        sort(g, g + k, [&](int a, int b) {
            return a > b;
        });
        for (int j = 0; j < k; j ++ ) {
            add(i, g[j]);
            st[g[j]] = true;
        }
    }
    // å¯»æ‰¾æ ¹èŠ‚ç‚¹
    int rt;
    for (int i = 0; i < n; i ++ )
        if (!st[i]) {
            rt = i;
            break;
        }
    cout << dp(rt) << endl;
    dfs(rt);
    // æ³¨æ„: æ§åˆ¶æ ¼å¼
    for (int i = 0; i < cnt; i ++ ) {
        if (!i) cout << path[i];
        else cout << " " << path[i];
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nk)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ ‘å½¢DP`ã€`è·¯å¾„è¾“å‡º`

**ç¼åˆæ€ª**



## çŠ¶æ€å‹ç¼© `DP`

### [Acwing 1064. å°å›½ç‹](https://www.acwing.com/problem/content/1066/)

**é¢˜ç›®æè¿°**

> åœ¨ `nÃ—n` çš„æ£‹ç›˜ä¸Šæ”¾ `k` ä¸ªå›½ç‹ï¼Œå›½ç‹å¯æ”»å‡»ç›¸é‚»çš„ `8` ä¸ªæ ¼å­ï¼Œæ±‚ä½¿å®ƒä»¬æ— æ³•äº’ç›¸æ”»å‡»çš„æ–¹æ¡ˆæ€»æ•°ã€‚

**è¾“å…¥æ ¼å¼**

> å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `k`ã€‚

**è¾“å‡ºæ ¼å¼**

> å…±ä¸€è¡Œï¼Œè¡¨ç¤ºæ–¹æ¡ˆæ€»æ•°ï¼Œè‹¥ä¸èƒ½å¤Ÿæ”¾ç½®åˆ™è¾“å‡º `0`ã€‚

**æ•°æ®èŒƒå›´**

> $1\;\leq\;n\;\leq\;10$
>
> $0\;\leq\;k\;\leq{n^2}$

**è¾“å…¥æ ·ä¾‹**

```c++
3 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
16
```

**æ‰‹å†™ç¨¿**

![å°å›½ç‹](img/%E5%B0%8F%E5%9B%BD%E7%8E%8B.png)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
typedef long long LL;
const int N = 15, M = 110, K = 1 << 10;
int n, m;
int cnt[K];
vector<int> state;
vector<int> convert[K];
LL f[N][M][K];
// åˆ¤æ–­æ˜¯å¦å«æœ‰è¿ç»­çš„ 1
bool check(int u) {
    for (int i = 0; i < n; i ++ )
        if (u >> i & 1 && u >> i + 1 & 1) return false;
    return true;
}
// ç»Ÿè®¡ 1 çš„æ•°é‡
int count(int u) {
    int res = 0;
    for (int i = 0; i < n; i ++ )
        if (u >> i & 1) res ++;
    return res;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < 1 << n; i ++ )
        if (check(i)) {
            state.push_back(i);
            cnt[i] = count(i);
        }
    for (int i = 0; i < state.size(); i ++ )
        for (int j = 0; j < state.size(); j ++ ) {
            int a = state[i], b = state[j];
            if ((a & b) == 0 && check(a | b)) convert[i].push_back(j);
        }
    f[0][0][0] = 1;
    for (int i = 1; i <= n + 1; i ++ )
        for (int j = 0; j <= m; j ++ )
            for (int a = 0; a < state.size(); a ++ )
                for (auto& b : convert[a])
                    if (j >= cnt[state[a]]) f[i][j][a] += f[i - 1][j - cnt[state[a]]][b];
    cout << f[n + 1][m][0] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`

### [Acwing 327. ç‰ç±³ç”°](https://www.acwing.com/problem/content/329/)

**é¢˜ç›®æè¿°**

> å†œå¤«çº¦ç¿°çš„åœŸåœ°ç”± `MÃ—N` ä¸ªå°æ–¹æ ¼ç»„æˆï¼Œç°åœ¨ä»–è¦åœ¨åœŸåœ°é‡Œç§æ¤ç‰ç±³ã€‚
>
> éå¸¸é—æ†¾ï¼Œéƒ¨åˆ†åœŸåœ°æ˜¯ä¸è‚²çš„ï¼Œæ— æ³•ç§æ¤ã€‚
>
> è€Œä¸”ï¼Œç›¸é‚»çš„åœŸåœ°ä¸èƒ½åŒæ—¶ç§æ¤ç‰ç±³ï¼Œä¹Ÿå°±æ˜¯è¯´ç§æ¤ç‰ç±³çš„æ‰€æœ‰æ–¹æ ¼ä¹‹é—´éƒ½ä¸ä¼šæœ‰å…¬å…±è¾¹ç¼˜ã€‚
>
> ç°åœ¨ç»™å®šåœŸåœ°çš„å¤§å°ï¼Œè¯·ä½ æ±‚å‡ºå…±æœ‰å¤šå°‘ç§ç§æ¤æ–¹æ³•ã€‚
>
> åœŸåœ°ä¸Šä»€ä¹ˆéƒ½ä¸ç§ä¹Ÿç®—ä¸€ç§æ–¹æ³•ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ `1` è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `M` å’Œ `N`ã€‚
>
> ç¬¬ `2..M+1`è¡Œï¼šæ¯è¡ŒåŒ…å« `N` ä¸ªæ•´æ•° `0` æˆ– `1`ï¼Œç”¨æ¥æè¿°æ•´ä¸ªåœŸåœ°çš„çŠ¶å†µï¼Œ`1` è¡¨ç¤ºè¯¥å—åœŸåœ°è‚¥æ²ƒï¼Œ`0` è¡¨ç¤ºè¯¥å—åœŸåœ°ä¸è‚²ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºæ€»ç§æ¤æ–¹æ³•å¯¹ $10^8$ å–æ¨¡åçš„å€¼ã€‚

**æ•°æ®èŒƒå›´**

> $1\;\leq{M},\;N\leq12$

**è¾“å…¥æ ·ä¾‹**

```c++
2 3
1 1 1
0 1 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
9
```

**æ‰‹å†™ç¨¿**

![ç‰ç±³ç”°](img/%E7%8E%89%E7%B1%B3%E7%94%B0.jpg)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
const int N = 15, M = 1 << 12, mod = 1e8;
int n, m;
int g[N];
int f[N][M];
vector<int> state;
vector<int> convert[M];
bool check(int u) {
    for (int i = 0; i < m; i ++ )
        if (u >> i & 1 && u >> i + 1 & 1) return false;
    return true;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ )
        for (int j = 0, s; j < m; j ++ ) {
            scanf("%d", &s);
            // é€šå¸¸æƒ…å†µä¸‹ 1 ä»£è¡¨æœ‰éšœç¢ 0 ä»£è¡¨æ— éšœç¢
            g[i] += !s << j;
        }
    for (int i = 0; i < 1 << m; i ++ )
        if (check(i))
            state.push_back(i);
    for (int i = 0; i < state.size(); i ++ )
        for (int j = 0; j < state.size(); j ++ ) {
            int a = state[i], b = state[j];
            if ((a & b) == 0 && check(a))
                convert[i].push_back(j);
        }
    f[0][0] = 1;
    // i å¾ªç¯åˆ° n + 1 å°æŠ€å·§ ä¸éœ€è¦é¢å¤–åœ¨è®¡ç®—
    for (int i = 1; i <= n + 1; i ++ )
        for (int j = 0; j < state.size(); j ++ )
            for (auto& k : convert[j]) {
                // å¦‚æœåŒåˆ—çš„ç›¸é‚»ä¸¤è¡Œä¹‹é—´éƒ½æ˜¯ 1 åˆ™æ”¾å¼ƒæœ¬æ¬¡å¾ªç¯
                if (g[i] & state[j]) continue;
                f[i][j] = (f[i][j] + f[i - 1][k]) % mod;
            }
    cout << f[n + 1][0] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`

## çŠ¶æ€æœº

### [LeetCode 213. æ‰“å®¶åŠ«èˆ II](https://leetcode-cn.com/problems/house-robber-ii/)

**é¢˜ç›®æè¿°**

> ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°å·ï¼Œè®¡åˆ’å·çªƒæ²¿è¡—çš„æˆ¿å±‹ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ã€‚è¿™ä¸ªåœ°æ–¹æ‰€æœ‰çš„æˆ¿å±‹éƒ½ **å›´æˆä¸€åœˆ** ï¼Œè¿™æ„å‘³ç€ç¬¬ä¸€ä¸ªæˆ¿å±‹å’Œæœ€åä¸€ä¸ªæˆ¿å±‹æ˜¯ç´§æŒ¨ç€çš„ã€‚åŒæ—¶ï¼Œç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ ã€‚
>
> ç»™å®šä¸€ä¸ªä»£è¡¨æ¯ä¸ªæˆ¿å±‹å­˜æ”¾é‡‘é¢çš„éè´Ÿæ•´æ•°æ•°ç»„ï¼Œè®¡ç®—ä½  åœ¨ä¸è§¦åŠ¨è­¦æŠ¥è£…ç½®çš„æƒ…å†µä¸‹ ï¼Œä»Šæ™šèƒ½å¤Ÿå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ã€‚ 

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼šnums = [2,3,2]
> è¾“å‡ºï¼š3
> è§£é‡Šï¼šä½ ä¸èƒ½å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 2ï¼‰, å› ä¸ºä»–ä»¬æ˜¯ç›¸é‚»çš„ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼šnums = [1,2,3,1]
> è¾“å‡ºï¼š4
> è§£é‡Šï¼šä½ å¯ä»¥å…ˆå·çªƒ 1 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 1ï¼‰ï¼Œç„¶åå·çªƒ 3 å·æˆ¿å±‹ï¼ˆé‡‘é¢ = 3ï¼‰ï¼Œå·çªƒåˆ°çš„æœ€é«˜é‡‘é¢ = 1 + 3 = 4 ã€‚

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼šnums = [0]
> è¾“å‡ºï¼š0

**æç¤º**

> `1 <= nums.length <= 100`
> `0 <= nums[i] <= 1000`

**æ€è·¯**

> ç”±äºç¬¬ä¸€å®¶å’Œæœ€åä¸€å®¶æ˜¯ç›¸è¿çš„ï¼Œæ•…æ­¤åˆ†ä¸ºä¸¤ç»„ï¼š
>
> ç¬¬ä¸€ç»„ï¼š`1ï½n - 1`
>
> ç¬¬äºŒç»„ï¼š`2 ï½n`
>
> åˆ†åˆ«è¿›è¡ŒåŠ¨æ€è§„åˆ’å³å¯

**æ‰‹å†™ç¨¿**

![æ‰“å®¶åŠ«èˆ II](img/%E6%89%93%E5%AE%B6%E5%8A%AB%E8%88%8D%20II.png)

**ä»£ç **

```c++
class Solution {
public:
    int rob(vector<int>& nums) {
        int n = nums.size();
        if (n <= 1) return nums[0];
        int l;
        vector<vector<int>> f(n + 5, vector<int>(2));
        for (int i = 2; i <= n; i ++ ) {
            f[i][0] = max(f[i - 1][0], f[i - 1][1]);
            f[i][1] = f[i - 1][0] + nums[i - 1];
        }
        l = max(f[n][1], f[n][0]);
        f = vector<vector<int>>(n + 5, vector<int>(2));
        for (int i = 1; i <= n - 1; i ++ ) {
            f[i][0] = max(f[i - 1][0], f[i - 1][1]);
            f[i][1] = f[i - 1][0] + nums[i - 1];
        }
        return max(l, max(f[n - 1][0], f[n - 1][1]));
    }
};
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`

### [AcWing 1058. è‚¡ç¥¨ä¹°å– V](https://www.acwing.com/problem/content/1060/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º `N` çš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„ç¬¬ `i` ä¸ªæ•°å­—è¡¨ç¤ºä¸€ä¸ªç»™å®šè‚¡ç¥¨åœ¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚
>
> è®¾è®¡ä¸€ä¸ªç®—æ³•è®¡ç®—å‡ºæœ€å¤§åˆ©æ¶¦ã€‚åœ¨æ»¡è¶³ä»¥ä¸‹çº¦æŸæ¡ä»¶ä¸‹ï¼Œä½ å¯ä»¥å°½å¯èƒ½åœ°å®Œæˆæ›´å¤šçš„äº¤æ˜“ï¼ˆå¤šæ¬¡ä¹°å–ä¸€æ”¯è‚¡ç¥¨ï¼‰:
>
> - ä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚
> - å–å‡ºè‚¡ç¥¨åï¼Œä½ æ— æ³•åœ¨ç¬¬äºŒå¤©ä¹°å…¥è‚¡ç¥¨ (å³å†·å†»æœŸä¸º `1` å¤©)ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `N`ï¼Œè¡¨ç¤ºæ•°ç»„é•¿åº¦ã€‚
>
> ç¬¬äºŒè¡ŒåŒ…å« `N` ä¸ªä¸è¶…è¿‡ `10000` çš„æ­£æ•´æ•°ï¼Œè¡¨ç¤ºå®Œæ•´çš„æ•°ç»„ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§åˆ©æ¶¦ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤Nâ‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
5
1 2 3 0 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ ·ä¾‹è§£é‡Š**

> å¯¹åº”çš„äº¤æ˜“çŠ¶æ€ä¸º: [ä¹°å…¥, å–å‡º, å†·å†»æœŸ, ä¹°å…¥, å–å‡º]ï¼Œç¬¬ä¸€ç¬”äº¤æ˜“å¯å¾—åˆ©æ¶¦ `2-1 = 1`ï¼Œç¬¬äºŒç¬”äº¤æ˜“å¯å¾—åˆ©æ¶¦ `2-0 = 2`ï¼Œå…±å¾—åˆ©æ¶¦ `1+2 = 3`ã€‚

**æ‰‹å†™ç¨¿**

![2091151](img/2091151.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int n;
int w[N];
int f[N][3];
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &w[i]);
    // æ³¨æ„åˆå§‹åŒ–
    f[0][0] = f[0][1] = -1e9, f[0][2] = 0;
    for (int i = 1; i <= n; i ++ ) {
        f[i][0] = max(f[i - 1][0], f[i - 1][2] - w[i]);
        f[i][1] = f[i - 1][0] + w[i];
        f[i][2] = max(f[i - 1][2], f[i - 1][1]);
    }
    cout << max(f[n][1], f[n][2]) << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`ã€`çŠ¶æ€æœº`

## `LIS`

### [LeetCode 300. æœ€é•¿é€’å¢å­åºåˆ—](https://leetcode-cn.com/problems/longest-increasing-subsequence/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚
>
> å­åºåˆ—æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ`[3,6,2,7]` æ˜¯æ•°ç»„ `[0,3,1,6,2,2,7]` çš„å­åºåˆ—ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`nums = [10,9,2,5,3,7,101,18]`
> è¾“å‡ºï¼š`4`
> è§£é‡Šï¼šæœ€é•¿é€’å¢å­åºåˆ—æ˜¯ `[2,3,7,101]`ï¼Œå› æ­¤é•¿åº¦ä¸º `4` ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`nums = [0,1,0,3,2,3]`
> è¾“å‡ºï¼š`4`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`nums = [7,7,7,7,7,7,7]`
> è¾“å‡ºï¼š`1`

**æç¤º**

> $1 <= nums.length <= 2500$
> $-10^4 <= nums[i] <= 10^4$

**è¿›é˜¶**

> ä½ å¯ä»¥è®¾è®¡æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2)$ çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ
> ä½ èƒ½å°†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦é™ä½åˆ° $O(n log(n))$ å—?

**æ–¹æ³•ä¸€ï¼šåŠ¨æ€è§„åˆ’**

**æ‰‹å†™ç¨¿**

![æœ€é•¿é€’å¢å­åºåˆ—](img/%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97.png)

**ä»£ç **

```c++
// æ—¶é—´å¤æ‚åº¦ O(n ^ 2)
class Solution {
public:
    int lengthOfLIS(vector<int>& g) {
        int n = g.size();
        vector<int> f(n + 5, 1);
        int res = 0;
        for (int i = 0; i < n; i ++) {
            for (int j = 0; j < i; j ++ )
                if (g[i] > g[j]) f[i] = max(f[i], f[j] + 1);
            res = max(res, f[i]);
        }
        return res;
    }
};
```

**æ–¹æ³•äºŒï¼šäºŒåˆ†æŸ¥æ‰¾**

**æ€è·¯ä¸€ï¼š**

**æ­¥éª¤**

> 1. ä½¿ç”¨ `vector` å­˜å‚¨é•¿åº¦ä¸º `i` çš„é€’å¢å­åºåˆ—çš„æœ€å°å€¼ï¼Œå…¶ä¸‹æ ‡ `i` è¡¨ç¤ºé€’å¢å­åºåˆ—çš„é•¿åº¦ï¼Œå…¶å€¼ `q[i]` è¡¨ç¤ºé•¿åº¦ä¸º `i` çš„é€’å¢å­åºåˆ—çš„æœ€å°å€¼
> 2. åœ¨ `q` æ•°ç»„ä¸­äºŒåˆ†æŸ¥æ‰¾å°äº `x` çš„æœ€å¤§å€¼ï¼Œåˆ™ä¸‹ä¸€ä¸ªå€¼ä¸€å®šå°±æ˜¯å¤§äºç­‰äº `x` çš„æœ€å°å€¼
>     + æ³¨æ„ç‚¹ï¼šå¦‚æœå½“å‰å€¼æ¯” `q` ä¸­çš„æ‰€æœ‰å€¼éƒ½å°ï¼Œåˆ™å°†å½“å‰å€¼è®¾ç½®ä¸ºæœ€å°å€¼ï¼›ä¸è¿‡ï¼Œä¸è¿›è¡Œç‰¹åˆ¤ï¼ŒæŒ‰ç…§ç®—æ³•æ­¥éª¤ï¼Œå¯»æ‰¾ä¸‹ä¸€ä¸ªå€¼çš„è¯ï¼Œå°±ä¼šé€ æˆä¸‹ä¸€ä¸ªå€¼æ¯”å½“å‰å€¼å°
>     + ä¾‹å­ï¼š`4, 10, 4`
> 3. `q` æ˜¯ä¸€ä¸ªé€’å¢ä¸¥æ ¼å­åºåˆ—

**ä»£ç **

```c++
class Solution {
public:
    int lengthOfLIS(vector<int>& nums) {
        vector<int> q;
        for (auto& num : nums) {
            if (q.empty() || num > q.back()) q.push_back(num);
            else {
                // éœ€è¦ç‰¹åˆ¤ï¼Œå¦‚æœ num æ¯”æœ€å°å€¼éƒ½å°ï¼Œåˆ™å°†æœ€å°å€¼è®¾ç½®ä¸º num
                if (q[0] >= num) q[0] = num;
                else {
                    // äºŒåˆ†æŸ¥æ‰¾å°äºå½“å‰æ•°çš„æœ€å¤§å€¼
                    int l = 0, r = q.size() - 1;
                    while (l < r) {
                        int mid = l + r + 1 >> 1;
                        if (q[mid] < num) l = mid;
                        else r = mid - 1;
                    }
                    q[l + 1] = num;
                }
            }
        }
        return q.size();
    }
};
```

**æ€è·¯äºŒï¼š**

**æ­¥éª¤**

> 1. åŒæ€è·¯ä¸€ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬è¿™æ¬¡å¯»æ‰¾çš„æ˜¯å¤§äºç­‰äº `x` çš„æœ€å°å€¼

**ä»£ç **

```c++
class Solution {
public:
    int lengthOfLIS(vector<int>& nums) {
        vector<int> q;
        for (auto& num : nums) {
            if (q.empty() || num > q.back()) q.push_back(num);
            else {
                // äºŒåˆ†æŸ¥æ‰¾å¤§äºç­‰äºå½“å‰æ•°çš„æœ€å°å€¼
                int l = 0, r = q.size() - 1;
                while (l < r) {
                    int mid = l + r >> 1;
                    if (nums[mid] >= num) r = mid;
                    else l = mid + 1;
                }
                q[r] = num;
            }
        }
        return q.size();
    }
};
```

**æ ‡ç­¾**

`LIS`ã€`äºŒåˆ†`ã€`æœ€é•¿ä¸Šå‡å­åºåˆ—`

### [LeetCode 334. é€’å¢çš„ä¸‰å…ƒå­åºåˆ—](https://leetcode-cn.com/problems/increasing-triplet-subsequence/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨é•¿åº¦ä¸º `3` çš„é€’å¢å­åºåˆ—ã€‚
>
>   å¦‚æœå­˜åœ¨è¿™æ ·çš„ä¸‰å…ƒç»„ä¸‹æ ‡ `(i, j, k)` ä¸”æ»¡è¶³ `i < j < k` ï¼Œä½¿å¾— `nums[i] < nums[j] < nums[k]` ï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`nums = [1,2,3,4,5]`
>   è¾“å‡ºï¼š`true`
>   è§£é‡Šï¼šä»»ä½• `i < j < k` çš„ä¸‰å…ƒç»„éƒ½æ»¡è¶³é¢˜æ„

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`nums = [5,4,3,2,1]`
>   è¾“å‡ºï¼š`false`
>   è§£é‡Šï¼šä¸å­˜åœ¨æ»¡è¶³é¢˜æ„çš„ä¸‰å…ƒç»„

**ç¤ºä¾‹ 3**

>   è¾“å…¥ï¼š`nums = [2,1,5,0,4,6]`
>   è¾“å‡ºï¼š`true`
>   è§£é‡Šï¼šä¸‰å…ƒç»„ `(3, 4, 5)` æ»¡è¶³é¢˜æ„ï¼Œå› ä¸º `nums[3] == 0 < nums[4] == 4 < nums[5] == 6`

**æç¤º**

>   +   $1 <= nums.length <= 5 * 10^5$
>   +   $-2^{31} <= nums[i] <= 2^{31} - 1$

**è¿›é˜¶**

>   ä½ èƒ½å®ç°æ—¶é—´å¤æ‚åº¦ä¸º `O(n)` ï¼Œç©ºé—´å¤æ‚åº¦ä¸º `O(1)` çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ

**æ‰‹å†™ç¨¿**

![321734](img/321734.png)

**ä»£ç **

```c++
class Solution {
public:
    bool increasingTriplet(vector<int>& nums) {
        vector<int> q(2, INT_MAX);
        for (auto& x : nums) {
            // å¯¹åº”æƒ…å†µä¸€
            if (x <= q[0]) q[0] = x;
            // å¯¹åº”æƒ…å†µäºŒ
            else if (x <= q[1]) q[1] = x;
            // å¯¹åº”æƒ…å†µä¸‰
            else return true;
        }
        return false;
    }
};
```

**æ ‡ç­¾**

`LIS`ã€`æœ€é•¿ä¸Šå‡å­åºåˆ—`

### [LeetCode 368. æœ€å¤§æ•´é™¤å­é›†](https://leetcode-cn.com/problems/largest-divisible-subset/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªç”± æ— é‡å¤ æ­£æ•´æ•°ç»„æˆçš„é›†åˆ `nums` ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›å…¶ä¸­æœ€å¤§çš„æ•´é™¤å­é›† `answer` ï¼Œå­é›†ä¸­æ¯ä¸€å…ƒç´ å¯¹ `(answer[i], answer[j])` éƒ½åº”å½“æ»¡è¶³ï¼š
>
>   +   `answer[i] % answer[j] == 0` ï¼Œæˆ–
>   +   `answer[j] % answer[i] == 0`
>       å¦‚æœå­˜åœ¨å¤šä¸ªæœ‰æ•ˆè§£å­é›†ï¼Œè¿”å›å…¶ä¸­ä»»ä½•ä¸€ä¸ªå‡å¯ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`nums = [1,2,3]`
>   è¾“å‡ºï¼š`[1,2]`
>   è§£é‡Šï¼š`[1,3]` ä¹Ÿä¼šè¢«è§†ä¸ºæ­£ç¡®ç­”æ¡ˆã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`nums = [1,2,4,8]`
>   è¾“å‡ºï¼š`[1,2,4,8]`

**æç¤º**

>   +   $1 <= nums.length <= 1000$
>   +   $1 <= nums[i] <= 2 * 10^9$
>   +   $nums ä¸­çš„æ‰€æœ‰æ•´æ•° äº’ä¸ç›¸åŒ$

**æ‰‹å†™ç¨¿**

![352205](img/352205.png)

**ä»£ç **

```c++
class Solution {
public:
    vector<int> largestDivisibleSubset(vector<int>& a) {
        int n = a.size();
        // é•¿åº¦è‡³å°‘ä¸º1ã€å…¶æœ¬èº«ä¸€ä¸ªæ•°å­—ã€‘
        vector<int> f(n + 5, 1);
        // æ’åº
        sort(a.begin(), a.end());
        // è®°å½•fæœ€å¤§æ—¶çš„ä¸‹æ ‡
        int k = 1;
        for (int i = 1; i <= n; i ++ ) {
            for (int j = 1; j < i;j ++ )
                if (a[i - 1] % a[j - 1] == 0) f[i] = max(f[i], f[j] + 1);
            // è®°å½•fæœ€å¤§æ—¶çš„ä¸‹æ ‡
            if (f[i] > f[k]) k = i;
        }
        // å€’åºæŸ¥æ‰¾æ–¹æ¡ˆï¼Œå…ˆæŠŠæœ€åä¸€ä¸ªæ–¹æ¡ˆåŠ è¿›å»
        vector<int> res(1, a[k - 1]);
        while (f[k] > 1)
            // åˆ¤æ–­ä»å“ªä¸ªæ–¹æ¡ˆè½¬ç§»è¿‡æ¥
            for (int i = 1; i < k; i ++ )
                if (a[k - 1] % a[i - 1] == 0 && f[k] == f[i] + 1) {
                    k = i;
                    res.push_back(a[k - 1]);
                    break;
                }
        return res;
    }
};
```

**æ ‡ç­¾**

`LIS`ã€`æ’åº`

## èƒŒåŒ…æ¨¡å‹

### `01` èƒŒåŒ…

#### [AcWing 12. èƒŒåŒ…é—®é¢˜æ±‚å…·ä½“æ–¹æ¡ˆ](https://www.acwing.com/problem/content/12/)

>   æœ‰ `N` ä»¶ç‰©å“å’Œä¸€ä¸ªå®¹é‡æ˜¯ `V` çš„èƒŒåŒ…ã€‚æ¯ä»¶ç‰©å“åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚
>
>   ç¬¬ `i` ä»¶ç‰©å“çš„ä½“ç§¯æ˜¯ $v_i$ï¼Œä»·å€¼æ˜¯ $w_i$ã€‚
>
>   æ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œå¯ä½¿è¿™äº›ç‰©å“çš„æ€»ä½“ç§¯ä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ï¼Œä¸”æ€»ä»·å€¼æœ€å¤§ã€‚
>
>   è¾“å‡º **å­—å…¸åºæœ€å°çš„æ–¹æ¡ˆ**ã€‚è¿™é‡Œçš„å­—å…¸åºæ˜¯æŒ‡ï¼šæ‰€é€‰ç‰©å“çš„ç¼–å·æ‰€æ„æˆçš„åºåˆ—ã€‚ç‰©å“çš„ç¼–å·èŒƒå›´æ˜¯ `1â€¦N`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œ`Nï¼ŒV`ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç‰©å“æ•°é‡å’ŒèƒŒåŒ…å®¹ç§¯ã€‚
>
>   æ¥ä¸‹æ¥æœ‰ `N` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° $v_i,w_i$ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç¬¬ `i` ä»¶ç‰©å“çš„ä½“ç§¯å’Œä»·å€¼ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€è¡Œï¼ŒåŒ…å«è‹¥å¹²ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ•´æ•°ï¼Œè¡¨ç¤ºæœ€ä¼˜è§£ä¸­æ‰€é€‰ç‰©å“çš„ç¼–å·åºåˆ—ï¼Œä¸”è¯¥ç¼–å·åºåˆ—çš„å­—å…¸åºæœ€å°ã€‚
>
>   ç‰©å“ç¼–å·èŒƒå›´æ˜¯ `1â€¦N`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $0<N,Vâ‰¤1000$
>   +   $0<v_i,w_iâ‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
4 5
1 2
2 4
3 4
4 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 4
```

**æ‰‹å†™ç¨¿**

![3122020](img/3122020.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, m;
int v[N], w[N], way[N];
int f[N][N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ )
        scanf("%d%d", &v[i], &w[i]);
    // å€’åºæšä¸¾
    for (int i = n; i >= 1; i -- )
        for (int j = 0; j <= m; j ++ ) {
            f[i][j] = f[i + 1][j];
            if (j >= v[i]) f[i][j] = max(f[i][j], f[i + 1][j - v[i]] + w[i]);
        }
    int j = m;
    for (int i = 1; i <= n; i ++ )
        if (j >= v[i] && f[i][j] == f[i + 1][j - v[i]] + w[i]) {
            cout << i << " ";
            j -= v[i];
        }
    return 0;
}
```

**æ ‡ç­¾**

`01èƒŒåŒ…`ã€`01èƒŒåŒ…è¾“å‡ºå…·ä½“æ–¹æ¡ˆ`ã€`é€†åº01èƒŒåŒ…`ã€`å­—å…¸åº`

### å®Œå…¨èƒŒåŒ…

#### [AcWing 3. å®Œå…¨èƒŒåŒ…é—®é¢˜](https://www.acwing.com/problem/content/3/)

**é¢˜ç›®æè¿°**

> æœ‰ `N` ç§ç‰©å“å’Œä¸€ä¸ªå®¹é‡æ˜¯ `V` çš„èƒŒåŒ…ï¼Œæ¯ç§ç‰©å“éƒ½æœ‰æ— é™ä»¶å¯ç”¨ã€‚
>
> ç¬¬ `i` ç§ç‰©å“çš„ä½“ç§¯æ˜¯ $v_i$ï¼Œä»·å€¼æ˜¯ $w_i$ã€‚
>
> æ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œå¯ä½¿è¿™äº›ç‰©å“çš„æ€»ä½“ç§¯ä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ï¼Œä¸”æ€»ä»·å€¼æœ€å¤§ã€‚
> è¾“å‡ºæœ€å¤§ä»·å€¼ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œ`Nï¼ŒV`ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç‰©å“ç§æ•°å’ŒèƒŒåŒ…å®¹ç§¯ã€‚
>
> æ¥ä¸‹æ¥æœ‰ `N` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° $v_i,w_i$ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç¬¬ `i` ç§ç‰©å“çš„ä½“ç§¯å’Œä»·å€¼ã€‚

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§ä»·å€¼ã€‚

**æ•°æ®èŒƒå›´**

> + $0<N,Vâ‰¤1000$
> + $0<v_i,w_iâ‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
4 5
1 2
2 4
3 4
4 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
10
```

**æ‰‹å†™ç¨¿**

![2211255](img/2211255.png)

**ä»£ç **

**ä»£ç ä¸€ï¼šäºŒç»´æ•°ç»„**

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, m;
int v[N], w[N];
int f[N][N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d%d", &v[i], &w[i]);
    for (int i = 1; i <= n; i ++ )
        for (int j = 0;j <= m; j ++ ) {
            // ä¸é€‰ç¬¬iä»¶å•†å“
            f[i][j] = f[i - 1][j];
            if (j >= v[i]) f[i][j] = max(f[i][j], f[i][j - v[i]] + w[i]);
        }
    cout << f[n][m] << endl;
    return 0;
}
```

**ä»£ç äºŒï¼šæ»šåŠ¨æ•°ç»„**

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, m;
int v[N], w[N];
int f[2][N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d%d", &v[i], &w[i]);
    for (int i = 1; i <= n; i ++ )
        for (int j = 0;j <= m; j ++ ) {
            f[i & 1][j] = f[i - 1 & 1][j];
            if (j >= v[i]) f[i & 1][j] = max(f[i & 1][j], f[i & 1][j - v[i]] + w[i]);
        }
    cout << f[n & 1][m] << endl;
    return 0;
}
```

**ä»£ç ä¸‰ï¼šä¸€ç»´æ•°ç»„**

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, m;
int v[N], w[N], f[N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d%d", &v[i], &w[i]);
    for (int i = 1; i <= n; i ++ )
        for (int j = v[i]; j <= m; j ++ )
            f[j] = max(f[j], f[j - v[i]] + w[i]);
    cout << f[m] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`å®Œå…¨èƒŒåŒ…`

#### [AcWing 1021. è´§å¸ç³»ç»Ÿ](https://www.acwing.com/problem/content/description/1023/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ª `n` ç§é¢å€¼çš„è´§å¸ç³»ç»Ÿï¼Œæ±‚ç»„æˆé¢å€¼ä¸º `m` çš„è´§å¸æœ‰å¤šå°‘ç§æ–¹æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
> æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸€ç§è´§å¸çš„é¢å€¼ã€‚

**è¾“å‡ºæ ¼å¼**

> å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ–¹æ¡ˆæ•°ã€‚

**æ•°æ®èŒƒå›´**

> + $nâ‰¤15,mâ‰¤3000$

**è¾“å…¥æ ·ä¾‹**

```c++
3 10
1
2
5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
10
```

**æ‰‹å†™ç¨¿**

![2211418](img/2211418.png)

**ä»£ç **

**ä»£ç ä¸€ï¼šäºŒç»´æ•°ç»„**

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 20, M = 3010;
int n, m;
int v[N];
// æ³¨æ„æ–¹æ¡ˆæ•°ç›®å¯èƒ½çˆ†int
LL f[N][M];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &v[i]);
    f[0][0] = 1;
    for (int i = 1; i <= n; i ++ )
        for (int j = 0; j <= m; j ++ ) {
            f[i][j] = f[i - 1][j];
            if (j >= v[i]) f[i][j] += f[i][j - v[i]];
        }
    cout << f[n][m] << endl;
    return 0;
}
```

**ä»£ç äºŒï¼šæ»šåŠ¨æ•°ç»„**

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 20, M = 3010;
int n, m;
int v[N];
LL f[2][M];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &v[i]);
    f[0][0] = 1;
    for (int i = 1; i <= n; i ++ )
        for (int j = 0; j <= m; j ++ ) {
            // æ³¨æ„ï¼šä¸èƒ½ä½¿ç”¨+=ï¼Œå› ä¸ºf[i & 1][j]å¯èƒ½æ˜¯åˆ«çš„å±‚çš„ï¼Œä¸ä¸€å®šä¸º0
            f[i & 1][j] = f[i - 1 & 1][j];
            if (j >= v[i]) f[i & 1][j] += f[i & 1][j - v[i]];
        }
    cout << f[n & 1][m] << endl;
    return 0;
}
```

**ä»£ç ä¸‰ï¼šä¸€ç»´æ•°ç»„**

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 20, M = 3010;
int n, m;
int v[N];
LL f[M];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &v[i]);
    f[0] = 1;
    for (int i = 1; i <= n; i ++ )
        for (int j = v[i]; j <= m; j ++ ) f[j] += f[j - v[i]];
    cout << f[m] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`å®Œå…¨èƒŒåŒ…`

#### [LeetCode 322. é›¶é’±å…‘æ¢](https://leetcode-cn.com/problems/coin-change/)

> ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `coins` ï¼Œè¡¨ç¤ºä¸åŒé¢é¢çš„ç¡¬å¸ï¼›ä»¥åŠä¸€ä¸ªæ•´æ•° `amount` ï¼Œè¡¨ç¤ºæ€»é‡‘é¢ã€‚
>
> è®¡ç®—å¹¶è¿”å›å¯ä»¥å‡‘æˆæ€»é‡‘é¢æ‰€éœ€çš„ æœ€å°‘çš„ç¡¬å¸ä¸ªæ•° ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ç§ç¡¬å¸ç»„åˆèƒ½ç»„æˆæ€»é‡‘é¢ï¼Œè¿”å› `-1` ã€‚
>
> ä½ å¯ä»¥è®¤ä¸ºæ¯ç§ç¡¬å¸çš„æ•°é‡æ˜¯æ— é™çš„ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`coins = [1, 2, 5], amount = 11`
> è¾“å‡ºï¼š`3`
> è§£é‡Šï¼š`11 = 5 + 5 + 1`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`coins = [2], amount = 3`
> è¾“å‡ºï¼š`-1`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`coins = [1], amount = 0`
> è¾“å‡ºï¼š`0`

**æç¤º**

> + $1 <= coins.length <= 12$
> + $1 <= coins[i] <= 2^{31} - 1$
> + $0 <= amount <= 10^4$

**æ‰‹å†™ç¨¿**

![2211833](img/2211833.png)

**ä»£ç **

**ä»£ç ä¸€ï¼šäºŒç»´æ•°ç»„**

```c++
class Solution {
public:
    int coinChange(vector<int>& v, int m) {
        int n = v.size();
        // åˆå§‹åŒ–ä¸ºæ­£æ— ç©·
        vector<vector<int>> f(n + 5, vector<int>(m + 5, 1e9));
        // å‰é›¶å¼ çº¸å¸ï¼Œä»·å€¼æ€»é¢æ°å¥½ä¸ºé›¶çš„ã€çº¸å¸æ•°é‡ã€‘ä¸ºé›¶å¼ 
        f[0][0] = 0;
        for (int i = 1; i <= n; i ++ )
            for (int j = 0; j <= m; j ++ ) {
                f[i][j] = f[i - 1][j];
                if (j >= v[i - 1]) f[i][j] = min(f[i][j], f[i][j - v[i - 1]] + 1);
            }
        // å¦‚æœä¸ç¬¦åˆæ¡ä»¶ï¼Œè¾“å‡º-1
        if (f[n][m] == 1e9) f[n][m] = -1;
        return f[n][m];
    }
};
```

**ä»£ç äºŒï¼šæ»šåŠ¨æ•°ç»„**

```c++
class Solution {
public:
    int coinChange(vector<int>& v, int m) {
        int n = v.size();
        // åˆå§‹åŒ–ä¸ºæ­£æ— ç©·
        vector<vector<int>> f(2, vector<int>(m + 5, 1e9));
        // å‰é›¶å¼ çº¸å¸ï¼Œä»·å€¼æ€»é¢æ°å¥½ä¸ºé›¶çš„ã€çº¸å¸æ•°é‡ã€‘ä¸ºé›¶å¼ 
        f[0][0] = 0;
        for (int i = 1; i <= n; i ++ )
            for (int j = 0; j <= m; j ++ ) {
                f[i & 1][j] = f[i - 1 & 1][j];
                if (j >= v[i - 1]) f[i & 1][j] = min(f[i & 1][j], f[i & 1][j - v[i - 1]] + 1);
            }
        // å¦‚æœä¸ç¬¦åˆæ¡ä»¶ï¼Œè¾“å‡º-1
        if (f[n & 1][m] == 1e9) f[n & 1][m] = -1;
        return f[n & 1][m];
    }
};
```

**ä»£ç ä¸‰ï¼šä¸€ç»´æ•°ç»„**

```c++
class Solution {
public:
    int coinChange(vector<int>& v, int m) {
        int n = v.size();
        // åˆå§‹åŒ–ä¸ºæ­£æ— ç©·
        vector<int> f(m + 5, 1e9);
        // å‰é›¶å¼ çº¸å¸ï¼Œä»·å€¼æ€»é¢æ°å¥½ä¸ºé›¶çš„ã€çº¸å¸æ•°é‡ã€‘ä¸ºé›¶å¼ 
        f[0] = 0;
        for (int i = 1; i <= n; i ++ )
            for (int j = v[i - 1]; j <= m; j ++ )
                f[j] = min(f[j], f[j - v[i - 1]] + 1);
        // å¦‚æœä¸ç¬¦åˆæ¡ä»¶ï¼Œè¾“å‡º-1
        if (f[m] == 1e9) f[m] = -1;
        return f[m];
    }
};
```

**æ ‡ç­¾**

`å®Œå…¨èƒŒåŒ…`

#### [LeetCode 377. ç»„åˆæ€»å’Œ â…£](https://leetcode-cn.com/problems/combination-sum-iv/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªç”± ä¸åŒ æ•´æ•°ç»„æˆçš„æ•°ç»„ `nums` ï¼Œå’Œä¸€ä¸ªç›®æ ‡æ•´æ•° `target` ã€‚è¯·ä½ ä» `nums` ä¸­æ‰¾å‡ºå¹¶è¿”å›æ€»å’Œä¸º `target` çš„å…ƒç´ ç»„åˆçš„ä¸ªæ•°ã€‚
>
>   é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆç¬¦åˆ `32` ä½æ•´æ•°èŒƒå›´ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`nums = [1,2,3], target = 4`
>   è¾“å‡ºï¼š`7`
>   è§£é‡Šï¼š
>   æ‰€æœ‰å¯èƒ½çš„ç»„åˆä¸ºï¼š
>   `(1, 1, 1, 1)`
>   `(1, 1, 2)`
>   `(1, 2, 1)`
>   `(1, 3)`
>   `(2, 1, 1)`
>   `(2, 2)`
>   `(3, 1)`
>   è¯·æ³¨æ„ï¼Œé¡ºåºä¸åŒçš„åºåˆ—è¢«è§†ä½œä¸åŒçš„ç»„åˆã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`nums = [9], target = 3`
>   è¾“å‡ºï¼š`0`

**æç¤º**

>   +   $1 <= nums.length <= 200$
>   +   $1 <= nums[i] <= 1000$
>   +   $nums ä¸­çš„æ‰€æœ‰å…ƒç´  äº’ä¸ç›¸åŒ$
>   +   $1 <= target <= 1000$

**è¿›é˜¶**

>   å¦‚æœç»™å®šçš„æ•°ç»„ä¸­å«æœ‰è´Ÿæ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿé—®é¢˜ä¼šäº§ç”Ÿä½•ç§å˜åŒ–ï¼Ÿå¦‚æœå…è®¸è´Ÿæ•°å‡ºç°ï¼Œéœ€è¦å‘é¢˜ç›®ä¸­æ·»åŠ å“ªäº›é™åˆ¶æ¡ä»¶ï¼Ÿ

**æ‰‹å†™ç¨¿**

![3171040](img/3171040.png)

**ä»£ç ä¸€ï¼šäºŒç»´æ•°ç»„**

```c++
typedef long long LL;
class Solution {
public:
    int combinationSum4(vector<int>& a, int n) {
        vector<vector<LL>> f(n + 5, vector<LL>(n + 5));
        f[0][0] = 1;
        // ç»Ÿè®¡ç­”æ¡ˆ
        int res = 0;
        // æšä¸¾å‰iä¸ªä½ç½®
        for (int i = 1; i <= n; i ++ ) {
            // æšä¸¾å‰iä¸ªä½ç½®æ„æˆçš„æ€»å’Œ
            for (int j = 0; j <= n; j ++ )
                // æšä¸¾æœ€åä¸€ä¸ªä½ç½®é€‰æ‹©çš„æ•°å­—
                for (auto& num : a)
                    if (j >= num)
                        // å¯èƒ½ä¼šè¶Šç•Œï¼Œå–æ¨¡å³å¯ï¼Œå› ä¸ºï¼Œç­”æ¡ˆä½äºintèŒƒå›´å†…
                        // å¦‚æœè¶…å‡ºintçš„è¯ï¼Œéšä¾¿ä½™æ— æ‰€è°“
                        f[i][j] = (f[i][j] + f[i - 1][j - num]) % INT_MAX;
            // è®°å½•ç­”æ¡ˆï¼Œå› ä¸º
            // å¯èƒ½å‰1ä¸ªä½ç½®çš„å’Œå·²ç»æ˜¯näº†
            // å¯èƒ½å‰2ä¸ªä½ç½®çš„å’Œå·²ç»æ˜¯näº†
            // ä»¥æ­¤ç±»æ¨
            res += f[i][n];
        }
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**ä»£ç äºŒï¼šä¸€ç»´æ•°ç»„**

```c++
typedef long long LL;
class Solution {
public:
    int combinationSum4(vector<int>& a, int n) {
        vector<LL> f(n + 5);
        f[0] = 1;
        for (int j = 0; j <= n; j ++ )
            // æšä¸¾æœ€åä¸€ä¸ªä½ç½®é€‰æ‹©çš„æ•°å­—
            for (auto& num : a)
                if (j >= num)
                    // å¯èƒ½ä¼šè¶Šç•Œï¼Œå–æ¨¡å³å¯ï¼Œå› ä¸ºï¼Œç­”æ¡ˆä½äºintèŒƒå›´å†…
                    // å¦‚æœè¶…å‡ºintçš„è¯ï¼Œéšä¾¿ä½™æ— æ‰€è°“
                    f[j] = (f[j] + f[j - num]) % INT_MAX;
        return f[n];
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æœ‰é¡ºåºçš„å®Œå…¨èƒŒåŒ…é—®é¢˜`

**ç¼åˆæ€ª**

### åˆ†ç»„èƒŒåŒ…

#### [AcWing 10. æœ‰ä¾èµ–çš„èƒŒåŒ…é—®é¢˜](https://www.acwing.com/problem/content/description/10/)

> æœ‰ `N` ä¸ªç‰©å“å’Œä¸€ä¸ªå®¹é‡æ˜¯ `V` çš„èƒŒåŒ…ã€‚
>
> ç‰©å“ä¹‹é—´å…·æœ‰ä¾èµ–å…³ç³»ï¼Œä¸”ä¾èµ–å…³ç³»ç»„æˆä¸€æ£µæ ‘çš„å½¢çŠ¶ã€‚å¦‚æœé€‰æ‹©ä¸€ä¸ªç‰©å“ï¼Œåˆ™å¿…é¡»é€‰æ‹©å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚
>
> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
> ![QQå›¾ç‰‡20181018170337.png](img/1_bb51ecbcd2-QQ%E5%9B%BE%E7%89%8720181018170337.png)
>
> å¦‚æœé€‰æ‹©ç‰©å“ `5`ï¼Œåˆ™å¿…é¡»é€‰æ‹©ç‰©å“ `1` å’Œ `2`ã€‚è¿™æ˜¯å› ä¸º `2` æ˜¯ `5` çš„çˆ¶èŠ‚ç‚¹ï¼Œ`1` æ˜¯ `2` çš„çˆ¶èŠ‚ç‚¹ã€‚
>
> æ¯ä»¶ç‰©å“çš„ç¼–å·æ˜¯ `i`ï¼Œä½“ç§¯æ˜¯ $v_i$ï¼Œä»·å€¼æ˜¯ $w_i$ï¼Œä¾èµ–çš„çˆ¶èŠ‚ç‚¹ç¼–å·æ˜¯ $p_i$ã€‚ç‰©å“çš„ä¸‹æ ‡èŒƒå›´æ˜¯ $1â€¦N$ã€‚
>
> æ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œå¯ä½¿ç‰©å“æ€»ä½“ç§¯ä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ï¼Œä¸”æ€»ä»·å€¼æœ€å¤§ã€‚
>
> è¾“å‡ºæœ€å¤§ä»·å€¼ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° `Nï¼ŒV`ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç‰©å“ä¸ªæ•°å’ŒèƒŒåŒ…å®¹é‡ã€‚
>
> æ¥ä¸‹æ¥æœ‰ `N` è¡Œæ•°æ®ï¼Œæ¯è¡Œæ•°æ®è¡¨ç¤ºä¸€ä¸ªç‰©å“ã€‚
> ç¬¬ `i` è¡Œæœ‰ä¸‰ä¸ªæ•´æ•° $v_i,w_i,p_i$ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç‰©å“çš„ä½“ç§¯ã€ä»·å€¼å’Œä¾èµ–çš„ç‰©å“ç¼–å·ã€‚
> å¦‚æœ $p_i=âˆ’1$ï¼Œè¡¨ç¤ºæ ¹èŠ‚ç‚¹ã€‚ **æ•°æ®ä¿è¯æ‰€æœ‰ç‰©å“æ„æˆä¸€æ£µæ ‘ã€‚**

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§ä»·å€¼ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤N,Vâ‰¤100$
> + $1â‰¤v_i,w_iâ‰¤100$
>
> çˆ¶èŠ‚ç‚¹ç¼–å·èŒƒå›´ï¼š
>
> - å†…éƒ¨ç»“ç‚¹ï¼š$1â‰¤p_iâ‰¤N$;
> - æ ¹èŠ‚ç‚¹ $p_i=âˆ’1$;

**è¾“å…¥æ ·ä¾‹**

```c++
5 7
2 3 -1
2 2 1
3 5 1
4 7 2
3 6 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
11
```

**æ‰‹å†™ç¨¿**

![2161118](img/2161118.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110;
int n, m, p, root, idx;
int v[N], w[N], h[N], e[N], ne[N];
int f[N][N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u) {
    for (int i = h[u]; i != -1; i = ne[i]) { // æšä¸¾ç»„
        int son = e[i];
        // é€’å½’å­æ ‘
        dfs(son);
        // åˆ†ç»„èƒŒåŒ…
        // é€†åºçš„åŸå› ï¼Œåœ¨å›¾è§£ä¸­
        for (int j = m - v[u]; j >= 0; j -- ) // æšä¸¾ç»„æ‰€å ç”¨çš„ä½“ç§¯
            for (int k = 0; k <= j; k ++ ) // æšä¸¾ç»„å†…ç‰©å“æ‰€å ä½“ç§¯
                f[u][j] = max(f[u][j], f[u][j - k] + f[son][k]);
    }
    // æ·»åŠ æ ¹èŠ‚ç‚¹çš„æƒå€¼
    for (int i = m; i >= v[u]; i -- ) f[u][i] = f[u][i - v[u]] + w[u];
    // å¦‚æœä½“ç§¯è¿æ ¹èŠ‚ç‚¹ä¹Ÿä¸èƒ½è£…ä¸‹ï¼Œåˆ™é‡ç½®ä¸º0
    // é‡ç½®çš„åŸå› ï¼Œåœ¨å›¾è§£ä¸­
    for (int i = 0; i < v[u]; i ++ ) f[u][i] = 0;
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d%d%d", &v[i], &w[i] ,&p);
        if (p == -1) root = i;
        else add(p, i);
    }
    dfs(root);
    cout << f[root][m] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`ã€`åˆ†ç»„èƒŒåŒ…`ã€`æ ‘å½¢DP`

#### [AcWing 9. åˆ†ç»„èƒŒåŒ…é—®é¢˜](https://www.acwing.com/problem/content/description/9/)

**é¢˜ç›®æè¿°**

> æœ‰ `N` ç»„ç‰©å“å’Œä¸€ä¸ªå®¹é‡æ˜¯ `V` çš„èƒŒåŒ…ã€‚
>
> æ¯ç»„ç‰©å“æœ‰è‹¥å¹²ä¸ªï¼ŒåŒä¸€ç»„å†…çš„ç‰©å“æœ€å¤šåªèƒ½é€‰ä¸€ä¸ªã€‚
> æ¯ä»¶ç‰©å“çš„ä½“ç§¯æ˜¯ $v_{ij}$ï¼Œä»·å€¼æ˜¯ $w_{ij}$ï¼Œå…¶ä¸­ $i$ æ˜¯ç»„å·ï¼Œ$j$ æ˜¯ç»„å†…ç¼–å·ã€‚
>
> æ±‚è§£å°†å“ªäº›ç‰©å“è£…å…¥èƒŒåŒ…ï¼Œå¯ä½¿ç‰©å“æ€»ä½“ç§¯ä¸è¶…è¿‡èƒŒåŒ…å®¹é‡ï¼Œä¸”æ€»ä»·å€¼æœ€å¤§ã€‚
>
> è¾“å‡ºæœ€å¤§ä»·å€¼ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° `Nï¼ŒV`ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç‰©å“ç»„æ•°å’ŒèƒŒåŒ…å®¹é‡ã€‚
>
> æ¥ä¸‹æ¥æœ‰ `N` ç»„æ•°æ®ï¼š
>
> - æ¯ç»„æ•°æ®ç¬¬ä¸€è¡Œæœ‰ä¸€ä¸ªæ•´æ•° $S_i$ï¼Œè¡¨ç¤ºç¬¬ $i$ ä¸ªç‰©å“ç»„çš„ç‰©å“æ•°é‡ï¼›
> - æ¯ç»„æ•°æ®æ¥ä¸‹æ¥æœ‰ $S_i$ è¡Œï¼Œæ¯è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° $v_{ij},w_{ij}$ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºç¬¬ $i$ ä¸ªç‰©å“ç»„çš„ç¬¬ $j$ ä¸ªç‰©å“çš„ä½“ç§¯å’Œä»·å€¼ï¼›

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤§ä»·å€¼ã€‚

**æ•°æ®èŒƒå›´**

> + $0<N,Vâ‰¤100$
> + $0<S_iâ‰¤100$
> + $0<v_{ij},w_{ij}â‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
3 5
2
1 2
2 4
1
3 4
1
4 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
8
```

**æ‰‹å†™ç¨¿**

![2142101](img/2142101.png)

**ä»£ç **

**äºŒç»´æ•°ç»„**

```c++
#include <iostream>
using namespace std;
const int N = 110;
int n, m;
int s[N], v[N][N], w[N][N], f[N][N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d", &s[i]);
        for (int j = 1; j <= s[i]; j ++ ) scanf("%d%d", &v[i][j], &w[i][j]);
    }
    for (int i = 1; i <= n; i ++ ) // å¾ªç¯å‰iç»„
        for (int j = 0; j <= m; j ++ ) { // å¾ªç¯ä½“ç§¯
            f[i][j] = f[i - 1][j]; // ç¬¬iç»„çš„ç‰©å“ä¸€ä¸ªéƒ½ä¸é€‰
            for (int k = 1; k <= s[i]; k ++) // æšä¸¾ç¬¬iç»„çš„æ‰€æœ‰ç‰©å“
                if (j >= v[i][k]) // æ³¨æ„ï¼šä½“ç§¯éœ€è¦å¤§äºç­‰äºå½“å‰ç‰©å“ä½“ç§¯æ‰å¯è½¬ç§»
                    // ç¬¬iç»„çš„ç‰©å“çš„æŸä¸ªç‰©å“é€‰æ‹©1ä¸ª
                    f[i][j] = max(f[i][j], f[i - 1][j - v[i][k]] + w[i][k]);
        }
    cout << f[n][m] << endl;
    return 0;
}
```

**ä¸€ç»´æ•°ç»„ä¼˜åŒ–**

```c++
#include <iostream>
using namespace std;
const int N = 110;
int n, m;
int f[N];
int s[N], v[N][N], w[N][N];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d", &s[i]);
        for (int j = 1; j <= s[i]; j ++ ) scanf("%d%d", &v[i][j], &w[i][j]);
    }
    for (int i = 1; i <= n; i ++ ) // å¾ªç¯å‰iç»„
        for (int j = m; j >= 0; j -- ) { // å¾ªç¯ä½“ç§¯
            for (int k = 1; k <= s[i]; k ++)
                if (j >= v[i][k]) // æ³¨æ„ï¼šä½“ç§¯éœ€è¦å¤§äºç­‰äºå½“å‰ç‰©å“ä½“ç§¯æ‰å¯è½¬ç§»
                    f[j] = max(f[j], f[j - v[i][k]] + w[i][k]);
        }
    cout << f[m] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åˆ†ç»„èƒŒåŒ…`

#### [AcWing 1013. æœºå™¨åˆ†é…](https://www.acwing.com/problem/content/1015/)

>   æ€»å…¬å¸æ‹¥æœ‰ `M` å° **ç›¸åŒ** çš„é«˜æ•ˆè®¾å¤‡ï¼Œå‡†å¤‡åˆ†ç»™ä¸‹å±çš„ `N` ä¸ªåˆ†å…¬å¸ã€‚
>
>   å„åˆ†å…¬å¸è‹¥è·å¾—è¿™äº›è®¾å¤‡ï¼Œå¯ä»¥ä¸ºå›½å®¶æä¾›ä¸€å®šçš„ç›ˆåˆ©ã€‚ç›ˆåˆ©ä¸åˆ†é…çš„è®¾å¤‡æ•°é‡æœ‰å…³ã€‚
>
>   é—®ï¼šå¦‚ä½•åˆ†é…è¿™ `M` å°è®¾å¤‡æ‰èƒ½ä½¿å›½å®¶å¾—åˆ°çš„ç›ˆåˆ©æœ€å¤§ï¼Ÿ
>
>   æ±‚å‡ºæœ€å¤§ç›ˆåˆ©å€¼ã€‚
>
>   åˆ†é…åŸåˆ™ï¼šæ¯ä¸ªå…¬å¸æœ‰æƒè·å¾—ä»»æ„æ•°ç›®çš„è®¾å¤‡ï¼Œä½†æ€»å°æ•°ä¸è¶…è¿‡è®¾å¤‡æ•° `M`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•°ï¼Œç¬¬ä¸€ä¸ªæ•°æ˜¯åˆ†å…¬å¸æ•° `N`ï¼Œç¬¬äºŒä¸ªæ•°æ˜¯è®¾å¤‡å°æ•° `M`ï¼›
>
>   æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ª `N * M` çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­çš„ç¬¬ `i` è¡Œç¬¬ `j` åˆ—çš„æ•´æ•°è¡¨ç¤ºç¬¬ `i` ä¸ªå…¬å¸åˆ†é… `j` å°æœºå™¨æ—¶çš„ç›ˆåˆ©ã€‚

**è¾“å‡ºæ ¼å¼**

>   ç¬¬ä¸€è¡Œè¾“å‡ºæœ€å¤§ç›ˆåˆ©å€¼ï¼›
>
>   æ¥ä¸‹ `N` è¡Œï¼Œæ¯è¡Œæœ‰ `2` ä¸ªæ•°ï¼Œå³åˆ†å…¬å¸ç¼–å·å’Œè¯¥åˆ†å…¬å¸è·å¾—è®¾å¤‡å°æ•°ã€‚
>
>   ç­”æ¡ˆä¸å”¯ä¸€ï¼Œè¾“å‡ºä»»æ„åˆæ³•æ–¹æ¡ˆå³å¯ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤10,$
>   +   $1â‰¤Mâ‰¤15$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
30 40 50
20 30 50
20 25 30
```

**è¾“å‡ºæ ·ä¾‹**

```c++
70
1 1
2 1
3 1
```

**æ‰‹å†™ç¨¿**

![3112204](img/3112204.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 15, M = 20;
int n, m;
int way[N];
int w[N][M], f[N][M];
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= m; j ++ )
            scanf("%d", &w[i][j]);
    for (int i = 1; i <= n; i ++ ) // æšä¸¾ç‰©å“ç»„i
        for (int j = 1; j <= m; j ++ ) { // æšä¸¾ã€å‰iç»„ã€‘åˆ†é…çš„æœºå™¨æ€»æ•°ç›®
            f[i][j] = f[i - 1][j];
            for (int k = 1; k <= j; k ++ ) // æšä¸¾ã€ç¬¬iç»„ã€‘åˆ†é…çš„æœºå™¨æ•°ç›®
                f[i][j] = max(f[i][j], f[i - 1][j - k] + w[i][k]);
        }
    cout << f[n][m] << endl;
    for (int i = n; i >= 1; i -- )
        // æšä¸¾åˆ†é…çš„æœºå™¨æ•°ç›®
        for (int j = m; j >= 0; j -- )
            // çŠ¶æ€è½¬ç§»æ–¹ç¨‹é€†è¿‡æ¥
            if (f[i - 1][m - j] + w[i][j] == f[i][m]) {
                way[i] = j;
                m -= j;
                break;
            }
    for (int i = 1; i <= n; i ++ ) cout << i << " " << way[i] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åˆ†ç»„èƒŒåŒ…`ã€`åˆ†ç»„èƒŒåŒ…æ±‚æ–¹æ¡ˆæ•°`

### å„ç§èƒŒåŒ…ä¹‹é—´çš„åŒºåˆ«

#### `01`èƒŒåŒ…å’Œåˆ†ç»„èƒŒåŒ…

>1.   01èƒŒåŒ…ä»£ç 
>
>     ```c++
>     // æšä¸¾å‰iä»¶ç‰©å“
>     for (int i = 1; i <= n; i ++ ) {
>         // æšä¸¾ä½“ç§¯
>         for (int j = 1; j <= m; j ++ ){
>             f[i][j] = f[i - 1][j];
>             // æšä¸¾ç¬¬iä»¶ç‰©å“ï¼Œé€‰0ä»¶æˆ–è€…é€‰1ä»¶
>             if (j >= v[i]) f[i][j] = max(f[i][j],f[i - 1][j - v[i]] + w[i]);
>         }
>     }
>     ```
>
>2.   åˆ†ç»„èƒŒåŒ…ä»£ç 
>
>     ```c++
>     // æšä¸¾å‰iä»¶ç‰©å“
>     for (int i = 1; i <= n; i ++ ) {
>         // æšä¸¾ä½“ç§¯
>         for (int j = 1; j <= m; j ++ ) {
>             // æšä¸¾ç¬¬iä»¶ç‰©å“ï¼Œé€‰æ‹©0ä»¶ï¼Œ1ä»¶ï¼Œ2ä»¶ï¼Œ...ï¼Œkä»¶
>             f[i][j] = f[i - 1][j]; // é€‰æ‹©0ä»¶
>             for (int k = 1; k <= s[i]; k ++ ) // é€‰æ‹©1ä»¶åˆ°kä»¶
>                 f[i][j] = max(f[i][j], f[i - 1][j - k * v[i]] + k * w[i]);
>         }
>     }
>     ```
>
>3.   ç–‘éš¾è§£ç­”
>
>     +   ä¸ºå•¥ `01` èƒŒåŒ…æ˜¯äºŒç»´ï¼Œè€Œåˆ†ç»„èƒŒåŒ…éœ€è¦å†™ä¸‰ç»´ï¼Ÿ
>         +   `01` èƒŒåŒ…å¯¹äºæ¯ä¸ªç‰©å“åªæœ‰ä¸¤ç§é€‰æ‹©ï¼Œå³é€‰æ‹© `0` ä»¶ç‰©å“å’Œé€‰æ‹© `1` ä»¶ç‰©å“ï¼Œå¯ä»¥ä¸æšä¸¾å³å¯å®Œæˆå¤§å°çš„æ¯”è¾ƒ
>         +   åˆ†ç»„èƒŒåŒ…å¯¹äºæ¯ä¸ªç‰©å“è€Œè¨€ä¸ä»…ä»…åªæœ‰ä¸¤ç§é€‰æ‹©ï¼Œå¯èƒ½æœ‰ `k + 1` ç§é€‰æ‹©ï¼Œå³é€‰æ‹© `0` ä»¶ç‰©å“ï¼Œé€‰æ‹© `1` ä»¶ç‰©å“ï¼Œ`...`ï¼Œé€‰æ‹© `k` ä»¶ç‰©å“ï¼Œä¸æšä¸¾æ¯”è¾ƒä¸å‡ºæ¥ï¼Œå¿…é¡»æšä¸¾

## åŒºé—´ `DP`

### æšä¸¾é¡ºåºçš„è§£é‡Š

>   <font style = "color: red">**`AcWing 282` çŸ³å­åˆå¹¶çš„æ‰‹å†™ç¨¿ä¸­æœ‰ä»‹ç»**</font>

### [AcWing 282. çŸ³å­åˆå¹¶](https://www.acwing.com/problem/content/description/284/)

**é¢˜ç›®æè¿°**

>   è®¾æœ‰ `N` å †çŸ³å­æ’æˆä¸€æ’ï¼Œå…¶ç¼–å·ä¸º `1ï¼Œ2ï¼Œ3ï¼Œâ€¦ï¼ŒN`ã€‚
>
>   æ¯å †çŸ³å­æœ‰ä¸€å®šçš„è´¨é‡ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæ•´æ•°æ¥æè¿°ï¼Œç°åœ¨è¦å°†è¿™ `N` å †çŸ³å­åˆå¹¶æˆä¸ºä¸€å †ã€‚
>
>   æ¯æ¬¡åªèƒ½åˆå¹¶ç›¸é‚»çš„ä¸¤å †ï¼Œåˆå¹¶çš„ä»£ä»·ä¸ºè¿™ä¸¤å †çŸ³å­çš„è´¨é‡ä¹‹å’Œï¼Œåˆå¹¶åä¸è¿™ä¸¤å †çŸ³å­ç›¸é‚»çš„çŸ³å­å°†å’Œæ–°å †ç›¸é‚»ï¼Œåˆå¹¶æ—¶ç”±äºé€‰æ‹©çš„é¡ºåºä¸åŒï¼Œåˆå¹¶çš„æ€»ä»£ä»·ä¹Ÿä¸ç›¸åŒã€‚
>
>   ä¾‹å¦‚æœ‰ `4` å †çŸ³å­åˆ†åˆ«ä¸º `1 3 5 2`ï¼Œ æˆ‘ä»¬å¯ä»¥å…ˆåˆå¹¶ `1ã€2` å †ï¼Œä»£ä»·ä¸º `4`ï¼Œå¾—åˆ° `4 5 2`ï¼Œ åˆåˆå¹¶ `1ï¼Œ2` å †ï¼Œä»£ä»·ä¸º `9`ï¼Œå¾—åˆ° `9 2` ï¼Œå†åˆå¹¶å¾—åˆ° `11`ï¼Œæ€»ä»£ä»·ä¸º `4+9+11=24`ï¼›
>
>   å¦‚æœç¬¬äºŒæ­¥æ˜¯å…ˆåˆå¹¶ `2ï¼Œ3` å †ï¼Œåˆ™ä»£ä»·ä¸º `7`ï¼Œå¾—åˆ° `4 7`ï¼Œæœ€åä¸€æ¬¡åˆå¹¶ä»£ä»·ä¸º `11`ï¼Œæ€»ä»£ä»·ä¸º `4+7+11=22`ã€‚
>
>   é—®é¢˜æ˜¯ï¼šæ‰¾å‡ºä¸€ç§åˆç†çš„æ–¹æ³•ï¼Œä½¿æ€»çš„ä»£ä»·æœ€å°ï¼Œè¾“å‡ºæœ€å°ä»£ä»·ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸€ä¸ªæ•° `N` è¡¨ç¤ºçŸ³å­çš„å †æ•° `N`ã€‚
>
>   ç¬¬äºŒè¡Œ `N` ä¸ªæ•°ï¼Œè¡¨ç¤ºæ¯å †çŸ³å­çš„è´¨é‡(å‡ä¸è¶…è¿‡ `1000`)ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°ä»£ä»·ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤300$

**è¾“å…¥æ ·ä¾‹**

```c++
4
1 3 5 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
22
```

**æ‰‹å†™ç¨¿**

![371121](img/371121.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 310, inf = 0x3f3f3f3f;
int n;
int g[N], sum[N];
int f[N][N];
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d", &g[i]);
        sum[i] = sum[i - 1] + g[i];
    }
    // æšä¸¾é•¿åº¦
    // é•¿åº¦ä¸º1æ²¡æ„ä¹‰ï¼Œé¢˜ç›®è¦æ±‚è‡³å°‘ä¸¤å †çŸ³å­åˆå¹¶æ‰æœ‰æ„ä¹‰
    for (int len = 2; len <= n; len ++ )
        // æšä¸¾ã€å½“å‰åŒºé—´ã€‘å·¦ç«¯ç‚¹çš„ã€ä¸‹æ ‡ã€‘
        for (int i = 1; i + len - 1 <= n; i ++ ) {
            // ã€å½“å‰åŒºé—´ã€‘å³ç«¯ç‚¹çš„ã€ä¸‹æ ‡ã€‘
            // ã€ä¸‹æ ‡ã€‘ç­‰äºã€len - 1ã€‘
            int j = i + len - 1;
            // åˆå§‹åŒ–ä¸ºæ­£æ— ç©·
            f[i][j] = inf;
            // æšä¸¾åˆ†ç•Œç‚¹
            for (int k = i; k < j; k ++ )
                f[i][j] = min(f[i][j], f[i][k] + f[k + 1][j] + sum[j] - sum[i - 1]);
        }
    cout << f[1][n] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŒºé—´DP`

### [AcWing 1068. ç¯å½¢çŸ³å­åˆå¹¶](https://www.acwing.com/problem/content/1070/)

**é¢˜ç›®æè¿°**

>   å°† `n` å †çŸ³å­ç»•åœ†å½¢æ“åœºæ’æ”¾ï¼Œç°è¦å°†çŸ³å­æœ‰åºåœ°åˆå¹¶æˆä¸€å †ã€‚
>
>   è§„å®šæ¯æ¬¡åªèƒ½é€‰ç›¸é‚»çš„ä¸¤å †åˆå¹¶æˆæ–°çš„ä¸€å †ï¼Œå¹¶å°†æ–°çš„ä¸€å †çš„çŸ³å­æ•°è®°åšè¯¥æ¬¡åˆå¹¶çš„å¾—åˆ†ã€‚
>
>   è¯·ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯»å…¥å †æ•° `n` åŠæ¯å †çš„çŸ³å­æ•°ï¼Œå¹¶è¿›è¡Œå¦‚ä¸‹è®¡ç®—ï¼š
>
>   -   é€‰æ‹©ä¸€ç§åˆå¹¶çŸ³å­çš„æ–¹æ¡ˆï¼Œä½¿å¾—åš `nâˆ’1` æ¬¡åˆå¹¶å¾—åˆ†æ€»å’Œæœ€å¤§ã€‚
>   -   é€‰æ‹©ä¸€ç§åˆå¹¶çŸ³å­çš„æ–¹æ¡ˆï¼Œä½¿å¾—åš `nâˆ’1` æ¬¡åˆå¹¶å¾—åˆ†æ€»å’Œæœ€å°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ï¼Œè¡¨ç¤ºå…±æœ‰ `n` å †çŸ³å­ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤ºæ¯å †çŸ³å­çš„æ•°é‡ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå…±ä¸¤è¡Œï¼š
>
>   ç¬¬ä¸€è¡Œä¸ºåˆå¹¶å¾—åˆ†æ€»å’Œæœ€å°å€¼ï¼Œ
>
>   ç¬¬äºŒè¡Œä¸ºåˆå¹¶å¾—åˆ†æ€»å’Œæœ€å¤§å€¼ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤200$

**è¾“å…¥æ ·ä¾‹**

```c++
4
4 5 9 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
43
54
```

**æ‰‹å†™ç¨¿**

![381151](img/381151.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 410, INF = 0x3f3f3f3f;
int n;
int h[N], sum[N];
int f[N][N], g[N][N];
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d", &h[i]);
        // å¤åˆ¶ä¸€éæ•°ç»„
        h[i + n] = h[i];
    }
    // æ±‚å‰ç¼€å’Œ
    for (int i = 1; i <= n * 2; i ++ )
        sum[i] = sum[i - 1] + h[i];
    // åŒºé—´DP
    memset(f, INF, sizeof f);
    memset(g, -INF, sizeof g);
    for (int len = 1; len <= n; len ++ )
        for (int i = 1; i + len - 1 <= n * 2; i ++ ) {
            int j = i + len - 1;
            // åˆå¹¶çŸ³å­ï¼Œè¯´æ˜è‡³å°‘æ˜¯ä¸¤å †
            // å¦‚æœå½“å‰åŒºé—´åªæœ‰ä¸€ä¸ªæ•°å­—ï¼Œè¯´æ˜åªæœ‰ä¸€å †ï¼Œä¸å¯èƒ½è¿›è¡Œåˆå¹¶
            // å› æ­¤ï¼Œåˆå¹¶çš„ä»·å€¼ä¸º0
            if (i == j) f[i][j] = g[i][j] = 0;
            for (int k = i; k < j; k ++ ) {
                f[i][j] = min(f[i][j], f[i][k] + f[k + 1][j] + sum[j] - sum[i - 1]);
                g[i][j] = max(g[i][j], g[i][k] + g[k + 1][j] + sum[j] - sum[i - 1]);
            }
        }
    int Minr = INF, Maxr = -INF;
    for (int i = 1; i <= n; i ++ ) {
        // åŒºé—´DPæ˜¯ä¸‹æ ‡
        // æšä¸¾åŒºé—´èµ·ç‚¹ï¼Œå¯»æ‰¾æœ€å¤§å€¼å’Œæœ€å°å€¼
        // ç­”æ¡ˆå¯èƒ½ä½äº[1, n]æˆ–è€…[2, n + 1]æˆ–ï¼Œå› æ­¤ï¼Œéœ€è¦è¿›è¡Œæšä¸¾
        Minr = min(Minr, f[i][i + n - 1]);
        Maxr = max(Maxr, g[i][i + n - 1]);
    }
    cout << Minr << endl << Maxr << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŒºé—´DP`ã€`ç¯`ã€`æ–­ç¯æˆé“¾`

### [AcWing 320. èƒ½é‡é¡¹é“¾](https://www.acwing.com/problem/content/322/)

>   åœ¨ `Mars` æ˜Ÿçƒä¸Šï¼Œæ¯ä¸ª `Mars` äººéƒ½éšèº«ä½©å¸¦ç€ä¸€ä¸²èƒ½é‡é¡¹é“¾ï¼Œåœ¨é¡¹é“¾ä¸Šæœ‰ `N` é¢—èƒ½é‡ç ã€‚
>
>   èƒ½é‡ç æ˜¯ä¸€é¢—æœ‰å¤´æ ‡è®°ä¸å°¾æ ‡è®°çš„ç å­ï¼Œè¿™äº›æ ‡è®°å¯¹åº”ç€æŸä¸ªæ­£æ•´æ•°ã€‚
>
>   å¹¶ä¸”ï¼Œå¯¹äºç›¸é‚»çš„ä¸¤é¢—ç å­ï¼Œå‰ä¸€é¢—ç å­çš„å°¾æ ‡è®°ä¸€å®šç­‰äºåä¸€é¢—ç å­çš„å¤´æ ‡è®°ã€‚
>
>   å› ä¸ºåªæœ‰è¿™æ ·ï¼Œé€šè¿‡å¸ç›˜ï¼ˆå¸ç›˜æ˜¯ `Mars` äººå¸æ”¶èƒ½é‡çš„ä¸€ç§å™¨å®˜ï¼‰çš„ä½œç”¨ï¼Œè¿™ä¸¤é¢—ç å­æ‰èƒ½èšåˆæˆä¸€é¢—ç å­ï¼ŒåŒæ—¶é‡Šæ”¾å‡ºå¯ä»¥è¢«å¸ç›˜å¸æ”¶çš„èƒ½é‡ã€‚
>
>   å¦‚æœå‰ä¸€é¢—èƒ½é‡ç çš„å¤´æ ‡è®°ä¸º `m`ï¼Œå°¾æ ‡è®°ä¸º `r`ï¼Œåä¸€é¢—èƒ½é‡ç çš„å¤´æ ‡è®°ä¸º `r`ï¼Œå°¾æ ‡è®°ä¸º `n`ï¼Œåˆ™èšåˆåé‡Šæ”¾çš„èƒ½é‡ä¸º `mÃ—rÃ—n`ï¼ˆ`Mars` å•ä½ï¼‰ï¼Œæ–°äº§ç”Ÿçš„ç å­çš„å¤´æ ‡è®°ä¸º `m`ï¼Œå°¾æ ‡è®°ä¸º `n`ã€‚
>
>   éœ€è¦æ—¶ï¼Œ`Mars` äººå°±ç”¨å¸ç›˜å¤¹ä½ç›¸é‚»çš„ä¸¤é¢—ç å­ï¼Œé€šè¿‡èšåˆå¾—åˆ°èƒ½é‡ï¼Œç›´åˆ°é¡¹é“¾ä¸Šåªå‰©ä¸‹ä¸€é¢—ç å­ä¸ºæ­¢ã€‚
>
>   æ˜¾ç„¶ï¼Œä¸åŒçš„èšåˆé¡ºåºå¾—åˆ°çš„æ€»èƒ½é‡æ˜¯ä¸åŒçš„ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªèšåˆé¡ºåºï¼Œä½¿ä¸€ä¸²é¡¹é“¾é‡Šæ”¾å‡ºçš„æ€»èƒ½é‡æœ€å¤§ã€‚
>
>   ä¾‹å¦‚ï¼šè®¾ `N=4`ï¼Œ`4` é¢—ç å­çš„å¤´æ ‡è®°ä¸å°¾æ ‡è®°ä¾æ¬¡ä¸º `(2ï¼Œ3)(3ï¼Œ5)(5ï¼Œ10)(10ï¼Œ2)`ã€‚
>
>   æˆ‘ä»¬ç”¨è®°å· `âŠ•` è¡¨ç¤ºä¸¤é¢—ç å­çš„èšåˆæ“ä½œï¼Œ`(jâŠ•k)` è¡¨ç¤ºç¬¬ `j`ï¼Œ`k` ä¸¤é¢—ç å­èšåˆåæ‰€é‡Šæ”¾çš„èƒ½é‡ã€‚åˆ™
>
>   ç¬¬ `4ã€1` ä¸¤é¢—ç å­èšåˆåé‡Šæ”¾çš„èƒ½é‡ä¸ºï¼š`(4âŠ•1)=10Ã—2Ã—3=60`ã€‚
>
>   è¿™ä¸€ä¸²é¡¹é“¾å¯ä»¥å¾—åˆ°æœ€ä¼˜å€¼çš„ä¸€ä¸ªèšåˆé¡ºåºæ‰€é‡Šæ”¾çš„æ€»èƒ½é‡ä¸º `((4âŠ•1)âŠ•2)âŠ•3)=10Ã—2Ã—3+10Ã—3Ã—5+10Ã—5Ã—10=710`ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•° `N`ï¼Œè¡¨ç¤ºé¡¹é“¾ä¸Šç å­çš„ä¸ªæ•°ã€‚
>
>   ç¬¬äºŒè¡Œæ˜¯ `N` ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ­£æ•´æ•°ï¼Œæ‰€æœ‰çš„æ•°å‡ä¸è¶…è¿‡ `1000`ï¼Œç¬¬ `i` ä¸ªæ•°ä¸ºç¬¬ `i` é¢—ç å­çš„å¤´æ ‡è®°ï¼Œå½“ `i<N` æ—¶ï¼Œç¬¬ `i` é¢—ç å­çš„å°¾æ ‡è®°åº”è¯¥ç­‰äºç¬¬ `i+1` é¢—ç å­çš„å¤´æ ‡è®°ï¼Œç¬¬ `N` é¢—ç å­çš„å°¾æ ‡è®°åº”è¯¥ç­‰äºç¬¬ `1` é¢—ç å­çš„å¤´æ ‡è®°ã€‚
>
>   è‡³äºç å­çš„é¡ºåºï¼Œä½ å¯ä»¥è¿™æ ·ç¡®å®šï¼šå°†é¡¹é“¾æ”¾åˆ°æ¡Œé¢ä¸Šï¼Œä¸è¦å‡ºç°äº¤å‰ï¼Œéšæ„æŒ‡å®šç¬¬ä¸€é¢—ç å­ï¼Œç„¶åæŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç¡®å®šå…¶ä»–ç å­çš„é¡ºåºã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºåªæœ‰ä¸€è¡Œï¼Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•° `E`ï¼Œä¸ºä¸€ä¸ªæœ€ä¼˜èšåˆé¡ºåºæ‰€é‡Šæ”¾çš„æ€»èƒ½é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $4â‰¤Nâ‰¤100,$
>   +   $1â‰¤Eâ‰¤2.1Ã—10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
4
2 3 5 10
```

**è¾“å‡ºæ ·ä¾‹**

```c++
710
```

**æ‰‹å†™ç¨¿**

![381759](img/381759.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 210;
int n;
int g[N];
int f[N][N];
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d", &g[i]);
        g[i + n] = g[i];
    }
    // æšä¸¾åŒºé—´é•¿åº¦
    // è‡³å°‘éœ€è¦ä¸¤ä¸ªåŒºé—´ï¼Œå› æ­¤ï¼Œé•¿åº¦æœ€å°ä¸º3
    for (int len = 3; len <= n + 1; len ++ )
        // æšä¸¾å·¦ç«¯ç‚¹
        // ç»ˆç‚¹æ˜¯ã€n * 2ã€‘
        for (int i = 1; i + len - 1 <= n * 2; i ++ ) {
            int j = i + len - 1;
            // å¤´å’Œå°¾æ„æˆä¸€ä¸ªæ•°å¯¹(x, y)
            // æ ‘å¯¹å¯¹åº”çš„ä¸‹æ ‡æ˜¯[i, i + 1]ä¸æ˜¯[i, i]
            for (int k = i + 1; k < j; k ++ )
                f[i][j] = max(f[i][j], f[i][k] + f[k][j] + g[i] * g[k] * g[j]);
        }
    int res = 0;
    // æ³¨æ„ï¼šé•¿åº¦ä¸ºã€n + 1ã€‘ä¸æ˜¯ã€nã€‘
    // åŸå› ï¼šä»1å‡ºå‘æœ€åè¿˜æ˜¯å¾—å›åˆ°1ï¼Œå…±ã€n + 1ã€‘ä¸ªæ•°
    for (int i = 1; i <= n; i ++ ) res = max(res, f[i][i + n]);
    cout << res << endl;
    return 0;
}
```

**æ ‡ç­¾**

`åŒºé—´DP`ã€`ç¯`ã€`æ–­ç¯æˆé“¾`

### [AcWing 1069. å‡¸å¤šè¾¹å½¢çš„åˆ’åˆ†](https://www.acwing.com/problem/content/1071/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªå…·æœ‰ `N` ä¸ªé¡¶ç‚¹çš„å‡¸å¤šè¾¹å½¢ï¼Œå°†é¡¶ç‚¹ä» `1` è‡³ `N` æ ‡å·ï¼Œæ¯ä¸ªé¡¶ç‚¹çš„æƒå€¼éƒ½æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ã€‚
>
>   å°†è¿™ä¸ªå‡¸å¤šè¾¹å½¢åˆ’åˆ†æˆ `Nâˆ’2` ä¸ªäº’ä¸ç›¸äº¤çš„ä¸‰è§’å½¢ï¼Œå¯¹äºæ¯ä¸ªä¸‰è§’å½¢ï¼Œå…¶ä¸‰ä¸ªé¡¶ç‚¹çš„æƒå€¼ç›¸ä¹˜éƒ½å¯å¾—åˆ°ä¸€ä¸ªæƒå€¼ä¹˜ç§¯ï¼Œè¯•æ±‚æ‰€æœ‰ä¸‰è§’å½¢çš„é¡¶ç‚¹æƒå€¼ä¹˜ç§¯ä¹‹å’Œè‡³å°‘ä¸ºå¤šå°‘ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `N`ï¼Œè¡¨ç¤ºé¡¶ç‚¹æ•°é‡ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å« `N` ä¸ªæ•´æ•°ï¼Œä¾æ¬¡ä¸ºé¡¶ç‚¹ `1` è‡³é¡¶ç‚¹ `N` çš„æƒå€¼ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä»…ä¸€è¡Œï¼Œä¸ºæ‰€æœ‰ä¸‰è§’å½¢çš„é¡¶ç‚¹æƒå€¼ä¹˜ç§¯ä¹‹å’Œçš„æœ€å°å€¼ã€‚

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤50$,
>   +   $æ•°æ®ä¿è¯æ‰€æœ‰é¡¶ç‚¹çš„æƒå€¼éƒ½å°äº10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
5
121 122 123 245 231
```

**è¾“å‡ºæ ·ä¾‹**

```c++
12214884
```

**æ‰‹å†™ç¨¿**

![3110834](img/3110834.png)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
typedef long long LL;
const int N = 55, INF = 1e9;
int n;
int w[N];
vector<int> f[N][N];
// é«˜ç²¾åº¦ä¹˜æ³•
vector<int> mul(vector<int> A, int b) {
    vector<int> C;
    LL t = 0;
    for (int i = 0; i < A.size(); i ++ ) {
        t += (LL)A[i] * b;
        C.push_back(t % 10);
        t /= 10;
    }
    while (t) C.push_back(t % 10), t /= 10;
    while (C.size() > 1 && C.back() == 0) C.pop_back();
    return C;
}
// é«˜ç²¾åº¦åŠ æ³•
vector<int> add(vector<int> A, vector<int> B) {
    vector<int> C;
    int t = 0;
    for (int i = 0, j = 0; i < A.size() || j < B.size(); i ++ , j ++ ) {
        if (i < A.size()) t += A[i];
        if (j < B.size()) t += B[i];
        C.push_back(t % 10);
        t /= 10;
    }
    while (t) C.push_back(t % 10), t /= 10;
    return C;
}
// æ¯”è¾ƒå‡½æ•°
bool cmp(vector<int>& A, vector<int>& B) {
    if (A.size() != B.size()) return A.size() > B.size();
    for (int i = A.size() - 1; i >= 0; i -- )
        if (A[i] != B[i]) return A[i] > B[i];
    return false;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &w[i]);
    for (int len = 3; len <= n; len ++ )
        for (int i = 1; i + len - 1 <= n; i ++ ) {
            int j = i + len - 1;
            for (int k = i + 1; k < j; k ++ ) {
                // w[i] * w[k] * w[j];
                auto new_mul = mul(mul({w[i]}, w[k]), w[j]);
                // f[i][k] + f[k][j] + w[i] * w[k] * w[j];
                auto new_add = add(add(f[i][k], f[k][j]), new_mul);
                // f[i][j] = min(f[i][j], f[i][k] + f[k][j] + w[i] * w[k] * w[j]);
                // åªæœ‰ç®—è¿‡çš„æ‰æ›´æ–°ï¼Œæ²¡ç®—è¿‡çš„å°±ä¸éœ€è¦æ›´æ–°
                if (f[i][j].empty() || cmp(f[i][j], new_add)) // å¦‚æœf[i][j] > new_add
                    f[i][j] = new_add;
            }
        }
    auto res = f[1][n];
    for (int i = res.size() - 1; i >= 0; i -- ) cout << res[i];
    return 0;
}
```

**æ ‡ç­¾**

`åŒºé—´DP`ã€`é«˜ç²¾åº¦`

**ç¼åˆæ€ª**

[é«˜ç²¾åº¦](#é«˜ç²¾åº¦)

### [AcWing 479. åŠ åˆ†äºŒå‰æ ‘](https://www.acwing.com/problem/content/481/)

**é¢˜ç›®æè¿°**

>   è®¾ä¸€ä¸ª `n` ä¸ªèŠ‚ç‚¹çš„äºŒå‰æ ‘ `tree` çš„ä¸­åºéå†ä¸º`ï¼ˆ1,2,3,â€¦,nï¼‰`ï¼Œå…¶ä¸­æ•°å­— `1,2,3,â€¦,n` ä¸ºèŠ‚ç‚¹ç¼–å·ã€‚
>
>   æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªåˆ†æ•°ï¼ˆå‡ä¸ºæ­£æ•´æ•°ï¼‰ï¼Œè®°ç¬¬ `i` ä¸ªèŠ‚ç‚¹çš„åˆ†æ•°ä¸º $d_i$ï¼Œ`tree` åŠå®ƒçš„æ¯ä¸ªå­æ ‘éƒ½æœ‰ä¸€ä¸ªåŠ åˆ†ï¼Œä»»ä¸€æ£µå­æ ‘ `subtree`ï¼ˆä¹ŸåŒ…å« `tree` æœ¬èº«ï¼‰çš„åŠ åˆ†è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼šâ€‚â€‚â€‚â€‚â€‚
>
>   `subtree` çš„å·¦å­æ ‘çš„åŠ åˆ† `Ã—` `subtree` çš„å³å­æ ‘çš„åŠ åˆ† `ï¼‹` `subtree` çš„æ ¹çš„åˆ†æ•°â€‚
>
>   è‹¥æŸä¸ªå­æ ‘ä¸ºç©ºï¼Œè§„å®šå…¶åŠ åˆ†ä¸º `1`ã€‚
>
>   å¶å­çš„åŠ åˆ†å°±æ˜¯å¶èŠ‚ç‚¹æœ¬èº«çš„åˆ†æ•°ï¼Œä¸è€ƒè™‘å®ƒçš„ç©ºå­æ ‘ã€‚
>
>   è¯•æ±‚ä¸€æ£µç¬¦åˆä¸­åºéå†ä¸º`ï¼ˆ1,2,3,â€¦,nï¼‰`ä¸”åŠ åˆ†æœ€é«˜çš„äºŒå‰æ ‘ `tree`ã€‚
>
>   è¦æ±‚è¾“å‡ºï¼šâ€‚
>
>   ï¼ˆ1ï¼‰`tree` çš„æœ€é«˜åŠ åˆ†â€‚
>
>   ï¼ˆ2ï¼‰`tree` çš„å‰åºéå†

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œï¼šä¸€ä¸ªæ•´æ•° `n`ï¼Œä¸ºèŠ‚ç‚¹ä¸ªæ•°ã€‚â€‚
>
>   ç¬¬ `2` è¡Œï¼š`n` ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ•´æ•°ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„åˆ†æ•°`ï¼ˆ0<åˆ†æ•°<100ï¼‰`ã€‚

**è¾“å‡ºæ ¼å¼**

>   ç¬¬ `1` è¡Œï¼šä¸€ä¸ªæ•´æ•°ï¼Œä¸ºæœ€é«˜åŠ åˆ†ï¼ˆç»“æœä¸ä¼šè¶…è¿‡`int`èŒƒå›´ï¼‰ã€‚â€‚â€‚â€‚â€‚â€‚
>
>   ç¬¬ `2` è¡Œï¼š`n` ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ•´æ•°ï¼Œä¸ºè¯¥æ ‘çš„å‰åºéå†ã€‚å¦‚æœå­˜åœ¨å¤šç§æ–¹æ¡ˆï¼Œåˆ™è¾“å‡ºå­—å…¸åºæœ€å°çš„æ–¹æ¡ˆã€‚

**æ•°æ®èŒƒå›´**

>   +   `n < 30`

**è¾“å…¥æ ·ä¾‹**

```c++
5
5 7 1 2 10
```

**è¾“å‡ºæ ·ä¾‹**

```c++
145
3 1 2 4 5
```

**æ‰‹å†™ç¨¿**

![3122138](img/3122138.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 35;
int n;
int w[N];
int f[N][N], g[N][N];
void dfs(int l, int r) {
    if (l > r) return;
    // [l, r]çš„æ ¹èŠ‚ç‚¹æ˜¯g[l][r]
    cout << g[l][r] << " ";
    // å·¦å³å­æ ‘ä¸åŒ…æ‹¬æ ¹èŠ‚ç‚¹
    // å·¦å­æ ‘çš„åŒºé—´[l, g[l][r] - 1]
    dfs(l, g[l][r] - 1);
    // å·¦å­æ ‘çš„åŒºé—´[g[l][r] + 1, r]
    dfs(g[l][r] + 1, r);
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &w[i]);
    for (int len = 1; len <= n; len ++ )
        for (int i = 1; i + len - 1 <= n; i ++ ) {
            int j = i + len - 1;
            if (len == 1) { // å¶èŠ‚ç‚¹
                // å¶èŠ‚ç‚¹çš„ä»·å€¼ä¸ºå¶èŠ‚ç‚¹æœ¬èº«çš„åˆ†æ•°
                f[i][j] = w[i];
                // å¶èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹ä¸ºå…¶æœ¬èº«
                g[i][j] = i;
            }
            else { // éå¶èŠ‚ç‚¹
                for (int k = i; k <= j; k ++ ) {
                    // è¯´æ˜æ— å·¦å­æ ‘ï¼Œè§„å®šå…¶åˆ†æ•°ä¸º1
                    if (k == i) f[i][k - 1] = 1;
                    // è¯´æ˜æ— å³å­æ ‘ï¼Œè§„å®šå…¶åˆ†æ•°ä¸º1
                    if (k == j) f[k + 1][j] = 1;
                    // è®¡ç®—ä»¥kä¸ºæ ¹èŠ‚ç‚¹çš„äºŒå‰æ ‘çš„åˆ†æ•°
                    int score = f[i][k - 1] * f[k + 1][j] + w[k];
                    // åŒºé—´[i, j]çš„åˆ†æ•°å°äºscoreæ—¶ï¼Œæ‰æ›´æ–°
                    // åŒºé—´[i, j]çš„åˆ†æ•°ç­‰äºscoreæ—¶ï¼Œç”±äºå­—å…¸åºçš„é™åˆ¶ï¼Œä¸æ›´æ–°
                    // å…·ä½“çœ‹æ‰‹å†™ç¨¿åˆ†æ
                    if (f[i][j] < score) {
                        f[i][j] = score;
                        g[i][j] = k;
                    }
                }
            }
        }
    cout << f[1][n] << endl;
    dfs(1, n);
    return 0;
}
```

**æ ‡ç­¾**

`åŒºé—´DP`ã€`åŒºé—´DPæ±‚å…·ä½“æ–¹æ¡ˆ`

### [AcWing 321. æ£‹ç›˜åˆ†å‰²](https://www.acwing.com/problem/content/323/)

**é¢˜ç›®æè¿°**

>   å°†ä¸€ä¸ª `8Ã—8` çš„æ£‹ç›˜è¿›è¡Œå¦‚ä¸‹åˆ†å‰²ï¼šå°†åŸæ£‹ç›˜å‰²ä¸‹ä¸€å—çŸ©å½¢æ£‹ç›˜å¹¶ä½¿å‰©ä¸‹éƒ¨åˆ†ä¹Ÿæ˜¯çŸ©å½¢ï¼Œå†å°†å‰©ä¸‹çš„éƒ¨åˆ†ç»§ç»­å¦‚æ­¤åˆ†å‰²ï¼Œè¿™æ ·å‰²äº† `(nâˆ’1)` æ¬¡åï¼Œè¿åŒæœ€åå‰©ä¸‹çš„çŸ©å½¢æ£‹ç›˜å…±æœ‰ `n` å—çŸ©å½¢æ£‹ç›˜ã€‚(æ¯æ¬¡åˆ‡å‰²éƒ½åªèƒ½æ²¿ç€æ£‹ç›˜æ ¼å­çš„è¾¹è¿›è¡Œ)
>
>   ![1191_1.jpg](img/19_32dad08629-1191_1-20220312214449106.jpg)
>
>   åŸæ£‹ç›˜ä¸Šæ¯ä¸€æ ¼æœ‰ä¸€ä¸ªåˆ†å€¼ï¼Œä¸€å—çŸ©å½¢æ£‹ç›˜çš„æ€»åˆ†ä¸ºå…¶æ‰€å«å„æ ¼åˆ†å€¼ä¹‹å’Œã€‚
>
>   ç°åœ¨éœ€è¦æŠŠæ£‹ç›˜æŒ‰ä¸Šè¿°è§„åˆ™åˆ†å‰²æˆ `n` å—çŸ©å½¢æ£‹ç›˜ï¼Œå¹¶ä½¿å„çŸ©å½¢æ£‹ç›˜æ€»åˆ†çš„å‡æ–¹å·®æœ€å°ã€‚
>
>   å‡æ–¹å·®![formula.png](img/19_566d096029-formula.png) ï¼Œå…¶ä¸­å¹³å‡å€¼![lala.png](img/19_047fe57229-lala-20220312215123355.png) ï¼Œ$x_i$ ä¸ºç¬¬ `i` å—çŸ©å½¢æ£‹ç›˜çš„æ€»åˆ†ã€‚
>
>   è¯·ç¼–ç¨‹å¯¹ç»™å‡ºçš„æ£‹ç›˜åŠ `n`ï¼Œæ±‚å‡ºå‡æ–¹å·®çš„æœ€å°å€¼ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œä¸ºä¸€ä¸ªæ•´æ•° `n`ã€‚
>
>   ç¬¬ `2` è¡Œè‡³ç¬¬ `9` è¡Œæ¯è¡Œä¸º `8` ä¸ªå°äº `100` çš„éè´Ÿæ•´æ•°ï¼Œè¡¨ç¤ºæ£‹ç›˜ä¸Šç›¸åº”æ ¼å­çš„åˆ†å€¼ã€‚æ¯è¡Œç›¸é‚»ä¸¤æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼åˆ†éš”ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºæœ€å°å‡æ–¹å·®å€¼ï¼ˆå››èˆäº”å…¥ç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸‰ä½ï¼‰ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1<n<15$

**è¾“å…¥æ ·ä¾‹**

```c++
3
1 1 1 1 1 1 1 3
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 1
1 1 1 1 1 1 1 0
1 1 1 1 1 1 0 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1.633
```

**æ‰‹å†™ç¨¿**

![3140755](img/3140755.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <cmath>
using namespace std;
const int N = 10, M = 15;
int n;
double X;
int g[N][N], sum[N][N];
double f[N][N][N][N][M];
// è®¡ç®—æ–¹å·®
double get(int x1, int y1, int x2, int y2) {
    double s = sum[x2][y2] - sum[x1 - 1][y2] - sum[x2][y1 - 1] + sum[x1 - 1][y1 - 1] - X;
    return (double)s * s / n;
}
double dfs(int x1, int y1, int x2, int y2, int k) {
    double &v = f[x1][y1][x2][y2][k];
    // å¦‚æœå·²ç»è®¡ç®—è¿‡ï¼Œåˆ™ç›´æ¥è¿”å›
    if (v >= 0) return v;
    // å¦‚æœåªéœ€è¦1ä¸ªçŸ©å½¢ï¼Œç›´æ¥è®¡ç®—å³å¯
    if (k == 1) return v = get(x1, y1, x2, y2);
    // åˆå§‹åŒ–ä¸ºæœ€å¤§å€¼
    v = 1e9;
    // æ¨ªç€åˆ‡
    for (int i = x1; i <= x2; i ++ ) {
        v = min(v, dfs(x1, y1, i, y2, k - 1) + get(i + 1, y1, x2, y2));
        v = min(v, dfs(i, y1, x2, y2, k - 1) + get(x1, y1, i - 1, y2));
    }
    // ç«–ç€åˆ‡
    for (int i = y1; i <= y2; i ++ ) {
        v = min(v, dfs(x1, y1, x2, i, k - 1) + get(x1, i + 1, x2, y2));
        v = min(v, dfs(x1, i, x2, y2, k - 1) + get(x1, y1, x2, i - 1));
    }
    return v;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= 8; i ++ )
        for (int j = 1; j <= 8; j ++ ) {
            scanf("%d", &g[i][j]);
            // å‰ç¼€å’Œ
            sum[i][j] = g[i][j] + sum[i - 1][j] + sum[i][j - 1] - sum[i - 1][j - 1];
        }
    // Xæ‹”
    X = (double)sum[8][8] / n;
    // æµ®ç‚¹å‹æ•°ç»„åˆå§‹åŒ–-1ï¼Œå…¶å€¼ä¸ºNaN
    memset(f, -1, sizeof f);
    printf("%.3lf\n", sqrt(dfs(1, 1, 8, 8, n)));
    return 0;
}
```

**æ ‡ç­¾**

`åŒºé—´DP`ã€`è®°å¿†åŒ–æœç´¢`ã€`å‰ç¼€å’Œ`

### [LeetCode 375. çŒœæ•°å­—å¤§å° II](https://leetcode-cn.com/problems/guess-number-higher-or-lower-ii/)

**é¢˜ç›®æè¿°**

>   æˆ‘ä»¬æ­£åœ¨ç©ä¸€ä¸ªçŒœæ•°æ¸¸æˆï¼Œæ¸¸æˆè§„åˆ™å¦‚ä¸‹ï¼š
>
>   +   æˆ‘ä» `1` åˆ° `n` ä¹‹é—´é€‰æ‹©ä¸€ä¸ªæ•°å­—ã€‚
>   +   ä½ æ¥çŒœæˆ‘é€‰äº†å“ªä¸ªæ•°å­—ã€‚
>   +   å¦‚æœä½ çŒœåˆ°æ­£ç¡®çš„æ•°å­—ï¼Œå°±ä¼š èµ¢å¾—æ¸¸æˆ ã€‚
>   +   å¦‚æœä½ çŒœé”™äº†ï¼Œé‚£ä¹ˆæˆ‘ä¼šå‘Šè¯‰ä½ ï¼Œæˆ‘é€‰çš„æ•°å­—æ¯”ä½ çš„ æ›´å¤§æˆ–è€…æ›´å° ï¼Œå¹¶ä¸”ä½ éœ€è¦ç»§ç»­çŒœæ•°ã€‚
>   +   æ¯å½“ä½ çŒœäº†æ•°å­— `x` å¹¶ä¸”çŒœé”™äº†çš„æ—¶å€™ï¼Œä½ éœ€è¦æ”¯ä»˜é‡‘é¢ä¸º `x` çš„ç°é‡‘ã€‚å¦‚æœä½ èŠ±å…‰äº†é’±ï¼Œå°±ä¼š è¾“æ‰æ¸¸æˆ ã€‚
>
>   ç»™ä½ ä¸€ä¸ªç‰¹å®šçš„æ•°å­— `n` ï¼Œè¿”å›èƒ½å¤Ÿ ç¡®ä¿ä½ è·èƒœ çš„æœ€å°ç°é‡‘æ•°ï¼Œä¸ç®¡æˆ‘é€‰æ‹©é‚£ä¸ªæ•°å­— ã€‚

**ç¤ºä¾‹ 1**

![img](img/graph.png)

>   è¾“å…¥ï¼š`n = 10`
>   è¾“å‡ºï¼š`16`
>   è§£é‡Šï¼šåˆ¶èƒœç­–ç•¥å¦‚ä¸‹ï¼š
>
>   - æ•°å­—èŒƒå›´æ˜¯ `[1,10]` ã€‚ä½ å…ˆçŒœæµ‹æ•°å­—ä¸º `7` ã€‚
>       - å¦‚æœè¿™æ˜¯æˆ‘é€‰ä¸­çš„æ•°å­—ï¼Œä½ çš„æ€»è´¹ç”¨ä¸º `0` ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ”¯ä»˜ `7` ã€‚
>       - å¦‚æœæˆ‘çš„æ•°å­—æ›´å¤§ï¼Œåˆ™ä¸‹ä¸€æ­¥éœ€è¦çŒœæµ‹çš„æ•°å­—èŒƒå›´æ˜¯ `[8,10]` ã€‚ä½ å¯ä»¥çŒœæµ‹æ•°å­—ä¸º `9` ã€‚
>           - å¦‚æœè¿™æ˜¯æˆ‘é€‰ä¸­çš„æ•°å­—ï¼Œä½ çš„æ€»è´¹ç”¨ä¸º `7` ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ”¯ä»˜ `9` ã€‚
>           - å¦‚æœæˆ‘çš„æ•°å­—æ›´å¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯ `10` ã€‚ä½ çŒœæµ‹æ•°å­—ä¸º `10` å¹¶èµ¢å¾—æ¸¸æˆï¼Œæ€»è´¹ç”¨ä¸º `7 + 9 = 16` ã€‚
>           - å¦‚æœæˆ‘çš„æ•°å­—æ›´å°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯ `8` ã€‚ä½ çŒœæµ‹æ•°å­—ä¸º `8` å¹¶èµ¢å¾—æ¸¸æˆï¼Œæ€»è´¹ç”¨ä¸º `7 + 9 = 16` ã€‚
>       - å¦‚æœæˆ‘çš„æ•°å­—æ›´å°ï¼Œåˆ™ä¸‹ä¸€æ­¥éœ€è¦çŒœæµ‹çš„æ•°å­—èŒƒå›´æ˜¯ `[1,6]` ã€‚ä½ å¯ä»¥çŒœæµ‹æ•°å­—ä¸º `3` ã€‚
>           - å¦‚æœè¿™æ˜¯æˆ‘é€‰ä¸­çš„æ•°å­—ï¼Œä½ çš„æ€»è´¹ç”¨ä¸º `7` ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ”¯ä»˜ `3` ã€‚
>           - å¦‚æœæˆ‘çš„æ•°å­—æ›´å¤§ï¼Œåˆ™ä¸‹ä¸€æ­¥éœ€è¦çŒœæµ‹çš„æ•°å­—èŒƒå›´æ˜¯ `[4,6]` ã€‚ä½ å¯ä»¥çŒœæµ‹æ•°å­—ä¸º `5` ã€‚
>               - å¦‚æœè¿™æ˜¯æˆ‘é€‰ä¸­çš„æ•°å­—ï¼Œä½ çš„æ€»è´¹ç”¨ä¸º `7 + 3 = 10` ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ”¯ä»˜ `5` ã€‚
>               - å¦‚æœæˆ‘çš„æ•°å­—æ›´å¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯ `6` ã€‚ä½ çŒœæµ‹æ•°å­—ä¸º `6` å¹¶èµ¢å¾—æ¸¸æˆï¼Œæ€»è´¹ç”¨ä¸º `7 + 3 + 5 = 15` ã€‚
>               - å¦‚æœæˆ‘çš„æ•°å­—æ›´å°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯ `4` ã€‚ä½ çŒœæµ‹æ•°å­—ä¸º `4` å¹¶èµ¢å¾—æ¸¸æˆï¼Œæ€»è´¹ç”¨ä¸º `7 + 3 + 5 = 15` ã€‚
>           - å¦‚æœæˆ‘çš„æ•°å­—æ›´å°ï¼Œåˆ™ä¸‹ä¸€æ­¥éœ€è¦çŒœæµ‹çš„æ•°å­—èŒƒå›´æ˜¯ `[1,2]` ã€‚ä½ å¯ä»¥çŒœæµ‹æ•°å­—ä¸º `1` ã€‚
>               - å¦‚æœè¿™æ˜¯æˆ‘é€‰ä¸­çš„æ•°å­—ï¼Œä½ çš„æ€»è´¹ç”¨ä¸º `7 + 3 = 10` ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ”¯ä»˜ `1` ã€‚
>               - å¦‚æœæˆ‘çš„æ•°å­—æ›´å¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯ `2` ã€‚ä½ çŒœæµ‹æ•°å­—ä¸º `2` å¹¶èµ¢å¾—æ¸¸æˆï¼Œæ€»è´¹ç”¨ä¸º `7 + 3 + 1 = 11` ã€‚
>
>   åœ¨æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ”¯ä»˜ `16` ã€‚å› æ­¤ï¼Œä½ åªéœ€è¦ `16` å°±å¯ä»¥ç¡®ä¿è‡ªå·±èµ¢å¾—æ¸¸æˆã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`n = 1`
>   è¾“å‡ºï¼š`0`
>   è§£é‡Šï¼šåªæœ‰ä¸€ä¸ªå¯èƒ½çš„æ•°å­—ï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›´æ¥çŒœ `1` å¹¶èµ¢å¾—æ¸¸æˆï¼Œæ— éœ€æ”¯ä»˜ä»»ä½•è´¹ç”¨ã€‚

**ç¤ºä¾‹ 3**

>   è¾“å…¥ï¼š`n = 2`
>   è¾“å‡ºï¼š`1`
>   è§£é‡Šï¼šæœ‰ä¸¤ä¸ªå¯èƒ½çš„æ•°å­— `1` å’Œ `2` ã€‚
>
>   - ä½ å¯ä»¥å…ˆçŒœ `1` ã€‚
>       - å¦‚æœè¿™æ˜¯æˆ‘é€‰ä¸­çš„æ•°å­—ï¼Œä½ çš„æ€»è´¹ç”¨ä¸º `0` ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ”¯ä»˜ `1` ã€‚
>       - å¦‚æœæˆ‘çš„æ•°å­—æ›´å¤§ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯ `2` ã€‚ä½ çŒœæµ‹æ•°å­—ä¸º `2` å¹¶èµ¢å¾—æ¸¸æˆï¼Œæ€»è´¹ç”¨ä¸º `1` ã€‚
>           æœ€ç³Ÿç³•çš„æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ”¯ä»˜ `1` ã€‚

**æç¤º**

>   +   $1 <= n <= 200$

**æ‰‹å†™ç¨¿**

![3162058](img/3162058.png)

**ä»£ç **

```c++
class Solution {
public:
    int getMoneyAmount(int n) {
        vector<vector<int>> f(n + 5, vector<int>(n + 5));
        // æšä¸¾åŒºé—´é•¿åº¦
        for (int len = 2; len <= n; len ++ )
            // æšä¸¾å·¦ç«¯ç‚¹
            for (int i = 1; i + len - 1 <= n; i ++ ) {
                // æ‰¾åˆ°å³ç«¯ç‚¹
                int j = i + len - 1;
                f[i][j] = 1e9;
                for (int k = i; k <= j; k ++ ) 
                    f[i][j] = min(f[i][j], max(f[i][k - 1], f[k + 1][j]) + k);
            }
        return f[1][n];
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`åŒºé—´DP`

**ç¼åˆæ€ª**

# æœç´¢



## å®½åº¦ä¼˜å…ˆæœç´¢

### æ¦‚è¿°

>   1.   å®½æœè§£å†³çš„ä¸€èˆ¬æ˜¯æœ€çŸ­ã€æœ€å°‘ç­‰ç±»ä¼¼é—®é¢˜
>   2.   å®½æœç›¸æ¯”è¾ƒäºæ·±æœï¼Œä¸ä¼šå­˜åœ¨çˆ†æ ˆç­‰é—®é¢˜

### `Flood Fill`

#### [AcWing 1097. æ± å¡˜è®¡æ•°](https://www.acwing.com/problem/content/1099/)

**é¢˜ç›®æè¿°**

>   å†œå¤«çº¦ç¿°æœ‰ä¸€ç‰‡ `N âˆ— M` çš„çŸ©å½¢åœŸåœ°ã€‚
>
>   æœ€è¿‘ï¼Œç”±äºé™é›¨çš„åŸå› ï¼Œéƒ¨åˆ†åœŸåœ°è¢«æ°´æ·¹æ²¡äº†ã€‚
>
>   ç°åœ¨ç”¨ä¸€ä¸ªå­—ç¬¦çŸ©é˜µæ¥è¡¨ç¤ºä»–çš„åœŸåœ°ã€‚
>
>   æ¯ä¸ªå•å…ƒæ ¼å†…ï¼Œå¦‚æœåŒ…å«é›¨æ°´ï¼Œåˆ™ç”¨â€`W`â€è¡¨ç¤ºï¼Œå¦‚æœä¸å«é›¨æ°´ï¼Œåˆ™ç”¨â€`.`â€è¡¨ç¤ºã€‚
>
>   ç°åœ¨ï¼Œçº¦ç¿°æƒ³çŸ¥é“ä»–çš„åœŸåœ°ä¸­å½¢æˆäº†å¤šå°‘ç‰‡æ± å¡˜ã€‚
>
>   æ¯ç»„ç›¸è¿çš„ç§¯æ°´å•å…ƒæ ¼é›†åˆå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç‰‡æ± å¡˜ã€‚
>
>   æ¯ä¸ªå•å…ƒæ ¼è§†ä¸ºä¸å…¶ä¸Šã€ä¸‹ã€å·¦ã€å³ã€å·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€å³ä¸‹å…«ä¸ªé‚»è¿‘å•å…ƒæ ¼ç›¸è¿ã€‚
>
>   è¯·ä½ è¾“å‡ºå…±æœ‰å¤šå°‘ç‰‡æ± å¡˜ï¼Œå³çŸ©é˜µä¸­å…±æœ‰å¤šå°‘ç‰‡ç›¸è¿çš„â€`W`â€å—ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
>   æ¥ä¸‹æ¥ `N` è¡Œï¼Œæ¯è¡ŒåŒ…å« `M` ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦ä¸ºâ€`W`â€æˆ–â€`.`â€ï¼Œç”¨ä»¥è¡¨ç¤ºçŸ©å½¢åœŸåœ°çš„ç§¯æ°´çŠ¶å†µï¼Œå­—ç¬¦ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ± å¡˜æ•°ç›®ã€‚

**æ•°æ®èŒƒå›´**

>   +   `1â‰¤N,Mâ‰¤1000`

**è¾“å…¥æ ·ä¾‹**

```c++
10 12
W........WW.
.WWW.....WWW
....WW...WW.
.........WW.
.........W..
..W......W..
.W.W.....WW.
W.W.W.....W.
.W.W......W.
..W.......W.
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![3180942](img/3180942.png)

**ä»£ç **

```c++
#include <iostream>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 1010, M = N * N;
int n, m;
// å­˜å‚¨æ¯ä¸€ä¸ªç‚¹
PII q[M];
// å­˜å‚¨xçš„å…«ä¸ªæ–¹å‘
int dx[8] = {-1, -1, -1, 0, 1, 1, 1, 0};
// å­˜å‚¨yçš„å…«ä¸ªæ–¹å‘
int dy[8] = {-1, 0, 1, 1, 1, 0, -1, -1};
char g[N][N];
// stæ•°ç»„ä¿è¯æ¯ä¸ªç‚¹éƒ½åªè¢«éå†ä¸€æ¬¡
int st[N][N];
void bfs(int sx, int sy) {
    int hh = 0, tt = -1;
    q[++ tt] = {sx, sy};
    // ä¸€å¼€å§‹å½“å‰æ°´æ´¼å·²ç»è¢«è®¿é—®è¿‡
    st[sx][sy] = true;
    while (hh <= tt) {
        PII t = q[hh ++ ];
        for (int i = 0; i < 8; i ++ ) {
            int tx = t.x + dx[i];
            int ty = t.y + dy[i];
            // å¦‚æœæ²¡æœ‰è¶Šç•Œï¼Œå¹¶ä¸”å½“å‰ç”°åœ°æ˜¯æ°´æ´¼ï¼Œå¹¶ä¸”å½“å‰ç”°åœ°æ²¡æœ‰è¢«è®¿é—®è¿‡
            if (tx < 0 || tx >= n || ty < 0 || ty >= m || g[tx][ty] == '.' || st[tx][ty])
                continue;
            // å½“å‰ç”°åœ°å·²ç»è¢«è®¿é—®è¿‡
            // ä¿è¯æ¯ä¸ªç‚¹éƒ½åªè¢«éå†ä¸€æ¬¡
            st[tx][ty] = true;
            // å…¥é˜Ÿ
            q[++ tt] = {tx, ty};
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n; i ++ ) scanf("%s", g[i]);
    int cnt = 0;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < m; j ++ )
            // å¦‚æœå½“å‰ä½ç½®ä¸º'W'å¹¶ä¸”å½“å‰ä½ç½®æ²¡æœ‰è¢«è®¿é—®è¿‡
            if (g[i][j] == 'W' && !st[i][j]) {
                bfs(i, j);
                // æ± å¡˜æ•°é‡++
                cnt ++;
            }
    cout << cnt << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`å®½æœ`ã€`Flood Fill`

**ç¼åˆæ€ª**

#### [AcWing 1098. åŸå ¡é—®é¢˜](https://www.acwing.com/problem/content/1100/)

**é¢˜ç›®æè¿°**

>   ```c++
>   1   2   3   4   5   6   7  
>   #############################
>   1 #   |   #   |   #   |   |   #
>   #####---#####---#---#####---#
>   2 #   #   |   #   #   #   #   #
>   #---#####---#####---#####---#
>   3 #   |   |   #   #   #   #   #
>   #---#########---#####---#---#
>   4 #   #   |   |   |   |   #   #
>   #############################
>          (å›¾ 1)
>   
>   #  = Wall   
>   |  = No wall
>      -  = No wall
>   
>      æ–¹å‘ï¼šä¸ŠåŒ—ä¸‹å—å·¦è¥¿å³ä¸œã€‚
>   ```
>
>   å›¾ `1` æ˜¯ä¸€ä¸ªåŸå ¡çš„åœ°å½¢å›¾ã€‚
>
>   è¯·ä½ ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè®¡ç®—åŸå ¡ä¸€å…±æœ‰å¤šå°‘æˆ¿é—´ï¼Œæœ€å¤§çš„æˆ¿é—´æœ‰å¤šå¤§ã€‚
>
>   åŸå ¡è¢«åˆ†å‰²æˆ `m âˆ— n`ä¸ªæ–¹æ ¼åŒºåŸŸï¼Œæ¯ä¸ªæ–¹æ ¼åŒºåŸŸå¯ä»¥æœ‰ `0 ~ 4` é¢å¢™ã€‚
>
>   æ³¨æ„ï¼šå¢™ä½“åšåº¦å¿½ç•¥ä¸è®¡ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `m` å’Œ `n`ï¼Œåˆ†åˆ«è¡¨ç¤ºåŸå ¡å—åŒ—æ–¹å‘çš„é•¿åº¦å’Œä¸œè¥¿æ–¹å‘çš„é•¿åº¦ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼Œæ¯ä¸ªæ•´æ•°éƒ½è¡¨ç¤ºå¹³é¢å›¾å¯¹åº”ä½ç½®çš„æ–¹å—çš„å¢™çš„ç‰¹å¾ã€‚
>
>   æ¯ä¸ªæ–¹å—ä¸­å¢™çš„ç‰¹å¾ç”±æ•°å­— `P` æ¥æè¿°ï¼Œæˆ‘ä»¬ç”¨ `1` è¡¨ç¤ºè¥¿å¢™ï¼Œ`2` è¡¨ç¤ºåŒ—å¢™ï¼Œ`4` è¡¨ç¤ºä¸œå¢™ï¼Œ`8` è¡¨ç¤ºå—å¢™ï¼Œ`P` ä¸ºè¯¥æ–¹å—åŒ…å«å¢™çš„æ•°å­—ä¹‹å’Œã€‚
>
>   ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæ–¹å—çš„ `P` ä¸º `3`ï¼Œåˆ™ `3 = 1 + 2`ï¼Œè¯¥æ–¹å—åŒ…å«è¥¿å¢™å’ŒåŒ—å¢™ã€‚
>
>   åŸå ¡çš„å†…å¢™è¢«è®¡ç®—ä¸¤æ¬¡ï¼Œæ–¹å—`(1,1)`çš„å—å¢™åŒæ—¶ä¹Ÿæ˜¯æ–¹å—`(2,1)`çš„åŒ—å¢™ã€‚
>
>   è¾“å…¥çš„æ•°æ®ä¿è¯åŸå ¡è‡³å°‘æœ‰ä¸¤ä¸ªæˆ¿é—´ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œè¾“å‡ºæˆ¿é—´æ€»æ•°ï¼Œç¬¬äºŒè¡Œè¾“å‡ºæœ€å¤§æˆ¿é—´çš„é¢ç§¯ï¼ˆæ–¹å—æ•°ï¼‰ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤m,nâ‰¤50,$
>   +   $0â‰¤Pâ‰¤15$

**è¾“å…¥æ ·ä¾‹**

```c++
4 7 
11 6 11 6 3 10 6 
7 9 6 13 5 15 5 
1 10 12 7 13 7 5 
13 11 10 8 10 12 13 
```

**è¾“å‡ºæ ·ä¾‹**

```c++
5
9
```

**æ‰‹å†™ç¨¿**

![3181225](img/3181225.png)

**ä»£ç **

```c++
#include <iostream>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 55, M = N * N;
int n, m;
// æ³¨æ„ï¼šæ­¤å¤„è®¾ç½®çš„æ–¹å‘è¦å’Œé¢˜ç›®ä¸­çš„ä¸€è‡´ã€æ‰‹å†™ç¨¿æœ‰è¯´æ˜ã€‘
int dx[4] = {0, -1, 0, 1};
int dy[4] = {-1, 0, 1, 0};
PII q[M];
int g[N][N], st[N][N];
int bfs(int sx, int sy) {
    // æ–¹å—çš„æ•°é‡
    int area = 0;
    int hh = 0, tt = -1;
    q[++ tt] = {sx, sy};
    st[sx][sy] = true;
    while (hh <= tt) {
        PII t = q[hh ++];
        area ++;
        // æšä¸¾å››ä¸ªæ–¹å‘
        for (int i = 0; i < 4; i ++ ) {
            int tx = t.x + dx[i];
            int ty = t.y + dy[i];
            // åˆ¤æ–­æ˜¯å¦è¶Šç•Œä»¥åŠæ˜¯å¦å·²ç»è¢«è®¿é—®è¿‡
            if (tx < 0 || tx >= n || ty < 0 || ty >= m || st[tx][ty]) continue;
            // åˆ¤æ–­æ˜¯å¦æœ‰å¢™
            if (g[t.x][t.y] >> i & 1) continue;
            q[++ tt] = {tx, ty};
            // æ”¾ç½®æŸä¸ªç‚¹è¢«é‡å¤åŠ å…¥
            // ä¿è¯æ¯ä¸ªç‚¹åªè¢«éå†ä¸€æ¬¡
            st[tx][ty] = true;
        }
    }
    return area;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < m; j ++ )
            scanf("%d", &g[i][j]);
    int cnt = 0, area = 0;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < m; j ++ )
            if (!st[i][j]) {
                area = max(area, bfs(i, j));
                cnt ++;
            }
    cout << cnt << endl << area << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(nm)$

**æ ‡ç­¾**

`Flood Fill`

**ç¼åˆæ€ª**

#### [AcWing 1106. å±±å³°å’Œå±±è°·](https://www.acwing.com/problem/content/1108/)

**é¢˜ç›®æè¿°**

>   `FGD`å°æœ‹å‹ç‰¹åˆ«å–œæ¬¢çˆ¬å±±ï¼Œåœ¨çˆ¬å±±çš„æ—¶å€™ä»–å°±åœ¨ç ”ç©¶å±±å³°å’Œå±±è°·ã€‚
>
>   ä¸ºäº†èƒ½å¤Ÿå¯¹æ—…ç¨‹æœ‰ä¸€ä¸ªå®‰æ’ï¼Œä»–æƒ³çŸ¥é“å±±å³°å’Œå±±è°·çš„æ•°é‡ã€‚
>
>   ç»™å®šä¸€ä¸ªåœ°å›¾ï¼Œä¸º `FGD` æƒ³è¦æ—…è¡Œçš„åŒºåŸŸï¼Œåœ°å›¾è¢«åˆ†ä¸º `n Ã— n` çš„ç½‘æ ¼ï¼Œæ¯ä¸ªæ ¼å­ `(i,j)` çš„é«˜åº¦ `w(i,j)` æ˜¯ç»™å®šçš„ã€‚
>
>   è‹¥ä¸¤ä¸ªæ ¼å­æœ‰å…¬å…±é¡¶ç‚¹ï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ˜¯ç›¸é‚»çš„æ ¼å­ï¼Œå¦‚ä¸ `(i,j)` ç›¸é‚»çš„æ ¼å­æœ‰`(iâˆ’1,jâˆ’1),(iâˆ’1,j),(iâˆ’1,j+1),(i,jâˆ’1),(i,j+1),(i+1,jâˆ’1),(i+1,j),(i+1,j+1)`ã€‚
>
>   æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ ¼å­çš„é›†åˆ `S` ä¸ºå±±å³°ï¼ˆå±±è°·ï¼‰å½“ä¸”ä»…å½“ï¼š
>
>   1.  `S` çš„æ‰€æœ‰æ ¼å­éƒ½æœ‰ç›¸åŒçš„é«˜åº¦ã€‚
>   2.  `S` çš„æ‰€æœ‰æ ¼å­éƒ½è¿é€šã€‚
>   3.  å¯¹äº `s` å±äº `S`ï¼Œä¸ `s` ç›¸é‚»çš„ `sâ€²` ä¸å±äº `S`ï¼Œéƒ½æœ‰ $w_s>w_{sâ€²}$ï¼ˆå±±å³°ï¼‰ï¼Œæˆ–è€… $w_s<w_{sâ€²}$ï¼ˆå±±è°·ï¼‰ã€‚
>   4.  å¦‚æœå‘¨å›´ä¸å­˜åœ¨ç›¸é‚»åŒºåŸŸï¼Œåˆ™åŒæ—¶å°†å…¶è§†ä¸ºå±±å³°å’Œå±±è°·ã€‚
>
>   ä½ çš„ä»»åŠ¡æ˜¯ï¼Œå¯¹äºç»™å®šçš„åœ°å›¾ï¼Œæ±‚å‡ºå±±å³°å’Œå±±è°·çš„æ•°é‡ï¼Œå¦‚æœæ‰€æœ‰æ ¼å­éƒ½æœ‰ç›¸åŒçš„é«˜åº¦ï¼Œé‚£ä¹ˆæ•´ä¸ªåœ°å›¾å³æ˜¯å±±å³°ï¼Œåˆæ˜¯å±±è°·ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ­£æ•´æ•° `n`ï¼Œè¡¨ç¤ºåœ°å›¾çš„å¤§å°ã€‚
>
>   æ¥ä¸‹æ¥ä¸€ä¸ª `n Ã— n` çš„çŸ©é˜µï¼Œè¡¨ç¤ºåœ°å›¾ä¸Šæ¯ä¸ªæ ¼å­çš„é«˜åº¦ `w`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå±±å³°å’Œå±±è°·çš„æ•°é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤1000,$
>   +   $0â‰¤wâ‰¤10^9$

**è¾“å…¥æ ·ä¾‹1**

```c++
5
8 8 8 7 7
7 7 8 8 7
7 7 7 7 7
7 8 8 7 8
7 8 8 8 8
```

**è¾“å‡ºæ ·ä¾‹1**

```c++
2 1
```

**è¾“å…¥æ ·ä¾‹2**

```c++
5
5 7 8 3 1
5 5 7 6 6
6 6 6 2 8
5 7 2 5 8
7 1 0 1 7
```

**è¾“å‡ºæ ·ä¾‹2**

```c++
3 3
```

**æ ·ä¾‹è§£é‡Š**

>   æ ·ä¾‹1ï¼š
>
>   ![1â€”â€”1.png](img/19_0250799aef-1-20220318165849164.png)
>
>   æ ·ä¾‹2ï¼š
>
>   ![2.png](img/19_08db5e60ef-2.png)

**æ‰‹å†™ç¨¿**

![3182025](img/3182025.png)

**ä»£ç **

```c++
#include <iostream>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 1010, M = N * N;
int n;
int dx[8] = {-1, -1, -1, 0, 1, 1, 1, 0};
int dy[8] = {-1, 0, 1, 1, 1, 0, -1, -1};
PII q[M];
int g[N][N], st[N][N];
void bfs(int sx, int sy, bool &is_peak, bool &is_valley) {
    int hh = 0, tt = -1;
    q[++ tt] = {sx, sy};
    st[sx][sy] = true;
    while (hh <= tt) {
        PII t = q[hh ++ ];
        // éå†8ä¸ªæ–¹å‘
        for (int i = 0; i < 8; i ++ ) {
            int tx = t.x + dx[i];
            int ty = t.y + dy[i];
            // æ³¨æ„ï¼šè¿™é‡Œä¸èƒ½æ·»åŠ æ­¤æ¡ä»¶st[tx][ty]
            // åŸå› ï¼šéœ€è¦åˆ¤æ–­å½“å‰ç‚¹ä¸å‘¨å›´ç‚¹çš„é«˜åº¦ï¼Œç”¨ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯å±±å³°è¿˜æ˜¯å±±è°·
            if (tx < 0 || tx >= n || ty < 0 || ty >= n) continue;
            // å¦‚æœå½“å‰ç‚¹å’Œå‘¨å›´ç‚¹é«˜åº¦ä¸ç›¸ç­‰
            if (g[t.x][t.y] != g[tx][ty]) {
                // å¦‚æœå½“å‰ç‚¹æ¯”å‘¨å›´ç‚¹é«˜ï¼Œåˆ™å½“å‰ç‚¹ä¸€å®šä¸æ˜¯å±±è°·
                if (g[t.x][t.y] > g[tx][ty]) is_valley = false;
                // å¦‚æœå½“å‰ç‚¹æ¯”å‘¨å›´ç‚¹ä½ï¼Œåˆ™å½“å‰ç‚¹ä¸€å®šä¸æ˜¯å±±å³°
                else is_peak = false;
            }
            // åœ¨æ­¤å¤„è¿›è¡Œåˆ¤æ–­st[tx][ty]è¿™ä¸ªæ¡ä»¶
            // å¦‚æœå½“å‰ç‚¹æ²¡æœ‰è¢«è®¿é—®è¿‡ï¼Œåˆ™åŠ å…¥å½“å‰ç‚¹ï¼Œå¹¶æ ‡è®°ä¸ºå·²è®¿é—®è¿‡
            else if (!st[tx][ty]) {
                q[++ tt] = {tx, ty};
                st[tx][ty] = true;
            }
        }
    }
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            scanf("%d", &g[i][j]);
    // å®šä¹‰å±±å³°å’Œå±±è°·çš„æ•°é‡
    int peak = 0, valley = 0;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            if (!st[i][j]) {
                // åˆå§‹å‡è®¾å³æ˜¯å±±å³°åˆæ˜¯å±±è°·
                bool is_peak = true, is_valley = true;
                bfs(i, j, is_peak, is_valley);
                // å¦‚æœæ˜¯å±±å³°
                if (is_peak) peak ++;
                // å¦‚æœæ˜¯å±±è°·
                if (is_valley) valley ++;
            }
    cout << peak << " " << valley << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`Flood Fill`

**ç¼åˆæ€ª**



### æœ€çŸ­è·¯æ¨¡å‹

#### [AcWing 1076. è¿·å®«é—®é¢˜](https://www.acwing.com/problem/content/1078/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n Ã— n` çš„äºŒç»´æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
>
>   ```c++
>   int maze[5][5] = {
>   
>   0, 1, 0, 0, 0,
>   
>   0, 1, 0, 1, 0,
>   
>   0, 0, 0, 0, 0,
>   
>   0, 1, 1, 1, 0,
>   
>   0, 0, 0, 1, 0,
>   
>   };
>   ```
>
>   å®ƒè¡¨ç¤ºä¸€ä¸ªè¿·å®«ï¼Œå…¶ä¸­çš„`1`è¡¨ç¤ºå¢™å£ï¼Œ`0`è¡¨ç¤ºå¯ä»¥èµ°çš„è·¯ï¼Œåªèƒ½æ¨ªç€èµ°æˆ–ç«–ç€èµ°ï¼Œä¸èƒ½æ–œç€èµ°ï¼Œè¦æ±‚ç¼–ç¨‹åºæ‰¾å‡ºä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„æœ€çŸ­è·¯çº¿ã€‚
>
>   æ•°æ®ä¿è¯è‡³å°‘å­˜åœ¨ä¸€æ¡ä»å·¦ä¸Šè§’èµ°åˆ°å³ä¸‹è§’çš„è·¯å¾„ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å« `n` ä¸ªæ•´æ•° `0` æˆ– `1`ï¼Œè¡¨ç¤ºè¿·å®«ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’çš„æœ€çŸ­è·¯çº¿ï¼Œå¦‚æœç­”æ¡ˆä¸å”¯ä¸€ï¼Œè¾“å‡ºä»»æ„ä¸€æ¡è·¯å¾„å‡å¯ã€‚
>
>   æŒ‰é¡ºåºï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªè·¯å¾„ä¸­ç»è¿‡çš„å•å…ƒæ ¼çš„åæ ‡ï¼Œå·¦ä¸Šè§’åæ ‡ä¸º `(0,0)`ï¼Œå³ä¸‹è§’åæ ‡ä¸º `(nâˆ’1,nâˆ’1)`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $0â‰¤nâ‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
5
0 1 0 0 0
0 1 0 1 0
0 0 0 0 0
0 1 1 1 0
0 0 0 1 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
0 0
1 0
2 0
2 1
2 2
2 3
2 4
3 4
4 4
```

**æ‰‹å†™ç¨¿**

![3211047](img/3211047.png)

**ä»£ç **

```c++
#include <iostream>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 1010, M = N * N;
int n;
int dx[4] = {1, -1, 0, 0};
int dy[4] = {0, 0, -1, 1};
PII q[M];
// ståˆ¤é‡æ•°ç»„ï¼Œä¿è¯å®½æœçš„æ—¶å€™æ¯ä¸ªæ•°æ®åªè¿›ä¸€æ¬¡é˜Ÿåˆ—
int g[N][N], st[N][N];
// è®°å½•æŸä¸ªç‚¹ä»å“ªä¸ªç‚¹è½¬ç§»è¿‡æ¥çš„ï¼Œä½¿ç”¨pairæ•°ç»„è®°å½•
PII pre[N][N];
// å®½æœæ¨¡æ¿
void bfs(int sx, int sy) {
    int hh = 0, tt = -1;
    q[++ tt] = {sx, sy};
    st[sx][sy] = true;
    pre[sx][sy] = {0, 0};
    while (hh <= tt) {
        PII t = q[hh ++ ];
        for (int i = 0; i < 4; i ++ ) {
            int tx = t.x + dx[i];
            int ty = t.y + dy[i];
            if (tx < 0 || tx >= n || ty < 0 || ty >= n || g[tx][ty] || st[tx][ty])
                continue;
            q[++ tt] = {tx, ty};
            st[tx][ty] = true;
            pre[tx][ty] = {t.x, t.y};
        }
    }
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            scanf("%d", &g[i][j]);
    bfs(n - 1, n - 1);
    // åˆå§‹å€¼
    PII end(0, 0);
    while (true) {
        cout << end.x << " " << end.y << endl;
        // å¦‚æœå·²ç»åˆ°è¾¾ç»ˆç‚¹ï¼Œåˆ™ç»“æŸ
        if (end.x == n - 1 && end.y == n - 1) break;
        // å¦åˆ™ï¼Œè®°å½•å‰é©±å€¼
        end = pre[end.x][end.y];
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`å®½åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**

#### [AcWing 188. æ­¦å£«é£åº¦çš„ç‰›](https://www.acwing.com/problem/content/190/)

**é¢˜ç›®æè¿°**

>   å†œæ°‘ `John` æœ‰å¾ˆå¤šç‰›ï¼Œä»–æƒ³äº¤æ˜“å…¶ä¸­ä¸€å¤´è¢« `Don` ç§°ä¸º `The Knight` çš„ç‰›ã€‚
>
>   è¿™å¤´ç‰›æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„è¶…èƒ½åŠ›ï¼Œåœ¨å†œåœºé‡Œåƒ `Knight` ä¸€æ ·åœ°è·³ï¼ˆå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„è±¡æ£‹ä¸­é©¬çš„èµ°æ³•ï¼‰ã€‚
>
>   è™½ç„¶è¿™å¤´ç¥å¥‡çš„ç‰›ä¸èƒ½è·³åˆ°æ ‘ä¸Šå’ŒçŸ³å¤´ä¸Šï¼Œä½†æ˜¯å®ƒå¯ä»¥åœ¨ç‰§åœºä¸Šéšæ„è·³ï¼Œæˆ‘ä»¬æŠŠç‰§åœºç”¨ä¸€ä¸ª `xï¼Œy` çš„åæ ‡å›¾æ¥è¡¨ç¤ºã€‚
>
>   è¿™å¤´ç¥å¥‡çš„ç‰›åƒå…¶å®ƒç‰›ä¸€æ ·å–œæ¬¢åƒè‰ï¼Œç»™ä½ ä¸€å¼ åœ°å›¾ï¼Œä¸Šé¢æ ‡æ³¨äº† `The Knight` çš„å¼€å§‹ä½ç½®ï¼Œæ ‘ã€çŒæœ¨ã€çŸ³å¤´ä»¥åŠå…¶å®ƒéšœç¢çš„ä½ç½®ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€æ†è‰ã€‚
>
>   ç°åœ¨ä½ çš„ä»»åŠ¡æ˜¯ï¼Œç¡®å®š `The Knight` è¦æƒ³åƒåˆ°è‰ï¼Œè‡³å°‘éœ€è¦è·³å¤šå°‘æ¬¡ã€‚
>
>   `The Knight` çš„ä½ç½®ç”¨ `K` æ¥æ ‡è®°ï¼Œéšœç¢çš„ä½ç½®ç”¨ `*` æ¥æ ‡è®°ï¼Œè‰çš„ä½ç½®ç”¨ `H` æ¥æ ‡è®°ã€‚
>
>   è¿™é‡Œæœ‰ä¸€ä¸ªåœ°å›¾çš„ä¾‹å­ï¼š
>
>   ```c++
>            11 | . . . . . . . . . .
>            10 | . . . . * . . . . . 
>             9 | . . . . . . . . . . 
>             8 | . . . * . * . . . . 
>             7 | . . . . . . . * . . 
>             6 | . . * . . * . . . H 
>             5 | * . . . . . . . . . 
>             4 | . . . * . . . * . . 
>             3 | . K . . . . . . . . 
>             2 | . . . * . . . . . * 
>             1 | . . * . . . . * . . 
>             0 ----------------------
>                                   1 
>               0 1 2 3 4 5 6 7 8 9 0 
>   ```
>
>   `The Knight` å¯ä»¥æŒ‰ç…§ä¸‹å›¾ä¸­çš„ `A,B,C,Dâ€¦` è¿™æ¡è·¯å¾„ç”¨ `5` æ¬¡è·³åˆ°è‰çš„åœ°æ–¹ï¼ˆæœ‰å¯èƒ½å…¶å®ƒè·¯çº¿çš„é•¿åº¦ä¹Ÿæ˜¯ `5`ï¼‰ï¼š
>
>   ```c++
>            11 | . . . . . . . . . .
>            10 | . . . . * . . . . .
>             9 | . . . . . . . . . .
>             8 | . . . * . * . . . .
>             7 | . . . . . . . * . .
>             6 | . . * . . * . . . F<
>             5 | * . B . . . . . . .
>             4 | . . . * C . . * E .
>             3 | .>A . . . . D . . .
>             2 | . . . * . . . . . *
>             1 | . . * . . . . * . .
>             0 ----------------------
>                                   1
>               0 1 2 3 4 5 6 7 8 9 0
>   ```
>
>   **æ³¨æ„ï¼š** æ•°æ®ä¿è¯ä¸€å®šæœ‰è§£ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œï¼š ä¸¤ä¸ªæ•°ï¼Œè¡¨ç¤ºå†œåœºçš„åˆ—æ•° `C` å’Œè¡Œæ•° `R`ã€‚
>
>   ç¬¬ `2..R+1` è¡Œ: æ¯è¡Œä¸€ä¸ªç”± `C` ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå…±åŒæç»˜å‡ºç‰§åœºåœ°å›¾ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè·³è·ƒçš„æœ€å°æ¬¡æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤R,Câ‰¤150$

**è¾“å…¥æ ·ä¾‹**

```c++
10 11
..........
....*.....
..........
...*.*....
.......*..
..*..*...H
*.........
...*...*..
.K........
...*.....*
..*....*..
```

**è¾“å‡ºæ ·ä¾‹**

```c++
5
```

**æ‰‹å†™ç¨¿**

![3211127](img/3211127.png)

**ä»£ç **

```c++
#include <iostream>
#define x first
#define y second
using namespace std;
const int N = 155, M = N * N;
typedef pair<int, int> PII;
int n, m;
int dx[8] = {-2, -1, 1, 2, 2, 1, -1, -2};
int dy[8] = {1, 2, 2, 1, -1, -2, -2, -1};
PII q[M];
int st[N][N], dist[N][N];
char g[N][N];
// bfsæ¨¡æ¿
int bfs() {
    int sx = -1, sy = -1;
    // æ‰¾èµ·å§‹ç‚¹
    for (int i = 0; i < n; i ++ ) {
        for (int j = 0; j < m; j ++ )
            if (g[i][j] == 'K') {
                sx = i, sy = j;
                break;
            }
        if (sx != -1 && sy != -1) break;
    }
    int hh = 0, tt = -1;
    q[++ tt] = {sx, sy};
    st[sx][sy] = true;
    while (hh <= tt) {
        auto t = q[hh ++ ];
        for (int i = 0; i < 8; i ++ ) {
            int tx = t.x + dx[i];
            int ty = t.y + dy[i];
            if (tx < 0 || tx >= n || ty < 0 || ty >= m || st[tx][ty] || g[tx][ty] == '*')
                continue;
            q[++ tt] = {tx, ty};
            // å°†å½“å‰ç‚¹æ ‡è®°ä¸ºå·²ç»è¢«è®¿é—®è¿‡
            st[tx][ty] = true;
            // è·ç¦» â• 1 
            dist[tx][ty] = dist[t.x][t.y] + 1;
            // å¦‚æœåˆ°è¾¾ç»ˆç‚¹ï¼Œåˆ™ç›´æ¥è¿”å›
            if (g[tx][ty] == 'H') return dist[tx][ty];
        }
    }
    return -1;
}
int main() {
    scanf("%d%d", &m, &n);
    for (int i = 0; i < n; i ++ ) scanf("%s", g[i]);
    cout << bfs() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`å®½åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**

#### [AcWing 1100. æŠ“ä½é‚£å¤´ç‰›](https://www.acwing.com/problem/content/1102/)

>   å†œå¤«çŸ¥é“ä¸€å¤´ç‰›çš„ä½ç½®ï¼Œæƒ³è¦æŠ“ä½å®ƒã€‚
>
>   å†œå¤«å’Œç‰›éƒ½ä½äºæ•°è½´ä¸Šï¼Œå†œå¤«èµ·å§‹ä½äºç‚¹ `N`ï¼Œç‰›ä½äºç‚¹ `K`ã€‚
>
>   å†œå¤«æœ‰ä¸¤ç§ç§»åŠ¨æ–¹å¼ï¼š
>
>   1.  ä» `X` ç§»åŠ¨åˆ° `Xâˆ’1` æˆ– `X+1`ï¼Œæ¯æ¬¡ç§»åŠ¨èŠ±è´¹ä¸€åˆ†é’Ÿ
>   2.  ä» `X` ç§»åŠ¨åˆ° `2âˆ—X`ï¼Œæ¯æ¬¡ç§»åŠ¨èŠ±è´¹ä¸€åˆ†é’Ÿ
>
>   å‡è®¾ç‰›æ²¡æœ‰æ„è¯†åˆ°å†œå¤«çš„è¡ŒåŠ¨ï¼Œç«™åœ¨åŸåœ°ä¸åŠ¨ã€‚
>
>   å†œå¤«æœ€å°‘è¦èŠ±å¤šå°‘æ—¶é—´æ‰èƒ½æŠ“ä½ç‰›ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªæ•´æ•°`N`å’Œ`K`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæŠ“åˆ°ç‰›æ‰€èŠ±è´¹çš„æœ€å°‘æ—¶é—´ã€‚

**æ•°æ®èŒƒå›´**

>   +   $0â‰¤N,Kâ‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
5 17
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
```

**æ‰‹å†™ç¨¿**

>   1.   è£¸çš„å¹¿æœ
>   2.   éå†ä¸‰ç§èµ°è·¯çš„æ–¹å¼å³å¯

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 1e5 + 10;
int n, m;
int q[N], st[N], dist[N];
int bfs() {
    int hh = 0, tt = -1;
    q[++ tt] = n;
    st[n] = true;
    while (hh <= tt) {
        int t = q[hh ++ ];
        if (t == m) return dist[t];
        // éå†ä¸‰ç§æ–¹å¼
        if (t - 1 >= 0 && !st[t - 1]) {
            st[t - 1] = true;
            dist[t - 1] = dist[t] + 1;
            q[++ tt] = t - 1;
        }
        // æ³¨æ„å°äºç­‰äºN
        if (t + 1 <= N && !st[t + 1]) {
            st[t + 1] = true;
            dist[t + 1] = dist[t] + 1;
            q[++ tt ] = t + 1;
        }
        // æ³¨æ„å°äºç­‰äºN
        if (t * 2 <= N && !st[t * 2]) {
            st[t * 2] = true;
            dist[t * 2] = dist[t] + 1;
            q[++ tt ] = t * 2;
        }
    }
    return -1;
}
int main() {
    scanf("%d%d", &n, &m);
    cout << bfs() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`å®½åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**



### å¤šæº `BFS` æ¨¡å‹

#### [AcWing 173. çŸ©é˜µè·ç¦»](https://www.acwing.com/problem/content/175/)

>   ç»™å®šä¸€ä¸ª `N` è¡Œ `M` åˆ—çš„ `01` çŸ©é˜µ `A`ï¼Œ`A[i][j]` ä¸ `A[k][l]` ä¹‹é—´çš„æ›¼å“ˆé¡¿è·ç¦»å®šä¹‰ä¸ºï¼š
>
>   $dist(A[i][j],A[k][l])=|iâˆ’k|+|jâˆ’l|$
>
>   è¾“å‡ºä¸€ä¸ª `N` è¡Œ `M` åˆ—çš„æ•´æ•°çŸ©é˜µ `B`ï¼Œå…¶ä¸­ï¼š
>
>   $B[i][j]=min_{1â‰¤xâ‰¤N,1â‰¤yâ‰¤M,A[x][y]=1}dist(A[i][j],A[x][y])$

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `N,M`ã€‚
>
>   æ¥ä¸‹æ¥ä¸€ä¸ª `N` è¡Œ `M` åˆ—çš„ `01` çŸ©é˜µï¼Œæ•°å­—ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ª `N` è¡Œ `M` åˆ—çš„çŸ©é˜µ `B`ï¼Œç›¸é‚»ä¸¤ä¸ªæ•´æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤N,Mâ‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
3 4
0001
0011
0110
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3 2 1 0
2 1 0 0
1 0 0 1
```

**æ‰‹å†™ç¨¿**

![3221422](img/3221422.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 1010, M = N * N;
int n, m;
int dx[] = {1, -1, 0, 0};
int dy[] = {0, 0, -1, 1};
PII q[M];
char g[N][N];
int dist[N][N];
bool st[N][N];
void bfs() {
    memset(dist, -1, sizeof dist);
    int hh = 0, tt = -1;
    // æ‰¾å‡ºæ‰€æœ‰æºç‚¹ï¼Œæ‰¾å‡ºæ‰€æœ‰åˆå§‹åŒ–çš„æœ€çŸ­è·ç¦»
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < m; j ++ )
            if (g[i][j] == '1') {
                // æœ€çŸ­è·ç¦»ä¸º0
                dist[i][j] = 0;
                // çŠ¶æ€ä¸ºtrue
                st[i][j] = true;
                // å°†å½“å‰ç‚¹å…¥é˜Ÿ
                q[++ tt] = {i, j};
            }
    while (hh <= tt) {
        auto t = q[hh ++];
        // æšä¸¾å››ä¸ªæ–¹å‘
        for (int i = 0; i < 4; i ++ ) {
            int tx = t.x + dx[i];
            int ty = t.y + dy[i];
            if (tx < 0 || tx >= n || ty < 0 || ty >= m || st[tx][ty]) continue;
            st[tx][ty] = true;
            // è·ç¦» â• 1
            dist[tx][ty] = dist[t.x][t.y] + 1;
            q[++ tt] = {tx, ty};
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n; i ++ ) scanf("%s", g[i]);
    bfs();
    for (int i = 0; i < n; i ++ ) {
        for (int j = 0; j < m; j ++ ) 
            printf("%d ", dist[i][j]);
        cout << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`å¤šæºBFS`

**ç¼åˆæ€ª**



### æœ€å°æ­¥æ•°æ¨¡å‹

#### [AcWing 845. å…«æ•°ç ](https://www.acwing.com/problem/content/847/)

**é¢˜ç›®æè¿°**

>   åœ¨ä¸€ä¸ª `3 Ã— 3` çš„ç½‘æ ¼ä¸­ï¼Œ`1 âˆ¼ 8` è¿™ `8` ä¸ªæ•°å­—å’Œä¸€ä¸ª `x` æ°å¥½ä¸é‡ä¸æ¼åœ°åˆ†å¸ƒåœ¨è¿™ `3 Ã— 3` çš„ç½‘æ ¼ä¸­ã€‚
>
>   ä¾‹å¦‚ï¼š
>
>   ```c++
>   1 2 3
>   x 4 6
>   7 5 8
>   ```
>
>   åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŠŠ `x` ä¸å…¶ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘ä¹‹ä¸€çš„æ•°å­—äº¤æ¢ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚
>
>   æˆ‘ä»¬çš„ç›®çš„æ˜¯é€šè¿‡äº¤æ¢ï¼Œä½¿å¾—ç½‘æ ¼å˜ä¸ºå¦‚ä¸‹æ’åˆ—ï¼ˆç§°ä¸ºæ­£ç¡®æ’åˆ—ï¼‰ï¼š
>
>   ```c++
>   1 2 3
>   4 5 6
>   7 8 x
>   ```
>
>   ä¾‹å¦‚ï¼Œç¤ºä¾‹ä¸­å›¾å½¢å°±å¯ä»¥é€šè¿‡è®© `x` å…ˆåä¸å³ã€ä¸‹ã€å³ä¸‰ä¸ªæ–¹å‘çš„æ•°å­—äº¤æ¢æˆåŠŸå¾—åˆ°æ­£ç¡®æ’åˆ—ã€‚
>
>   äº¤æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š
>
>   ```c++
>   1 2 3   1 2 3   1 2 3   1 2 3
>   x 4 6   4 x 6   4 5 6   4 5 6
>   7 5 8   7 5 8   7 x 8   7 8 x
>   ```
>
>   ç°åœ¨ï¼Œç»™ä½ ä¸€ä¸ªåˆå§‹ç½‘æ ¼ï¼Œè¯·ä½ æ±‚å‡ºå¾—åˆ°æ­£ç¡®æ’åˆ—è‡³å°‘éœ€è¦è¿›è¡Œå¤šå°‘æ¬¡äº¤æ¢ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥å ä¸€è¡Œï¼Œå°† `3 Ã— 3` çš„åˆå§‹ç½‘æ ¼æç»˜å‡ºæ¥ã€‚
>
>   ä¾‹å¦‚ï¼Œå¦‚æœåˆå§‹ç½‘æ ¼å¦‚ä¸‹æ‰€ç¤ºï¼š
>
>   ```c++
>   1 2 3
>   x 4 6
>   7 5 8
>   ```
>
>   åˆ™è¾“å…¥ä¸ºï¼š`1 2 3 x 4 6 7 5 8`

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°‘äº¤æ¢æ¬¡æ•°ã€‚
>
>   å¦‚æœä¸å­˜åœ¨è§£å†³æ–¹æ¡ˆï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
2  3  4  1  5  x  7  6  8
```

**è¾“å‡ºæ ·ä¾‹**

```c++
19
```

**æ‰‹å†™ç¨¿**

> 1. æ¨¡æ¿é¢˜, é¡ºç€å››ä¸ªæ–¹å‘æœç´¢å³å¯

**ä»£ç **

```c++
#include <iostream>
#include <queue>
#include <unordered_map>
using namespace std;
int dx[4] = {-1, 0, 1, 0};
int dy[4] = {0, 1, 0, -1};
queue<string> q;
unordered_map<string, int> dist;
int bfs(string start) {
    string end = "12345678x";
    dist[start] = 0;
    q.push(start);
    while (q.size()) {
        string t = q.front(); q.pop();
        if (t == end) return dist[t];
        // æ‰¾åˆ°xçš„ä½ç½®
        int k = t.find('x');
        // å°†xçš„ä½ç½®å˜æˆåæ ‡å½¢å¼
        int x = k / 3, y = k % 3;
        // éå†å››ä¸ªæ–¹å‘
        for (int i = 0; i < 4; i ++ ) {
            string tmp = t;
            int tx = x + dx[i];
            int ty = y + dy[i];
            // è¶Šç•Œ
            if (tx < 0 || tx >= 3 || ty < 0 || ty >= 3)
                continue;
            // äº¤æ¢å€¼
            swap(tmp[k], tmp[tx * 3 + ty]);
            // å¦‚æœtmpå·²ç»è¢«è®¿é—®è¿‡, ç›´æ¥è¿”å›
            if (dist.count(tmp)) continue;
            // æ›´æ–°è·ç¦»
            dist[tmp] = dist[t] + 1;
            // å…¥é˜Ÿ
            q.push(tmp);
        }
    }
    return -1;
}
int main() {
    char c;
    string start;
    while (cin >> c) start += c;
    cout << bfs(start) << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(æŒ‡æ•°çº§åˆ«)$

**ç©ºé—´å¤æ‚åº¦**

$O(æŒ‡æ•°çº§åˆ«)$

**æ ‡ç­¾**

`BFS`ã€`æœ€å°æ­¥æ•°æ¨¡å‹`

**ç¼åˆæ€ª**



#### [AcWing 1107. é­”æ¿](https://www.acwing.com/problem/content/1109/)

**é¢˜ç›®æè¿°**

>   `Rubik` å…ˆç”Ÿåœ¨å‘æ˜äº†é£é¡å…¨çƒçš„é­”æ–¹ä¹‹åï¼Œåˆå‘æ˜äº†å®ƒçš„äºŒç»´ç‰ˆæœ¬â€”â€”é­”æ¿ã€‚
>
>   è¿™æ˜¯ä¸€å¼ æœ‰ `8` ä¸ªå¤§å°ç›¸åŒçš„æ ¼å­çš„é­”æ¿ï¼š
>
>   ```c++
>   1 2 3 4
>   8 7 6 5
>   ```
>
>   æˆ‘ä»¬çŸ¥é“é­”æ¿çš„æ¯ä¸€ä¸ªæ–¹æ ¼éƒ½æœ‰ä¸€ç§é¢œè‰²ã€‚
>
>   è¿™ `8` ç§é¢œè‰²ç”¨å‰ `8` ä¸ªæ­£æ•´æ•°æ¥è¡¨ç¤ºã€‚
>
>   å¯ä»¥ç”¨é¢œè‰²çš„åºåˆ—æ¥è¡¨ç¤ºä¸€ç§é­”æ¿çŠ¶æ€ï¼Œè§„å®šä»é­”æ¿çš„å·¦ä¸Šè§’å¼€å§‹ï¼Œæ²¿é¡ºæ—¶é’ˆæ–¹å‘ä¾æ¬¡å–å‡ºæ•´æ•°ï¼Œæ„æˆä¸€ä¸ªé¢œè‰²åºåˆ—ã€‚
>
>   å¯¹äºä¸Šå›¾çš„é­”æ¿çŠ¶æ€ï¼Œæˆ‘ä»¬ç”¨åºåˆ— `(1,2,3,4,5,6,7,8)` æ¥è¡¨ç¤ºï¼Œè¿™æ˜¯åŸºæœ¬çŠ¶æ€ã€‚
>
>   è¿™é‡Œæä¾›ä¸‰ç§åŸºæœ¬æ“ä½œï¼Œåˆ†åˆ«ç”¨å¤§å†™å­—æ¯ `A`ï¼Œ`B`ï¼Œ`C` æ¥è¡¨ç¤ºï¼ˆå¯ä»¥é€šè¿‡è¿™äº›æ“ä½œæ”¹å˜é­”æ¿çš„çŠ¶æ€ï¼‰ï¼š
>
>   `A`ï¼šäº¤æ¢ä¸Šä¸‹ä¸¤è¡Œï¼›
>   `B`ï¼šå°†æœ€å³è¾¹çš„ä¸€åˆ—æ’å…¥åˆ°æœ€å·¦è¾¹ï¼›
>   `C`ï¼šé­”æ¿ä¸­å¤®å¯¹çš„4ä¸ªæ•°ä½œé¡ºæ—¶é’ˆæ—‹è½¬ã€‚
>
>   ä¸‹é¢æ˜¯å¯¹åŸºæœ¬çŠ¶æ€è¿›è¡Œæ“ä½œçš„ç¤ºèŒƒï¼š
>
>   `A`ï¼š
>
>   ```c++
>   8 7 6 5
>   1 2 3 4
>   ```
>
>   `B`ï¼š
>
>   ```c++
>   4 1 2 3
>   5 8 7 6
>   ```
>
>   `C`ï¼š
>
>   ```c++
>   1 7 2 4
>   8 6 3 5
>   ```
>
>   å¯¹äºæ¯ç§å¯èƒ½çš„çŠ¶æ€ï¼Œè¿™ä¸‰ç§åŸºæœ¬æ“ä½œéƒ½å¯ä»¥ä½¿ç”¨ã€‚
>
>   ä½ è¦ç¼–ç¨‹è®¡ç®—ç”¨æœ€å°‘çš„åŸºæœ¬æ“ä½œå®ŒæˆåŸºæœ¬çŠ¶æ€åˆ°ç‰¹æ®ŠçŠ¶æ€çš„è½¬æ¢ï¼Œè¾“å‡ºåŸºæœ¬æ“ä½œåºåˆ—ã€‚
>
>   **æ³¨æ„**ï¼šæ•°æ®ä¿è¯ä¸€å®šæœ‰è§£ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥ä»…ä¸€è¡Œï¼ŒåŒ…æ‹¬ `8` ä¸ªæ•´æ•°ï¼Œç”¨ç©ºæ ¼åˆ†å¼€ï¼Œè¡¨ç¤ºç›®æ ‡çŠ¶æ€ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºæ–‡ä»¶çš„ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€çŸ­æ“ä½œåºåˆ—çš„é•¿åº¦ã€‚
>
>   å¦‚æœæ“ä½œåºåˆ—çš„é•¿åº¦å¤§äº`0`ï¼Œåˆ™åœ¨ç¬¬äºŒè¡Œè¾“å‡ºå­—å…¸åºæœ€å°çš„æ“ä½œåºåˆ—ã€‚

**æ•°æ®èŒƒå›´**

>   è¾“å…¥æ•°æ®ä¸­çš„æ‰€æœ‰æ•°å­—å‡ä¸º `1` åˆ° `8` ä¹‹é—´çš„æ•´æ•°ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
2 6 8 4 5 7 3 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
7
BCABCCB
```

**æ‰‹å†™ç¨¿**

![3221913](img/3221913.png)

**ä»£ç **

```c++
#include <iostream>
#include <unordered_map>
#include <algorithm>
#include <queue>
using namespace std;
char g[2][4];
queue<string> q;
unordered_map<string, int> dist;
unordered_map<string, bool> st;
unordered_map<string, pair<string, char>> pre;
void set(string state) { // å°†å­—ç¬¦ä¸²å˜æˆå­—ç¬¦çŸ©é˜µ
    for (int i = 0; i < 4; i ++ ) g[0][i] = state[i];
    for (int i = 0; i < 4; i ++ ) g[1][i] = state[7 - i];
    return;
}
string get() { // å°†å­—ç¬¦çŸ©é˜µå˜æˆå­—ç¬¦ä¸²
    string res = "";
    for (int i = 0; i < 4; i ++ ) res += g[0][i];
    for (int i = 3; i >= 0; i -- ) res += g[1][i];
    return res;
}
string move0(string state) {
    set(state);
    for (int i = 0; i < 4; i ++ ) swap(g[0][i], g[1][i]);
    return get();
}
string move1(string state) {
    set(state);
    char c0 = g[0][3], c1 = g[1][3];
    for (int j = 2; j >= 0; j -- )
        for (int i = 0; i < 2; i ++ )
            g[i][j + 1] = g[i][j];
    g[0][0] = c0;
    g[1][0] = c1;
    return get();
}
string move2(string state) {
    set(state);
    char t = g[0][1];
    g[0][1] = g[1][1];
    g[1][1] = g[1][2];
    g[1][2] = g[0][2];
    g[0][2] = t;
    return get();
}
void bfs(string start, string end) {
    if (start == end) return;
    q.push(start);
    st[start] = true;
    while (q.size()) {
        auto t = q.front(); q.pop();
        string m0 = move0(t);
        string m1 = move1(t);
        string m2 = move2(t);
        // ä¸‰ç§æ“ä½œ
        for (int i = 0; i < 3; i ++ ) {
            if (i == 0) {
                if (!st.count(m0)) {
                    st[m0] = true;
                    dist[m0] = dist[t] + 1;
                    q.push(m0);
                    // è®°å½•ä»å“ªä¸ªçŠ¶æ€è½¬ç§»è¿‡æ¥çš„ï¼Œå¹¶ä¸”è®°å½•ä¸‹æ˜¯å“ªä¸ªæ“ä½œ
                    pre[m0] = {t, 'A'};
                }
                if (m0 == end) return;
            }
            else if (i == 1) {
                if (!st.count(m1)) {
                    st[m1] = true;
                    dist[m1] = dist[t] + 1;
                    q.push(m1);
                    // è®°å½•ä»å“ªä¸ªçŠ¶æ€è½¬ç§»è¿‡æ¥çš„ï¼Œå¹¶ä¸”è®°å½•ä¸‹æ˜¯å“ªä¸ªæ“ä½œ
                    pre[m1] = {t, 'B'};
                }
                if (m1 == end) return;
            }
            else {
                if (!st.count(m2)) {
                    st[m2] = true;
                    dist[m2] = dist[t] + 1;
                    q.push(m2);
                    // è®°å½•ä»å“ªä¸ªçŠ¶æ€è½¬ç§»è¿‡æ¥çš„ï¼Œå¹¶ä¸”è®°å½•ä¸‹æ˜¯å“ªä¸ªæ“ä½œ
                    pre[m2] = {t, 'C'};
                }
                if (m2 == end) return;
            }
        }
    }
    return;
}
int main() {
    string start, end;
    for (int i = 0, x; i < 8; i ++ ) {
        scanf("%d", &x);
        end += char(x + '0');
    }
    for (int i = 1; i <= 8; i ++ ) start += char(i + '0');
    bfs(start, end);
    // è®°å½•ä¸‹æ­¥æ•°
    // å› ä¸ºwhileå¾ªç¯ä¹‹åï¼Œend == start
    int step = dist[end];
    cout << step << endl;
    string res;
    while (end != start) {
        // while(true) ä¸­çš„ ifåˆ¤æ–­åº”è¯¥ä½äºè¿™é‡Œ
        // å¦åˆ™ï¼Œreså°±ä¼šå¤šæ‰§è¡Œä¸€æ¬¡+=ï¼Œå°±ä¼šå‡ºé”™ï¼ŒåŸå› ä¸æ˜
        res += pre[end].second;
        end = pre[end].first;
    }
    // åè½¬
    reverse(res.begin(), res.end());
    if (step) cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`BFS`

**ç¼åˆæ€ª**



### åŒç«¯é˜Ÿåˆ—å¹¿æœ

#### [AcWing 175. ç”µè·¯ç»´ä¿®](https://www.acwing.com/problem/content/177/)

**é¢˜ç›®æè¿°**

>   è¾¾è¾¾æ˜¯æ¥è‡ªå¼‚ä¸–ç•Œçš„é­”å¥³ï¼Œå¥¹åœ¨æ¼«æ— ç›®çš„åœ°å››å¤„æ¼‚æµçš„æ—¶å€™ï¼Œé‡åˆ°äº†å–„è‰¯çš„å°‘å¥³ç¿°ç¿°ï¼Œä»è€Œè¢«æ”¶ç•™åœ¨åœ°çƒä¸Šã€‚
>
>   ç¿°ç¿°çš„å®¶é‡Œæœ‰ä¸€è¾†é£è¡Œè½¦ã€‚
>
>   æœ‰ä¸€å¤©é£è¡Œè½¦çš„ç”µè·¯æ¿çªç„¶å‡ºç°äº†æ•…éšœï¼Œå¯¼è‡´æ— æ³•å¯åŠ¨ã€‚
>
>   ç”µè·¯æ¿çš„æ•´ä½“ç»“æ„æ˜¯ä¸€ä¸ª `R` è¡Œ `C` åˆ—çš„ç½‘æ ¼ï¼ˆ`R,Câ‰¤500`ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚
>
>   ![ç”µè·¯.png](img/19_be6ff7a219-%E7%94%B5%E8%B7%AF.png)
>
>   æ¯ä¸ªæ ¼ç‚¹éƒ½æ˜¯ç”µçº¿çš„æ¥ç‚¹ï¼Œæ¯ä¸ªæ ¼å­éƒ½åŒ…å«ä¸€ä¸ªç”µå­å…ƒä»¶ã€‚
>
>   ç”µå­å…ƒä»¶çš„ä¸»è¦éƒ¨åˆ†æ˜¯ä¸€ä¸ªå¯æ—‹è½¬çš„ã€è¿æ¥ä¸€æ¡å¯¹è§’çº¿ä¸Šçš„ä¸¤ä¸ªæ¥ç‚¹çš„çŸ­ç”µç¼†ã€‚
>
>   åœ¨æ—‹è½¬ä¹‹åï¼Œå®ƒå°±å¯ä»¥è¿æ¥å¦ä¸€æ¡å¯¹è§’çº¿çš„ä¸¤ä¸ªæ¥ç‚¹ã€‚
>
>   ç”µè·¯æ¿å·¦ä¸Šè§’çš„æ¥ç‚¹æ¥å…¥ç›´æµç”µæºï¼Œå³ä¸‹è§’çš„æ¥ç‚¹æ¥å…¥é£è¡Œè½¦çš„å‘åŠ¨è£…ç½®ã€‚
>
>   è¾¾è¾¾å‘ç°å› ä¸ºæŸäº›å…ƒä»¶çš„æ–¹å‘ä¸å°å¿ƒå‘ç”Ÿäº†æ”¹å˜ï¼Œç”µè·¯æ¿å¯èƒ½å¤„äºæ–­è·¯çš„çŠ¶æ€ã€‚
>
>   å¥¹å‡†å¤‡é€šè¿‡è®¡ç®—ï¼Œæ—‹è½¬æœ€å°‘æ•°é‡çš„å…ƒä»¶ï¼Œä½¿ç”µæºä¸å‘åŠ¨è£…ç½®é€šè¿‡è‹¥å¹²æ¡çŸ­ç¼†ç›¸è¿ã€‚
>
>   ä¸è¿‡ï¼Œç”µè·¯çš„è§„æ¨¡å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œè¾¾è¾¾å¹¶ä¸æ“…é•¿ç¼–ç¨‹ï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿå¸®å¥¹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
>
>   **æ³¨æ„**ï¼šåªèƒ½èµ°æ–œå‘çš„çº¿æ®µï¼Œæ°´å¹³å’Œç«–ç›´çº¿æ®µä¸èƒ½èµ°ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ–‡ä»¶åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚
>
>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `T`ï¼Œè¡¨ç¤ºæµ‹è¯•æ•°æ®çš„æ•°ç›®ã€‚
>
>   å¯¹äºæ¯ç»„æµ‹è¯•æ•°æ®ï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ­£æ•´æ•° `R` å’Œ `C`ï¼Œè¡¨ç¤ºç”µè·¯æ¿çš„è¡Œæ•°å’Œåˆ—æ•°ã€‚
>
>   ä¹‹å `R` è¡Œï¼Œæ¯è¡Œ `C` ä¸ªå­—ç¬¦ï¼Œå­—ç¬¦æ˜¯`"/"`å’Œ`"\"`ä¸­çš„ä¸€ä¸ªï¼Œè¡¨ç¤ºæ ‡å‡†ä»¶çš„æ–¹å‘ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ç»„æµ‹è¯•æ•°æ®ï¼Œåœ¨å•ç‹¬çš„ä¸€è¡Œè¾“å‡ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºæ‰€éœ€çš„æœ€å°æ—‹è½¬æ¬¡æ•°ã€‚
>
>   å¦‚æœæ— è®ºæ€æ ·éƒ½ä¸èƒ½ä½¿å¾—ç”µæºå’Œå‘åŠ¨æœºä¹‹é—´è¿é€šï¼Œè¾“å‡º `NO SOLUTION`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤R,Câ‰¤500,$
>   +   $1â‰¤Tâ‰¤5$

**è¾“å…¥æ ·ä¾‹**

```c++
1
3 5
\\/\\
\\///
/\\\\
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
```

**æ ·ä¾‹è§£é‡Š**

>   æ ·ä¾‹çš„è¾“å…¥å¯¹åº”äºé¢˜ç›®æè¿°ä¸­çš„æƒ…å†µã€‚
>
>   åªéœ€è¦æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼æ—‹è½¬æ ‡å‡†ä»¶ï¼Œå°±å¯ä»¥ä½¿å¾—ç”µæºå’Œå‘åŠ¨æœºä¹‹é—´è¿é€šã€‚
>
>   ![ç”µè·¯2.png](img/19_a0e8e80a19-%E7%94%B5%E8%B7%AF2.png)

**æ‰‹å†™ç¨¿**

![3251225](img/3251225.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <deque>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 510, M = N * N;
int T, n, m;
int dx[4] = {-1, -1, 1, 1};
int dy[4] = {-1, 1, 1, -1};
int ix[4] = {-1, -1, 0, 0};
int iy[4] = {-1, 0, 0, -1};
// åˆæ³•åºåˆ—çš„è§£é‡Šã€æ‰‹å†™ç¨¿ã€‘
char cs[] = "\\/\\/";
char g[N][N];
int dist[N][N], st[N][N];
int bfs() {
    // å¤šç»„æ•°æ®
    // æ¯æ¬¡è¿›è¡Œåˆå§‹åŒ–
    memset(dist, 0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    // åŒç«¯é˜Ÿåˆ—
    deque<PII> q;
    q.push_front({0, 0});
    // åˆå§‹åŒ–è·ç¦»
    dist[0][0] = 0;
    while (q.size()) {
        auto t = q.front(); q.pop_front();
        // è‹¥å·²è¢«è®¿é—®è¿‡
        if (st[t.x][t.y]) continue;
        // å°†å½“å‰ç‚¹æ ‡è®°ä¸ºå·²è¢«è®¿é—®
        st[t.x][t.y] = true;
        // éå†å››ä¸ªæ–¹å‘ä¸Šçš„ç‚¹
        for (int i = 0; i < 4; i ++ ) {
            int tx = t.x + dx[i];
            int ty = t.y + dy[i];
            // å¤„ç†è¶Šç•Œçš„é—®é¢˜
            if (tx < 0 || tx > n || ty < 0 || ty > m || st[tx][ty]) continue;
            // ç”±ç‚¹çš„åæ ‡å¾—åˆ°çº¿çš„åæ ‡
            int ga = t.x + ix[i];
            int gb = t.y + iy[i];
            if (g[ga][gb] != cs[i]) {
                // å–minçš„åŸå› åœ¨ã€æ‰‹å†™ç¨¿ã€‘
                dist[tx][ty] = min(dist[tx][ty], dist[t.x][t.y] + 1);
                q.push_back({tx, ty});
            }
            else {
                dist[tx][ty] = dist[t.x][t.y];
                q.push_front({tx, ty});
            }
            if (tx == n && ty == m) return dist[tx][ty];
        }
    }
    return -1;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        scanf("%d%d", &n, &m);
        for (int i = 0; i < n; i ++ ) scanf("%s", g[i]);
        if (n + m & 1) puts("NO SOLUTION");
        else cout << bfs() << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`åŒç«¯é˜Ÿåˆ—å¹¿æœ`

**ç¼åˆæ€ª**

### åŒå‘å¹¿æœ

#### [AcWing 190. å­—ä¸²å˜æ¢](https://www.acwing.com/problem/content/192/)

**é¢˜ç›®æè¿°**

>   å·²çŸ¥æœ‰ä¸¤ä¸ªå­—ä¸² `A`, `B` åŠä¸€ç»„å­—ä¸²å˜æ¢çš„è§„åˆ™ï¼ˆè‡³å¤š `6` ä¸ªè§„åˆ™ï¼‰:
>
>   $A_1â†’B_1$
>
>   $A_2â†’B_2$
>
>   $â€¦$
>
>   è§„åˆ™çš„å«ä¹‰ä¸ºï¼šåœ¨ `A` ä¸­çš„å­ä¸² $A_1$ å¯ä»¥å˜æ¢ä¸º $B_1$ã€$A_2$ å¯ä»¥å˜æ¢ä¸º $B_2â€¦$ã€‚
>
>   ä¾‹å¦‚ï¼š`A` `ï¼` `abcd` `B` `ï¼` `xyz`
>
>   å˜æ¢è§„åˆ™ä¸ºï¼š
>
>   ```c++
>   abc â†’â†’ xu ud â†’â†’ y y â†’â†’ yz
>   ```
>
>   åˆ™æ­¤æ—¶ï¼Œ`A` å¯ä»¥ç»è¿‡ä¸€ç³»åˆ—çš„å˜æ¢å˜ä¸º `B`ï¼Œå…¶å˜æ¢çš„è¿‡ç¨‹ä¸ºï¼š
>
>   ```c++
>   abcd â†’â†’ xud â†’â†’ xy â†’â†’ xyz
>   ```
>
>   å…±è¿›è¡Œäº†ä¸‰æ¬¡å˜æ¢ï¼Œä½¿å¾— `A` å˜æ¢ä¸º `B`ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ ¼å¼å¦‚ä¸‹ï¼š
>   $$
>   A B \\
>   A_1 B_1 \\
>   A_2 B_2 \\
>   â€¦ â€¦
>   $$
>   ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªç»™å®šçš„å­—ç¬¦ä¸² `A` å’Œ `B`ã€‚
>
>   æ¥ä¸‹æ¥è‹¥å¹²è¡Œï¼Œæ¯è¡Œæè¿°ä¸€ç»„å­—ä¸²å˜æ¢çš„è§„åˆ™ã€‚
>
>   æ‰€æœ‰å­—ç¬¦ä¸²é•¿åº¦çš„ä¸Šé™ä¸º `20`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è‹¥åœ¨ `10` æ­¥ï¼ˆåŒ…å« `10` æ­¥ï¼‰ä»¥å†…èƒ½å°† `A` å˜æ¢ä¸º `B` ï¼Œåˆ™è¾“å‡ºæœ€å°‘çš„å˜æ¢æ­¥æ•°ï¼›å¦åˆ™è¾“å‡º `NO ANSWER!`ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
abcd xyz
abc xu
ud y
y yz
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![3261200](img/3261200.png)

**ä»£ç **

```c++
#include <iostream>
#include <unordered_map>
#include <queue>
using namespace std;
const int N = 10;
int n;
string A, B;
string a[N], b[N];
queue<string> qa, qb;
unordered_map<string, int> da, db;
int extend(queue<string>& q, unordered_map<string, int>& da, unordered_map<string, int>& db, string a[], string b[]) {
    string t = q.front(); q.pop();
    // æšä¸¾ä»å“ªä¸ªå­—ç¬¦è¿›è¡Œæ‹“å±•
    for (int i = 0; i < t.size(); i ++ )
        // æšä¸¾è§„åˆ™
        for (int j = 0; j < n; j ++ )
            // å¦‚æœå½“å‰ä»iå¼€å§‹æ‹“å±•ï¼Œé•¿åº¦ä¸ºjçš„å•è¯å¯ä»¥è¿›è¡Œæ‹“å±•
            if (t.substr(i, a[j].size()) == a[j]) {
                // ç¼åˆæ–°å•è¯ï¼Œæ³¨æ„ï¼šçœ‹ä»”ç»†äº†
                string state = t.substr(0, i) + b[j] + t.substr(i + a[j].size());
                // å¦‚æœæ–°å•è¯å·²ç»è¢«dbæ‹“å±•è¿‡äº†ï¼Œç›´æ¥è¿”å›ç­”æ¡ˆå³å¯
                if (db.count(state)) return da[t] + 1 + db[state];
                // å¦‚æœæ–°å•è¯å·²ç»è¢«daæ‹“å±•è¿‡äº†ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯
                if (da.count(state)) continue;
                // æ›´æ–°æ–°å•è¯çš„è·ç¦»
                da[state] = da[t] + 1;
                // å…¥é˜Ÿ
                q.push(state);
            }
    return 11;
}
int bfs(string& A, string& B) {
    // ç‰¹åˆ¤ä¸‹ï¼Œå¦‚æœA == Bï¼Œè¿”å›0
    if (A == B) return 0;
    qa.push(A); da[A] = 0;
    qb.push(B); db[B] = 0;
    while (qa.size() && qb.size()) {
        int t = -1;
        // æ¯æ¬¡é€‰æ‹©é˜Ÿåˆ—ä¸ªæ•°å°‘çš„è¿›è¡Œæ‹“å±•
        if (qa.size() <= qb.size()) t = extend(qa, da, db, a, b);
        else t = extend(qb, db, da, b, a);
        if (t <= 10) return t;
    }
    return 11;
}
int main() {
    cin >> A >> B;
    while (cin >> a[n] >> b[n]) n ++;
    int t = bfs(A, B);
    if (t > 10) puts("NO ANSWER!");
    else cout << t << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**

`åŒå‘å¹¿æœ`

**ç¼åˆæ€ª**



### `A*`

#### åŸç†æ¦‚è¿°

![3271137](img/3271137.png)



#### [AcWing 179. å…«æ•°ç ](https://www.acwing.com/problem/content/181/)

**é¢˜ç›®æè¿°**

>   åœ¨ä¸€ä¸ª `3 Ã— 3` çš„ç½‘æ ¼ä¸­ï¼Œ`1âˆ¼8` è¿™ `8` ä¸ªæ•°å­—å’Œä¸€ä¸ª `X` æ°å¥½ä¸é‡ä¸æ¼åœ°åˆ†å¸ƒåœ¨è¿™ `3 Ã— 3` çš„ç½‘æ ¼ä¸­ã€‚
>
>   ä¾‹å¦‚ï¼š
>
>   ```c++
>   1 2 3
>   X 4 6
>   7 5 8
>   ```
>
>   åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŠŠ `X` ä¸å…¶ä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘ä¹‹ä¸€çš„æ•°å­—äº¤æ¢ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚
>
>   æˆ‘ä»¬çš„ç›®çš„æ˜¯é€šè¿‡äº¤æ¢ï¼Œä½¿å¾—ç½‘æ ¼å˜ä¸ºå¦‚ä¸‹æ’åˆ—ï¼ˆç§°ä¸ºæ­£ç¡®æ’åˆ—ï¼‰ï¼š
>
>   ```c++
>   1 2 3
>   4 5 6
>   7 8 X
>   ```
>
>   ä¾‹å¦‚ï¼Œç¤ºä¾‹ä¸­å›¾å½¢å°±å¯ä»¥é€šè¿‡è®© `X` å…ˆåä¸å³ã€ä¸‹ã€å³ä¸‰ä¸ªæ–¹å‘çš„æ•°å­—äº¤æ¢æˆåŠŸå¾—åˆ°æ­£ç¡®æ’åˆ—ã€‚
>
>   äº¤æ¢è¿‡ç¨‹å¦‚ä¸‹ï¼š
>
>   ```c++
>   1 2 3   1 2 3   1 2 3   1 2 3
>   X 4 6   4 X 6   4 5 6   4 5 6
>   7 5 8   7 5 8   7 X 8   7 8 X
>   ```
>
>   æŠŠ `X` ä¸ä¸Šä¸‹å·¦å³æ–¹å‘æ•°å­—äº¤æ¢çš„è¡ŒåŠ¨è®°å½•ä¸º `u`ã€`d`ã€`l`ã€`r`ã€‚
>
>   ç°åœ¨ï¼Œç»™ä½ ä¸€ä¸ªåˆå§‹ç½‘æ ¼ï¼Œè¯·ä½ é€šè¿‡æœ€å°‘çš„ç§»åŠ¨æ¬¡æ•°ï¼Œå¾—åˆ°æ­£ç¡®æ’åˆ—ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥å ä¸€è¡Œï¼Œå°† `3 Ã— 3` çš„åˆå§‹ç½‘æ ¼æç»˜å‡ºæ¥ã€‚
>
>   ä¾‹å¦‚ï¼Œå¦‚æœåˆå§‹ç½‘æ ¼å¦‚ä¸‹æ‰€ç¤ºï¼š
>
>   ```c++
>   1 2 3 
>   x 4 6 
>   7 5 8 
>   ```
>
>   åˆ™è¾“å…¥ä¸ºï¼š`1 2 3 x 4 6 7 5 8`

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå¾—åˆ°æ­£ç¡®æ’åˆ—çš„å®Œæ•´è¡ŒåŠ¨è®°å½•ã€‚
>
>   å¦‚æœç­”æ¡ˆä¸å”¯ä¸€ï¼Œè¾“å‡ºä»»æ„ä¸€ç§åˆæ³•æ–¹æ¡ˆå³å¯ã€‚
>
>   å¦‚æœä¸å­˜åœ¨è§£å†³æ–¹æ¡ˆï¼Œåˆ™è¾“å‡º `unsolvable`ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
2  3  4  1  5  x  7  6  8 
```

**è¾“å‡ºæ ·ä¾‹**

```c++
ullddrurdllurdruldr
```

**æ‰‹å†™ç¨¿**

![3271159](img/3271159.png)

**ä»£ç **

```c++
#include <iostream>
#include <queue>
#include <unordered_map>
#include <algorithm>
#define x first
#define y second
using namespace std;
typedef pair<int, string> PIS;
string start;
int dx[4] = {-1, 0, 1, 0};
int dy[4] = {0, 1, 0, -1};
char op[4] = {'u', 'r', 'd', 'l'};
unordered_map<string, int> dist;
unordered_map<string, pair<string, char>> pre;
priority_queue<PIS, vector<PIS>, greater<PIS>> q;
int f(string state) { // æ±‚è§£æ›¼å“ˆé¡¿è·ç¦»ã€æ‰‹åŠ¨æ¨¡æ‹Ÿæ ·ä¾‹ã€‘
    int res = 0;
    for (int i = 0; i < state.size(); i ++ ) {
        // è·å–å½“å‰å­—ç¬¦åœ¨ç­”æ¡ˆä¸­çš„ä¸‹æ ‡ä½ç½®
        int t = state[i] - '1';
        res += abs(i / 3 - t / 3) + abs(i % 3 - t % 3);
    }
    return res;
}
string Astar() {
    string end = "12345678x";
    // èµ·ç‚¹å…¥é˜Ÿ
    q.push({f(start), start});
    // èµ·ç‚¹è·ç¦»èµ·ç‚¹çš„è·ç¦»ä¸º0
    dist[start] = 0;
    while (q.size()) {
        auto t = q.top(); q.pop();
        string state = t.y;
        // æˆåŠŸæ‰¾åˆ°ï¼Œè·³å‡ºå¾ªç¯
        if (state == end) break;
        // æ‰¾åˆ°xåœ¨çŸ©é˜µä¸­çš„ä½ç½®
        int a = 0, b = 0;
        for (int i = 0; i < 9; i ++ )
            if (state[i] == 'x') {
                a = i / 3;
                b = i % 3;
                break;
            }
        // éå†å››ä¸ªæ–¹å‘
        string source = state;
        for (int i = 0; i < 4; i ++ ) {
            int tx = a + dx[i];
            int ty = b + dy[i];
            if (tx < 0 || tx >= 3 || ty < 0 || ty >= 3) continue;
            // äº¤æ¢ä¸¤ä¸ªå€¼
            swap(state[a * 3 + b], state[tx * 3 + ty]);
            // å¦‚æœå½“å‰è¿™ä¸ªçŠ¶æ€æ²¡æœ‰è¢«è®¿é—®è¿‡
            // æˆ–è€…åˆ°è¾¾å½“å‰è¿™ä¸ªçŠ¶æ€çš„è·ç¦»æ›´é•¿
            if (!dist.count(state) || dist[state] > dist[source] + 1) {
                // æ›´æ–°è·ç¦»
                dist[state] = dist[source] + 1;
                // è®°å½•å‰é©±èŠ‚ç‚¹
                pre[state] = {source, op[i]};
                // å…¥é˜Ÿ
                q.push({dist[state] + f(state), state});
            }
            // å†äº¤æ¢å›æ¥
            swap(state[a * 3 + b], state[tx * 3 + ty]);
        }
    }
    // è¾“å‡ºè·¯å¾„
    string res;
    while (end != start) {
        res += pre[end].y;
        end = pre[end].x;
    }
    // ç”±äºè·¯å¾„æ˜¯é€†åºè¾“å‡ºçš„
    // éœ€è¦å°†ç­”æ¡ˆåè¿‡æ¥
    reverse(res.begin(), res.end());
    return res;
}
int main() {
    char c;
    while (cin >> c) start += c;
    // ç»Ÿè®¡é€†åºå¯¹çš„æ•°é‡
    int n = 0;
    for (int i = 0; i < start.size(); i ++ ) {
        if (start[i] == 'x') continue;
        for (int j = i + 1; j < start.size(); j ++ ) {
            if (start[j] == 'x') continue;
            if (start[i] > start[j]) n ++;
        }
    }
    // é€†åºå¯¹æ•°é‡ä¸ºå¥‡æ•°ï¼Œæ— è§£ã€è§£é‡Šåœ¨æ‰‹å†™ç¨¿ã€‘
    if (n & 1) puts("unsolvable");
    else cout << Astar() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$æœ€åO(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`A*`ã€`BFS`

**ç¼åˆæ€ª**



#### [AcWing 178. ç¬¬KçŸ­è·¯](https://www.acwing.com/problem/content/180/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€å¼  `N` ä¸ªç‚¹ï¼ˆç¼–å· `1,2â€¦N`ï¼‰ï¼Œ`M` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œæ±‚ä»èµ·ç‚¹ `S` åˆ°ç»ˆç‚¹ `T` çš„ç¬¬ `K` çŸ­è·¯çš„é•¿åº¦ï¼Œè·¯å¾„å…è®¸é‡å¤ç»è¿‡ç‚¹æˆ–è¾¹ã€‚
>
>   **æ³¨æ„ï¼š** æ¯æ¡æœ€çŸ­è·¯ä¸­è‡³å°‘è¦åŒ…å«ä¸€æ¡è¾¹ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `A,B` å’Œ `L`ï¼Œè¡¨ç¤ºç‚¹ `A` ä¸ç‚¹ `B` ä¹‹é—´å­˜åœ¨æœ‰å‘è¾¹ï¼Œä¸”è¾¹é•¿ä¸º `L`ã€‚
>
>   æœ€åä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `S,T` å’Œ `K`ï¼Œåˆ†åˆ«è¡¨ç¤ºèµ·ç‚¹ `S`ï¼Œç»ˆç‚¹ `T` å’Œç¬¬ `K` çŸ­è·¯ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºç¬¬ `K` çŸ­è·¯çš„é•¿åº¦ï¼Œå¦‚æœç¬¬ `K` çŸ­è·¯ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤S,Tâ‰¤Nâ‰¤1000,$
>   +   $0â‰¤Mâ‰¤10^4,$
>   +   $1â‰¤Kâ‰¤1000,$
>   +   $1â‰¤Lâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
2 2
1 2 5
2 1 4
1 2 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
14
```

**æ‰‹å†™ç¨¿**

![3281604](img/3281604.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
typedef pair<int, PII> PIII;
const int N = 1010, M = 20010, INF = 0x3f3f3f3f;
int n, m, S, T, K, idx;
int h[N], rh[N], e[M], w[M], ne[M], f[N], st[N];
priority_queue<PII, vector<PII>, greater<PII>> q;
priority_queue<PIII, vector<PIII>, greater<PIII>> heap;
void add(int h[], int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dijkstra() { // éå†åå›¾ï¼Œæ±‚å‡ºæ¯ä¸ªç‚¹åˆ°ç»ˆç‚¹çš„è·ç¦»ï¼Œå½“ä½œé¢„ä¼°è·ç¦»
    memset(f, 0x3f, sizeof f);
    // å°†ç»ˆç‚¹åˆ°ç»ˆç‚¹çš„è·ç¦»ä¸º0
    f[T] = 0;
    // å°†ç»ˆç‚¹å…¥é˜Ÿ
    q.push({0, T});
    // Dijkstraæ¨¡æ¿
    while (q.size()) {
        auto t = q.top(); q.pop();
        int v = t.y;
        if (st[v]) continue;
        st[v] = true;
        for (int i = rh[v]; i != -1; i = ne[i]) {
            int j = e[i];
            if (!st[j] && f[j] > f[v] + w[i]) {
                f[j] = f[v] + w[i];
                q.push({f[j], j});
            }
        }
    }
    return;
}
int astar() {
    // å­˜å‚¨çš„æ•°æ®è¯´æ˜åœ¨ã€æ‰‹å†™ç¨¿ã€‘
    heap.push({f[S], {S, 0}});
    // å¦‚æœæ— æ³•åˆ°è¾¾ç»ˆç‚¹ï¼Œè¯´æ˜ä¸å­˜åœ¨ä»èµ·ç‚¹åˆ°è¾¾ç»ˆç‚¹çš„é€šè·¯ï¼Œè¿”å›-1
    if (f[S] == INF) return -1;
    int cnt = 0;
    while (heap.size()) {
        auto t = heap.top(); heap.pop();
        int v = t.y.x, distance = t.y.y;
        // è®°å½•ç»ˆç‚¹å‡ºé˜Ÿçš„æ¬¡æ•°
        if (v == T) cnt ++;
        // ç»ˆç‚¹å‡ºé˜Ÿçš„æ¬¡æ•°ç­‰äºKï¼Œè¯´æ˜æ‰¾åˆ°ç¬¬KçŸ­è·¯
        if (cnt == K) return t.x;
        // éå†é‚»è¾¹
        for (int i = h[v]; i != -1; i = ne[i]) {
            int j = e[i];
            // å°†æ‰€æœ‰é‚»è¾¹ä¸€è‚¡è„‘æ”¾å…¥é˜Ÿåˆ—ã€åŸå› åœ¨æ‰‹å†™ç¨¿ã€‘
            heap.push({f[j] + distance + w[i], {j, distance + w[i]}});
        }
    }
    return -1;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    memset(rh, -1, sizeof rh);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        // å»ºç«‹æ­£å‘è¾¹
        add(h, u, v, w);
        // å»ºç«‹åå‘è¾¹ã€ä½œä¸ºé¢„ä¼°è·ç¦»ã€‘
        add(rh, v, u, w);
    }
    scanf("%d%d%d", &S, &T, &K);
    // å¦‚æœèµ·ç‚¹ä¸ç»ˆç‚¹é‡åˆï¼ŒK ++ã€æœ€å°‘æœ‰ä¸€æ¡è¾¹ã€‘
    if (S == T) K ++;
    dijkstra();
    cout << astar() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$æœ€åO(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(nm)$

**æ ‡ç­¾**

`A*`ã€`å¯å‘å¼æœç´¢`

**ç¼åˆæ€ª**



## æ·±åº¦ä¼˜å…ˆæœç´¢

### æ™®é€šæ·±æœ

#### [LeetCode 306. ç´¯åŠ æ•°](https://leetcode-cn.com/problems/additive-number/)

**é¢˜ç›®æè¿°**

> ç´¯åŠ æ•° æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»„æˆå®ƒçš„æ•°å­—å¯ä»¥å½¢æˆç´¯åŠ åºåˆ—ã€‚
>
> ä¸€ä¸ªæœ‰æ•ˆçš„ ç´¯åŠ åºåˆ— å¿…é¡» è‡³å°‘ åŒ…å« `3` ä¸ªæ•°ã€‚é™¤äº†æœ€å¼€å§‹çš„ä¸¤ä¸ªæ•°ä»¥å¤–ï¼Œåºåˆ—ä¸­çš„æ¯ä¸ªåç»­æ•°å­—å¿…é¡»æ˜¯å®ƒä¹‹å‰ä¸¤ä¸ªæ•°å­—ä¹‹å’Œã€‚
>
> ç»™ä½ ä¸€ä¸ªåªåŒ…å«æ•°å­— `'0'-'9'` çš„å­—ç¬¦ä¸²ï¼Œç¼–å†™ä¸€ä¸ªç®—æ³•æ¥åˆ¤æ–­ç»™å®šè¾“å…¥æ˜¯å¦æ˜¯ ç´¯åŠ æ•° ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
>
> è¯´æ˜ï¼šç´¯åŠ åºåˆ—é‡Œçš„æ•°ï¼Œé™¤æ•°å­— `0` ä¹‹å¤–ï¼Œä¸ä¼š ä»¥ `0` å¼€å¤´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° `1, 2, 03` æˆ–è€… `1, 02, 3` çš„æƒ…å†µã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`"112358"`
> è¾“å‡ºï¼š`true`
> è§£é‡Šï¼šç´¯åŠ åºåˆ—ä¸º: `1, 1, 2, 3, 5, 8 ã€‚1 + 1 = 2, 1 + 2 = 3, 2 + 3 = 5, 3 + 5 = 8`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`"199100199"`
> è¾“å‡ºï¼š`true`
> è§£é‡Šï¼šç´¯åŠ åºåˆ—ä¸º: `1, 99, 100, 199ã€‚1 + 99 = 100, 99 + 100 = 199`

**æç¤º**

> + $1 <= num.length <= 35$
> + $num ä»…ç”±æ•°å­—ï¼ˆ0 - 9ï¼‰ç»„æˆ$

**è¿›é˜¶**

> ä½ è®¡åˆ’å¦‚ä½•å¤„ç†ç”±è¿‡å¤§çš„æ•´æ•°è¾“å…¥å¯¼è‡´çš„æº¢å‡º?

**æ­¥éª¤**

> 1. æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œçˆ†æœ `num` å­—ç¬¦ä¸²ï¼Œæšä¸¾æ¯ä¸ªæ•°å­—å­—ç¬¦å¹¶ä¸”å°†å…¶è®°å½•åœ¨ `path` æ•°ç»„å½“ä¸­ ï¼ŒæŸ¥çœ‹æ˜¯å¦æ»¡è¶³ç­”æ¡ˆ
> 2. é€’å½’å‡ºå£
>     + å¦‚æœ `path` çš„ä¸ªæ•°å¤§äºç­‰äº `3` ä¸ªï¼Œè¿›è¡Œåˆ¤æ–­ `path[n - 3] + path[n - 2] == path[n - 1]` æ˜¯å¦æˆç«‹ï¼Œåˆ†ä»¥ä¸‹ä¸¤ç§æƒ…å†µ
>         + å¦‚æœæ¡ä»¶æˆç«‹ï¼Œåˆ™ç»§ç»­å‘ä¸‹æ“ä½œ
>         + å¦‚æœæ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ç›´æ¥æˆªå»å½“å‰åˆ†æ”¯ï¼Œå³è¿”å› `false`
>     + å¦‚æœå½“å‰æšä¸¾çš„å­—ç¬¦ä½ç½® `u` ä¸ºæœ€åä¸€ä¸ªä½ç½®ï¼Œåˆ™è¿›è¡Œå¦‚ä¸‹åˆ¤æ–­
>         + å¦‚æœ `path` çš„ä¸ªæ•°å¤§äºç­‰äº `3` ä¸ªï¼Œåˆ™è¯´æ˜å­˜åœ¨ä¸€ç»„ç­”æ¡ˆï¼Œè¿”å› `true`
>         + å¦åˆ™ï¼Œè¿”å› `false`
> 3. éå†å­—ç¬¦ä¸²å³å¯

**ä»£ç **

```c++
class Solution {
public:
    string add(string& a, string& b) {
        vector<int> A, B, C;
        for (int i = a.size() - 1; i >= 0; i -- ) A.push_back(a[i] - '0');
        for (int i = b.size() - 1; i >= 0; i -- ) B.push_back(b[i] - '0');
        for (int i = 0, t = 0; i < A.size() || i < B.size() || t; i ++ ) {
            if (i < A.size()) t += A[i];
            if (i < B.size()) t += B[i];
            C.push_back(t % 10);
            t /= 10;
        }
        string res;
        for (int i = C.size() - 1; i >= 0; i -- ) res += to_string(C[i]);
        return res;
    }
    bool dfs(string& num, vector<string>& path, int u) {
        int n = path.size();
        // å¦‚æœä¸ªæ•°å¤§äºç­‰äº3ä¸ª
        if (n >= 3) {
            string a = path[n - 3];
            string b = path[n - 2];
            string c = path[n - 1];
            string d = add(a, b);
            // å¦‚æœä¸ç›¸ç­‰ï¼Œè¿”å›false
            if (d != c) return false;
        }
        // å¦‚æœæšä¸¾åˆ°æœ€åä¸€ä¸ªå­—ç¬¦
        if (u == num.size()) {
            // å¦‚æœä¸ªæ•°å¤§äºç­‰äº3ä¸ªï¼Œè¿”å›true
            if (path.size() >= 3) return true;
            return false;
        }
        for (int i = u; i < num.size(); i ++ ) {
            // ä»uå¼€å§‹æˆªå–é•¿åº¦ä¸ºi - u + 1çš„å­—ç¬¦ä¸²
            path.push_back(num.substr(u, i - u + 1));
            // å¦‚æœèƒ½å¤Ÿæœç´¢åˆ°æ­£ç¡®ç­”æ¡ˆï¼Œåˆ™è¿”å›true
            if (dfs(num, path, i + 1)) return true;
            // å›æº¯
            path.pop_back();
            // å¦‚æœå‡ºç°å‰å¯¼0ï¼Œåˆ™è¿”å›false
            // æ³¨æ„ï¼Œåœ¨åé¢æ·»åŠ æ­¤æ¡ä»¶ï¼Œè¯´æ˜å½“å‰å­—ç¬¦å·²ç»è¢«éå†è¿‡
            // å³0å·²ç»è¢«éå†è¿‡ï¼Œæ¥ä¸‹æ¥è¦éå†çš„æ˜¯å½¢å¦‚01ï¼Œ02ä¹‹ç±»çš„æ•°å­—ï¼Œå¿…ä¸æ»¡è¶³æ¡ä»¶ï¼Œè¿”å›å³å¯
            if (num[u] == '0') return false;
        }
        return false;
    }
    bool isAdditiveNumber(string num) {
        vector<string> path;
        return dfs(num, path, 0);
    }
};
```

**æ ‡ç­¾**

`dfs`ã€`é«˜ç²¾åº¦`

#### [LeetCode 385. è¿·ä½ è¯­æ³•åˆ†æå™¨](https://leetcode-cn.com/problems/mini-parser/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² `s` è¡¨ç¤ºä¸€ä¸ªæ•´æ•°åµŒå¥—åˆ—è¡¨ï¼Œå®ç°ä¸€ä¸ªè§£æå®ƒçš„è¯­æ³•åˆ†æå™¨å¹¶è¿”å›è§£æçš„ç»“æœ `NestedInteger` ã€‚
>
>   åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ åªå¯èƒ½æ˜¯æ•´æ•°æˆ–æ•´æ•°åµŒå¥—åˆ—è¡¨

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`s = "324",`
>   è¾“å‡ºï¼š`324`
>   è§£é‡Šï¼šä½ åº”è¯¥è¿”å›ä¸€ä¸ª `NestedInteger` å¯¹è±¡ï¼Œå…¶ä¸­åªåŒ…å«æ•´æ•°å€¼ `324`ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`s = "[123,[456,[789]]]",`
>   è¾“å‡ºï¼š`[123,[456,[789]]]`
>   è§£é‡Šï¼šè¿”å›ä¸€ä¸ª `NestedInteger` å¯¹è±¡åŒ…å«ä¸€ä¸ªæœ‰ä¸¤ä¸ªå…ƒç´ çš„åµŒå¥—åˆ—è¡¨ï¼š
>
>   1. ä¸€ä¸ª `integer` åŒ…å«å€¼ `123`
>   2. ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„åµŒå¥—åˆ—è¡¨ï¼š
>       i.  ä¸€ä¸ª `integer` åŒ…å«å€¼ `456`
>       ii. ä¸€ä¸ªåŒ…å«ä¸€ä¸ªå…ƒç´ çš„åµŒå¥—åˆ—è¡¨
>            a. ä¸€ä¸ª `integer` åŒ…å«å€¼ `789`

**æç¤º**

>   +   $1 <= s.length <= 5 * 10^4$
>   +   $s ç”±æ•°å­—ã€æ–¹æ‹¬å· "[]"ã€è´Ÿå· '-' ã€é€—å· ','ç»„æˆ$
>   +   $ç”¨ä¾‹ä¿è¯ s æ˜¯å¯è§£æçš„ NestedInteger$
>   +   $è¾“å…¥ä¸­çš„æ‰€æœ‰å€¼çš„èŒƒå›´æ˜¯ [-10^6, 10^6]$

**æ‰‹å†™ç¨¿**

![3172147](img/3172147.png)

**ä»£ç **

```c++
/**
 * // This is the interface that allows for creating nested lists.
 * // You should not implement it, or speculate about its implementation
 * class NestedInteger {
 *   public:
 *     // Constructor initializes an empty nested list.
 *     NestedInteger();
 *
 *     // Constructor initializes a single integer.
 *     NestedInteger(int value);
 *
 *     // Return true if this NestedInteger holds a single integer, rather than a nested list.
 *     bool isInteger() const;
 *
 *     // Return the single integer that this NestedInteger holds, if it holds a single integer
 *     // The result is undefined if this NestedInteger holds a nested list
 *     int getInteger() const;
 *
 *     // Set this NestedInteger to hold a single integer.
 *     void setInteger(int value);
 *
 *     // Set this NestedInteger to hold a nested list and adds a nested integer to it.
 *     void add(const NestedInteger &ni);
 *
 *     // Return the nested list that this NestedInteger holds, if it holds a nested list
 *     // The result is undefined if this NestedInteger holds a single integer
 *     const vector<NestedInteger> &getList() const;
 * };
 */
class Solution {
public:
    NestedInteger dfs(string& s, int& u) {
        NestedInteger res;
        if (s[u] == '[') {
            u ++; // è·³è¿‡å·¦æ‹¬å·
            while (s[u] != ']') res.add(dfs(s, u));
            u ++; // è·³è¿‡å³æ‹¬å·
            if (u < s.size() && s[u] == ',') u ++; // è·³è¿‡é€—å·
        }
        else {
            int k = u;
            // å°†æ•°å­—éƒ¨åˆ†æ‰¾å‡ºæ¥
            // æ³¨æ„ä¸èƒ½ä½¿ç”¨isdigit()ï¼Œå› ä¸ºï¼Œæ•°å­—å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œæœ‰'-'
            while (k < s.size() && s[k] != ',' && s[k] != ']') k ++;
            // å°†æ•°å­—è½¬åŒ–æˆintç±»å‹
            res.setInteger(stoi(s.substr(u, k - u)));
            // è·³è¿‡é€—å·
            if (k < s.size() && s[k] == ',') k ++;
            u = k;
        }
        return res;
    }
    NestedInteger deserialize(string s) {
        int u = 0;
        // æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯å¼•ç”¨
        // å…¶åŸå› æ˜¯ä¸éœ€è¦å›æº¯æ“ä½œï¼Œæ²¿ç€å­—ç¬¦ä¸²ä¸€æ¡è·¯èµ°åˆ°é»‘å³å¯
        return dfs(s, u);
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**

[LeetCode 341. æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨](#LeetCode 341. æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨)

#### [LeetCode 386. å­—å…¸åºæ’æ•°](https://leetcode-cn.com/problems/lexicographical-numbers/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªæ•´æ•° `n` ï¼ŒæŒ‰å­—å…¸åºè¿”å›èŒƒå›´ `[1, n]` å†…æ‰€æœ‰æ•´æ•°ã€‚
>
>   ä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º `O(n)` ä¸”ä½¿ç”¨ `O(1)` é¢å¤–ç©ºé—´çš„ç®—æ³•ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`n = 13`
>   è¾“å‡ºï¼š`[1,10,11,12,13,2,3,4,5,6,7,8,9]`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`n = 2`
>   è¾“å‡ºï¼š`[1,2]`

**æç¤º**

>   +   $1 <= n <= 5 * 10^4$

**æ‰‹å†™ç¨¿**

![3181401](img/3181401.png)

**ä»£ç **

```c++
class Solution {
public:
    vector<int> res;
    void dfs(int cur, int n) {
        // å¦‚æœå½“å‰çš„æ•°å­—å¤§äºnï¼Œåˆ™ç›´æ¥è¿”å›
        if (cur > n) return;
        // å¦‚æœå½“å‰çš„æ•°å­—å°äºç­‰äºnï¼Œè¯´æ˜ç¬¦åˆæ¡ä»¶ï¼ŒåŠ å…¥ç­”æ¡ˆæ•°ç»„å³å¯
        if (cur <= n) res.push_back(cur);
        // æšä¸¾ä¸‹ä¸€ä½æ•°å­—ï¼Œæ³¨æ„ï¼šé™¤ç¬¬ä¸€ä½æ•°å­—ä¹‹å¤–çš„æ¯ä¸€ä½ä¸Šçš„æ•°å­—å¯å¡«çš„èŒƒå›´ä¸º[0, 9]
        for (int i = 0; i <= 9; i ++ ) dfs(cur * 10 + i, n);
        return;
    }
    vector<int> lexicalOrder(int n) {
        // æšä¸¾ç¬¬ä¸€ä½æ•°å­—
        for (int i = 1; i <= 9; i ++ ) dfs(i, n);
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$é€’å½’å¤æ‚åº¦ä¸å¥½åˆ†æ$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**

#### [LeetCode 388. æ–‡ä»¶çš„æœ€é•¿ç»å¯¹è·¯å¾„](https://leetcode-cn.com/problems/longest-absolute-file-path/)

**é¢˜ç›®æè¿°**

>   å‡è®¾æœ‰ä¸€ä¸ªåŒæ—¶å­˜å‚¨æ–‡ä»¶å’Œç›®å½•çš„æ–‡ä»¶ç³»ç»Ÿã€‚ä¸‹å›¾å±•ç¤ºäº†æ–‡ä»¶ç³»ç»Ÿçš„ä¸€ä¸ªç¤ºä¾‹ï¼š
>
>   ![mdir](img/mdir.jpg)
>
>   è¿™é‡Œå°† `dir` ä½œä¸ºæ ¹ç›®å½•ä¸­çš„å”¯ä¸€ç›®å½•ã€‚`dir` åŒ…å«ä¸¤ä¸ªå­ç›®å½• `subdir1` å’Œ `subdir2` ã€‚`subdir1` åŒ…å«æ–‡ä»¶ `file1.ext` å’Œå­ç›®å½• `subsubdir1`ï¼›`subdir2` åŒ…å«å­ç›®å½• `subsubdir2`ï¼Œè¯¥å­ç›®å½•ä¸‹åŒ…å«æ–‡ä»¶ `file2.ext` ã€‚
>
>   åœ¨æ–‡æœ¬æ ¼å¼ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º(âŸ¶è¡¨ç¤ºåˆ¶è¡¨ç¬¦)ï¼š
>
>   >   dir
>   >   âŸ¶ subdir1
>   >   âŸ¶ âŸ¶ file1.ext
>   >   âŸ¶ âŸ¶ subsubdir1
>   >   âŸ¶ subdir2
>   >   âŸ¶ âŸ¶ subsubdir2
>   >   âŸ¶ âŸ¶ âŸ¶ file2.ext
>
>
>   å¦‚æœæ˜¯ä»£ç è¡¨ç¤ºï¼Œä¸Šé¢çš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥å†™ä¸º `"dir\n\tsubdir1\n\t\tfile1.ext\n\t\tsubsubdir1\n\tsubdir2\n\t\tsubsubdir2\n\t\t\tfile2.ext"` ã€‚`'\n'` å’Œ `'\t'` åˆ†åˆ«æ˜¯æ¢è¡Œç¬¦å’Œåˆ¶è¡¨ç¬¦ã€‚
>
>   æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ¯ä¸ªæ–‡ä»¶å’Œæ–‡ä»¶å¤¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ ç»å¯¹è·¯å¾„ ï¼Œå³å¿…é¡»æ‰“å¼€æ‰èƒ½åˆ°è¾¾æ–‡ä»¶/ç›®å½•æ‰€åœ¨ä½ç½®çš„ç›®å½•é¡ºåºï¼Œæ‰€æœ‰è·¯å¾„ç”¨ `'/'` è¿æ¥ã€‚ä¸Šé¢ä¾‹å­ä¸­ï¼ŒæŒ‡å‘ `file2.ext` çš„ ç»å¯¹è·¯å¾„ æ˜¯ `"dir/subdir2/subsubdir2/file2.ext"` ã€‚æ¯ä¸ªç›®å½•åç”±å­—æ¯ã€æ•°å­—å’Œ/æˆ–ç©ºæ ¼ç»„æˆï¼Œæ¯ä¸ªæ–‡ä»¶åéµå¾ª `name.extension` çš„æ ¼å¼ï¼Œå…¶ä¸­ `name` å’Œ `extension`ç”±å­—æ¯ã€æ•°å­—å’Œ/æˆ–ç©ºæ ¼ç»„æˆã€‚
>
>   ç»™å®šä¸€ä¸ªä»¥ä¸Šè¿°æ ¼å¼è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„å­—ç¬¦ä¸² `input` ï¼Œè¿”å›æ–‡ä»¶ç³»ç»Ÿä¸­ æŒ‡å‘ æ–‡ä»¶ çš„ æœ€é•¿ç»å¯¹è·¯å¾„ çš„é•¿åº¦ ã€‚ å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰æ–‡ä»¶ï¼Œè¿”å› `0`ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`input = "dir\n\tsubdir1\n\tsubdir2\n\t\tfile.ext"`
>   è¾“å‡ºï¼š`20`
>   è§£é‡Šï¼šåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œç»å¯¹è·¯å¾„ä¸º `"dir/subdir2/file.ext"` ï¼Œè·¯å¾„é•¿åº¦ `20`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`input = "dir\n\tsubdir1\n\t\tfile1.ext\n\t\tsubsubdir1\n\tsubdir2\n\t\tsubsubdir2\n\t\t\tfile2.ext"`
>   è¾“å‡ºï¼š`32`
>   è§£é‡Šï¼šå­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ï¼š
>   `"dir/subdir1/file1.ext"` ï¼Œè·¯å¾„é•¿åº¦ `21`
>   `"dir/subdir2/subsubdir2/file2.ext"` ï¼Œè·¯å¾„é•¿åº¦ `32`
>   è¿”å› `32` ï¼Œå› ä¸ºè¿™æ˜¯æœ€é•¿çš„è·¯å¾„

**ç¤ºä¾‹ 3**

>   è¾“å…¥ï¼š`input = "a"`
>   è¾“å‡ºï¼š`0`
>   è§£é‡Šï¼šä¸å­˜åœ¨ä»»ä½•æ–‡ä»¶

**ç¤ºä¾‹ 4**

>   è¾“å…¥ï¼š`input = "file1.txt\nfile2.txt\nlongfile.txt"`
>   è¾“å‡ºï¼š`12`
>   è§£é‡Šï¼šæ ¹ç›®å½•ä¸‹æœ‰ `3` ä¸ªæ–‡ä»¶ã€‚
>   å› ä¸ºæ ¹ç›®å½•ä¸­ä»»ä½•ä¸œè¥¿çš„ç»å¯¹è·¯å¾„åªæ˜¯åç§°æœ¬èº«ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ `"longfile.txt"` ï¼Œè·¯å¾„é•¿åº¦ä¸º `12`

**æç¤º**

>   +   $1 <= input.length <= 10^4$
>   +   $input å¯èƒ½åŒ…å«å°å†™æˆ–å¤§å†™çš„è‹±æ–‡å­—æ¯ï¼Œä¸€ä¸ªæ¢è¡Œç¬¦ '\n'ï¼Œä¸€ä¸ªåˆ¶è¡¨ç¬¦ '\t'ï¼Œä¸€ä¸ªç‚¹ '.'ï¼Œä¸€ä¸ªç©ºæ ¼ ' 'ï¼Œå’Œæ•°å­—ã€‚$

**æ‰‹å†™ç¨¿**

![3211446](img/3211446.png)

**ä»£ç **

```c++
class Solution {
public:
    int lengthLongestPath(string s) {
        int ans = 0;
        stack<string> stk;
        // ã€sumå§‹ç»ˆè®°å½•ã€æ ˆä¸­ã€‘ä¿å­˜çš„å•è¯çš„ã€é•¿åº¦ã€‘ã€‘
        for (int i = 0, sum = 0; i < s.size(); i ++ ) {
            int k = 0;
            // åˆ¤æ–­ä¸‹ä¸€ä¸ªå•è¯ä½äºç¬¬å‡ å±‚
            while (i < s.size() && s[i] == '\t') k ++, i ++;
            // åˆ¤æ–­å½“å‰å¤„äºç¬¬å‡ å±‚
            // å¦‚æœå±‚æ•°ä¸å¯¹ï¼Œéœ€è¦è¿›è¡Œå›æº¯
            // æ›´æ–°sumçš„å€¼ï¼Œæ³¨æ„sumå€¼çš„å«ä¹‰
            while (stk.size() > k) sum -= stk.top().size(), stk.pop();
            // æ‰¾å‡ºå½“å‰çš„å•è¯
            int j = i;
            while (j < s.size() && s[j] != '\n') j ++;
            // å°†å½“å‰çš„å•è¯æ‰£å‡ºæ¥
            string t = s.substr(i, j - i);
            // å°†å½“å‰ã€å•è¯çš„é•¿åº¦ã€‘å‹å…¥æ ˆä¸­
            stk.push(t);
            // æ›´æ–°sumçš„å€¼
            sum += t.size();
            if (t.find('.') != -1) // è¿˜éœ€è¦åŠ '/'ï¼Œnä¸ªå•è¯éœ€è¦n - 1ä¸ª/
                ans = max(ans, sum + (int)stk.size() - 1);
            i = j;
        }
        return ans;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ¨¡æ‹Ÿ`

**ç¼åˆæ€ª**

#### [AcWing 92. é€’å½’å®ç°æŒ‡æ•°å‹æšä¸¾](https://www.acwing.com/problem/content/description/94/)

**é¢˜ç›®æè¿°**

>   ä» `1 âˆ¼ n` è¿™ `n` ä¸ªæ•´æ•°ä¸­éšæœºé€‰å–ä»»æ„å¤šä¸ªï¼Œè¾“å‡ºæ‰€æœ‰å¯èƒ½çš„é€‰æ‹©æ–¹æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥ä¸€ä¸ªæ•´æ•° `n`ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯è¡Œè¾“å‡ºä¸€ç§æ–¹æ¡ˆã€‚
>
>   åŒä¸€è¡Œå†…çš„æ•°å¿…é¡»å‡åºæ’åˆ—ï¼Œç›¸é‚»ä¸¤ä¸ªæ•°ç”¨æ°å¥½ `1` ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
>   å¯¹äºæ²¡æœ‰é€‰ä»»ä½•æ•°çš„æ–¹æ¡ˆï¼Œè¾“å‡ºç©ºè¡Œã€‚
>
>   æœ¬é¢˜æœ‰è‡ªå®šä¹‰æ ¡éªŒå™¨ï¼ˆ`SPJ`ï¼‰ï¼Œå„è¡Œï¼ˆä¸åŒæ–¹æ¡ˆï¼‰ä¹‹é—´çš„é¡ºåºä»»æ„ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤15$

**è¾“å…¥æ ·ä¾‹**

```c++
3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
2
2 3
1
1 3
1 2
1 2 3
```

**æ‰‹å†™ç¨¿**

![3301220](img/3301220.png)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
int n;
vector<int> path;
void dfs(int u, vector<int>& path) {
    // è¶Šç•Œï¼Œåˆ™è¿”å›
    if (u > n) return;
    // è¾“å‡ºç­”æ¡ˆ
    for (auto num : path) cout << num << " ";
    // è¾“å‡ºå›è½¦
    // ç©ºè¡Œç®—ç­”æ¡ˆ
    cout << endl;
    for (int i = u; i <= n; i ++ ) {
        // å°†ä¸‹ä¸€ä¸ªæ•°å­—åŠ å…¥ç­”æ¡ˆ
        path.push_back(i + 1);
        // æ·±æœ
        dfs(i + 1, path);
        // å¤–éƒ¨æšä¸¾
        // å›æº¯ç°åœº
        path.pop_back();
    }
}
int main() {
    scanf("%d", &n);
    // ä»0å¼€å§‹æœç´¢ï¼Œå°†0å½“ä½œè¶…çº§æºç‚¹
    dfs(0, path);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

`O(n)`

**æ ‡ç­¾**

`DFS`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**

#### [AcWing 93. é€’å½’å®ç°ç»„åˆå‹æšä¸¾](https://www.acwing.com/problem/content/description/95/)

**é¢˜ç›®æè¿°**

>   ä» `1 âˆ¼ n` è¿™ `n` ä¸ªæ•´æ•°ä¸­éšæœºé€‰å‡º `m` ä¸ªï¼Œè¾“å‡ºæ‰€æœ‰å¯èƒ½çš„é€‰æ‹©æ–¹æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

>   ä¸¤ä¸ªæ•´æ•° `n,m` ,åœ¨åŒä¸€è¡Œç”¨ç©ºæ ¼éš”å¼€ã€‚

**è¾“å‡ºæ ¼å¼**

>   æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºè¾“å‡ºæ‰€æœ‰æ–¹æ¡ˆï¼Œæ¯è¡Œ `1` ä¸ªã€‚
>
>   é¦–å…ˆï¼ŒåŒä¸€è¡Œå†…çš„æ•°å‡åºæ’åˆ—ï¼Œç›¸é‚»ä¸¤ä¸ªæ•°ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
>   å…¶æ¬¡ï¼Œå¯¹äºä¸¤ä¸ªä¸åŒçš„è¡Œï¼Œå¯¹åº”ä¸‹æ ‡çš„æ•°ä¸€ä¸€æ¯”è¾ƒï¼Œå­—å…¸åºè¾ƒå°çš„æ’åœ¨å‰é¢ï¼ˆä¾‹å¦‚ `1 3 5 7` æ’åœ¨ `1 3 6 8` å‰é¢ï¼‰ã€‚

**æ•°æ®èŒƒå›´**

>   +   $n > 0,$
>   +   $0 â‰¤ m â‰¤ n,$
>   +   $n + (n âˆ’ m) â‰¤ 25$

**è¾“å…¥æ ·ä¾‹**

```c++
5 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 2 3 
1 2 4 
1 2 5 
1 3 4 
1 3 5 
1 4 5 
2 3 4 
2 3 5 
2 4 5 
3 4 5 
```

**æ€è€ƒé¢˜**

>   å¦‚æœè¦æ±‚ä½¿ç”¨éé€’å½’æ–¹æ³•ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

**æ‰‹å†™ç¨¿**

![3301255](img/3301255.png)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
int n, m;
vector<int> path;
/*
å‚æ•°è¯´æ˜ï¼š
    å½“å‰æšä¸¾çš„æ•°å­—
    å½“å‰å¤„äºç¬¬å‡ å±‚
    ç­”æ¡ˆæ•°ç»„
*/
void dfs(int u, int k, vector<int>& path) {
    // å½“å‰æšä¸¾çš„æ•°å­—è¶…å‡ºæœ€å¤§å€¼ï¼Œè¿”å›
    if (u > n) return;
    // å½“å‰æšä¸¾çš„å±‚æ•°
    if (k > m) {
        for (int i = 0; i < path.size(); i ++ ) cout << path[i] << " ";
        cout << endl;
        return;
    }
    // ä»uå¼€å§‹æšä¸¾
    for (int i = u; i <= n; i ++ ) {
        // å°†æ•°å­—æ’å…¥ç­”æ¡ˆ
        path.push_back(i + 1);
        // è¿›å…¥ä¸‹ä¸€å±‚
        dfs(i + 1, k + 1, path);
        // å¤–éƒ¨æœç´¢
        // å›æº¯
        path.pop_back();
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    dfs(0, 1, path);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`DFS`

**ç¼åˆæ€ª**

#### [AcWing 94. é€’å½’å®ç°æ’åˆ—å‹æšä¸¾](https://www.acwing.com/problem/content/description/96/)

**é¢˜ç›®æè¿°**

>   æŠŠ `1 âˆ¼ n` è¿™ `n` ä¸ªæ•´æ•°æ’æˆä¸€è¡Œåéšæœºæ‰“ä¹±é¡ºåºï¼Œè¾“å‡ºæ‰€æœ‰å¯èƒ½çš„æ¬¡åºã€‚

**è¾“å…¥æ ¼å¼**

>   ä¸€ä¸ªæ•´æ•° `n`ã€‚

**è¾“å‡ºæ ¼å¼**

>   æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºè¾“å‡ºæ‰€æœ‰æ–¹æ¡ˆï¼Œæ¯è¡Œ `1` ä¸ªã€‚
>
>   é¦–å…ˆï¼ŒåŒä¸€è¡Œç›¸é‚»ä¸¤ä¸ªæ•°ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
>   å…¶æ¬¡ï¼Œå¯¹äºä¸¤ä¸ªä¸åŒçš„è¡Œï¼Œå¯¹åº”ä¸‹æ ‡çš„æ•°ä¸€ä¸€æ¯”è¾ƒï¼Œå­—å…¸åºè¾ƒå°çš„æ’åœ¨å‰é¢ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 9$

**è¾“å…¥æ ·ä¾‹**

```c++
3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 2 3
1 3 2
2 1 3
2 3 1
3 1 2
3 2 1
```

**æ‰‹å†™ç¨¿**

![3301344](img/3301344.png)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
const int N = 15;
int n;
int st[N];
vector<int> path;
/*
å‚æ•°è¯´æ˜ï¼š
    å½“å‰æšä¸¾çš„æ˜¯ç¬¬å‡ å±‚
    ç­”æ¡ˆæ•°ç»„
*/
void dfs(int u, vector<int>& path) {
    // å¦‚æœå½“å‰æšä¸¾åˆ°ç¬¬ n + 1 å±‚ï¼Œåˆ™è¾“å‡ºç­”æ¡ˆ
    if (u > n) {
        for (int i = 0; i < n; i ++ ) cout << path[i] << " ";
        cout << endl;
        return;
    }
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœå½“å‰æ•°æ²¡æœ‰è¢«éå†è¿‡ï¼Œåˆ™éå†å½“å‰æ•°
        if (!st[i]) {
            st[i] = true;
            path.push_back(i);
            // é€’å½’ä¸‹ä¸€å±‚
            dfs(u + 1, path);
            // å›æº¯
            path.pop_back();
            st[i] = false;
        }
    return;
}
int main() {
    scanf("%d", &n);
    dfs(1, path);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`DFS`

**ç¼åˆæ€ª**

#### [LeetCode 4. å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°](https://leetcode-cn.com/problems/median-of-two-sorted-arrays/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªå¤§å°åˆ†åˆ«ä¸º `m` å’Œ `n` çš„æ­£åºï¼ˆä»å°åˆ°å¤§ï¼‰æ•°ç»„ `nums1` å’Œ `nums2`ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›è¿™ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ ä¸­ä½æ•° ã€‚
>
>   ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åº”è¯¥ä¸º `O(log (m + n))` ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`nums1 = [1,3], nums2 = [2]`
>   è¾“å‡ºï¼š`2.00000`
>   è§£é‡Šï¼šåˆå¹¶æ•°ç»„ = `[1,2,3]` ï¼Œä¸­ä½æ•° `2`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`nums1 = [1,2], nums2 = [3,4]`
>   è¾“å‡ºï¼š`2.50000`
>   è§£é‡Šï¼šåˆå¹¶æ•°ç»„ = `[1,2,3,4]` ï¼Œä¸­ä½æ•° `(2 + 3) / 2 = 2.5`

**æç¤º**

>   +   $nums1.length == m$
>   +   $nums2.length == n$
>   +   $0 <= m <= 1000$
>   +   $0 <= n <= 1000$
>   +   $1 <= m + n <= 2000$
>   +   $-10^6 <= nums1[i], nums2[i] <= 10^6$

**æ‰‹å†™ç¨¿**

![411743](img/411743.png)

**ä»£ç **

```c++
class Solution {
public:
    // ä¿è¯nums1çš„é•¿åº¦å¤§äºç­‰äºnums2çš„é•¿åº¦
    int dfs(vector<int>& nums1, int l1, vector<int>& nums2, int l2, int k) {
        // å¦‚æœnums1çš„é•¿åº¦å°äºnums2çš„é•¿åº¦ï¼Œåˆ™äº¤æ¢ä¸¤ä¸ªæ•°ç»„
        if (nums1.size() < nums2.size()) return dfs(nums2, l2, nums1, l1, k);
        // å¦‚æœå¯»æ‰¾çš„æ˜¯ç¬¬ä¸€ä¸ªæ•°
        if (k == 1) {
            // å¦‚æœnums1ä¸ºç©ºï¼Œè¿”å›nums2çš„ç¬¬kä¸ªæ•°å­—
            if (l1 == nums1.size()) return nums2[l2 + k - 1];
            // å¦‚æœnums2ä¸ºç©ºï¼Œè¿”å›nums1çš„ç¬¬kä¸ªæ•°å­—
            else if (l2 == nums2.size()) return nums1[l1 + k - 1];
            // å¦‚æœnums1å’Œnums2éƒ½ä¸ç©ºï¼Œè¿”å›ä¸¤è€…çš„æœ€å°å€¼
            return min(nums1[l1 + k - 1], nums2[l2 + k - 1]);
        }
        // å¦‚æœnums2çš„é•¿åº¦å·²ç»åˆ°è¾¾æœ«å°¾ï¼Œè¿”å›nums1çš„ç¬¬kä¸ªæ•°å­—
        if (l2 == nums2.size()) return nums1[l1 + k - 1];
        // nums1çš„ç¬¬k / 2ä¸ªæ•°å­—
        int t1 = l1 + k / 2 - 1;
        // nums2çš„ç¬¬k / 2ä¸ªæ•°å­—
        int t2 = l2 + k / 2 - 1;
        // å› ä¸ºnums2æ•°ç»„é•¿åº¦çŸ­ï¼Œå› æ­¤ï¼Œå¦‚æœnums2çš„é•¿åº¦å¯èƒ½ä¸å¤Ÿk / 2ä¸ª
        // é‚£ä¹ˆï¼Œnums2çš„èµ·å§‹ä½ç½®ä¸ºnums2.size() - 1ï¼Œå³èµ·å§‹ä½ç½®ä¸ºæœ€åä¸€ä¸ªæ•°å­—
        if (t2 >= nums2.size()) t2 = nums2.size() - 1;
        if (nums1[t1] < nums2[t2])
            // æ¯æ¬¡æ’é™¤çš„æ•°å­—ä¸ä¸€å®šä¸ºk / 2ä¸ª
            // æ¯æ¬¡æ’é™¤çš„æ•°å­—ä¸ºä¸‹ä¸€æ¬¡èµ·å§‹ä½ç½® - åˆå§‹ä½ç½®
            return dfs(nums1, t1 + 1, nums2, l2, k - (t1 - l1 + 1));
        return dfs(nums1, l1, nums2, t2 + 1, k - (t2 - l2 + 1));
    }
    double findMedianSortedArrays(vector<int>& nums1, vector<int>& nums2) {
        int n = nums1.size() + nums2.size();
        if (n & 1) return dfs(nums1, 0, nums2, 0, n / 2 + 1);
        return (dfs(nums1, 0, nums2, 0, n / 2) + dfs(nums1, 0, nums2, 0, n / 2 + 1)) / 2.0;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`DFS`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**



#### [LeetCode 394. å­—ç¬¦ä¸²è§£ç ](https://leetcode-cn.com/problems/decode-string/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªç»è¿‡ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å®ƒè§£ç åçš„å­—ç¬¦ä¸²ã€‚
>
>   ç¼–ç è§„åˆ™ä¸º: `k[encoded_string]`ï¼Œè¡¨ç¤ºå…¶ä¸­æ–¹æ‹¬å·å†…éƒ¨çš„ `encoded_string` æ­£å¥½é‡å¤ `k` æ¬¡ã€‚æ³¨æ„ `k` ä¿è¯ä¸ºæ­£æ•´æ•°ã€‚
>
>   ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥å­—ç¬¦ä¸²æ€»æ˜¯æœ‰æ•ˆçš„ï¼›è¾“å…¥å­—ç¬¦ä¸²ä¸­æ²¡æœ‰é¢å¤–çš„ç©ºæ ¼ï¼Œä¸”è¾“å…¥çš„æ–¹æ‹¬å·æ€»æ˜¯ç¬¦åˆæ ¼å¼è¦æ±‚çš„ã€‚
>
>   æ­¤å¤–ï¼Œä½ å¯ä»¥è®¤ä¸ºåŸå§‹æ•°æ®ä¸åŒ…å«æ•°å­—ï¼Œæ‰€æœ‰çš„æ•°å­—åªè¡¨ç¤ºé‡å¤çš„æ¬¡æ•° `k` ï¼Œä¾‹å¦‚ä¸ä¼šå‡ºç°åƒ `3a` æˆ– `2[4]` çš„è¾“å…¥ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`s = "3[a]2[bc]"`
>   è¾“å‡ºï¼š`"aaabcbc"`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`s = "3[a2[c]]"`
>   è¾“å‡ºï¼š`"accaccacc"`

**ç¤ºä¾‹ 3**

>   è¾“å…¥ï¼š`s = "2[abc]3[cd]ef"`
>   è¾“å‡ºï¼š`"abcabccdcdcdef"`

**ç¤ºä¾‹ 4**

>   è¾“å…¥ï¼š`s = "abc3[cd]xyz"`
>   è¾“å‡ºï¼š`"abccdcdcdxyz"`

**æç¤º**

>   +   $1 <= s.length <= 30$
>   +   $s ç”±å°å†™è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œæ–¹æ‹¬å· '[]' ç»„æˆ$
>   +   $s ä¿è¯æ˜¯ä¸€ä¸ª æœ‰æ•ˆ çš„è¾“å…¥ã€‚$
>   +   $s ä¸­æ‰€æœ‰æ•´æ•°çš„å–å€¼èŒƒå›´ä¸º [1, 300]$

**æ‰‹å†™ç¨¿**

![4252109](img/4252109.png)

**ä»£ç ä¸€: æ ˆ**

```c++
class Solution {
public:
    string decodeString(string s) {
        stack<int> num;
        stack<string> str;
        int multi = 0;
        string res = "";
        for (int i = 0; i < s.size(); i ++ ) {
            if (s[i] >= 'a' && s[i] <= 'z' || s[i] >= 'A' && s[i] <= 'Z') res += s[i];
            else if (s[i] >= '0' && s[i] <= '9') multi = multi * 10 + s[i] - '0';
            else if (s[i] == '[') {
                num.push(multi);
                multi = 0;
                str.push(res);
                res = "";
            }
            else {
                // å–å‡ºå€æ•°
                multi = num.top(); num.pop();
                while (multi -- ) str.top() += res;
                // æ³¨æ„: æ­¤æ—¶çš„multiçš„å€¼ä¸º-1, éœ€è¦å°†å…¶é‡ç½®ä¸º0, æˆ–è€…ç›´æ¥ä½¿ç”¨å¦ä¸€ä¸ªå˜é‡kå³å¯
                multi = 0;
                res = str.top();
                str.pop();
            }
        }
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm), næ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦, mæ˜¯é‡å¤çš„æ•°é‡çš„æœ€å¤§å€¼$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ ˆ`

**ä»£ç äºŒ: é€’å½’**

```c++
class Solution {
public:
    string dfs(string &s, int &u) {
        string res = "";
        int multi = 0;
        while (u < s.size()) {
            if (s[u] >= 'a' && s[u] <= 'z' || s[u] >= 'A' && s[u] <= 'Z')
                res += s[u ++ ];
            else if (s[u] >= '0' && s[u] <= '9') multi = multi * 10 + s[u ++ ] - '0';
            else if (s[u] == '[') {
                // è®°å½•ä¸Šä¸€å±‚çš„å­—ç¬¦ä¸²
                string tmp = dfs(s, ++ u);
                // å€å¢multiæ¬¡
                while (multi -- ) res += tmp;
                // æ³¨æ„: æ­¤æ—¶çš„multiçš„å€¼ä¸º-1
                // é‡ç½®multiä¸º0, å¼€å§‹è®°å½•å½“å‰å±‚çš„ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²å€å¢çš„æ¬¡æ•°
                multi = 0;
            }
            else {
                // è·³è¿‡']'
                u ++;
                // è¿”å›res
                return res;
            }
        }
        return res;
    }
    string decodeString(string s) {
        int u = 0;
        return dfs(s, u);
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm), næ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦, mæ˜¯é‡å¤çš„æ•°é‡çš„æœ€å¤§å€¼$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`DFS`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**



### DFSä¹‹è¿é€šæ€§æ¨¡å‹

#### [AcWing 1112. è¿·å®«](https://www.acwing.com/problem/content/1114/)

**é¢˜ç›®æè¿°**

>   ä¸€å¤© `Extense` åœ¨æ£®æ—é‡Œæ¢é™©çš„æ—¶å€™ä¸å°å¿ƒèµ°å…¥äº†ä¸€ä¸ªè¿·å®«ï¼Œè¿·å®«å¯ä»¥çœ‹æˆæ˜¯ç”± `n âˆ— n` çš„æ ¼ç‚¹ç»„æˆï¼Œæ¯ä¸ªæ ¼ç‚¹åªæœ‰ `2` ç§çŠ¶æ€ï¼Œ`.`å’Œ`#`ï¼Œå‰è€…è¡¨ç¤ºå¯ä»¥é€šè¡Œåè€…è¡¨ç¤ºä¸èƒ½é€šè¡Œã€‚
>
>   åŒæ—¶å½“ `Extense` å¤„åœ¨æŸä¸ªæ ¼ç‚¹æ—¶ï¼Œä»–åªèƒ½ç§»åŠ¨åˆ°ä¸œå—è¥¿åŒ—(æˆ–è€…è¯´ä¸Šä¸‹å·¦å³)å››ä¸ªæ–¹å‘ä¹‹ä¸€çš„ç›¸é‚»æ ¼ç‚¹ä¸Šï¼Œ `Extense` æƒ³è¦ä»ç‚¹ `A` èµ°åˆ°ç‚¹ `B`ï¼Œé—®åœ¨ä¸èµ°å‡ºè¿·å®«çš„æƒ…å†µä¸‹èƒ½ä¸èƒ½åŠåˆ°ã€‚
>
>   å¦‚æœèµ·ç‚¹æˆ–è€…ç»ˆç‚¹æœ‰ä¸€ä¸ªä¸èƒ½é€šè¡Œ(ä¸º `#` )ï¼Œåˆ™çœ‹æˆæ— æ³•åŠåˆ°ã€‚
>
>   **æ³¨æ„**ï¼š`A`ã€`B`ä¸ä¸€å®šæ˜¯ä¸¤ä¸ªä¸åŒçš„ç‚¹ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œæ˜¯æµ‹è¯•æ•°æ®çš„ç»„æ•° `k`ï¼Œåé¢è·Ÿç€ `k` ç»„è¾“å…¥ã€‚
>
>   æ¯ç»„æµ‹è¯•æ•°æ®çš„ç¬¬ `1` è¡Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•° `n`ï¼Œè¡¨ç¤ºè¿·å®«çš„è§„æ¨¡æ˜¯ `n âˆ— n` çš„ã€‚
>
>   æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ª `n âˆ— n` çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­çš„å…ƒç´ ä¸º`.`æˆ–è€…`#`ã€‚
>
>   å†æ¥ä¸‹æ¥ä¸€è¡Œæ˜¯ `4` ä¸ªæ•´æ•° $h_a,l_a,h_b,l_b$ï¼Œæè¿° `A` å¤„åœ¨ç¬¬ $h_a$ è¡Œ, ç¬¬ $l_a$ åˆ—ï¼Œ`B` å¤„åœ¨ç¬¬ $h_b$ è¡Œ, ç¬¬ $l_b$ åˆ—ã€‚
>
>   æ³¨æ„åˆ° $h_a,l_a,h_b,l_b$ å…¨éƒ¨æ˜¯ä» `0` å¼€å§‹è®¡æ•°çš„ã€‚

**è¾“å‡ºæ ¼å¼**

>   `k`è¡Œï¼Œæ¯è¡Œè¾“å‡ºå¯¹åº”ä¸€ä¸ªè¾“å…¥ã€‚
>
>   èƒ½åŠåˆ°åˆ™è¾“å‡ºâ€œ`YES`â€ï¼Œå¦åˆ™è¾“å‡ºâ€œ`NO`â€ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
2
3
.##
..#
#..
0 0 2 2
5
.....
###.#
..#..
###..
...#.
0 0 4 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
YES
NO
```

**æ‰‹å†™ç¨¿**

>   1.   ä»èµ·ç‚¹å¼€å§‹æœç´¢ï¼Œéå†å››ä¸ªæ–¹å‘å³å¯

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110;
int n, x1, y1, x2, y2, T;
int dx[4] = {-1, 0, 1, 0};
int dy[4] = {0, 1, 0, -1};
char g[N][N];
bool st[N][N];
bool dfs(int x, int y) {
    // å¦‚æœg[x][y]ä¸èƒ½èµ°ï¼Œè¿”å›false
    if (g[x][y] == '#') return false;
    // å¦‚æœåˆ°è¾¾ç»ˆç‚¹ï¼Œè¯´æ˜å­˜åœ¨ä¸€æ¡åˆæ³•è·¯å¾„ï¼Œè¿”å›true
    if (x == x2 && y == y2) return true;
    st[x][y] = true;
    // éå†å››ä¸ªæ–¹å‘
    for (int i = 0; i < 4; i ++ ) {
        int tx = x + dx[i];
        int ty = y + dy[i];
        if (tx < 0 || tx >= n || ty < 0 || ty >= n || st[tx][ty] || g[tx][ty] == '#')
            continue;
        // å¦‚æœä»(tx, ty)èƒ½æœåˆ°ç­”æ¡ˆï¼Œè¿”å›true
        if (dfs(tx, ty)) return true;
    }
    return false;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        scanf("%d", &n);
        for (int i = 0; i < n; i ++ ) scanf("%s", g[i]);
        scanf("%d%d%d%d", &x1, &y1, &x2, &y2);
        // å¤šç»„æµ‹è¯•æ•°æ®
        // è®°å¾—æ¯æ¬¡åŠ¡å¿…è¦åˆå§‹åŒ–
        memset(st, 0, sizeof st);
        if (dfs(x1, y1)) puts("YES");
        else puts("NO");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**

`DFS`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**

#### [AcWing 1113. çº¢ä¸é»‘](https://www.acwing.com/problem/content/1115/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸€é—´é•¿æ–¹å½¢çš„æˆ¿å­ï¼Œåœ°ä¸Šé“ºäº†çº¢è‰²ã€é»‘è‰²ä¸¤ç§é¢œè‰²çš„æ­£æ–¹å½¢ç“·ç –ã€‚
>
>   ä½ ç«™åœ¨å…¶ä¸­ä¸€å—é»‘è‰²çš„ç“·ç –ä¸Šï¼Œåªèƒ½å‘ç›¸é‚»ï¼ˆä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘ï¼‰çš„é»‘è‰²ç“·ç –ç§»åŠ¨ã€‚
>
>   è¯·å†™ä¸€ä¸ªç¨‹åºï¼Œè®¡ç®—ä½ æ€»å…±èƒ½å¤Ÿåˆ°è¾¾å¤šå°‘å—é»‘è‰²çš„ç“·ç –ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…æ‹¬å¤šä¸ªæ•°æ®é›†åˆã€‚
>
>   æ¯ä¸ªæ•°æ®é›†åˆçš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•° `W` å’Œ `H`ï¼Œåˆ†åˆ«è¡¨ç¤º `x` æ–¹å‘å’Œ `y` æ–¹å‘ç“·ç –çš„æ•°é‡ã€‚
>
>   åœ¨æ¥ä¸‹æ¥çš„ `H` è¡Œä¸­ï¼Œæ¯è¡ŒåŒ…æ‹¬ `W` ä¸ªå­—ç¬¦ã€‚æ¯ä¸ªå­—ç¬¦è¡¨ç¤ºä¸€å—ç“·ç –çš„é¢œè‰²ï¼Œè§„åˆ™å¦‚ä¸‹
>
>   1ï¼‰â€˜`.`â€™ï¼šé»‘è‰²çš„ç“·ç –ï¼›
>   2ï¼‰â€˜`#`â€™ï¼šçº¢è‰²çš„ç“·ç –ï¼›
>   3ï¼‰â€˜`@`â€™ï¼šé»‘è‰²çš„ç“·ç –ï¼Œå¹¶ä¸”ä½ ç«™åœ¨è¿™å—ç“·ç –ä¸Šã€‚è¯¥å­—ç¬¦åœ¨æ¯ä¸ªæ•°æ®é›†åˆä¸­å”¯ä¸€å‡ºç°ä¸€æ¬¡ã€‚
>
>   å½“åœ¨ä¸€è¡Œä¸­è¯»å…¥çš„æ˜¯ä¸¤ä¸ªé›¶æ—¶ï¼Œè¡¨ç¤ºè¾“å…¥ç»“æŸã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹æ¯ä¸ªæ•°æ®é›†åˆï¼Œåˆ†åˆ«è¾“å‡ºä¸€è¡Œï¼Œæ˜¾ç¤ºä½ ä»åˆå§‹ä½ç½®å‡ºå‘èƒ½åˆ°è¾¾çš„ç“·ç –æ•°(è®°æ•°æ—¶åŒ…æ‹¬åˆå§‹ä½ç½®çš„ç“·ç –)ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤W,Hâ‰¤20$

**è¾“å…¥æ ·ä¾‹**

```c++
6 9 
....#. 
.....# 
...... 
...... 
...... 
...... 
...... 
#@...# 
.#..#. 
0 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
45
```

**æ‰‹å†™ç¨¿**

>   1.   æ‰¾åˆ°äººæ‰€ç«™çš„ä½ç½®ï¼Œåšä¸€é `Flood Fill` ç®—æ³•å³å¯
>   2.   æ³¨æ„ `dfs` å‡½æ•°æ‰€ä»£è¡¨çš„å«ä¹‰

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 25;
int n, m;
int dx[4] = {-1, 0, 1, 0};
int dy[4] = {0, 1, 0, -1};
bool st[N][N];
char g[N][N];
// dfsè¡¨ç¤ºçš„å«ä¹‰æ˜¯ä»å½“å‰ç‚¹(x, y)å‡ºå‘ï¼Œèƒ½åˆ°è¾¾çš„ç“·ç –çš„æ•°ç›®
int dfs(int x, int y) {
    // åˆšå¼€å§‹è¿™ä¸ªæ•°è¢«é€‰ä¸Š
    int cnt = 1;
    // æ ‡è®°ä¸‹ï¼Œç›®çš„æ˜¯ä½¿å¾—æ¯ä¸ªæ•°å­—åªä¼šè¢«éå†ä¸€æ¬¡
    st[x][y] = true;
    // éå†å››ä¸ªæ–¹å‘
    for (int i = 0; i < 4; i ++ ) {
        int tx = x + dx[i];
        int ty = y + dy[i];
        if (tx < 0 || tx >= n || ty < 0 || ty >= m || st[tx][ty] || g[tx][ty] == '#')
            continue;
        cnt += dfs(tx, ty);
    }
    return cnt;
}
int main() {
    while (~scanf("%d%d", &m, &n), n || m) {
        for (int i = 0; i < n; i ++ ) scanf("%s", g[i]);
        int x, y;
        for (int i = 0; i < n; i ++ )
            for (int j = 0; j < m; j ++ )
                if (g[i][j] == '@') {
                    x = i;
                    y = j;
                    break;
                }
        // å¤šç»„æµ‹è¯•æ•°æ®
        // æ¯æ¬¡éƒ½éœ€è¦åˆå§‹åŒ–
        memset(st, 0, sizeof st);
        cout << dfs(x, y) << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**

`DFS`ã€`Flood Fill`

**ç¼åˆæ€ª**



### DFSä¹‹æœç´¢é¡ºåº

#### [AcWing 1116. é©¬èµ°æ—¥](https://www.acwing.com/problem/content/1118/)

**é¢˜ç›®æè¿°**

>   é©¬åœ¨ä¸­å›½è±¡æ£‹ä»¥æ—¥å­—å½¢è§„åˆ™ç§»åŠ¨ã€‚
>
>   è¯·ç¼–å†™ä¸€æ®µç¨‹åºï¼Œç»™å®š `n âˆ— m` å¤§å°çš„æ£‹ç›˜ï¼Œä»¥åŠé©¬çš„åˆå§‹ä½ç½® `(xï¼Œy)`ï¼Œè¦æ±‚ä¸èƒ½é‡å¤ç»è¿‡æ£‹ç›˜ä¸Šçš„åŒä¸€ä¸ªç‚¹ï¼Œè®¡ç®—é©¬å¯ä»¥æœ‰å¤šå°‘é€”å¾„éå†æ£‹ç›˜ä¸Šçš„æ‰€æœ‰ç‚¹ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸ºæ•´æ•° `T`ï¼Œè¡¨ç¤ºæµ‹è¯•æ•°æ®ç»„æ•°ã€‚
>
>   æ¯ä¸€ç»„æµ‹è¯•æ•°æ®åŒ…å«ä¸€è¡Œï¼Œä¸ºå››ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«ä¸ºæ£‹ç›˜çš„å¤§å°ä»¥åŠåˆå§‹ä½ç½®åæ ‡ `n,m,x,y`ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æµ‹è¯•æ•°æ®åŒ…å«ä¸€è¡Œï¼Œä¸ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºé©¬èƒ½éå†æ£‹ç›˜çš„é€”å¾„æ€»æ•°ï¼Œè‹¥æ— æ³•éå†æ£‹ç›˜ä¸Šçš„æ‰€æœ‰ç‚¹åˆ™è¾“å‡º `0`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Tâ‰¤9,$
>   +   $1â‰¤m,nâ‰¤9,$
>   +   $0â‰¤xâ‰¤nâˆ’1,$
>   +   $0â‰¤yâ‰¤mâˆ’1$

**è¾“å…¥æ ·ä¾‹**

```c++
1
5 4 0 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
32
```

**æ‰‹å†™ç¨¿**

>   1.   éå† `8` ä¸ªæ–¹å‘å³å¯

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 15;
int n, m, ans, T;
int st[N][N];
int dx[8] = {-2, -2, -1, 1, 2, 2, 1, -1};
int dy[8] = {-1, 1, 2, 2, 1, -1, -2, -2};
void dfs(int x, int y, int cnt) {
    // å¦‚æœå·²ç»éå†äº†n * mä¸ªæ ¼å­
    if (cnt == n * m) {
        ans ++;
        return;
    }
    st[x][y] = true;
    // éå†8ä¸ªæ–¹å‘
    for (int i = 0; i < 8; i ++ ) {
        int tx = x + dx[i];
        int ty = y + dy[i];
        if (tx < 0 || tx >= n || ty < 0 || ty >= m || st[tx][ty])
            continue;
        dfs(tx, ty, cnt + 1);
    }
    st[x][y] = false;
    return;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        int x, y;
        scanf("%d%d%d%d", &n, &m, &x, &y);
        ans = 0;
        dfs(x, y, 1);
        cout << ans << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**

`DFS`

**ç¼åˆæ€ª**

#### [AcWing 1117. å•è¯æ¥é¾™](https://www.acwing.com/problem/content/1119/)

**é¢˜ç›®æè¿°**

>   å•è¯æ¥é¾™æ˜¯ä¸€ä¸ªä¸æˆ‘ä»¬ç»å¸¸ç©çš„æˆè¯­æ¥é¾™ç›¸ç±»ä¼¼çš„æ¸¸æˆã€‚
>
>   ç°åœ¨æˆ‘ä»¬å·²çŸ¥ä¸€ç»„å•è¯ï¼Œä¸”ç»™å®šä¸€ä¸ªå¼€å¤´çš„å­—æ¯ï¼Œè¦æ±‚å‡ºä»¥è¿™ä¸ªå­—æ¯å¼€å¤´çš„æœ€é•¿çš„â€œé¾™â€ï¼Œæ¯ä¸ªå•è¯æœ€å¤šè¢«ä½¿ç”¨ä¸¤æ¬¡ã€‚
>
>   åœ¨ä¸¤ä¸ªå•è¯ç›¸è¿æ—¶ï¼Œå…¶é‡åˆéƒ¨åˆ†åˆä¸ºä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ `beast` å’Œ `astonish` ï¼Œå¦‚æœæ¥æˆä¸€æ¡é¾™åˆ™å˜ä¸º `beastonish`ã€‚
>
>   æˆ‘ä»¬å¯ä»¥ä»»æ„é€‰æ‹©é‡åˆéƒ¨åˆ†çš„é•¿åº¦ï¼Œä½†å…¶é•¿åº¦å¿…é¡»å¤§äºç­‰äº`1`ï¼Œä¸”ä¸¥æ ¼å°äºä¸¤ä¸ªä¸²çš„é•¿åº¦ï¼Œä¾‹å¦‚ `at` å’Œ `atide` é—´ä¸èƒ½ç›¸è¿ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥çš„ç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªå•ç‹¬çš„æ•´æ•° `n` è¡¨ç¤ºå•è¯æ•°ï¼Œä»¥ä¸‹ `n` è¡Œæ¯è¡Œæœ‰ä¸€ä¸ªå•è¯ï¼ˆåªå«æœ‰å¤§å†™æˆ–å°å†™å­—æ¯ï¼Œé•¿åº¦ä¸è¶…è¿‡`20`ï¼‰ï¼Œè¾“å…¥çš„æœ€åä¸€è¡Œä¸ºä¸€ä¸ªå•ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºâ€œé¾™â€å¼€å¤´çš„å­—æ¯ã€‚
>
>   ä½ å¯ä»¥å‡å®šä»¥æ­¤å­—æ¯å¼€å¤´çš„â€œé¾™â€ä¸€å®šå­˜åœ¨ã€‚

**è¾“å‡ºæ ¼å¼**

>   åªéœ€è¾“å‡ºä»¥æ­¤å­—æ¯å¼€å¤´çš„æœ€é•¿çš„â€œé¾™â€çš„é•¿åº¦ã€‚

**æ•°æ®èŒƒå›´**

>   +   $nâ‰¤20$

**è¾“å…¥æ ·ä¾‹**

```c++
5
at
touch
cheat
choose
tact
a
```

**è¾“å‡ºæ ·ä¾‹**

```c++
23
```

**æç¤º**

>   è¿æˆçš„â€œé¾™â€ä¸º `atoucheatactactouchoose`ã€‚

**æ‰‹å†™ç¨¿**

![3301026](img/3301026.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 25;
int n, ans;
char start;
int g[N][N], used[N];
string word[N];
void dfs(string wd, int last) {
    // æ›´æ–°ç­”æ¡ˆ
    ans = max(ans, (int)wd.size());
    // æ ‡è®°ä¸ºå½“å‰å•è¯å·²ç»è¢«ä½¿ç”¨ä¸€æ¬¡
    used[last] ++;
    for (int i = 0; i < n; i ++ )
        // å¦‚æœä¸Šä¸€ä¸ªå•è¯ä¸å½“å‰å•è¯æœ‰è¿æ¥å¹¶ä¸”å½“å‰å•è¯è¢«ä½¿ç”¨çš„æ¬¡æ•°ä¸¥æ ¼å°äº2
        if (g[last][i] && used[i] < 2)
            // æ‹¼æ¥å°±å®Œäº‹äº†
            dfs(wd + word[i].substr(g[last][i]), i);
    // å›æº¯
    used[last] --;
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ ) cin >> word[i];
    scanf(" %c", &start);
    // é¢„å¤„ç†æ¯ä¸ªå•è¯å¯ä¸å“ªäº›å•è¯ç›¸è¿æ¥
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ ) {
            string a = word[i], b = word[j];
            // è‹¥å¯ä»¥è¿æ¥ï¼Œåˆ™é€‰æ‹©è¿æ¥æœ€çŸ­çš„é•¿åº¦
            for (int k = 1; k < min(a.size(), b.size()); k ++ )
                if (a.substr(a.size() - k) == b.substr(0, k)) {
                    g[i][j] = k;
                    break;
                }
        }
    for (int i = 0; i < n; i ++ )
        // ç¡®å®šæœç´¢èµ·ç‚¹
        if (word[i][0] == start)
            dfs(word[i], i);
    cout << ans << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`DFS`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**

#### [AcWing 1118. åˆ†æˆäº’è´¨ç»„](https://www.acwing.com/problem/content/1120/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` ä¸ªæ­£æ•´æ•°ï¼Œå°†å®ƒä»¬åˆ†ç»„ï¼Œä½¿å¾—æ¯ç»„ä¸­ä»»æ„ä¸¤ä¸ªæ•°äº’è´¨ã€‚
>
>   è‡³å°‘è¦åˆ†æˆå¤šå°‘ä¸ªç»„ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•° `n`ã€‚
>
>   ç¬¬äºŒè¡Œæ˜¯ `n` ä¸ªä¸å¤§äº `10000` çš„æ­£æ•´æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå³æœ€å°‘éœ€è¦çš„ç»„æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10$

**è¾“å…¥æ ·ä¾‹**

```c++
6
14 20 33 117 143 175
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![3311220](img/3311220.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 15;
int n, ans = N;
int p[N];
bool st[N];
int group[N][N];
int gcd(int a, int b) {
    if (!b) return a;
    return gcd(b, a % b);
}
bool check(int g[], int gc, int k) {
    for (int i = 0; i < gc; i ++ )
        if (gcd(p[g[i]], p[k]) > 1) return false;
    return true;
}
/*
å‚æ•°è§£é‡Šï¼š
    ã€å½“å‰ç»„ã€‘çš„ç¼–å·
    ã€å½“å‰ç»„ã€‘çš„ä¸ªæ•°
    ã€å½“å‰ç»„ã€‘æœ€åä¸€ä¸ªæ•°å¯¹åº”åŸæ•°ç»„çš„ä¸‹æ ‡ä½ç½®
    ã€æ‰€æœ‰ç»„ã€‘ä¸€å…±æšä¸¾çš„æ•°å­—ä¸ªæ•°
*/
// æ³¨æ„æ¯ä¸ªå˜é‡çš„å«ä¹‰ï¼ï¼
void dfs(int u, int gc, int gi, int cnt) {
    // å½“å‰å·²ç»æœç´¢åˆ°çš„æœ€ä¼˜è§£ä¸ºans
    // å¦‚æœå¦ä¸€æ¡è·¯å¾„æœç´¢åˆ°çš„è§£å¤§äºæœ€ä¼˜è§£ï¼Œè¯´æ˜ä¸€å®šä¸æ˜¯æœ€ä¼˜è§£ï¼Œåˆ™ç›´æ¥è¿”å›
    if (u >= ans) return;
    // å½“å‰å·²ç»æšä¸¾å®Œã€æ‰€æœ‰çš„æ•°å­—ã€‘
    if (cnt == n) {
        // æ›´æ–°ç­”æ¡ˆ
        ans = u;
        return;
    }
    int flag = true;
    // æšä¸¾æ‰€æœ‰æ•°å­—
    for (int i = gi; i < n; i ++ )
        // å¦‚æœå½“å‰çš„æ•°å­—æ²¡æœ‰è¢«è®¿é—®è¿‡å¹¶ä¸”å½“å‰æ•°å­—å¯ä»¥æ”¾åˆ°å½“å‰çš„ç»„ä¸­
        if (!st[i] && check(group[u], gc, i)) {
            // æ ‡è®°å·²ç»è¢«è®¿é—®è¿‡
            st[i] = true;
            // å°†å½“å‰æ•°æ”¾åˆ°å½“å‰ç»„
            group[u][gc] = i;
            // é€’å½’ä¸‹ä¸€å±‚
            dfs(u, gc + 1, i + 1, cnt + 1);
            // å¤–éƒ¨æœç´¢
            // å›æº¯
            flag = false;
            st[i] = false;
        }
    // å¦‚æœå½“å‰æ•°ä¸èƒ½æ”¾ç½®åˆ°å½“å‰ç»„
    // æ–°å¼€ä¸€ä¸ªç»„å³å¯
    if (flag) dfs(u + 1, 0, 0, cnt);
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ ) scanf("%d", &p[i]);
    /*
    å‚æ•°è§£é‡Šï¼š
        ã€å½“å‰ç»„ã€‘çš„ç¼–å·
        ã€å½“å‰ç»„ã€‘çš„ä¸ªæ•°
        ã€å½“å‰ç»„ã€‘æœ€åä¸€ä¸ªæ•°å¯¹åº”åŸæ•°ç»„çš„ä¸‹æ ‡ä½ç½®
        ã€æ‰€æœ‰ç»„ã€‘ä¸€å…±æšä¸¾çš„æ•°å­—ä¸ªæ•°
    */
    dfs(1, 0, 0, 0);
    cout << ans << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`BFS`

**ç¼åˆæ€ª**

### `DFS` ä¹‹å‰ªæä¸ä¼˜åŒ–

#### å‰ªææ¦‚è®º

![410959](img/410959.png)

#### [AcWing 165. å°çŒ«çˆ¬å±±](https://www.acwing.com/problem/content/167/)

**é¢˜ç›®æè¿°**

>   ç¿°ç¿°å’Œè¾¾è¾¾é¥²å…»äº† `N` åªå°çŒ«ï¼Œè¿™å¤©ï¼Œå°çŒ«ä»¬è¦å»çˆ¬å±±ã€‚
>
>   ç»å†äº†åƒè¾›ä¸‡è‹¦ï¼Œå°çŒ«ä»¬ç»ˆäºçˆ¬ä¸Šäº†å±±é¡¶ï¼Œä½†æ˜¯ç–²å€¦çš„å®ƒä»¬å†ä¹Ÿä¸æƒ³å¾’æ­¥èµ°ä¸‹å±±äº†ï¼ˆå‘œå’•>_<ï¼‰ã€‚
>
>   ç¿°ç¿°å’Œè¾¾è¾¾åªå¥½èŠ±é’±è®©å®ƒä»¬åç´¢é“ä¸‹å±±ã€‚
>
>   ç´¢é“ä¸Šçš„ç¼†è½¦æœ€å¤§æ‰¿é‡é‡ä¸º `W`ï¼Œè€Œ `N` åªå°çŒ«çš„é‡é‡åˆ†åˆ«æ˜¯ $C_1ã€C_2â€¦â€¦C_N$ã€‚
>
>   å½“ç„¶ï¼Œæ¯è¾†ç¼†è½¦ä¸Šçš„å°çŒ«çš„é‡é‡ä¹‹å’Œä¸èƒ½è¶…è¿‡ `W`ã€‚
>
>   æ¯ç§Ÿç”¨ä¸€è¾†ç¼†è½¦ï¼Œç¿°ç¿°å’Œè¾¾è¾¾å°±è¦ä»˜ `1` ç¾å…ƒï¼Œæ‰€ä»¥ä»–ä»¬æƒ³çŸ¥é“ï¼Œæœ€å°‘éœ€è¦ä»˜å¤šå°‘ç¾å…ƒæ‰èƒ½æŠŠè¿™ `N` åªå°çŒ«éƒ½è¿é€ä¸‹å±±ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œï¼šåŒ…å«ä¸¤ä¸ªç”¨ç©ºæ ¼éš”å¼€çš„æ•´æ•°ï¼Œ`N` å’Œ `W`ã€‚
>
>   ç¬¬ `2..N + 1` è¡Œï¼šæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œå…¶ä¸­ç¬¬ `i + 1` è¡Œçš„æ•´æ•°è¡¨ç¤ºç¬¬ `i` åªå°çŒ«çš„é‡é‡ $C_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°‘éœ€è¦å¤šå°‘ç¾å…ƒï¼Œä¹Ÿå°±æ˜¯æœ€å°‘éœ€è¦å¤šå°‘è¾†ç¼†è½¦ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 18,$
>   +   $1 â‰¤ C_i â‰¤ W â‰¤ 10^8$

**è¾“å…¥æ ·ä¾‹**

```c++
5 1996
1
2
1994
12
29
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
```

**æ‰‹å†™ç¨¿**

![411127](img/411127.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 20;
int n, m, ans = N;
int w[N], sum[N];
void dfs(int u, int car) {
    // æœ€ä¼˜æ€§å‰ªæ
    if (car >= ans) return;
    // å¦‚æœå°†å…¨éƒ¨å°çŒ«éƒ½æšä¸¾ç»“æŸ
    if (u == n) {
        ans = car;
        return;
    }
    // æšä¸¾æ¯è¾†è½¦
    for (int i = 0; i < car; i ++ )
        if (sum[i] + w[u] <= m) {
            sum[i] += w[u];
            dfs(u + 1, car);
            sum[i] -= w[u];
        }
    // æ–°å¼€ä¸€è¾†è½¦
    sum[car] = w[u];
    // æ³¨æ„ï¼šè½¦çš„æ•°é‡ + 1ã€æ–°å¼€ä¸€è¾†è½¦ã€‘
    dfs(u + 1, car + 1);
    sum[car] = 0;
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n; i ++ ) scanf("%d", &w[i]);
    // æŒ‰ç…§ä½“é‡ä»é‡åˆ°è½»æ’åº
    sort(w, w + n, [&](int a, int b) {
        return a > b;
    });
    // ä»ç¬¬0åªå°çŒ«å¼€å§‹æšä¸¾
    // å½“å‰è½¦çš„æ•°é‡ä¸º0
    dfs(0, 0);
    cout << ans << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`DFS`ã€`å‰ªæ`

**ç¼åˆæ€ª**

#### [AcWing 166. æ•°ç‹¬](https://www.acwing.com/problem/content/168/)

**é¢˜ç›®æè¿°**

>   æ•°ç‹¬æ˜¯ä¸€ç§ä¼ ç»Ÿç›Šæ™ºæ¸¸æˆï¼Œä½ éœ€è¦æŠŠä¸€ä¸ª `9 Ã— 9` çš„æ•°ç‹¬è¡¥å……å®Œæ•´ï¼Œä½¿å¾—å›¾ä¸­æ¯è¡Œã€æ¯åˆ—ã€æ¯ä¸ª `3 Ã— 3` çš„ä¹å®«æ ¼å†…æ•°å­— `1 âˆ¼ 9` å‡æ°å¥½å‡ºç°ä¸€æ¬¡ã€‚
>
>   è¯·ç¼–å†™ä¸€ä¸ªç¨‹åºå¡«å†™æ•°ç‹¬ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚
>
>   æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å ä¸€è¡Œï¼ŒåŒ…å« `81` ä¸ªå­—ç¬¦ï¼Œä»£è¡¨æ•°ç‹¬çš„ `81` ä¸ªæ ¼å†…æ•°æ®ï¼ˆé¡ºåºæ€»ä½“ç”±ä¸Šåˆ°ä¸‹ï¼ŒåŒè¡Œç”±å·¦åˆ°å³ï¼‰ã€‚
>
>   æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªæ•°å­—ï¼ˆ`1 âˆ’ 9`ï¼‰æˆ–ä¸€ä¸ª `.`ï¼ˆè¡¨ç¤ºå°šæœªå¡«å……ï¼‰ã€‚
>
>   æ‚¨å¯ä»¥å‡è®¾è¾“å…¥ä¸­çš„æ¯ä¸ªè°œé¢˜éƒ½åªæœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚
>
>   æ–‡ä»¶ç»“å°¾å¤„ä¸ºåŒ…å«å•è¯ `end` çš„å•è¡Œï¼Œè¡¨ç¤ºè¾“å…¥ç»“æŸã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¾“å‡ºä¸€è¡Œæ•°æ®ï¼Œä»£è¡¨å¡«å……å®Œå…¨åçš„æ•°ç‹¬ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
4.....8.5.3..........7......2.....6.....8.4......1.......6.3.7.5..2.....1.4......
......52..8.4......3...9...5.1...6..2..7........3.....6...1..........7.4.......3.
end
```

**è¾“å‡ºæ ·ä¾‹**

```c++
417369825632158947958724316825437169791586432346912758289643571573291684164875293
416837529982465371735129468571298643293746185864351297647913852359682714128574936
```

**æ‰‹å†™ç¨¿**

![421005](img/421005.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 9, M = 100;
char g[M];
int row[N], col[N], ones[1 << N], map[1 << N];
int tri[3][3];
// åˆå§‹åŒ–
void init() {
    for (int i = 0; i < N; i ++ )
        row[i] = col[i] = (1 << N) - 1;
    for (int i = 0; i < 3; i ++ )
        for (int j = 0; j < 3; j ++ )
            tri[i][j] = (1 << N) - 1;
    return;
}
void draw(int x, int y, int t, bool is_set) {
    if (is_set) g[x * N + y] = t + '1';
    else g[x * N + y] = '.';
    int v = 1 << t;
    // å°†vå–å
    if (!is_set) v = -v;
    // å°†væŠ æ‰
    row[x] -= v;
    col[y] -= v;
    tri[x / 3][y / 3] -= v;
    return;
}
int get(int x, int y) {
    return row[x] & col[y] & tri[x / 3][y / 3];
}
int lowbit(int x) {
    return x & -x;
}
bool dfs(int cnt) {
    if (!cnt) return true;
    int x, y, Max = 15;
    for (int i = 0; i < N; i ++ )
        for (int j = 0; j < N; j ++ )
            if (g[i * N + j] == '.') {
                int state = get(i, j);
                // å¯»æ‰¾å¡«å†™é€‰æ‹©æœ€å°‘çš„
                // äº§ç”Ÿçš„åˆ†æ”¯è¾ƒå°‘
                if (ones[state] < Max) {
                    x = i;
                    y = j;
                    Max = ones[state];
                }
            }
    int state = get(x, y);
    for (int i = state; i; i -= lowbit(i)) {
        int t = map[lowbit(i)];
        draw(x, y, t, true);
        if (dfs(cnt - 1)) return true;
        draw(x, y, t, false);
    }
    return false;
}
int main() {
    // å­˜å‚¨æ˜ å°„ã€æ‰‹å†™ç¨¿è¯´æ˜ã€‘
    for (int i = 0; i < N; i ++ ) map[1 << i] = i;
    // ç»Ÿè®¡æ¯ä¸ªæ•°ä¸­å­˜åœ¨çš„1ä¸ªæ•°
    for (int i = 0; i < 1 << N; i ++ )
        for (int j = 0; j < N; j ++ )
            ones[i] += i >> j & 1;
    while (~scanf("%s", g), g[0] != 'e') {
        // åˆå§‹åŒ–
        init();
        // ç»Ÿè®¡å¯ä»¥å¡«å†™çš„æ•°ç›®
        int cnt = 0;
        for (int i = 0; i < N; i ++ )
            for (int j = 0; j < N; j ++ ) {
                char c = g[i * N + j];
                // å¦‚æœå·²ç»å¡«å†™æ•°å­—
                if (c != '.') {
                    int t = c - '1';
                    // å°†æ­¤ç‚¹æ ‡è®°ä¸ºå·²ç»å¡«å†™è¿‡
                    draw(i, j, t, true);
                }
                // å¯ä»¥å¡«å†™çš„æ•°ç›® ++
                else cnt ++;
            }
        dfs(cnt);
        puts(g);
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(1 << N)$

**æ ‡ç­¾**

`DFS`ã€`å‰ªæ`

**ç¼åˆæ€ª**

#### [AcWing 167. æœ¨æ£’](https://www.acwing.com/problem/content/169/)

**é¢˜ç›®æè¿°**

>   ä¹”æ²»æ‹¿æ¥ä¸€ç»„ç­‰é•¿çš„æœ¨æ£’ï¼Œå°†å®ƒä»¬éšæœºåœ°ç æ–­ï¼Œä½¿å¾—æ¯ä¸€èŠ‚æœ¨æ£çš„é•¿åº¦éƒ½ä¸è¶…è¿‡ `50` ä¸ªé•¿åº¦å•ä½ã€‚
>
>   ç„¶åä»–åˆæƒ³æŠŠè¿™äº›æœ¨æ£æ¢å¤åˆ°ä¸ºè£æˆªå‰çš„çŠ¶æ€ï¼Œä½†å¿˜è®°äº†åˆå§‹æ—¶æœ‰å¤šå°‘æœ¨æ£’ä»¥åŠæœ¨æ£’çš„åˆå§‹é•¿åº¦ã€‚
>
>   è¯·ä½ è®¾è®¡ä¸€ä¸ªç¨‹åºï¼Œå¸®åŠ©ä¹”æ²»è®¡ç®—æœ¨æ£’çš„å¯èƒ½æœ€å°é•¿åº¦ã€‚
>
>   æ¯ä¸€èŠ‚æœ¨æ£çš„é•¿åº¦éƒ½ç”¨å¤§äºé›¶çš„æ•´æ•°è¡¨ç¤ºã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æ•°æ®ï¼Œæ¯ç»„æ•°æ®åŒ…æ‹¬ä¸¤è¡Œã€‚
>
>   ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªä¸è¶…è¿‡ `64` çš„æ•´æ•°ï¼Œè¡¨ç¤ºç æ–­ä¹‹åå…±æœ‰å¤šå°‘èŠ‚æœ¨æ£ã€‚
>
>   ç¬¬äºŒè¡Œæ˜¯æˆªæ–­ä»¥åï¼Œæ‰€å¾—åˆ°çš„å„èŠ‚æœ¨æ£çš„é•¿åº¦ã€‚
>
>   åœ¨æœ€åä¸€ç»„æ•°æ®ä¹‹åï¼Œæ˜¯ä¸€ä¸ªé›¶ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸ºæ¯ç»„æ•°æ®ï¼Œåˆ†åˆ«è¾“å‡ºåŸå§‹æœ¨æ£’çš„å¯èƒ½æœ€å°é•¿åº¦ï¼Œæ¯ç»„æ•°æ®å ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $æ•°æ®ä¿è¯æ¯ä¸€èŠ‚æœ¨æ£çš„é•¿åº¦å‡ä¸å¤§äº 50ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
9
5 2 1 5 2 1 5 2 1
4
1 2 3 4
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
6
5
```

**æ‰‹å†™ç¨¿**

![421600](img/421600.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
#include <cstring>
using namespace std;
const int N = 70;
int n, sum, length;
int g[N], st[N];
/*
    å‚æ•°è¯´æ˜ï¼š
        å¤§æ£çš„ç¼–å·
        ç»„æˆå¤§æ£çš„å°æ£é•¿åº¦å’Œ
        å°æ£çš„èµ·å§‹ä½ç½®
*/
bool dfs(int u, int cur, int start) {
    // å¦‚æœæ‰€æœ‰å¤§æ£çš„é•¿åº¦å’Œç­‰äºsumï¼Œè¯´æ˜æ‰¾åˆ°ä¸€ç»„ç­”æ¡ˆï¼Œç›´æ¥è¿”å›
    if (u * length == sum) return true;
    // å¦‚æœå½“å‰å¤§æ£å·²ç»è¢«ç»„è£…å®Œæ¯•ï¼Œåˆ™å¼€å§‹ç»„è£…ä¸‹ä¸€æ ¹å¤§æ£
    if (cur == length) return dfs(u + 1, 0, 0);
    // å‰ªæ 2.I (2)
    // ç»„åˆå‹æšä¸¾
    for (int i = start; i < n; i ++ ) {
        if (!st[i] && cur + g[i] <= length) {
            st[i] = true;
            if (dfs(u, cur + g[i], i + 1)) return true;
            st[i] = false;
            // å‰ªæ 2.III (1)
            int j = i + 1;
            while (j < n && g[j] == g[i]) j ++;
            i = j - 1;
            // ä¸èƒ½ä½¿ç”¨ä¸‹æ ‡åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ ¹å’Œæœ€åä¸€æ ¹
            // åŸå› ï¼šè‡ªå·±æƒ³
            // å‰ªæ 2.III (2)
            // å¦‚æœå½“å‰æ‹¼æˆçš„å¤§æ£é•¿åº¦ä¸º0ï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€æ ¹
            if (!cur) return false;
            // å‰ªæ 2.III (3)
            // å¦‚æœå½“å‰æ‹¼æˆçš„å¤§æ£é•¿åº¦â•å½“å‰å°æ£çš„é•¿åº¦ä¸ºlengthï¼Œè¯´æ˜æ˜¯æœ€åä¸€æ ¹
            if (cur + g[i] == length) return false;
        }
    }
    return false;
}
int main() {
    while (~scanf("%d", &n), n) {
        // å¤šç»„è¾“å…¥
        // åˆå§‹åŒ–æ•°ç»„
        memset(st, 0, sizeof st);
        sum = 0;
        for (int i = 0; i < n; i ++ ) {
            scanf("%d", &g[i]);
            sum += g[i];
        }
        // å‰ªæ 2.I (1)
        sort(g, g + n, [&](int a, int b) {
            return a > b;
        });
        length = 1;
        while (true) {
            // å‰ªæ 2.II
            if (sum % length == 0 && dfs(0, 0, 0)) break;
            length ++ ;
        }
        cout << length << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`BFS`ã€`å‰ªæä¼˜åŒ–`

**ç¼åˆæ€ª**



#### [AcWing 168. ç”Ÿæ—¥è›‹ç³•](https://www.acwing.com/problem/content/170/)

**é¢˜ç›®æè¿°**

>   `7` æœˆ `17` æ—¥æ˜¯ `Mr.W` çš„ç”Ÿæ—¥ï¼Œ`ACM-THU` ä¸ºæ­¤è¦åˆ¶ä½œä¸€ä¸ªä½“ç§¯ä¸º `NÏ€` çš„ `M` å±‚ç”Ÿæ—¥è›‹ç³•ï¼Œæ¯å±‚éƒ½æ˜¯ä¸€ä¸ªåœ†æŸ±ä½“ã€‚
>
>   è®¾ä»ä¸‹å¾€ä¸Šæ•°ç¬¬ `i` å±‚è›‹ç³•æ˜¯åŠå¾„ä¸º $R_i$ï¼Œé«˜åº¦ä¸º $H_i$ çš„åœ†æŸ±ã€‚
>
>   å½“ `i < M` æ—¶ï¼Œè¦æ±‚ $R_i>R_{i+1}$ ä¸” $H_i>H_{i+1}$ã€‚
>
>   ç”±äºè¦åœ¨è›‹ç³•ä¸ŠæŠ¹å¥¶æ²¹ï¼Œä¸ºå°½å¯èƒ½èŠ‚çº¦ç»è´¹ï¼Œæˆ‘ä»¬å¸Œæœ›è›‹ç³•å¤–è¡¨é¢ï¼ˆæœ€ä¸‹ä¸€å±‚çš„ä¸‹åº•é¢é™¤å¤–ï¼‰çš„é¢ç§¯ `Q` æœ€å°ã€‚
>
>   ä»¤ `Q = SÏ€` ï¼Œè¯·ç¼–ç¨‹å¯¹ç»™å‡ºçš„ `N` å’Œ `M`ï¼Œæ‰¾å‡ºè›‹ç³•çš„åˆ¶ä½œæ–¹æ¡ˆï¼ˆé€‚å½“çš„ $R_i$ å’Œ $H_i$ çš„å€¼ï¼‰ï¼Œä½¿ `S` æœ€å°ã€‚
>
>   é™¤ `Q` å¤–ï¼Œä»¥ä¸Šæ‰€æœ‰æ•°æ®çš†ä¸ºæ­£æ•´æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œä¸ºæ•´æ•° `N`ï¼Œè¡¨ç¤ºå¾…åˆ¶ä½œçš„è›‹ç³•çš„ä½“ç§¯ä¸º `NÏ€`ã€‚
>
>   ç¬¬äºŒè¡Œä¸ºæ•´æ•° `M`ï¼Œè¡¨ç¤ºè›‹ç³•çš„å±‚æ•°ä¸º `M`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä»…ä¸€è¡Œï¼Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•° `S`ï¼ˆè‹¥æ— è§£åˆ™ `S = 0`ï¼‰ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 10000,$
>   +   $1 â‰¤ M â‰¤ 20$

**è¾“å…¥æ ·ä¾‹**

```c++
100
2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
68
```

**æ‰‹å†™ç¨¿**

![441439](img/441439.png)

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
using namespace std;
const int N = 25, INF = 0x3f3f3f3f;
int n, m, ans = INF;
int Minv[N], Mins[N], R[N], H[N];
void dfs(int u, int v, int s) {
    // æœ€ä¼˜æ€§å‰ªæ
    // å¦‚æœä»måˆ°u - 1å±‚çš„è¡¨é¢ç§¯â•ä»ç¬¬1å±‚åˆ°ç¬¬må±‚çš„è¡¨é¢ç§¯ >= ans,è¿”å›å³å¯
    if (s + Mins[u] >= ans) return;
    // å¯è¡Œæ€§å‰ªæ
    // å¦‚æœä»måˆ°u - 1å±‚çš„ä½“ç§¯â•ä»ç¬¬1å±‚åˆ°ç¬¬må±‚çš„ä½“ç§¯ > n,[ä¸æ˜¯ç­‰äº],è¿”å›å³å¯
    if (v + Minv[u] > n) return;
    // æ•°å­¦å‰ªæ
    if (s + 2 * (n - v) / R[u + 1] >= ans) return;
    // å¦‚æœåˆ°è¾¾ç¬¬0å±‚
    if (!u) {
        // å¦‚æœä½“ç§¯åˆšå¥½ç”¨å®Œ,æ›´æ–°ç­”æ¡ˆ
        if (v == n) ans = s;
        return;
    }
    // å…ˆæšä¸¾åŠå¾„,ä»å¤§åˆ°å°æšä¸¾
    for (int r = min(R[u + 1] - 1, (int)sqrt(n - v)); r >= u; r -- )
        // å†æšä¸¾é«˜åº¦,ä»å¤§åˆ°å°æšä¸¾
        for (int h = min(H[u + 1] - 1, (n - v) / r / r); h >= u; h -- ) {
            // æ›´æ–°åŠå¾„å’Œé«˜åº¦
            R[u] = r, H[u] = h;
            int t = 0;
            // å¦‚æœu == m,åŠ ä¸Šç¬¬må±‚çš„é¢ç§¯[æ‰‹å†™ç¨¿å›¾çš„è“è‰²éƒ¨åˆ†]
            if (u == m) t = r * r;
            // é€’å½’ä¸‹ä¸€å±‚
            dfs(u - 1, v + r * r * h, s + 2 * r * h + t);
        }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    // é¢„å¤„ç†æœ€å°ä½“ç§¯å’Œæœ€å°ä¾§é¢ç§¯
    for (int i = 1; i <= m; i ++ ) {
        Minv[i] = i * i * i;
        Mins[i] = 2 * i * i;
    }
    // ç®¡ç†å“¨å…µ,åˆå§‹åŒ–ä¸ºæ­£æ— ç©·
    R[m + 1] = H[m + 1] = INF;
    dfs(m, 0, 0);
    // æ— è§£
    if (ans == INF) cout << 0 << endl;
    else cout << ans << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`DFS`ã€`å‰ªæ`

**ç¼åˆæ€ª**



### è¿­ä»£åŠ æ·±

#### ç®€ä»‹

![451027](img/451027.png)

#### [AcWing 170. åŠ æˆåºåˆ—](https://www.acwing.com/problem/content/172/)

**é¢˜ç›®æè¿°**

>   æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„åºåˆ— `X`ï¼ˆåºåˆ—ä¸­å…ƒç´ è¢«æ ‡å·ä¸º `1ã€ 2ã€ 3 â€¦ m`ï¼‰è¢«ç§°ä¸ºâ€œåŠ æˆåºåˆ—â€ï¼š
>
>   1.  `X[1] = 1`
>   2.  `X[m] = n`
>   3.  `X[1] < X[2] < â€¦ < X[mâˆ’1] < X[m]`
>   4.  å¯¹äºæ¯ä¸ª `k`ï¼ˆ`2 â‰¤ k â‰¤ m`ï¼‰éƒ½å­˜åœ¨ä¸¤ä¸ªæ•´æ•° `i` å’Œ `j` ï¼ˆ`1 â‰¤ i, j â‰¤ k âˆ’ 1`ï¼Œ`i` å’Œ `j` å¯ç›¸ç­‰ï¼‰ï¼Œä½¿å¾— `X[k] = X[i] + X[j]`ã€‚
>
>   ä½ çš„ä»»åŠ¡æ˜¯ï¼šç»™å®šä¸€ä¸ªæ•´æ•° `n`ï¼Œæ‰¾å‡ºç¬¦åˆä¸Šè¿°æ¡ä»¶çš„é•¿åº¦ `m` æœ€å°çš„â€œåŠ æˆåºåˆ—â€ã€‚
>
>   å¦‚æœæœ‰å¤šä¸ªæ»¡è¶³è¦æ±‚çš„ç­”æ¡ˆï¼Œåªéœ€è¦æ‰¾å‡ºä»»æ„ä¸€ä¸ªå¯è¡Œè§£ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚
>
>   æ¯ç»„æµ‹è¯•ç”¨ä¾‹å æ®ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `n`ã€‚
>
>   å½“è¾“å…¥ä¸ºå•è¡Œçš„ `0` æ—¶ï¼Œè¡¨ç¤ºè¾“å…¥ç»“æŸã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¾“å‡ºä¸€ä¸ªæ»¡è¶³éœ€æ±‚çš„æ•´æ•°åºåˆ—ï¼Œæ•°å­—ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚
>
>   æ¯ä¸ªè¾“å‡ºå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 100$

**è¾“å…¥æ ·ä¾‹**

```c++
5
7
12
15
77
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 2 4 5
1 2 4 6 7
1 2 4 8 12
1 2 4 5 10 15
1 2 4 8 9 17 34 68 77
```

**æ‰‹å†™ç¨¿**

![451029](img/451029.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 110;
int n;
int path[N];
/*
    å‚æ•°:
        å‚æ•°1: æšä¸¾çš„å±‚æ•°
        å‚æ•°2: è§„å®šçš„æ·±åº¦
*/
bool dfs(int u, int depth) {
    // å¦‚æœå½“å‰æ·±åº¦å¤§äºè§„å®šçš„æ·±åº¦, è¿”å›
    if (u > depth) return false;
    // ä¸‹æ ‡ä»[0, u - 1], å¦‚æœæœ€åä¸€ä¸ªæ•°ç­‰äºn
    if (path[u - 1] == n) return true;
    // æ’é™¤ç­‰æ•ˆå†—ä½™
    bool st[N] = {false};
    for (int i = 0; i < u; i ++ )
        for (int j = i; j >= 0; j -- ) {
            int s = path[i] + path[j];
            // å¦‚æœå½“å‰æ•°å­—çš„å’Œå°äºç­‰äº n
            // å½“å‰æ€»å’Œä¸¥æ ¼å¤§äºä¸Šä¸€ä¸ªæ•°å­—
            // å½“å‰æ•°å­—æ²¡æœ‰è¢«è®¿é—®è¿‡
            if (s <= n && s > path[u - 1] && !st[s]) {
                st[s] = true;
                path[u] = s;
                // äº§ç”Ÿè¿é”ååº”
                if (dfs(u + 1, depth)) return true;
            }
        }
    return false;
}
int main() {
    path[0] = 1;
    while (~scanf("%d", &n), n) {
        int depth = 1;
        // ç¡®å®šæ·±åº¦
        while (!dfs(1, depth)) depth ++;
        for (int i = 0; i < depth; i ++ ) cout << path[i] << " ";
        cout << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(h), hæ˜¯æ·±åº¦$

**æ ‡ç­¾**

`è¿­ä»£åŠ æ·±`

**ç¼åˆæ€ª**



### åŒå‘ `DFS`

#### [AcWing 171. é€ç¤¼ç‰©](https://www.acwing.com/problem/content/173/)

**é¢˜ç›®æè¿°**

>   è¾¾è¾¾å¸®ç¿°ç¿°ç»™å¥³ç”Ÿé€ç¤¼ç‰©ï¼Œç¿°ç¿°ä¸€å…±å‡†å¤‡äº† `N` ä¸ªç¤¼ç‰©ï¼Œå…¶ä¸­ç¬¬ ii ä¸ªç¤¼ç‰©çš„é‡é‡æ˜¯ `G[i]`ã€‚
>
>   è¾¾è¾¾çš„åŠ›æ°”å¾ˆå¤§ï¼Œä»–ä¸€æ¬¡å¯ä»¥æ¬åŠ¨é‡é‡ä¹‹å’Œä¸è¶…è¿‡ `W` çš„ä»»æ„å¤šä¸ªç‰©å“ã€‚
>
>   è¾¾è¾¾å¸Œæœ›ä¸€æ¬¡æ¬æ‰å°½é‡é‡çš„ä¸€äº›ç‰©å“ï¼Œè¯·ä½ å‘Šè¯‰è¾¾è¾¾åœ¨ä»–çš„åŠ›æ°”èŒƒå›´å†…ä¸€æ¬¡æ€§èƒ½æ¬åŠ¨çš„æœ€å¤§é‡é‡æ˜¯å¤šå°‘ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«ä»£è¡¨ `W` å’Œ `N`ã€‚
>
>   ä»¥å `N` è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ­£æ•´æ•°è¡¨ç¤º `G[i]`ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä»…ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¾¾è¾¾åœ¨ä»–çš„åŠ›æ°”èŒƒå›´å†…ä¸€æ¬¡æ€§èƒ½æ¬åŠ¨çš„æœ€å¤§é‡é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 46,$
>   +   $1 â‰¤ W, G[i] â‰¤ 2^{31} âˆ’ 1$

**è¾“å…¥æ ·ä¾‹**

```c++
20 5
7
5
4
18
1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
19
```

**æ‰‹å†™ç¨¿**

![451314](img/451314.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
typedef long long LL;
const int N = 50, M = 1 << 26;
int n, m, k, cnt, ans;
// å–M = 1 << 26ä¸æ˜¯ 1 << N 
int w[N], choices[M];
void dfs1(int u, int s) {
    if (u == k) {
        choices[cnt ++ ] = s;
        return;
    }
    // ä¸é€‰æ‹©ç¬¬uä¸ªç‰©å“
    dfs1(u + 1, s);
    // é€‰æ‹©ç¬¬uä¸ªç‰©å“
    // æ•°ç»„å¯èƒ½ä¼šè¶Šç•Œ
    if ((LL)s + w[u] <= m) dfs1(u + 1, s + w[u]);
    return;
}
void dfs2(int u, int s) {
    if (u == n) {
        // äºŒåˆ†æ¨¡æ¿
        int l = 0, r = cnt - 1;
        while (l < r) {
            int mid = l + r + 1 >> 1;
            if ((LL)s + choices[mid] <= m) l = mid;
            else r = mid - 1;
        }
        // åªæœ‰å½“ç­”æ¡ˆåˆæ³•çš„æ—¶å€™, æ‰æ›´æ–°ç­”æ¡ˆ
        if ((LL)s + choices[l] <= m) ans = max(ans, s + choices[l]);
        return;
    }
    // ä¸é€‰æ‹©ç¬¬uä¸ªç‰©å“
    dfs2(u + 1, s);
    // é€‰æ‹©ç¬¬uä¸ªç‰©å“
    // æ³¨æ„æ•°ç»„è¶Šç•Œ
    if ((LL)s + w[u] <= m) dfs2(u + 1, s + w[u]);
    return;
}
int main() {
    scanf("%d%d", &m, &n);
    for (int i = 0; i < n; i ++ ) scanf("%d", &w[i]);
    // ä»å¤§åˆ°å°æ’åº, æœç´¢ç©ºé—´å°
    sort(w, w + n, [&] (LL a, LL b) {
        return a > b;
    });
    // æ³¨æ„: å»æœ€å°å€¼, å› ä¸º n / 2 + 2 å¯èƒ½ä¼šè¶Šç•Œ
    // ä¾‹å¦‚ n = 1
    k = min(n - 1, n / 2 + 2);
    dfs1(0, 0);
    // æ’åº
    sort(choices, choices + cnt);
    // å»é‡
    cnt = unique(choices, choices + cnt) - choices;
    dfs2(k, 0);
    cout << ans << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(2 ^ {n / 2})$

**æ ‡ç­¾**

`åŒå‘DFS`

**ç¼åˆæ€ª**

[å®æ•°äºŒåˆ†](#å®æ•°äºŒåˆ†)

### `IDA*`

#### [AcWing 180. æ’ä¹¦](https://www.acwing.com/problem/content/182/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` æœ¬ä¹¦ï¼Œç¼–å·ä¸º `1 âˆ¼ n`ã€‚
>
>   åœ¨åˆå§‹çŠ¶æ€ä¸‹ï¼Œä¹¦æ˜¯ä»»æ„æ’åˆ—çš„ã€‚
>
>   åœ¨æ¯ä¸€æ¬¡æ“ä½œä¸­ï¼Œå¯ä»¥æŠ½å–å…¶ä¸­è¿ç»­çš„ä¸€æ®µï¼Œå†æŠŠè¿™æ®µæ’å…¥åˆ°å…¶ä»–æŸä¸ªä½ç½®ã€‚
>
>   æˆ‘ä»¬çš„ç›®æ ‡çŠ¶æ€æ˜¯æŠŠä¹¦æŒ‰ç…§ `1 âˆ¼ n` çš„é¡ºåºä¾æ¬¡æ’åˆ—ã€‚
>
>   æ±‚æœ€å°‘éœ€è¦å¤šå°‘æ¬¡æ“ä½œã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `T`ï¼Œè¡¨ç¤ºå…±æœ‰ `T` ç»„æµ‹è¯•æ•°æ®ã€‚
>
>   æ¯ç»„æ•°æ®åŒ…å«ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œä¸ºæ•´æ•° `n`ï¼Œè¡¨ç¤ºä¹¦çš„æ•°é‡ã€‚
>
>   ç¬¬äºŒè¡Œä¸º `n` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º `1 âˆ¼ n` çš„ä¸€ç§ä»»æ„æ’åˆ—ã€‚
>
>   åŒè¡Œæ•°ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºä¸€ä¸ªæœ€å°‘æ“ä½œæ¬¡æ•°ã€‚
>
>   å¦‚æœæœ€å°‘æ“ä½œæ¬¡æ•°å¤§äºæˆ–ç­‰äº `5` æ¬¡ï¼Œåˆ™è¾“å‡º `5 or more`ã€‚
>
>   æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 15$

**è¾“å…¥æ ·ä¾‹**

```c++
3
6
1 3 4 6 2 5
5
5 4 3 2 1
10
6 8 5 3 4 7 2 9 1 10
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
3
5 or more
```

**æ‰‹å†™ç¨¿**

![471125](img/471125.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 20;
int n, T;
int g[N];
// è®°å½•æ¯ä¸€å±‚çš„æ’åˆ—
int w[5][N];
// è®¡ç®—ä¸åˆæ³•æ•°å¯¹çš„ä¸ªæ•°
int f() {
    int tot = 0;
    for (int i = 0; i + 1 < n; i ++ )
        if (g[i + 1] != g[i] + 1) tot ++;
    return (tot + 2) / 3;
}
bool dfs(int u, int MaxDepth) {
    // è¶…è¿‡æœ€å¤§æ·±åº¦, ç›´æ¥è¿”å›å³å¯
    if (u + f() > MaxDepth) return false;
    // ä¸åˆæ³•æ•°å¯¹ä¸º0, è¯´æ˜å…¨éƒ¨åˆæ³•, æ‰¾åˆ°ç­”æ¡ˆ
    if (f() == 0) return true;
    // æšä¸¾é•¿åº¦
    // é•¿åº¦ä¸ºn, æ²¡æœ‰å¿…è¦æšä¸¾
    for (int len = 1; len < n; len ++ )
        // æšä¸¾å·¦ç«¯ç‚¹
        for (int l = 0; l + len - 1 < n; l ++ ) {
            // è®¡ç®—å³ç«¯ç‚¹
            int r = l + len - 1;
            for (int k = r + 1; k < n; k ++ ) {
                // æ‹·è´å½“å‰å±‚çš„æ’åˆ—é¡ºåº
                memcpy(w[u], g, sizeof g);
                // å…·ä½“ç§»åŠ¨æ­¥éª¤, çœ‹æ‰‹å†™ç¨¿
                int x, y;
                for (x = r + 1, y = l; x <= k; x ++, y ++ ) g[y] = w[u][x];
                for (x = l; x <= r; x ++, y ++ ) g[y] = w[u][x];
                if (dfs(u + 1, MaxDepth)) return true;
                // æ¢å¤ç°åœº
                memcpy(g, w[u], sizeof w[u]);
            }
        }
    return false;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        scanf("%d", &n);
        for (int i = 0; i < n; i ++ ) scanf("%d", &g[i]);
        int depth = 0;
        while (depth < 5 && !dfs(0, depth)) depth ++;
        if (depth >= 5) puts("5 or more");
        else cout << depth << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`IDA*`ã€`æ·±åº¦ä¼˜å…ˆæœç´¢`

**ç¼åˆæ€ª**



#### [AcWing 181. å›è½¬æ¸¸æˆ](https://www.acwing.com/problem/content/183/)

**é¢˜ç›®æè¿°**

>   å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ‰ä¸€ä¸ª `#` å½¢çš„æ£‹ç›˜ï¼Œä¸Šé¢æœ‰ `1, 2, 3` ä¸‰ç§æ•°å­—å„ `8` ä¸ªã€‚
>
>   ç»™å®š `8` ç§æ“ä½œï¼Œåˆ†åˆ«ä¸ºå›¾ä¸­çš„ `A âˆ¼ H`ã€‚
>
>   è¿™äº›æ“ä½œä¼šæŒ‰ç…§å›¾ä¸­å­—æ¯å’Œç®­å¤´æ‰€æŒ‡æ˜çš„æ–¹å‘ï¼ŒæŠŠä¸€æ¡é•¿ä¸º `7` çš„åºåˆ—å¾ªç¯ç§»åŠ¨ `1` ä¸ªå•ä½ã€‚
>
>   ä¾‹å¦‚ä¸‹å›¾æœ€å·¦è¾¹çš„ `#` å½¢æ£‹ç›˜æ‰§è¡Œæ“ä½œ `A` åï¼Œä¼šå˜ä¸ºä¸‹å›¾ä¸­é—´çš„ `#` å½¢æ£‹ç›˜ï¼Œå†æ‰§è¡Œæ“ä½œ `C` åä¼šå˜æˆä¸‹å›¾æœ€å³è¾¹çš„ `#` å½¢æ£‹ç›˜ã€‚
>
>   ç»™å®šä¸€ä¸ªåˆå§‹çŠ¶æ€ï¼Œè¯·ä½¿ç”¨æœ€å°‘çš„æ“ä½œæ¬¡æ•°ï¼Œä½¿ `#` å½¢æ£‹ç›˜æœ€ä¸­é—´çš„ `8` ä¸ªæ ¼å­é‡Œçš„æ•°å­—ç›¸åŒã€‚
>
>   ![2286_1.jpg](img/19_4ec33e321e-2286_1.jpg)

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚
>
>   æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å ä¸€è¡Œï¼ŒåŒ…å« `24` ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºå°†åˆå§‹æ£‹ç›˜ä¸­çš„æ¯ä¸€ä¸ªä½ç½®çš„æ•°å­—ï¼ŒæŒ‰æ•´ä½“ä»ä¸Šåˆ°ä¸‹ï¼ŒåŒè¡Œä»å·¦åˆ°å³çš„é¡ºåºä¾æ¬¡åˆ—å‡ºã€‚
>
>   è¾“å…¥æ ·ä¾‹ä¸­çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¯¹åº”ä¸Šå›¾æœ€å·¦è¾¹æ£‹ç›˜çš„åˆå§‹çŠ¶æ€ã€‚
>
>   å½“è¾“å…¥åªåŒ…å«ä¸€ä¸ª `0` çš„è¡Œæ—¶ï¼Œè¡¨ç¤ºè¾“å…¥ç»ˆæ­¢ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¾“å‡ºå ä¸¤è¡Œã€‚
>
>   ç¬¬ä¸€è¡ŒåŒ…å«æ‰€æœ‰ç§»åŠ¨æ­¥éª¤ï¼Œæ¯æ­¥ç§»åŠ¨ç”¨å¤§å†™å­—æ¯ `A âˆ¼ H` ä¸­çš„ä¸€ä¸ªè¡¨ç¤ºï¼Œå­—æ¯ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ï¼Œå¦‚æœä¸éœ€è¦ç§»åŠ¨åˆ™è¾“å‡º `No moves needed`ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºç§»åŠ¨å®Œæˆåï¼Œä¸­é—´ `8` ä¸ªæ ¼å­é‡Œçš„æ•°å­—ã€‚
>
>   å¦‚æœæœ‰å¤šç§æ–¹æ¡ˆï¼Œåˆ™è¾“å‡ºå­—å…¸åºæœ€å°çš„è§£å†³æ–¹æ¡ˆã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
1 1 1 1 3 2 3 2 3 1 3 2 2 3 1 2 2 2 3 1 2 1 3 3
1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
AC
2
DDHH
2
```

**æ‰‹å†™ç¨¿**

![481033](img/481033.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 24, M = 110;
int q[N], path[M];
int opposite[8] = {5, 4, 7, 6, 1, 0, 3, 2}; // A~Hçš„é€†æ“ä½œçš„ä¸‹æ ‡!!ä¸‹æ ‡!!
int center[8] = {6, 7, 8, 11, 12, 15, 16, 17}; // è®°å½•ä¸­é—´å…«ä¸ªç‚¹çš„ä¸‹æ ‡!!ä¸‹æ ‡!!
char map[8][7] = { // å­˜çš„æ˜¯ä¸‹æ ‡!!ä¸‹æ ‡!!
    {0, 2, 6, 11, 15, 20, 22},
    {1, 3, 8, 12, 17, 21, 23},
    {10, 9, 8, 7, 6, 5, 4},
    {19, 18, 17, 16, 15, 14, 13},
    {23, 21, 17, 12, 8, 3, 1},
    {22, 20, 15, 11, 6, 2, 0},
    {13, 14, 15, 16, 17, 18, 19},
    {4, 5, 6, 7, 8, 9, 10}
};
int f() { // é¢„ä¼°å‡½æ•°
    int sum[4] = {0};
    for (int i = 0; i < 8; i ++ ) // éå†ä¸­é—´8ä¸ªç‚¹
        sum[q[center[i]]] ++;
    int Max = -1;
    for (int i = 0; i < 4; i ++ ) Max = max(Max, sum[i]);
    return 8 - Max;
}
void operation(int x) { // è¿›è¡Œç¬¬xä¸ªæ“ä½œ
    int t = q[map[x][0]]; // mapå­˜çš„æ˜¯ä¸‹æ ‡!!ä¸‹æ ‡!!
    // mapå­˜çš„æ˜¯ä¸‹æ ‡!!ä¸‹æ ‡!!
    for (int i = 1; i < 7; i ++ ) q[map[x][i - 1]] = q[map[x][i]];
    q[map[x][6]] = t; // mapå­˜çš„æ˜¯ä¸‹æ ‡!!ä¸‹æ ‡!!
    return;
}
bool dfs(int u, int MaxDepth, int k) {
    if (u + f() > MaxDepth) return false;
    if (f() == 0) return true;
    // éå†8ä¸ªæ“ä½œ
    for (int i = 0; i < 8; i ++ ) // æŒ‰ç…§å­—å…¸åºæšä¸¾, ç­”æ¡ˆå³ä¸ºå­—å…¸åº
        if (opposite[i] != k) {
            operation(i); // è¿›è¡Œç¬¬iä¸ªæ“ä½œ
            path[u] = i; // è®°å½•æ“ä½œçš„ä¸‹æ ‡
            if (dfs(u + 1, MaxDepth, i)) return true; // äº§ç”Ÿè¿é”ååº”
            operation(opposite[i]); // æ¢å¤ç°åœº
        }
    return false;
}
int main() {
    while (~scanf("%d", &q[0]), q[0]) {
        for (int i = 1; i < N; i ++ ) scanf("%d", &q[i]);
        int MaxDepth = 0;
        while (!dfs(0, MaxDepth, -1)) MaxDepth ++;
        if (!MaxDepth) printf("No moves needed");
        else
            for (int i = 0; i < MaxDepth; i ++ ) cout << char(path[i] + 'A');
        printf("\n%d\n", q[6]);
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸è®²æ­¦å¾·)$

**ç©ºé—´å¤æ‚åº¦**

$O(max(N, M))$

**æ ‡ç­¾**

`DFS`ã€`IDA*`

**ç¼åˆæ€ª**



## å¯å‘å¼ç®—æ³•

### æ¨¡æ‹Ÿé€€ç«

#### åŸç†æ¦‚è¿°

>   1.   æ‰‹å†™ç¨¿
>
>        ![3191112](img/3191112.jpg)
>
>   2.   åŠ¨ç”»æ¼”ç¤º
>
>        ![img3191633](img/simulated-annealing-20220319163337913.gif)



#### [AcWing 3167. æ˜Ÿæ˜Ÿè¿˜æ˜¯æ ‘](https://www.acwing.com/problem/content/3170/)

**é¢˜ç›®æè¿°**

>   åœ¨äºŒç»´å¹³é¢ä¸Šæœ‰ `n` ä¸ªç‚¹ï¼Œç¬¬ `i` ä¸ªç‚¹çš„åæ ‡ä¸º $(x_i,y_i)$ã€‚
>
>   è¯·ä½ æ‰¾å‡ºä¸€ä¸ªç‚¹ï¼Œä½¿å¾—è¯¥ç‚¹åˆ°è¿™ `n` ä¸ªç‚¹çš„è·ç¦»ä¹‹å’Œæœ€å°ã€‚
>
>   è¯¥ç‚¹å¯ä»¥é€‰æ‹©åœ¨å¹³é¢ä¸­çš„ä»»æ„ä½ç½®ï¼Œç”šè‡³ä¸è¿™ `n` ä¸ªç‚¹çš„ä½ç½®é‡åˆã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $x_i,y_i$ï¼Œè¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªç‚¹çš„ä½ç½®åæ ‡ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºæœ€å°è·ç¦»å’Œï¼Œç­”æ¡ˆå››èˆäº”å…¥å–æ•´ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100,$
>   +   $0â‰¤x_i,y_iâ‰¤10000$

**è¾“å…¥æ ·ä¾‹**

```c++
4
0 0
0 10000
10000 10000
10000 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
28284
```

**æ‰‹å†™ç¨¿**

>   1.   åŸç†æ¦‚è¿°

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
#define x first
#define y second
using namespace std;
typedef pair<double, double> PDD;
const int N = 110, INF = 0x3f3f3f3f;
int n;
double ans = INF;
PDD q[N];
// ç­‰æ¦‚ç‡ç”ŸæˆåŒºé—´[l, r]å†…çš„ä¸€ä¸ªéšæœºç‚¹
double rand(int l, int r) {
    return (double)rand() / RAND_MAX * (r - l) + l;
}
double get_dist(PDD a, PDD b) {
    double dx = a.x - b.x;
    double dy = a.y - b.y;
    return sqrt(dx * dx + dy * dy);
}
double calc(PDD p) {
    double res = 0;
    for (int i = 0; i < n; i ++ )
        res += get_dist(p, q[i]);
    // æ›´æ–°ç­”æ¡ˆ
    ans = min(ans, res);
    return res;
}
void simulate_anneal() {
    // éšæœºç”Ÿæˆå½“å‰ç‚¹
    PDD cur(rand(0, 10000), rand(0, 10000));
    // éå†æ¸©åº¦[æ­¥é•¿]
    for (double t = 1e4; t > 1e-4; t *= 0.99) {
        // éšæœºç”Ÿæˆå½“å‰ç‚¹çš„é¢†åŸŸå†…çš„ç‚¹
        PDD np(rand(cur.x - t, cur.x + t), rand(cur.y - t, cur.y + t));
        double dt = calc(np) - calc(cur);
        // å¦‚æœdt < 0,åˆ™-dt / t > 0, e^{-dt / t} > 1ï¼Œåˆ™ä¸€å®šä¼šé€šè¿‡æ­¤æ¡ä»¶
        // å¦‚æœdt > 0,åˆ™-dt / t < 0, 0 < e^{-dt / t} < 1,åˆ™æœ‰ä¸€å®šæ¦‚ç‡å¯ä»¥è¿‡å»
        // å·®çš„è¶Šå¤§è¶Šä¸å®¹æ˜“è¿‡å»
        if (exp(-dt / t) > rand(0, 1)) cur = np;
    }
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ ) 
        scanf("%lf%lf", &q[i].x, &q[i].y);
    // è¿­ä»£ä¸€ç™¾æ¬¡
    for (int i = 0; i < 100; i ++ ) 
        simulate_anneal();
    printf("%.0lf\n", ans);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(log_t)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¯å‘å¼ç®—æ³•`ã€`æ¨¡æ‹Ÿé€€ç«`

**ç¼åˆæ€ª**

#### [AcWing 2424. ä¿é¾„çƒ](https://www.acwing.com/problem/content/2426/)

**é¢˜ç›®æè¿°**

>   `JYY` å¾ˆå–œæ¬¢æ‰“ä¿é¾„çƒï¼Œè™½ç„¶æŠ€æœ¯ä¸é«˜ï¼Œä½†æ˜¯è¿˜æ˜¯æ€»æƒ³ç€çš„é«˜åˆ†ã€‚
>
>   è¿™é‡Œ `JYY` å°†å‘ä½ ä»‹ç»ä»–æ‰€å‚åŠ çš„ç‰¹æ®Šä¿é¾„çƒæ¯”èµ›çš„è§„åˆ™ï¼Œç„¶åè¯·ä½ å¸®ä»–å¾—åˆ°å°½é‡å¤šçš„åˆ†æ•°ã€‚
>
>   ä¸€åœºä¿é¾„çƒæ¯”èµ›ä¸€å…±æœ‰ `N` ä¸ªè½®æ¬¡ï¼Œæ¯ä¸€è½®éƒ½ä¼šæœ‰ `10` ä¸ªæœ¨ç“¶æ”¾ç½®åœ¨æœ¨æ¿é“çš„å¦ä¸€ç«¯ã€‚
>
>   æ¯ä¸€è½®ä¸­ï¼Œé€‰æ‰‹éƒ½æœ‰ä¸¤æ¬¡æŠ•çƒçš„æœºä¼šæ¥å°è¯•å‡»å€’å…¨éƒ¨çš„ `10` ä¸ªæœ¨ç“¶ã€‚
>
>   å¯¹äºæ¯ä¸€æ¬¡æŠ•çƒæœºä¼šï¼Œé€‰æ‰‹æŠ•çƒçš„å¾—åˆ†ç­‰äºè¿™ä¸€æ¬¡æŠ•çƒæ‰€å‡»å€’çš„æœ¨ç“¶æ•°é‡ã€‚
>
>   é€‰æ‰‹æ¯ä¸€è½®çš„å¾—åˆ†æ˜¯ä»–ä¸¤æ¬¡æœºä¼šå‡»å€’å…¨éƒ¨æœ¨ç“¶çš„æ•°é‡ã€‚
>
>   å¯¹äºæ¯ä¸€ä¸ªè½®æ¬¡ï¼Œæœ‰å¦‚ä¸‹ä¸‰ç§æƒ…å†µï¼š
>
>   1.  â€œå…¨ä¸­â€ï¼šå¦‚æœé€‰æ‰‹ç¬¬ä¸€æ¬¡å°è¯•å°±å‡»å€’äº†å…¨éƒ¨ `10` ä¸ªæœ¨ç“¶ï¼Œé‚£ä¹ˆè¿™ä¸€è½®å°±ç§°ä¸ºâ€œå…¨ä¸­â€ã€‚åœ¨ä¸€ä¸ªâ€œå…¨ä¸­â€è½®ä¸­ï¼Œç”±äºæ‰€æœ‰æœ¨ç“¶åœ¨ç¬¬ä¸€æ¬¡å°è¯•ä¸­éƒ½å·²ç»è¢«å‡»å€’ï¼Œæ‰€ä»¥é€‰æ‰‹ä¸éœ€è¦å†è¿›è¡Œç¬¬äºŒæ¬¡æŠ•çƒå°è¯•ã€‚åŒæ—¶ï¼Œåœ¨è®¡ç®—æ€»åˆ†æ—¶ï¼Œé€‰æ‰‹åœ¨ä¸‹ä¸€è½®çš„å¾—åˆ†å°†ä¼šè¢«ä¹˜ `2` è®¡å…¥æ€»åˆ†ã€‚
>   2.  â€œè¡¥ä¸­â€ï¼šå¦‚æœé€‰æ‰‹ä½¿ç”¨ä¸¤æ¬¡å°è¯•å‡»å€’äº† `10` ä¸ªæœ¨ç“¶ï¼Œé‚£ä¹ˆè¿™ä¸€è½®å°±ç§°ä¸ºâ€œè¡¥ä¸­â€ã€‚åŒæ—¶ï¼Œåœ¨è®¡ç®—æ€»åˆ†æ—¶ï¼Œé€‰æ‰‹åœ¨ä¸‹ä¸€è½®ä¸­çš„ç¬¬ä¸€æ¬¡å°è¯•çš„å¾—åˆ†å°†ä¼šè¢«ä¹˜ä»¥ `2` è®¡å…¥æ€»åˆ†ã€‚
>   3.  â€œå¤±è¯¯â€ï¼šå¦‚æœé€‰æ‰‹æœªèƒ½é€šè¿‡ä¸¤æ¬¡å°è¯•å‡»å€’å…¨éƒ¨çš„æœ¨ç“¶ï¼Œé‚£ä¹ˆè¿™ä¸€è½®å°±è¢«ç§°ä¸ºâ€œå¤±è¯¯â€ã€‚åŒæ—¶ï¼Œåœ¨è®¡ç®—æ€»åˆ†æ—¶ï¼Œé€‰æ‰‹åœ¨ä¸‹ä¸€è½®çš„å¾—åˆ†ä¼šè¢«è®¡å…¥æ€»åˆ†ï¼Œæ²¡æœ‰åˆ†æ•°è¢«ç¿»å€ã€‚
>
>   æ­¤å¤–ï¼Œå¦‚æœç¬¬ `N` è½®æ˜¯â€œå…¨ä¸­â€ï¼Œé‚£ä¹ˆé€‰æ‰‹å¯ä»¥è¿›è¡Œä¸€æ¬¡é™„åŠ è½®ï¼šä¹Ÿå°±æ˜¯ï¼Œå¦‚æœç¬¬ `N` è½®æ˜¯â€œå…¨ä¸­â€ï¼Œé‚£ä¹ˆé€‰æ‰‹å°†ä¸€å…±è¿›è¡Œ `N + 1` è½®æ¯”èµ›ã€‚
>
>   æ˜¾ç„¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ `N + 1` è½®çš„åˆ†æ•°ä¸€å®šä¼šè¢«åŠ å€ã€‚
>
>   é™„åŠ è½®çš„è§„åˆ™åªæ‰§è¡Œä¸€æ¬¡ã€‚
>
>   ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ç¬¬ `N + 1` è½®é€‰æ‰‹åˆæ‰“å‡ºäº†â€œå…¨ä¸­â€ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œç¬¬ `N + 2` è½®æ¯”èµ›ã€‚
>
>   å› è€Œï¼Œé™„åŠ è½®çš„æˆç»©ä¸ä¼šä½¿å¾—å…¶ä»–è½®çš„åˆ†æ•°ç¿»ç•ªã€‚
>
>   æœ€åï¼Œé€‰æ‰‹çš„æ€»å¾—åˆ†å°±æ˜¯é™„åŠ è½®è§„åˆ™æ‰§è¡Œè¿‡ï¼Œå¹¶ä¸”åˆ†æ•°æŒ‰ä¸Šè¿°è§„åˆ™åŠ å€åçš„æ¯ä¸€è½®åˆ†æ•°ä¹‹å’Œã€‚
>
>   `JYY` åˆšåˆšè¿›è¡Œäº†ä¸€åœº `N` ä¸ªè½®æ¬¡çš„ä¿é¾„çƒæ¯”èµ›ï¼Œä½†æ˜¯ï¼Œ`JYY` éå¸¸ä¸æ»¡æ„ä»–çš„å¾—åˆ†ã€‚
>
>   `JYY` æƒ³å‡ºäº†ä¸€ä¸ªåŠæ³•ï¼šä»–å¯ä»¥æŠŠè®°åˆ†è¡¨ä¸Šï¼Œä»–æ‰€æ‰“å‡ºçš„æ‰€æœ‰è½®æ¬¡çš„é¡ºåºé‡æ–°æ’åˆ—ï¼Œè¿™æ ·é‡æ–°æ’åˆ—ä¹‹åï¼Œç”±äºç¿»å€è§„åˆ™çš„å­˜åœ¨ï¼Œ`JYY` å°±å¯ä»¥å¾—åˆ°æ›´é«˜çš„åˆ†æ•°äº†ï¼
>
>   å½“ç„¶äº†ï¼Œ`JYY` ä¸å¸Œæœ›åšçš„å¤ªå‡ï¼Œä»–å¸Œæœ›ä¿è¯é‡æ–°æ’åˆ—ä¹‹åï¼Œæ‰€éœ€è¦è¿›è¡Œçš„è½®æ•°å’Œé‡æ’å‰æ‰€è¿›è¡Œçš„è½®æ•°æ˜¯ä¸€è‡´çš„ï¼š
>
>   æ¯”å¦‚å¦‚æœé‡æ’å‰ `JYY` åœ¨ç¬¬ `N` è½®æ‰“å‡ºäº†â€œå…¨ä¸­â€ï¼Œé‚£ä¹ˆé‡æ’ä¹‹åï¼Œç¬¬ `N` è½®è¿˜å¾—æ˜¯â€œå…¨ä¸­â€ä»¥ä¿è¯æ¯”èµ›ä¸€å…±è¿›è¡Œ `N+1` è½®ï¼›åŒæ ·çš„ï¼Œå¦‚æœ `JYY` ç¬¬ `N` è½®æ²¡æœ‰æ‰“å‡ºâ€œå…¨ä¸­â€ï¼Œé‚£ä¹ˆé‡æ’è¿‡åç¬¬ `N` è½®ä¹Ÿä¸èƒ½æ˜¯å…¨ä¸­ã€‚
>
>   è¯·ä½ å¸®åŠ© `JYY` è®¡ç®—ä¸€ä¸‹ï¼Œä»–å¯ä»¥å¾—åˆ°çš„æœ€é«˜çš„åˆ†æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `N`ï¼Œè¡¨ç¤ºä¿é¾„çƒæ¯”èµ›æ‰€éœ€è¦è¿›è¡Œçš„è½®æ•°ã€‚
>
>   æ¥ä¸‹æ¥åŒ…å« `N` æˆ–è€… `N+1` è¡Œï¼Œç¬¬ `i` è¡ŒåŒ…å«ä¸¤ä¸ªéè´Ÿæ•´æ•° $X_i$ å’Œ $Y_i$ï¼Œè¡¨ç¤º `JYY` åœ¨è¿™ä¸€è½®ä¸¤æ¬¡æŠ•çƒå°è¯•æ‰€å¾—åˆ°çš„åˆ†æ•°ï¼Œ$X_i$ è¡¨ç¤ºç¬¬ä¸€æ¬¡å°è¯•ï¼Œ$Y_i$ è¡¨ç¤ºç¬¬äºŒæ¬¡å°è¯•ã€‚
>
>   æˆ‘ä»¬ç”¨ `10 0` è¡¨ç¤ºä¸€ä¸ªâ€œå…¨ä¸­â€è½®ã€‚
>
>   è¾“å…¥æ•°æ®ä¿è¯åˆæ³•ï¼Œå½“ä¸”ä»…å½“ $X_n=10,Y_n=0$ æ—¶ï¼Œå­˜åœ¨ `N+1` è¡Œ $X_i$ å’Œ $Y_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€è¡Œä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º `JYY` æœ€å¤§å¯èƒ½å¾—åˆ°çš„åˆ†æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤50$

**è¾“å…¥æ ·ä¾‹**

```c++
2
5 2
10 0
3 7
```

**è¾“å‡ºæ ·ä¾‹**

```c++
44
```

**æ ·ä¾‹**

>   æŒ‰ç…§è¾“å…¥é¡ºåºï¼Œ`JYY` å°†å¾—åˆ° $37$ åˆ†ã€‚
>
>   æœ€ä½³æ–¹æ¡ˆæ˜¯å°† `3` ä¸ªè½®æ¬¡æ’åˆ—æˆå¦‚ä¸‹é¡ºåºï¼š
>
>   ```c++
>   3 7
>   10 0
>   5 2
>   ```

**æ‰‹å†™ç¨¿**

![3191646](img/3191646.jpg)

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 55;
int n, m, ans;
PII q[N];
int calc() {
    int res = 0;
    for (int i = 0; i < m; i ++ ) {
        res += q[i].x + q[i].y;
        if (q[i].x == 10) res += q[i + 1].x + q[i + 1].y;
        else if (q[i].x + q[i].y == 10) res += q[i + 1].x;
    }
    ans = max(ans, res);
    return res;
}
void simulate_anneal() {
    // æ¸©åº¦
    for (double t = 1e4; t > 1e-6; t *= 0.98) {
        // ç”Ÿæˆéšæœºæ’åˆ—
        int x = calc();
        // éšæœºç”Ÿæˆä¸¤ä¸ªä¸‹æ ‡
        int a = rand() % m, b = rand() % m;
        // äº¤æ¢
        swap(q[a], q[b]);
        // å¦‚æœäº¤æ¢ä¹‹å‰å’Œäº¤æ¢ä¹‹åçš„è½®æ•°ä¸€æ ·ï¼Œåˆ™æ˜¯åˆæ³•çš„äº¤æ¢
        if (n + (q[n - 1].x == 10) == m) {
            // è®¡ç®—äº¤æ¢ä¹‹åçš„å€¼
            int y = calc();
            // è®¡ç®—å·®å€¼
            int dt = y - x;
            // å¦‚æœæ–°çš„å€¼æ¯”å½“å‰å€¼å°ï¼Œåˆ™ä»¥ä¸€å®šæ¦‚ç‡è·³è¿‡å»
            // å¦‚æœä»¥å½“å‰çš„æ¦‚ç‡è·³ä¸è¿‡å»ï¼Œåˆ™è®°å¾—æ¢å¤ç°åœº
            if (exp(dt / t) < (double)rand() / RAND_MAX) swap(q[a], q[b]);
        }
        // å¦‚æœå½“å‰äº¤æ¢ä¸åˆæ³•ï¼Œè®°å¾—æ¢å¤ç°åœº
        else swap(q[a], q[b]);
    }
    return;
}
int main() {
    scanf("%d", &n);
    m = n;
    for (int i = 0; i < n; i ++ )
        scanf("%d%d", &q[i].x, &q[i].y);
    if (q[n - 1].x == 10) scanf("%d%d", &q[n].x, &q[n].y), m ++ ;
    // æ¨¡æ‹Ÿé€€ç«
    for (int i = 0; i < 100; i ++ ) simulate_anneal();
    cout << ans << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_t)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¯å‘å¼ç®—æ³•`ã€`æ¨¡æ‹Ÿé€€ç«`

**ç¼åˆæ€ª**

#### [AcWing 2680. å‡åˆ†æ•°æ®](https://www.acwing.com/problem/content/2682/)

**é¢˜ç›®æè¿°**

>   å·²çŸ¥ `N` ä¸ªæ­£æ•´æ•°ï¼š$A_1ã€A_2ã€â€¦â€¦ã€A_n$ã€‚
>
>   ä»Šè¦å°†å®ƒä»¬åˆ†æˆ `M` ç»„ï¼Œä½¿å¾—å„ç»„æ•°æ®çš„æ•°å€¼å’Œæœ€å¹³å‡ï¼Œå³å„ç»„çš„å‡æ–¹å·®æœ€å°ã€‚
>
>   å‡æ–¹å·®å…¬å¼å¦‚ä¸‹ï¼š
>   $$
>   \sigma=\sqrt{\frac{\sum\nolimits_{i = 1}^{n}(x_i - \bar x)^2}{n}}, 
>   \bar x = \frac{\sum\nolimits_{i = 1}^{n}x_i}{n}
>   $$
>   å…¶ä¸­ `Ïƒ` ä¸ºå‡æ–¹å·®ï¼Œ$\bar x$ ä¸ºå„ç»„æ•°æ®å’Œçš„å¹³å‡å€¼ï¼Œ$x_i$ ä¸ºç¬¬ `i` ç»„æ•°æ®çš„æ•°å€¼å’Œã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º `N,M` çš„å€¼ï¼ˆ`N` æ˜¯æ•´æ•°ä¸ªæ•°ï¼Œ`M` æ˜¯è¦åˆ†æˆçš„ç»„æ•°ï¼‰ã€‚
>
>   ç¬¬äºŒè¡Œæœ‰ `N` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º $A_1ã€A_2ã€â€¦â€¦ã€A_n$ã€‚ï¼ˆåŒä¸€è¡Œçš„æ•´æ•°é—´ç”¨ç©ºæ ¼åˆ†å¼€ï¼‰

**è¾“å‡ºæ ¼å¼**

>   åŒ…æ‹¬ä¸€è¡Œï¼Œè¿™ä¸€è¡ŒåªåŒ…å«ä¸€ä¸ªæ•°ï¼Œè¡¨ç¤ºæœ€å°å‡æ–¹å·®çš„å€¼(ä¿ç•™å°æ•°ç‚¹åä¸¤ä½æ•°å­—)ã€‚

**æ•°æ®èŒƒå›´**

>   +   $Mâ‰¤Nâ‰¤20,$
>   +   $2â‰¤Mâ‰¤6,$
>   +   $1â‰¤A_iâ‰¤50$

**è¾“å…¥æ ·ä¾‹**

```c++
6 3
1 2 3 4 5 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
0.00
```

**æ‰‹å†™ç¨¿**

![3191855](img/3191855.jpg)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
#include <cstring>
#include <cmath>
using namespace std;
const int N = 25, INF = 0x3f3f3f3f;
int n, m;
// æ³¨æ„æ˜¯doubleç±»å‹
double ans = INF;
int q[N], sum[N];
int calc() {
    // æ¯æ¬¡æ¸…ç©ºæ€»å’Œ
    memset(sum, 0, sizeof sum);
    // è´ªå¿ƒçš„æšä¸¾å½“å‰æ•°åº”è¯¥æ”¾ç½®äºå“ªä¸ªç»„ä¸­
    for (int i = 0; i < n; i ++ ) {
        // é»˜è®¤ç»„k = 0
        int k = 0;
        for (int j = 0; j < m; j ++ )
            // å¦‚æœå½“å‰ç»„çš„æ€»å’Œæ›´å°ï¼Œåˆ™æ›´æ–°ç»„çš„ç¼–å·
            if (sum[j] < sum[k]) k = j;
        // å°†å½“å‰æ ‘æ’å…¥åˆ°ç»„kä¸­
        sum[k] += q[i];
    }
    // è®¡ç®—å¹³å‡å€¼
    double avg = 0;
    for (int i = 0; i < m; i ++ ) avg += (double)sum[i] / m;
    double res = 0;
    for (int i = 0; i < m; i ++ )
        // å‡æ–¹å·®çš„å…¬å¼
        res += (sum[i] - avg) * (sum[i] - avg);
    // åˆ«å¿˜è®°é™¤mï¼Œä¸æ˜¯é™¤nï¼Œå¥½å¥½ç†è§£ä¸‹é¢˜æ„
    res = sqrt(res / m);
    // æ›´æ–°ç­”æ¡ˆ
    ans = min(ans, res);
    return res;
}
void simulate_anneal() {
    // éšæœºç”Ÿæˆåºåˆ—
    random_shuffle(q, q + n);
    for (double t = 1e6; t > 1e-6; t *= 0.99) {
        // éšæœºç”Ÿæˆä¸¤ä¸ªä¸‹æ ‡
        int a = rand() % n, b = rand() % n;
        double x = calc();
        swap(q[a], q[b]);
        double y = calc();
        double dt = y - x;
        if (exp(-dt / t) < (double)rand() / RAND_MAX) swap(q[a], q[b]);
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n; i ++ ) scanf("%d", &q[i]);
    // è¿­ä»£100æ¬¡
    for (int i = 0; i < 100; i ++ )
        simulate_anneal();
    printf("%.2lf\n", ans);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`è´ªå¿ƒ`ã€`æ¨¡æ‹Ÿé€€ç«`

**ç¼åˆæ€ª**



### çˆ¬å±±æ³•

#### [AcWing 207. çƒå½¢ç©ºé—´äº§ç”Ÿå™¨](https://www.acwing.com/problem/content/209/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸€ä¸ªçƒå½¢ç©ºé—´äº§ç”Ÿå™¨èƒ½å¤Ÿåœ¨ `n` ç»´ç©ºé—´ä¸­äº§ç”Ÿä¸€ä¸ªåšç¡¬çš„çƒä½“ã€‚
>
>   ç°åœ¨ï¼Œä½ è¢«å›°åœ¨äº†è¿™ä¸ª `n` ç»´çƒä½“ä¸­ï¼Œä½ åªçŸ¥é“çƒé¢ä¸Š `n+1` ä¸ªç‚¹çš„åæ ‡ï¼Œä½ éœ€è¦ä»¥æœ€å¿«çš„é€Ÿåº¦ç¡®å®šè¿™ä¸ª `n` ç»´çƒä½“çš„çƒå¿ƒåæ ‡ï¼Œä»¥ä¾¿äºæ‘§æ¯è¿™ä¸ªçƒå½¢ç©ºé—´äº§ç”Ÿå™¨ã€‚
>
>   **æ³¨æ„ï¼š** æ•°æ®ä¿è¯æœ‰å”¯ä¸€è§£ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥çš„ `n + 1` è¡Œï¼Œæ¯è¡Œæœ‰ `n` ä¸ªå®æ•°ï¼Œè¡¨ç¤ºçƒé¢ä¸Šä¸€ç‚¹çš„ `n` ç»´åæ ‡ã€‚
>
>   æ¯ä¸€ä¸ªå®æ•°ç²¾ç¡®åˆ°å°æ•°ç‚¹å `6` ä½ï¼Œä¸”å…¶ç»å¯¹å€¼éƒ½ä¸è¶…è¿‡ `20000`ã€‚

**è¾“å‡ºæ ¼å¼**

>   æœ‰ä¸”åªæœ‰ä¸€è¡Œï¼Œä¾æ¬¡ç»™å‡ºçƒå¿ƒçš„ `n` ç»´åæ ‡ï¼ˆ`n` ä¸ªå®æ•°ï¼‰ï¼Œä¸¤ä¸ªå®æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
>   æ¯ä¸ªå®æ•°ç²¾ç¡®åˆ°å°æ•°ç‚¹å `3` ä½ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10$

**è¾“å…¥æ ·ä¾‹**

```c++
2
0.0 0.0
-1.0 1.0
1.0 0.0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
0.500 1.500
```

**æ‰‹å†™ç¨¿**

![3202158](img/3202158.png)

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
#include <cstring>
using namespace std;
const int N = 15;
int n;
// dist[N]è¡¨ç¤ºåœ†å¿ƒçš„nç»´åæ ‡
// delta[N]è¡¨ç¤ºæ¯ä¸ªç‚¹åœ¨å½“å‰æ–¹å‘ä¸Šçš„åç§»é‡
// d[N]è¡¨ç¤ºæ¯ä¸ªç‚¹è·ç¦»åœ†å¿ƒçš„æ¬§å¼è·ç¦»
double dist[N], delta[N], d[N];
double a[N][N];
void calc() {
    double avg = 0;
    memset(d, 0, sizeof d);
    memset(delta, 0, sizeof delta);
    // æšä¸¾æ¯ä¸ªç‚¹
    for (int i = 1; i <= n + 1; i ++ ) {
        // è®¡ç®—æ¬§å¼è·ç¦»
        for (int j = 1; j <= n; j ++ )
            d[i] += (a[i][j] - dist[j]) * (a[i][j] - dist[j]);
        // è·ç¦»è¦å¼€æ ¹å·
        d[i] = sqrt(d[i]);
        // è®¡ç®—å¹³å‡å€¼
        avg += d[i] / (n + 1);
    }
    // æšä¸¾æ¯ä¸ªç‚¹
    for (int i = 1; i <= n + 1; i ++ )
        // æšä¸¾æ¯ä¸ªç‚¹çš„æ¯ä¸€ç»´å‘é‡
        for (int j = 1; j <= n; j ++ )
            // å°†æ‰€æœ‰ç‚¹åœ¨å½“å‰ç»´çš„æ–¹å‘ä¸Šçš„åç§»é‡ç´¯åŠ 
            delta[j] += (d[i] - avg) / avg * (a[i][j] - dist[j]);
    return;
}

int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n + 1; i ++ )
        for (int j = 1; j <= n; j ++ ) {
            scanf("%lf", &a[i][j]);
            // nä¸ªç‚¹çš„è´¨å¿ƒ
            // è´¨å¿ƒè·ç¦»åŸç‚¹æ¯”è¾ƒè¿‘
            dist[j] += a[i][j] / (n + 1);
        }
    for (double t = 1e4; t > 1e-6; t *= 0.99997) {
        calc();
        for (int i = 1; i <= n; i ++ )
            // ä¹˜æ¸©åº¦çš„ç›®çš„ï¼Œæ˜¯è®©åç§»é‡è¶‹äºç¨³å®š
            // deltaå¸¦æ­£è´Ÿï¼Œæ‰€ä»¥ï¼Œç›´æ¥åŠ å³å¯
            dist[i] += t * delta[i];
    }
    for (int i = 1; i <= n; i ++ )
        printf("%.3lf ", dist[i]);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_t)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`çˆ¬å±±æ³•`

**ç¼åˆæ€ª**

# å›¾è®º

## `Dijkstra`

### åŸç†ä»¥åŠä¸ `SPFA` çš„åŒºåˆ«

![3240836](img/3240836.png)

### [AcWing 849. Dijkstraæ±‚æœ€çŸ­è·¯ I](https://www.acwing.com/problem/content/851/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œæ‰€æœ‰è¾¹æƒå‡ä¸ºæ­£å€¼ã€‚
>
>   è¯·ä½ æ±‚å‡º `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœæ— æ³•ä» `1` å·ç‚¹èµ°åˆ° `n` å·ç‚¹ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `x,y,z`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ‰å‘è¾¹ï¼Œè¾¹é•¿ä¸º `z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚
>
>   å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤500,$
>   +   $1â‰¤mâ‰¤10^5,$
>   +   $å›¾ä¸­æ¶‰åŠè¾¹é•¿å‡ä¸è¶…è¿‡10000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2 2
2 3 1
1 3 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![3231707](img/3231707.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 510, INF = 0x3f3f3f3f;
int n, m;
int st[N], dist[N];
int g[N][N];
int dijkstra() {
    memset(dist, 0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    // åˆå§‹åŒ–è·ç¦»
    dist[1] = 0;
    for (int i = 0; i < n; i ++ ) {
        // æ‰¾åˆ°ã€æœªè¢«é€‰æ‹©ã€‘çš„æœ€å°çš„ç‚¹
        int t = -1;
        for (int j = 1; j <= n; j ++ )
            if (!st[j] && (t == -1 || dist[j] < dist[t])) t = j;
        // æ ‡è®°å½“å‰ç‚¹å·²ç»è¢«é€‰æ‹©
        st[t] = true;
        // ä½¿ç”¨æœ€å°ç‚¹tå»æ›´æ–°ã€æœªè¢«é€‰æ‹©ã€‘çš„ç‚¹
        for (int j = 1; j <= n; j ++ )
            if (!st[j] && dist[j] > dist[t] + g[t][j])
                dist[j] = dist[t] + g[t][j];
    }
    if (dist[n] == INF) return -1;
    return dist[n];
}
int main() {
    scanf("%d%d", &n, &m);
    // åˆå§‹åŒ–ä¸ºæ­£æ— ç©·
    memset(g, 0x3f, sizeof g);
    // åˆå§‹åŒ–å¯¹è§’çº¿çš„è·ç¦»
    for (int i = 1; i <= n; i ++ ) g[i][i] = 0;
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        // æ³¨æ„ï¼šæœ‰ã€é‡è¾¹ã€‘ï¼Œå–é‡è¾¹çš„æœ€å°å€¼
        g[u][v] = min(g[u][v], w);
    }
    cout << dijkstra() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`Dijkstra`

**ç¼åˆæ€ª**

### [AcWing 850. Dijkstraæ±‚æœ€çŸ­è·¯ II](https://www.acwing.com/problem/content/852/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œæ‰€æœ‰è¾¹æƒå‡ä¸ºéè´Ÿå€¼ã€‚
>
>   è¯·ä½ æ±‚å‡º `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœæ— æ³•ä» `1` å·ç‚¹èµ°åˆ° `n` å·ç‚¹ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `x,y,z`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ‰å‘è¾¹ï¼Œè¾¹é•¿ä¸º `z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚
>
>   å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤1.5Ã—10^5,$
>   +   $å›¾ä¸­æ¶‰åŠè¾¹é•¿å‡ä¸å°äº 0ï¼Œä¸”ä¸è¶…è¿‡ 10000ã€‚$
>   +   $æ•°æ®ä¿è¯ï¼šå¦‚æœæœ€çŸ­è·¯å­˜åœ¨ï¼Œåˆ™æœ€çŸ­è·¯çš„é•¿åº¦ä¸è¶…è¿‡ 10^9ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2 2
2 3 1
1 3 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

>   åŸç†
>
>   ![3231936](img/3231936.png)
>
>   è¡¥å……è¯´æ˜
>
>   ![4121018](img/4121018.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 1.5e5 + 10, INF = 0x3f3f3f3f;
int n, m, idx;
int h[N], e[N], w[N], ne[N], dist[N], st[N];
priority_queue<PII, vector<PII>, greater<PII>> q;
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
int dijkstra() {
    memset(dist, 0x3f, sizeof dist);
    dist[1] = 0;
    q.push({0, 1});
    while (q.size()) {
        auto t = q.top(); q.pop();
        int v = t.y;
        // å¦‚æœvå·²ç»è¢«è®¿é—®è¿‡ï¼Œåˆ™ç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡è®¿é—®ã€åŸå› åœ¨æ‰‹å†™ç¨¿ä¸­å·²ç»è¯´æ˜ã€‘
        if (st[v]) continue;
        // å¦‚æœå·²ç»è®¿é—®åˆ°ç»ˆç‚¹
        if (v == n) break;
        // å°†å½“å‰ç‚¹æ ‡è®°ä¸ºå·²ç»é€‰æ‹©
        st[v] = true;
        // éå†vçš„é‚»æ¥ç‚¹
        for (int i = h[v]; i != -1; i = ne[i]) {
            int j = e[i];
            // å¦‚æœå½“å‰ç‚¹æ²¡æœ‰è¢«è®¿é—®è¿‡å¹¶ä¸”å½“å‰ç‚¹æœ‰æ›´ä¼˜çš„è·¯å¾„
            // é‚£å°±å¹²å®ƒ
            if (!st[j] && dist[j] > dist[v] + w[i]) {
                dist[j] = dist[v] + w[i];
                q.push({dist[j], j});
                // æ³¨æ„: è¿™é‡Œä¸èƒ½å¡«å†™st[j] = true[æ‰‹å†™ç¨¿è¡¥å……è¯´æ˜]
            }
        }
    }
    if (dist[n] == INF) return -1;
    return dist[n];
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        // é¢†æ¥è¡¨ä¸éœ€è¦è€ƒè™‘é‡è¾¹çš„é—®é¢˜
        add(u, v, w);
    }
    cout << dijkstra() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(log_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`å †ä¼˜åŒ–ç‰ˆDijkstra`

**ç¼åˆæ€ª**

### [AcWing 4196. æœ€çŸ­è·¯å¾„](https://www.acwing.com/problem/content/4199/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„çš„æ— å‘å›¾ã€‚
>
>   ç‚¹çš„ç¼–å·ä» `1` åˆ° `n`ã€‚
>
>   å›¾ä¸­å¯èƒ½åŒ…å«é‡è¾¹å’Œè‡ªç¯ã€‚
>
>   è¯·ä½ æ‰¾åˆ°å¹¶è¾“å‡ºä¸€æ¡ä»ç‚¹ `1` åˆ°ç‚¹ `n` çš„æœ€çŸ­è·¯å¾„ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n,m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `a,b,w`ï¼Œè¡¨ç¤ºç‚¹ `a` å’Œç‚¹ `b` ä¹‹é—´å­˜åœ¨ä¸€æ¡æ— å‘è¾¹ï¼Œè¾¹é•¿ä¸º `w`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¦‚æœæœ€çŸ­è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚
>
>   å¦åˆ™ï¼Œåœ¨ä¸€è¡Œå†…è¾“å‡ºä»ç‚¹ `1` åˆ°ç‚¹ `n` çš„æœ€çŸ­è·¯å¾„ä¸­ä¾æ¬¡åŒ…å«çš„ç‚¹çš„ç¼–å·ï¼Œå„ç‚¹ç¼–å·ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚
>
>   å¦‚æœç­”æ¡ˆä¸å”¯ä¸€ï¼Œè¾“å‡ºä»»æ„åˆç†æ–¹æ¡ˆå‡å¯ã€‚

**æ•°æ®èŒƒå›´**

>   +   $å‰å…­ä¸ªæµ‹è¯•ç‚¹æ»¡è¶³ 2 â‰¤ n â‰¤ 10ï¼Œ1 â‰¤ m â‰¤ 10ã€‚$
>   +   $æ‰€æœ‰æµ‹è¯•ç‚¹æ»¡è¶³ 2 â‰¤ n â‰¤ 10^5ï¼Œ1 â‰¤ m â‰¤ 10^5ï¼Œ1 â‰¤ a, b â‰¤ nï¼Œ1 â‰¤ w â‰¤ 10^6ã€‚$
>   +   $æœ¬é¢˜ä¸å¡spfaç®—æ³•ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
5 6
1 2 2
2 5 5
2 3 4
1 4 1
4 3 3
3 5 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 4 3 5
```

**æ‰‹å†™ç¨¿**

>   1.   `long long` å  `8` ä¸ªå­—èŠ‚, å› æ­¤, `memset` åˆå§‹åŒ–ä¸º `0x3f` çš„æ—¶å€™, æœ€å¤§å€¼ä¸æ˜¯ `0x3f3f3f3f`, è€Œæ˜¯ `0x3f3f3f3f3f3f3f3fll` å…± `8` ä¸ª `3f`

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
#define x first
#define y second
using namespace std;
typedef long long LL;
typedef pair<LL, int> PLI;
const int N = 100010, M = 200010;
// LLå 8ä¸ªå­—èŠ‚, å› æ­¤, INFåˆå§‹åŒ–ä¸º8ä¸ª3f
const LL INF = 0x3f3f3f3f3f3f3f3fll;
int n, m, idx;
int h[N], e[M], w[M], ne[M], st[N], path[N];
LL dist[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dijkstra() {
    // åˆå§‹åŒ–dist, ç±»å‹ä¸ºLL, å 8ä¸ªå­—èŠ‚!!!
    memset(dist, 0x3f, sizeof dist);
    memset(st, false, sizeof st);
    priority_queue<PLI, vector<PLI>, greater<PLI>> heap;
    // ä»nåˆ°1å€’åºæšä¸¾
    dist[n] = true;
    heap.push({0, n});
    while (heap.size()) {
        auto t = heap.top(); heap.pop();
        int u = t.y;
        LL distance = t.x;
        if (st[u]) continue;
        st[u] = true;
        for (int i = h[u]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] > distance + w[i]) {
                dist[j] = distance + w[i];
                heap.push({dist[j], j});
                path[j] = u;
            }
        }
    }
    if (dist[1] == INF) cout << -1 << endl;
    else {
        int start = 1;
        while (start != n) {
            cout << start << " ";
            start = path[start];
        }
        // æœ€åè¾“å‡ºnå³å¯
        cout << n << endl;
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    dijkstra();
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`è·¯å¾„è¾“å‡º`

**ç¼åˆæ€ª**



## `Bellman-Ford`

### [AcWing 853. æœ‰è¾¹æ•°é™åˆ¶çš„æœ€çŸ­è·¯](https://www.acwing.com/problem/content/855/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œ **è¾¹æƒå¯èƒ½ä¸ºè´Ÿæ•°**ã€‚
>
>   è¯·ä½ æ±‚å‡ºä» `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€å¤šç»è¿‡ `k` æ¡è¾¹çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœæ— æ³•ä» `1` å·ç‚¹èµ°åˆ° `n` å·ç‚¹ï¼Œè¾“å‡º `impossible`ã€‚
>
>   æ³¨æ„ï¼šå›¾ä¸­å¯èƒ½ **å­˜åœ¨è´Ÿæƒå›è·¯** ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `n,m,k`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `x,y,z`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ‰å‘è¾¹ï¼Œè¾¹é•¿ä¸º `z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä» `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€å¤šç»è¿‡ `k` æ¡è¾¹çš„æœ€çŸ­è·ç¦»ã€‚
>
>   å¦‚æœä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è·¯å¾„ï¼Œåˆ™è¾“å‡º `impossible`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,kâ‰¤500,$
>   +   $1â‰¤mâ‰¤10000,$
>   +   $ä»»æ„è¾¹é•¿çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 10000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3 1
1 2 1
2 3 1
1 3 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![3240954](img/3240954.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1e4 + 10, INF = 0x3f3f3f3f;
struct Node {
    int u, v, w;
}edges[N];
int n, m, k;
int backup[N], dist[N];
int Bellman_Ford() {
    // åˆå§‹åŒ–è·ç¦»
    memset(dist, 0x3f, sizeof dist);
    // è·ç¦»æºç‚¹çš„è·ç¦»ä¸º0
    dist[1] = 0;
    for (int i = 0; i < k; i ++ ) { // é™åˆ¶èµ°kæ¡è·¯
        // å°†ä¸Šä¸€å±‚çš„æ•°æ®å¤‡ä»½
        memcpy(backup, dist, sizeof dist);
        for (int j = 0; j < m; j ++ ) { // éå†æ¯æ¡è¾¹
            int u = edges[j].u, v = edges[j].v, w = edges[j].w;
            // è®°å¾—ä½¿ç”¨ä¸Šä¸€å±‚çš„æ•°æ®
            dist[v] = min(dist[v], backup[u] + w);
        }
    }
    if (dist[n] > INF / 2) return INF;
    return dist[n];
}
int main() {
    scanf("%d%d%d", &n, &m, &k);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        edges[i] = {u, v, w};
    }
    int t = Bellman_Ford();
    if (t == INF) puts("impossible");
    else cout << t << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mk)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`Bellman_Ford`

**ç¼åˆæ€ª**

## `SPFA`ã€å †ä¼˜åŒ–ç‰ˆ `BF`ã€‘

### [AcWing 851. spfaæ±‚æœ€çŸ­è·¯](https://www.acwing.com/problem/content/853/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œ **è¾¹æƒå¯èƒ½ä¸ºè´Ÿæ•°**ã€‚
>
>   è¯·ä½ æ±‚å‡º `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœæ— æ³•ä» `1` å·ç‚¹èµ°åˆ° `n` å·ç‚¹ï¼Œåˆ™è¾“å‡º `impossible`ã€‚
>
>   æ•°æ®ä¿è¯ä¸å­˜åœ¨è´Ÿæƒå›è·¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `x,y,z`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ‰å‘è¾¹ï¼Œè¾¹é•¿ä¸º `z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º `1` å·ç‚¹åˆ° `n` å·ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚
>
>   å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `impossible`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤10^5,$
>   +   $å›¾ä¸­æ¶‰åŠè¾¹é•¿ç»å¯¹å€¼å‡ä¸è¶…è¿‡ 10000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2 5
2 3 -3
1 3 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
```

**æ‰‹å†™ç¨¿**

![3241140](img/3241140.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 1e5 + 10, INF = 0x3f3f3f3f;
int n, m, idx;
queue<int> q;
int h[N], e[N], w[N], ne[N], dist[N], st[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
int spfa() {
    // åˆå§‹åŒ–è·ç¦»
    memset(dist, 0x3f, sizeof dist);
    // æºç‚¹è·ç¦»ä¸º0
    dist[1] = 0;
    // å°†æºç‚¹å…¥é˜Ÿ
    q.push(1);
    // æ ‡è®°1å·ç‚¹å·²ç»åœ¨é˜Ÿåˆ—ä¸­
    st[1] = true;
    while (q.size()) {
        int t = q.front(); q.pop();
        // æ ‡è®°1å·ç‚¹å·²ç»å‡ºé˜Ÿåˆ—
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // ä¸æ–­æ›´æ–°æœ€å°è·ç¦»
            if (dist[j] > dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                // å¦‚æœå½“å‰ç‚¹jä¸åœ¨é˜Ÿåˆ—ä¸­
                // å…¥é˜Ÿ
                // æ ‡è®°å…¶åœ¨é˜Ÿåˆ—ä¸­
                if (!st[j]) {
                    st[j] = true;
                    q.push(j);
                }
            }
        }
    }
    if (dist[n] > INF / 2) return INF;
    return dist[n];
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        add(u, v, w);
    }
    int t = spfa();
    if (t == INF) puts("impossible");
    else cout << t << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$æœ€åæ—¶é—´å¤æ‚åº¦O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`spfa`

**ç¼åˆæ€ª**

### [AcWing 852. spfaåˆ¤æ–­è´Ÿç¯](https://www.acwing.com/problem/content/854/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œ **è¾¹æƒå¯èƒ½ä¸ºè´Ÿæ•°**ã€‚
>
>   è¯·ä½ åˆ¤æ–­å›¾ä¸­æ˜¯å¦å­˜åœ¨è´Ÿæƒå›è·¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `x,y,z`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ‰å‘è¾¹ï¼Œè¾¹é•¿ä¸º `z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¦‚æœå›¾ä¸­**å­˜åœ¨**è´Ÿæƒå›è·¯ï¼Œåˆ™è¾“å‡º `Yes`ï¼Œå¦åˆ™è¾“å‡º `No`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤2000,$
>   +   $1â‰¤mâ‰¤10000,$
>   +   $å›¾ä¸­æ¶‰åŠè¾¹é•¿ç»å¯¹å€¼å‡ä¸è¶…è¿‡ 10000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2 -1
2 3 4
3 1 -4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
Yes
```

**æ‰‹å†™ç¨¿**

>   1.   å¦‚æœæŸä¸ªç‚¹è¢«æ›´æ–°çš„æ¬¡æ•°å¤§äºç­‰äº `n`ï¼Œè¯´æ˜ä¸€å®šå­˜åœ¨è´Ÿç¯

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 2010, M = 10010;
int n, m, idx;
int h[N], dist[N], cnt[N], st[N], e[M], w[M], ne[M];
queue<int> q;
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
bool spfa() {
    for (int i = 1; i <= n; i ++ ) {
        q.push(i);
        st[i] = true;
    }
    while (q.size()) {
        int t = q.front(); q.pop();
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] > dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                // è®°å½•æ¯ä¸ªç‚¹è¢«æ›´æ–°çš„æ¬¡æ•°
                cnt[j] = cnt[t] + 1;
                // å¦‚æœè¢«æ›´æ–°çš„æ¬¡æ•°å¤§äºç­‰äºnï¼Œè¯´æ˜å­˜åœ¨ç¯
        		if (cnt[j] >= n) return true;
                if (!st[j]) {
                    st[j] = true;
                    q.push(j);
                }
            }
        }
    }
    return false;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        add(u, v, w);
    }
    if(spfa()) puts("Yes");
    else puts("No");
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`SPFAåˆ¤è´Ÿç¯`

**ç¼åˆæ€ª**



## å•æºæœ€çŸ­è·¯çš„å»ºå›¾æ–¹å¼

### [AcWing 1129. çƒ­æµª](https://www.acwing.com/problem/content/1131/)

**é¢˜ç›®æè¿°**

>   å¾·å…‹è¨æ–¯çº¯æœ´çš„æ°‘ä¼—ä»¬è¿™ä¸ªå¤å¤©æ­£åœ¨é­å—å·¨å¤§çš„çƒ­æµªï¼ï¼ï¼
>
>   ä»–ä»¬çš„å¾·å…‹è¨æ–¯é•¿è§’ç‰›åƒèµ·æ¥ä¸é”™ï¼Œå¯æ˜¯å®ƒä»¬å¹¶ä¸æ˜¯å¾ˆæ“…é•¿ç”Ÿäº§å¯Œå«å¥¶æ²¹çš„ä¹³åˆ¶å“ã€‚
>
>   å†œå¤« `John` æ­¤æ—¶èº«å…ˆå£«å’åœ°æ‰¿æ‹…èµ·å‘å¾·å…‹è¨æ–¯è¿é€å¤§é‡çš„è¥å…»å†°å‡‰çš„ç‰›å¥¶çš„é‡ä»»ï¼Œä»¥å‡è½»å¾·å…‹è¨æ–¯äººå¿å—é…·æš‘çš„ç—›è‹¦ã€‚
>
>   `John` å·²ç»ç ”ç©¶è¿‡å¯ä»¥æŠŠç‰›å¥¶ä»å¨æ–¯åº·æ˜Ÿè¿é€åˆ°å¾·å…‹è¨æ–¯å·çš„è·¯çº¿ã€‚
>
>   è¿™äº›è·¯çº¿åŒ…æ‹¬èµ·å§‹ç‚¹å’Œç»ˆç‚¹ä¸€å…±æœ‰ `T` ä¸ªåŸé•‡ï¼Œä¸ºäº†æ–¹ä¾¿æ ‡å·ä¸º `1` åˆ° `T`ã€‚
>
>   é™¤äº†èµ·ç‚¹å’Œç»ˆç‚¹å¤–çš„æ¯ä¸ªåŸé•‡éƒ½ç”± **åŒå‘é“è·¯** è¿å‘è‡³å°‘ä¸¤ä¸ªå…¶å®ƒçš„åŸé•‡ã€‚
>
>   æ¯æ¡é“è·¯æœ‰ä¸€ä¸ªé€šè¿‡è´¹ç”¨ï¼ˆåŒ…æ‹¬æ²¹è´¹ï¼Œè¿‡è·¯è´¹ç­‰ç­‰ï¼‰ã€‚
>
>   ç»™å®šä¸€ä¸ªåœ°å›¾ï¼ŒåŒ…å« ``C`` æ¡ç›´æ¥è¿æ¥ `2` ä¸ªåŸé•‡çš„é“è·¯ã€‚
>
>   æ¯æ¡é“è·¯ç”±é“è·¯çš„èµ·ç‚¹ $R_s$ï¼Œç»ˆç‚¹ $R_e$ å’ŒèŠ±è´¹ $C_i$ ç»„æˆã€‚
>
>   æ±‚ä»èµ·å§‹çš„åŸé•‡ $T_s$ åˆ°ç»ˆç‚¹çš„åŸé•‡ $T_e$ æœ€å°çš„æ€»è´¹ç”¨ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œ: `4` ä¸ªç”±ç©ºæ ¼éš”å¼€çš„æ•´æ•°: $T,C,T_s,T_e$;
>
>   ç¬¬ `2` åˆ°ç¬¬ `C + 1` è¡Œ: ç¬¬ `i + 1` è¡Œæè¿°ç¬¬ `i` æ¡é“è·¯ï¼ŒåŒ…å« `3` ä¸ªç”±ç©ºæ ¼éš”å¼€çš„æ•´æ•°: $R_s,R_e,C_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªå•ç‹¬çš„æ•´æ•°è¡¨ç¤ºä» $T_s$ åˆ° $T_e$ çš„æœ€å°æ€»è´¹ç”¨ã€‚
>
>   æ•°æ®ä¿è¯è‡³å°‘å­˜åœ¨ä¸€æ¡é“è·¯ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ T â‰¤ 2500,$
>   +   $1 â‰¤ C â‰¤ 6200,$
>   +   $1 â‰¤ T_s, T_e, R_s, R_e â‰¤ T,$
>   +   $1 â‰¤ C_i â‰¤ 1000$

**è¾“å…¥æ ·ä¾‹**

```c++
7 11 5 4
2 4 2
1 4 3
7 2 2
3 4 3
5 7 5
7 3 3
6 1 1
6 3 4
2 4 3
5 6 3
7 2 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
7
```

**æ‰‹å†™ç¨¿**

>   1.   ç¼åˆæ€ª ==> `spfa`
>   2.   ç¼åˆæ€ª ==> å¾ªç¯é˜Ÿåˆ—
>
>   ![491255](img/491255.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 2510, M = 6200 * 2 + 10;
int n, m, S, T, idx;
int h[N], e[M], w[M], ne[M], st[N], dist[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void spfa() {
    memset(dist, 0x3f, sizeof dist);
    memset(st, false, sizeof st);
    // å¾ªç¯é˜Ÿåˆ—é˜Ÿå¤´é˜Ÿå°¾åˆå§‹åŒ–ä¸º0
    int hh = 0, tt = 0;
    dist[S] = 0;
    // é˜Ÿå°¾æŒ‡é’ˆæ°¸è¿œæŒ‡å‘[æœ€åä¸€ä¸ªä½ç½®]çš„[ä¸‹ä¸€ä¸ªä½ç½®]
    q[tt ++ ] = S;
    st[S] = true;
    // å¾ªç¯é˜Ÿåˆ—åˆ¤ç©ºæ¡ä»¶ hh == tt
    // å¾ªç¯é˜Ÿåˆ—åˆ¤æ»¡æ¡ä»¶ (tt + 1) % é•¿åº¦ == hh
    while (hh != tt) {
        int t = q[hh ++ ];
        // é˜Ÿå¤´è¶Šç•Œ, åˆ™é‡ç½®ä¸º0
        if (hh >= N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] > dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                if (!st[j]) {
                    st[j] = true;
                    // é˜Ÿå°¾è¶Šç•Œ, åˆ™é‡ç½®ä¸º0
                    if (tt >= N) tt = 0;
                    q[tt ++ ] = j;
                }
            }
        }
    }
    return;
}
int main() {
    scanf("%d%d%d%d", &n, &m, &S, &T);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        add(u, v, w);
        add(v, u, w);
    }
    spfa();
    cout << dist[T] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$å¹³å‡æ—¶é—´å¤æ‚åº¦O(log_n), æœ€åæ—¶é—´å¤æ‚åº¦O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`SPFA`

**ç¼åˆæ€ª**

[AcWing 851. spfaæ±‚æœ€çŸ­è·¯](#AcWing 851. spfaæ±‚æœ€çŸ­è·¯)ã€[LeetCode 622. è®¾è®¡å¾ªç¯é˜Ÿåˆ—](#LeetCode 622. è®¾è®¡å¾ªç¯é˜Ÿåˆ—)

### [AcWing 1128. ä¿¡ä½¿](https://www.acwing.com/problem/content/1130/)

**é¢˜ç›®æè¿°**

>   æˆ˜äº‰æ—¶æœŸï¼Œå‰çº¿æœ‰ `n` ä¸ªå“¨æ‰€ï¼Œæ¯ä¸ªå“¨æ‰€å¯èƒ½ä¼šä¸å…¶ä»–è‹¥å¹²ä¸ªå“¨æ‰€ä¹‹é—´æœ‰é€šä¿¡è”ç³»ã€‚
>
>   ä¿¡ä½¿è´Ÿè´£åœ¨å“¨æ‰€ä¹‹é—´ä¼ é€’ä¿¡æ¯ï¼Œå½“ç„¶ï¼Œè¿™æ˜¯è¦èŠ±è´¹ä¸€å®šæ—¶é—´çš„ï¼ˆä»¥å¤©ä¸ºå•ä½ï¼‰ã€‚
>
>   æŒ‡æŒ¥éƒ¨è®¾åœ¨ç¬¬ä¸€ä¸ªå“¨æ‰€ã€‚
>
>   å½“æŒ‡æŒ¥éƒ¨ä¸‹è¾¾ä¸€ä¸ªå‘½ä»¤åï¼ŒæŒ‡æŒ¥éƒ¨å°±æ´¾å‡ºè‹¥å¹²ä¸ªä¿¡ä½¿å‘ä¸æŒ‡æŒ¥éƒ¨ç›¸è¿çš„å“¨æ‰€é€ä¿¡ã€‚
>
>   å½“ä¸€ä¸ªå“¨æ‰€æ¥åˆ°ä¿¡åï¼Œè¿™ä¸ªå“¨æ‰€å†…çš„ä¿¡ä½¿ä»¬ä¹Ÿä»¥åŒæ ·çš„æ–¹å¼å‘å…¶ä»–å“¨æ‰€é€ä¿¡ã€‚**ä¿¡åœ¨ä¸€ä¸ªå“¨æ‰€å†…åœç•™çš„æ—¶é—´å¯ä»¥å¿½ç•¥ä¸è®¡**ã€‚
>
>   ç›´è‡³æ‰€æœ‰ `n` ä¸ªå“¨æ‰€å…¨éƒ¨æ¥åˆ°å‘½ä»¤åï¼Œé€ä¿¡æ‰ç®—æˆåŠŸã€‚
>
>   å› ä¸ºå‡†å¤‡å……è¶³ï¼Œæ¯ä¸ªå“¨æ‰€å†…éƒ½å®‰æ’äº†è¶³å¤Ÿçš„ä¿¡ä½¿ï¼ˆå¦‚æœä¸€ä¸ªå“¨æ‰€ä¸å…¶ä»– `k` ä¸ªå“¨æ‰€æœ‰é€šä¿¡è”ç³»çš„è¯ï¼Œè¿™ä¸ªå“¨æ‰€å†…è‡³å°‘ä¼šé…å¤‡ `k` ä¸ªä¿¡ä½¿ï¼‰ã€‚
>
>   ç°åœ¨æ€»æŒ‡æŒ¥è¯·ä½ ç¼–ä¸€ä¸ªç¨‹åºï¼Œè®¡ç®—å‡ºå®Œæˆæ•´ä¸ªé€ä¿¡è¿‡ç¨‹æœ€çŸ­éœ€è¦å¤šå°‘æ—¶é—´ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ï¼Œä¸­é—´ç”¨ `1` ä¸ªç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºæœ‰ `n` ä¸ªå“¨æ‰€å’Œ `m` æ¡é€šä¿¡çº¿è·¯ã€‚
>
>   ç¬¬ `2` è‡³ `m+1` è¡Œï¼šæ¯è¡Œä¸‰ä¸ªæ•´æ•° `iã€jã€k`ï¼Œä¸­é—´ç”¨ `1` ä¸ªç©ºæ ¼éš”å¼€ï¼Œè¡¨ç¤ºç¬¬ `i` ä¸ªå’Œç¬¬ `j` ä¸ªå“¨æ‰€ä¹‹é—´å­˜åœ¨ **åŒå‘** é€šä¿¡çº¿è·¯ï¼Œä¸”è¿™æ¡çº¿è·¯è¦èŠ±è´¹ `k` å¤©ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå®Œæˆæ•´ä¸ªé€ä¿¡è¿‡ç¨‹çš„æœ€çŸ­æ—¶é—´ã€‚
>
>   å¦‚æœä¸æ˜¯æ‰€æœ‰çš„å“¨æ‰€éƒ½èƒ½æ”¶åˆ°ä¿¡ï¼Œå°±è¾“å‡º `-1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 100,$
>   +   $1 â‰¤ m â‰¤ 200,$
>   +   $1 â‰¤ k â‰¤ 1000$

**è¾“å…¥æ ·ä¾‹**

```c++
4 4
1 2 4
2 3 7
2 4 1
3 4 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
11
```

**æ‰‹å†™ç¨¿**

![491315](img/491315.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110, INF = 0x3f3f3f3f;
int n, m;
int g[N][N];
int main() {
    scanf("%d%d", &n, &m);
    memset(g, 0x3f, sizeof g);
    for (int i = 1; i <= n; i ++ ) g[i][i] = 0;
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        // é˜²æ­¢å‡ºç°é‡è¾¹, é‡è¾¹å–æœ€å°å€¼
        g[u][v] = g[v][u] = min(g[u][v], w);
    }
    // Floydæ¨¡æ¿
    for (int k = 1; k <= n; k ++ )
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= n; j ++ )
                g[i][j] = min(g[i][j], g[i][k] + g[k][j]);
    // è®°å½•ç­”æ¡ˆ
    int res = -1;
    for (int i = 1; i <= n; i ++ )
        // å–æ‰€æœ‰[æœ€å°å€¼]ä¸­çš„[æœ€å¤§å€¼], å³æœ€å°æœ€å¤§å€¼
        res = max(res, g[1][i]);
    // ä¸è¿é€š, è¾“å‡º-1
    if (res == INF) res = -1;
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`Floyd`

**ç¼åˆæ€ª**



### [AcWing 1127. é¦™ç”œçš„é»„æ²¹](https://www.acwing.com/problem/content/1129/)

**é¢˜ç›®æè¿°**

>   å†œå¤« `John` å‘ç°äº†åšå‡ºå…¨å¨æ–¯åº·è¾›å·æœ€ç”œçš„é»„æ²¹çš„æ–¹æ³•ï¼šç³–ã€‚
>
>   æŠŠç³–æ”¾åœ¨ä¸€ç‰‡ç‰§åœºä¸Šï¼Œä»–çŸ¥é“ `N` åªå¥¶ç‰›ä¼šè¿‡æ¥èˆ”å®ƒï¼Œè¿™æ ·å°±èƒ½åšå‡ºèƒ½å–å¥½ä»·é’±çš„è¶…ç”œé»„æ²¹ã€‚
>
>   å½“ç„¶ï¼Œä»–å°†ä»˜å‡ºé¢å¤–çš„è´¹ç”¨åœ¨å¥¶ç‰›ä¸Šã€‚
>
>   å†œå¤« `John` å¾ˆç‹¡çŒ¾ï¼Œå°±åƒä»¥å‰çš„å·´ç”«æ´›å¤«ï¼Œä»–çŸ¥é“ä»–å¯ä»¥è®­ç»ƒè¿™äº›å¥¶ç‰›ï¼Œè®©å®ƒä»¬åœ¨å¬åˆ°é“ƒå£°æ—¶å»ä¸€ä¸ªç‰¹å®šçš„ç‰§åœºã€‚
>
>   ä»–æ‰“ç®—å°†ç³–æ”¾åœ¨é‚£é‡Œç„¶åä¸‹åˆå‘å‡ºé“ƒå£°ï¼Œä»¥è‡³ä»–å¯ä»¥åœ¨æ™šä¸ŠæŒ¤å¥¶ã€‚
>
>   å†œå¤« `John` çŸ¥é“æ¯åªå¥¶ç‰›éƒ½åœ¨å„è‡ªå–œæ¬¢çš„ç‰§åœºï¼ˆä¸€ä¸ªç‰§åœºä¸ä¸€å®šåªæœ‰ä¸€å¤´ç‰›ï¼‰ã€‚
>
>   ç»™å‡ºå„å¤´ç‰›åœ¨çš„ç‰§åœºå’Œç‰§åœºé—´çš„è·¯çº¿ï¼Œæ‰¾å‡ºä½¿æ‰€æœ‰ç‰›åˆ°è¾¾çš„è·¯ç¨‹å’Œæœ€çŸ­çš„ç‰§åœºï¼ˆä»–å°†æŠŠç³–æ”¾åœ¨é‚£ï¼‰ã€‚
>
>   **æ•°æ®ä¿è¯è‡³å°‘å­˜åœ¨ä¸€ä¸ªç‰§åœºå’Œæ‰€æœ‰ç‰›æ‰€åœ¨çš„ç‰§åœºè¿é€š**ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œ: ä¸‰ä¸ªæ•°ï¼šå¥¶ç‰›æ•° `N`ï¼Œç‰§åœºæ•° `P`ï¼Œç‰§åœºé—´é“è·¯æ•° `C`ã€‚
>
>   ç¬¬äºŒè¡Œåˆ°ç¬¬ `N + 1` è¡Œ: `1` åˆ° `N` å¤´å¥¶ç‰›æ‰€åœ¨çš„ç‰§åœºå·ã€‚
>
>   ç¬¬ `N + 2` è¡Œåˆ°ç¬¬ `N + C + 1` è¡Œï¼šæ¯è¡Œæœ‰ä¸‰ä¸ªæ•°ï¼šç›¸è¿çš„ç‰§åœº`Aã€B`ï¼Œä¸¤ç‰§åœºé—´è· `D`ï¼Œå½“ç„¶ï¼Œè¿æ¥æ˜¯åŒå‘çš„ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼Œè¾“å‡ºå¥¶ç‰›å¿…é¡»è¡Œèµ°çš„æœ€å°çš„è·ç¦»å’Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 500,$
>   +   $2 â‰¤ P â‰¤ 800,$
>   +   $1 â‰¤ C â‰¤ 1450,$
>   +   $1 â‰¤ D â‰¤ 255$

**è¾“å…¥æ ·ä¾‹**

```c++
3 4 5
2
3
4
1 2 1
1 3 5
2 3 7
2 4 3
3 4 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
8
```

**æ‰‹å†™ç¨¿**

![4100916](img/4100916.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 810, M = 3000, INF = 0x3f3f3f3f;
int n, p, m, idx;
int id[N], h[N], e[M], w[M], ne[M], st[N], dist[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
int spfa(int start) {
    memset(dist, 0x3f, sizeof dist);
    memset(st, false, sizeof st);
    int hh = 0, tt = 0;
    // èµ·ç‚¹åˆ°èµ·ç‚¹çš„è·ç¦»ä¸º0
    dist[start] = 0;
    // å°†èµ·ç‚¹å…¥é˜Ÿ
    q[tt ++ ] = start;
    // å°†å½“å‰ç‚¹æ ‡è®°ä¸ºå·²ç»åœ¨é˜Ÿåˆ—ä¸­, å³å…¥é˜Ÿ
    st[start] = true;
    while (hh != tt) {
        int t = q[hh ++ ];
        // è¶Šç•Œ, åˆ™ä»0å¼€å§‹
        if (hh == N) hh = 0;
        // å°†å½“å‰ç‚¹æ ‡è®°ä¸ºä¸åœ¨å¯¹åˆ—ä¸­, å³å‡ºé˜Ÿ
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // æ›´æ–°è·ç¦»
            if (dist[j] > dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                // å¦‚æœå½“å‰ç‚¹ä¸åœ¨é˜Ÿä¸­
                if (!st[j]) {
                    // å…¥é˜Ÿ
                    q[tt ++ ] = j;
                    // è¶Šç•Œ, åˆ™ä»0å¼€å§‹
                    if (tt == N) tt = 0;
                    // æ ‡è®°å½“å‰ç‚¹åœ¨é˜Ÿåˆ—ä¸­, å³å…¥é˜Ÿ
                    st[j] = true;
                }
            }
        }
    }
    int res = 0;
    for (int i = 1; i <= n; i ++ ) {
        // è·å–å¥¶ç‰›æ‰€åœ¨çš„ç‰§åœºå·
        int j = id[i];
        // ä¸å¯è¾¾, åˆ™ç›´æ¥è¿”å›
        if (dist[j] == INF) return INF;
        // åŠ ä¸Šè·ç¦»å³å¯
        res += dist[j];
    }
    return res;
}
int main() {
    scanf("%d%d%d", &n, &p, &m);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ )
        scanf("%d", &id[i]);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        add(u, v, w);
        add(v, u, w);
    }
    int res = INF;
    for (int i = 1; i <= p; i ++ )
        // å–æœ€å°è·ç¦»å’Œ
        res = min(res, spfa(i));
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm), næ˜¯ç‰§åœºæ•°ç›®, mæ˜¯è¾¹çš„ä¸ªæ•°$

**ç©ºé—´å¤æ‚åº¦**

$O(m), mæ˜¯è¾¹æ•°$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`SPFA`

**ç¼åˆæ€ª**

### [AcWing 1126. æœ€å°èŠ±è´¹](https://www.acwing.com/problem/content/1128/)

**é¢˜ç›®æè¿°**

>   åœ¨ `n` ä¸ªäººä¸­ï¼ŒæŸäº›äººçš„é“¶è¡Œè´¦å·ä¹‹é—´å¯ä»¥äº’ç›¸è½¬è´¦ã€‚
>
>   è¿™äº›äººä¹‹é—´è½¬è´¦çš„æ‰‹ç»­è´¹å„ä¸ç›¸åŒã€‚
>
>   ç»™å®šè¿™äº›äººä¹‹é—´è½¬è´¦æ—¶éœ€è¦ä»è½¬è´¦é‡‘é¢é‡Œæ‰£é™¤ç™¾åˆ†ä¹‹å‡ çš„æ‰‹ç»­è´¹ï¼Œè¯·é—® `A` æœ€å°‘éœ€è¦å¤šå°‘é’±ä½¿å¾—è½¬è´¦å `B` æ”¶åˆ° `100` å…ƒã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•° `n,m`ï¼Œåˆ†åˆ«è¡¨ç¤ºæ€»äººæ•°å’Œå¯ä»¥äº’ç›¸è½¬è´¦çš„äººçš„å¯¹æ•°ã€‚
>
>   ä»¥ä¸‹ `m` è¡Œæ¯è¡Œè¾“å…¥ä¸‰ä¸ªæ­£æ•´æ•° `x,y,z`ï¼Œè¡¨ç¤ºæ ‡å·ä¸º `x` çš„äººå’Œæ ‡å·ä¸º `y` çš„äººä¹‹é—´äº’ç›¸è½¬è´¦éœ€è¦æ‰£é™¤ `z%` çš„æ‰‹ç»­è´¹ ( `z < 100` )ã€‚
>
>   æœ€åä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•° `A, B`ã€‚
>
>   æ•°æ®ä¿è¯ `A` ä¸ `B` ä¹‹é—´å¯ä»¥ç›´æ¥æˆ–é—´æ¥åœ°è½¬è´¦ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡º `A` ä½¿å¾— `B` åˆ°è´¦ `100` å…ƒæœ€å°‘éœ€è¦çš„æ€»è´¹ç”¨ã€‚
>
>   ç²¾ç¡®åˆ°å°æ•°ç‚¹å `8` ä½ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 2000,$
>   +   $m â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2 1
2 3 2
1 3 3
1 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
103.07153164
```

**æ‰‹å†™ç¨¿**

![4101235](img/4101235.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 2010, INF = 0x43434343;
int n, m;
int st[N];
double dist[N];
double g[N][N];
// æœ´ç´ ç‰ˆDijkstraæ¨¡æ¿
// æ³¨æ„: æ•°æ®ç±»å‹
void dijkstra(int start, int end) {
    memset(dist, 0x43, sizeof dist);
    dist[start] = 100;
    for (int i = 0; i < n - 1; i ++ ) {
        int t = -1;
        for (int j = 1; j <= n; j ++ )
            if (!st[j] && (t == -1 || dist[t] > dist[j])) t = j;
        if (t == end) return;
        st[t] = true;
        for (int j = 1; j <= n; j ++ ) {
            if (g[t][j] == INF) continue;
            if (!st[j] && dist[j] > dist[t] / g[t][j])
                dist[j] = dist[t] / g[t][j];
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        g[u][v] = g[v][u] = (100.0 - w) / 100;
    }
    int start, end;
    scanf("%d%d", &end, &start);
    // åå‘Dijkstra
    dijkstra(start, end);
    printf("%.8lf\n", dist[end]);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ´ç´ ç‰ˆDijkstra`

**ç¼åˆæ€ª**



### [AcWing 920. æœ€ä¼˜ä¹˜è½¦](https://www.acwing.com/problem/content/922/)

**é¢˜ç›®æè¿°**

>   `H` åŸæ˜¯ä¸€ä¸ªæ—…æ¸¸èƒœåœ°ï¼Œæ¯å¹´éƒ½æœ‰æˆåƒä¸Šä¸‡çš„äººå‰æ¥è§‚å…‰ã€‚
>
>   ä¸ºæ–¹ä¾¿æ¸¸å®¢ï¼Œå·´å£«å…¬å¸åœ¨å„ä¸ªæ—…æ¸¸æ™¯ç‚¹åŠå®¾é¦†ï¼Œé¥­åº—ç­‰åœ°éƒ½è®¾ç½®äº†å·´å£«ç«™å¹¶å¼€é€šäº†ä¸€äº›å•ç¨‹å·´å£«çº¿è·¯ã€‚
>
>   æ¯æ¡å•ç¨‹å·´å£«çº¿è·¯ä»æŸä¸ªå·´å£«ç«™å‡ºå‘ï¼Œä¾æ¬¡é€”ç»è‹¥å¹²ä¸ªå·´å£«ç«™ï¼Œæœ€ç»ˆåˆ°è¾¾ç»ˆç‚¹å·´å£«ç«™ã€‚
>
>   ä¸€åæ—…å®¢æœ€è¿‘åˆ° `H` åŸæ—…æ¸¸ï¼Œä»–å¾ˆæƒ³å» `S` å…¬å›­æ¸¸ç©ï¼Œä½†å¦‚æœä»ä»–æ‰€åœ¨çš„é¥­åº—æ²¡æœ‰ä¸€è·¯å·´å£«å¯ä»¥ç›´æ¥åˆ°è¾¾ `S` å…¬å›­ï¼Œåˆ™ä»–å¯èƒ½è¦å…ˆä¹˜æŸä¸€è·¯å·´å£«åå‡ ç«™ï¼Œå†ä¸‹æ¥æ¢ä¹˜åŒä¸€ç«™å°çš„å¦ä¸€è·¯å·´å£«ï¼Œè¿™æ ·æ¢ä¹˜å‡ æ¬¡ååˆ°è¾¾ `S` å…¬å›­ã€‚
>
>   ç°åœ¨ç”¨æ•´æ•° `1, 2, â€¦ N` ç»™ `H` åŸçš„æ‰€æœ‰çš„å·´å£«ç«™ç¼–å·ï¼Œçº¦å®šè¿™åæ—…å®¢æ‰€åœ¨é¥­åº—çš„å·´å£«ç«™ç¼–å·ä¸º `1`ï¼Œ`S` å…¬å›­å·´å£«ç«™çš„ç¼–å·ä¸º `N`ã€‚
>
>   å†™ä¸€ä¸ªç¨‹åºï¼Œå¸®åŠ©è¿™åæ—…å®¢å¯»æ‰¾ä¸€ä¸ªæœ€ä¼˜ä¹˜è½¦æ–¹æ¡ˆï¼Œä½¿ä»–åœ¨ä»é¥­åº—ä¹˜è½¦åˆ° `S` å…¬å›­çš„è¿‡ç¨‹ä¸­æ¢ä¹˜çš„æ¬¡æ•°æœ€å°‘ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•°å­— `M` å’Œ `N`ï¼Œè¡¨ç¤ºå¼€é€šäº† `M` æ¡å•ç¨‹å·´å£«çº¿è·¯ï¼Œæ€»å…±æœ‰ `N` ä¸ªè½¦ç«™ã€‚
>
>   ä»ç¬¬äºŒè¡Œåˆ°ç¬¬ `M + 1` è¡Œä¾æ¬¡ç»™å‡ºäº†ç¬¬ `1` æ¡åˆ°ç¬¬ `M` æ¡å·´å£«çº¿è·¯çš„ä¿¡æ¯ï¼Œå…¶ä¸­ç¬¬ `i + 1` è¡Œç»™å‡ºçš„æ˜¯ç¬¬ `i` æ¡å·´å£«çº¿è·¯çš„ä¿¡æ¯ï¼Œä»å·¦è‡³å³æŒ‰è¿è¡Œé¡ºåºä¾æ¬¡ç»™å‡ºäº†è¯¥çº¿è·¯ä¸Šçš„æ‰€æœ‰ç«™å·ï¼Œç›¸é‚»ä¸¤ä¸ªç«™å·ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼Œå¦‚æœæ— æ³•ä¹˜å·´å£«ä»é¥­åº—åˆ°è¾¾ `S` å…¬å›­ï¼Œåˆ™è¾“å‡º `NO`ï¼Œå¦åˆ™è¾“å‡ºæœ€å°‘æ¢ä¹˜æ¬¡æ•°ï¼Œæ¢ä¹˜æ¬¡æ•°ä¸º `0` è¡¨ç¤ºä¸éœ€æ¢è½¦å³å¯åˆ°è¾¾ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ M â‰¤ 100,$
>   +   $2 â‰¤ N â‰¤ 500$

**è¾“å…¥æ ·ä¾‹**

```c++
3 7
6 7
4 7 3 6
2 1 3 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
```

**æ‰‹å†™ç¨¿**

![4110919](img/4110919.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <sstream>
using namespace std;
const int N = 510, INF = 0x3f3f3f3f;
int n, m;
int stop[N], q[N], dist[N], st[N];
bool g[N][N];
// BFSæ¨¡æ¿
void bfs() {
    memset(dist, 0x3f, sizeof dist);
    int hh = 0, tt = -1;
    q[++ tt ] = 1;
    st[1] = true;
    dist[1] = 0;
    while (hh <= tt) {
        int t = q[hh ++ ];
        if (t == n) return;
        for (int i = 1; i <= n; i ++ )
            if (!st[i] && g[t][i] && dist[i] > dist[t] + 1) {
                dist[i] = dist[t] + 1;
                q[++ tt] = i;
                st[i] = true;
            }
    }
    return;
}
int main() {
    scanf("%d%d", &m, &n);
    string line;
    // ç”±äºä¸çŸ¥é“è¦è¾“å…¥å¤šå°‘ä¸ªæ•°
    // ä½¿ç”¨stringstreamæ¥å¤„ç†è¾“å…¥
    getline(cin, line);
    while (m -- ) {
        int cnt = 0, t = 0;
        getline(cin, line);
        stringstream ssin(line);
        while (ssin >> t) stop[cnt ++ ] = t;
        for (int i = 0; i < cnt; i ++ )
            for (int j = i + 1; j < cnt; j ++ )
                // ä¸¤ä¸ªç‚¹ä¹‹é—´æœ‰å•å‘è¾¹
                g[stop[i]][stop[j]] = true;
    }
    bfs();
    if (dist[n] == INF) puts("NO");
    else cout << max(dist[n] - 1, 0) << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mn^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`BFS`

**ç¼åˆæ€ª**



### [AcWing 903. æ˜‚è´µçš„è˜ç¤¼](https://www.acwing.com/problem/content/905/)

**é¢˜ç›®æè¿°**

>   å¹´è½»çš„æ¢é™©å®¶æ¥åˆ°äº†ä¸€ä¸ªå°ç¬¬å®‰éƒ¨è½é‡Œã€‚
>
>   åœ¨é‚£é‡Œä»–å’Œé…‹é•¿çš„å¥³å„¿ç›¸çˆ±äº†ï¼Œäºæ˜¯ä¾¿å‘é…‹é•¿å»æ±‚äº²ã€‚
>
>   é…‹é•¿è¦ä»–ç”¨ `10000` ä¸ªé‡‘å¸ä½œä¸ºè˜ç¤¼æ‰ç­”åº”æŠŠå¥³å„¿å«ç»™ä»–ã€‚
>
>   æ¢é™©å®¶æ‹¿ä¸å‡ºè¿™ä¹ˆå¤šé‡‘å¸ï¼Œä¾¿è¯·æ±‚é…‹é•¿é™ä½è¦æ±‚ã€‚
>
>   é…‹é•¿è¯´ï¼šâ€å—¯ï¼Œå¦‚æœä½ èƒ½å¤Ÿæ›¿æˆ‘å¼„åˆ°å¤§ç¥­å¸çš„çš®è¢„ï¼Œæˆ‘å¯ä»¥åªè¦ `8000` é‡‘å¸ã€‚å¦‚æœä½ èƒ½å¤Ÿå¼„æ¥ä»–çš„æ°´æ™¶çƒï¼Œé‚£ä¹ˆåªè¦ `5000` é‡‘å¸å°±è¡Œäº†ã€‚â€
>
>   æ¢é™©å®¶å°±è·‘åˆ°å¤§ç¥­å¸é‚£é‡Œï¼Œå‘ä»–è¦æ±‚çš®è¢„æˆ–æ°´æ™¶çƒï¼Œå¤§ç¥­å¸è¦ä»–ç”¨é‡‘å¸æ¥æ¢ï¼Œæˆ–è€…æ›¿ä»–å¼„æ¥å…¶ä»–çš„ä¸œè¥¿ï¼Œä»–å¯ä»¥é™ä½ä»·æ ¼ã€‚
>
>   æ¢é™©å®¶äºæ˜¯åˆè·‘åˆ°å…¶ä»–åœ°æ–¹ï¼Œå…¶ä»–äººä¹Ÿæå‡ºäº†ç±»ä¼¼çš„è¦æ±‚ï¼Œæˆ–è€…ç›´æ¥ç”¨é‡‘å¸æ¢ï¼Œæˆ–è€…æ‰¾åˆ°å…¶ä»–ä¸œè¥¿å°±å¯ä»¥é™ä½ä»·æ ¼ã€‚
>
>   ä¸è¿‡æ¢é™©å®¶æ²¡å¿…è¦ç”¨å¤šæ ·ä¸œè¥¿å»æ¢ä¸€æ ·ä¸œè¥¿ï¼Œå› ä¸ºä¸ä¼šå¾—åˆ°æ›´ä½çš„ä»·æ ¼ã€‚
>
>   æ¢é™©å®¶ç°åœ¨å¾ˆéœ€è¦ä½ çš„å¸®å¿™ï¼Œè®©ä»–ç”¨æœ€å°‘çš„é‡‘å¸å¨¶åˆ°è‡ªå·±çš„å¿ƒä¸Šäººã€‚
>
>   å¦å¤–ä»–è¦å‘Šè¯‰ä½ çš„æ˜¯ï¼Œåœ¨è¿™ä¸ªéƒ¨è½é‡Œï¼Œç­‰çº§è§‚å¿µååˆ†æ£®ä¸¥ã€‚
>
>   åœ°ä½å·®è·è¶…è¿‡ä¸€å®šé™åˆ¶çš„ä¸¤ä¸ªäººä¹‹é—´ä¸ä¼šè¿›è¡Œä»»ä½•å½¢å¼çš„ç›´æ¥æ¥è§¦ï¼ŒåŒ…æ‹¬äº¤æ˜“ã€‚
>
>   ä»–æ˜¯ä¸€ä¸ªå¤–æ¥äººï¼Œæ‰€ä»¥å¯ä»¥ä¸å—è¿™äº›é™åˆ¶ã€‚
>
>   ä½†æ˜¯å¦‚æœä»–å’ŒæŸä¸ªåœ°ä½è¾ƒä½çš„äººè¿›è¡Œäº†äº¤æ˜“ï¼Œåœ°ä½è¾ƒé«˜çš„çš„äººä¸ä¼šå†å’Œä»–äº¤æ˜“ï¼Œä»–ä»¬è®¤ä¸ºè¿™æ ·ç­‰äºæ˜¯é—´æ¥æ¥è§¦ï¼Œåè¿‡æ¥ä¹Ÿä¸€æ ·ã€‚
>
>   å› æ­¤ä½ éœ€è¦åœ¨è€ƒè™‘æ‰€æœ‰çš„æƒ…å†µä»¥åç»™ä»–æä¾›ä¸€ä¸ªæœ€å¥½çš„æ–¹æ¡ˆã€‚
>
>   ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰çš„ç‰©å“ä» `1` å¼€å§‹è¿›è¡Œç¼–å·ï¼Œé…‹é•¿çš„å…è¯ºä¹Ÿçœ‹ä½œä¸€ä¸ªç‰©å“ï¼Œå¹¶ä¸”ç¼–å·æ€»æ˜¯ `1`ã€‚
>
>   æ¯ä¸ªç‰©å“éƒ½æœ‰å¯¹åº”çš„ä»·æ ¼ `P`ï¼Œä¸»äººçš„åœ°ä½ç­‰çº§ `L`ï¼Œä»¥åŠä¸€ç³»åˆ—çš„æ›¿ä»£å“ $T_i$ å’Œè¯¥æ›¿ä»£å“æ‰€å¯¹åº”çš„â€ä¼˜æƒ â€ $V_i$ã€‚
>
>   å¦‚æœä¸¤äººåœ°ä½ç­‰çº§å·®è·è¶…è¿‡äº† `M`ï¼Œå°±ä¸èƒ½â€é—´æ¥äº¤æ˜“â€ã€‚
>
>   ä½ å¿…é¡»æ ¹æ®è¿™äº›æ•°æ®æ¥è®¡ç®—å‡ºæ¢é™©å®¶æœ€å°‘éœ€è¦å¤šå°‘é‡‘å¸æ‰èƒ½å¨¶åˆ°é…‹é•¿çš„å¥³å„¿ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•° `Mï¼ŒN`ï¼Œä¾æ¬¡è¡¨ç¤ºåœ°ä½ç­‰çº§å·®è·é™åˆ¶å’Œç‰©å“çš„æ€»æ•°ã€‚
>
>   æ¥ä¸‹æ¥æŒ‰ç…§ç¼–å·ä»å°åˆ°å¤§ä¾æ¬¡ç»™å‡ºäº† `N` ä¸ªç‰©å“çš„æè¿°ã€‚
>
>   æ¯ä¸ªç‰©å“çš„æè¿°å¼€å¤´æ˜¯ä¸‰ä¸ªéè´Ÿæ•´æ•° `Pã€Lã€X`ï¼Œä¾æ¬¡è¡¨ç¤ºè¯¥ç‰©å“çš„ä»·æ ¼ã€ä¸»äººçš„åœ°ä½ç­‰çº§å’Œæ›¿ä»£å“æ€»æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `X` è¡Œæ¯è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ•´æ•° `T` å’Œ `V`ï¼Œåˆ†åˆ«è¡¨ç¤ºæ›¿ä»£å“çš„ç¼–å·å’Œâ€ä¼˜æƒ ä»·æ ¼â€ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºæœ€å°‘éœ€è¦çš„é‡‘å¸æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 100,$
>   +   $1 â‰¤ P â‰¤ 10000,$
>   +   $1 â‰¤ L, M â‰¤ N$
>   +   $0 â‰¤ X < N$

**è¾“å…¥æ ¼å¼**

```c++
1 4
10000 3 2
2 8000
3 5000
1000 2 1
4 200
3000 2 1
4 200
50 2 0
```

**è¾“å‡ºæ ¼å¼**

```c++
5250
```

**æ‰‹å†™ç¨¿**

![4111127](img/4111127.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110, INF = 0x3f3f3f3f;
int n, m;
int pce[N], lev[N], dist[N], st[N];
int g[N][N];
// Dijkstraæ¨¡æ¿
int dijkstra(int down, int up) {
    memset(dist, 0x3f, sizeof dist);
    memset(st, false, sizeof st);
    dist[0] = 0;
    for (int i = 1; i <= n; i ++ ) {
        int t = -1;
        for (int j = 0; j <= n; j ++ )
            if (!st[j] && (t == -1 || dist[t] > dist[j])) t = j;
        st[t] = true;
        if (t == 1) return dist[1];
        for (int j = 0; j <= n; j ++ )
            // æ³¨æ„: åˆ¤æ–­ç­‰çº§èŒƒå›´
            if (!st[j] && lev[j] >= down && lev[j] <= up && g[t][j] != INF && dist[j] > dist[t] + g[t][j])
                dist[j] = dist[t] + g[t][j];
    }
    return dist[1];
}
int main() {
    scanf("%d%d", &m, &n);
    memset(g, 0x3f, sizeof g);
    for (int i = 0; i <= n; i ++ ) g[i][i] = 0;
    for (int i = 1, cnt; i <= n; i ++ ) {
        scanf("%d%d%d", &pce[i], &lev[i], &cnt);
        // 0å·ç‚¹æ˜¯è¶…çº§æºç‚¹
        // å–æœ€å°å€¼, é˜²æ­¢é‡è¾¹
        g[0][i] = min(g[0][i], pce[i]);
        while (cnt -- ) {
            int id, price;
            scanf("%d%d", &id, &price);
            // å–æœ€å°å€¼, é˜²æ­¢é‡è¾¹
            g[id][i] = min(g[id][i], price);
        }
    }
    int res = INF;
    // æšä¸¾ç­‰çº§åˆ¶åº¦èŒƒå›´
    for (int i = lev[1] - m; i <= lev[1]; i ++ )
        res = min(res, dijkstra(i, i + m));
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2m)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`å»ºå›¾`ã€`Dijkstra`ã€`æœ€çŸ­è·¯`

**ç¼åˆæ€ª**



## å•æºæœ€çŸ­è·¯çš„ç»¼åˆåº”ç”¨

### [AcWing 1135. æ–°å¹´å¥½](https://www.acwing.com/problem/content/1137/)

**é¢˜ç›®æè¿°**

>   é‡åº†åŸé‡Œæœ‰ `n` ä¸ªè½¦ç«™ï¼Œ`m` æ¡ **åŒå‘** å…¬è·¯è¿æ¥å…¶ä¸­çš„æŸäº›è½¦ç«™ã€‚
>
>   æ¯ä¸¤ä¸ªè½¦ç«™æœ€å¤šç”¨ä¸€æ¡å…¬è·¯è¿æ¥ï¼Œä»ä»»ä½•ä¸€ä¸ªè½¦ç«™å‡ºå‘éƒ½å¯ä»¥ç»è¿‡ä¸€æ¡æˆ–è€…å¤šæ¡å…¬è·¯åˆ°è¾¾å…¶ä»–è½¦ç«™ï¼Œä½†ä¸åŒçš„è·¯å¾„éœ€è¦èŠ±è´¹çš„æ—¶é—´å¯èƒ½ä¸åŒã€‚
>
>   åœ¨ä¸€æ¡è·¯å¾„ä¸ŠèŠ±è´¹çš„æ—¶é—´ç­‰äºè·¯å¾„ä¸Šæ‰€æœ‰å…¬è·¯éœ€è¦çš„æ—¶é—´ä¹‹å’Œã€‚
>
>   ä½³ä½³çš„å®¶åœ¨è½¦ç«™ `1`ï¼Œä»–æœ‰äº”ä¸ªäº²æˆšï¼Œåˆ†åˆ«ä½åœ¨è½¦ç«™ `a,b,c,d,e`ã€‚
>
>   è¿‡å¹´äº†ï¼Œä»–éœ€è¦ä»è‡ªå·±çš„å®¶å‡ºå‘ï¼Œæ‹œè®¿æ¯ä¸ªäº²æˆšï¼ˆé¡ºåºä»»æ„ï¼‰ï¼Œç»™ä»–ä»¬é€å»èŠ‚æ—¥çš„ç¥ç¦ã€‚
>
>   æ€æ ·èµ°ï¼Œæ‰éœ€è¦æœ€å°‘çš„æ—¶é—´ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œï¼šåŒ…å«ä¸¤ä¸ªæ•´æ•° `n,m`ï¼Œåˆ†åˆ«è¡¨ç¤ºè½¦ç«™æ•°ç›®å’Œå…¬è·¯æ•°ç›®ã€‚
>
>   ç¬¬äºŒè¡Œï¼šåŒ…å«äº”ä¸ªæ•´æ•° `a,b,c,d,e`ï¼Œåˆ†åˆ«è¡¨ç¤ºäº”ä¸ªäº²æˆšæ‰€åœ¨è½¦ç«™ç¼–å·ã€‚
>
>   ä»¥ä¸‹ `m` è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•° `x,y,t`ï¼Œè¡¨ç¤ºå…¬è·¯è¿æ¥çš„ä¸¤ä¸ªè½¦ç«™ç¼–å·å’Œæ—¶é—´ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä»…ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `T`ï¼Œè¡¨ç¤ºæœ€å°‘çš„æ€»æ—¶é—´ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 50000,$
>   +   $1 â‰¤ m â‰¤ 10^5,$
>   +   $1 < a, b, c, d, e â‰¤ n,$
>   +   $1 â‰¤ x, y â‰¤ n,$
>   +   $1 â‰¤ t â‰¤ 100$

**è¾“å…¥æ ·ä¾‹**

```c++
6 6
2 3 4 5 6
1 2 8
2 3 3
3 4 4
4 5 5
5 6 2
1 6 7
```

**è¾“å‡ºæ ·ä¾‹**

```c++
21
```

**æ‰‹å†™ç¨¿**

![4121036](img/4121036.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 50010, M = 200010, INF = 0x3f3f3f3f;
int n, m, idx;
int rel[6], h[N], e[M], w[M], ne[M], st[N];
int dist[6][N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// æ•°ç»„ä¼ çš„éƒ½æ˜¯æŒ‡é’ˆ
void dijkstra(int start, int dist[]) {
    // æ³¨æ„: è¿™é‡Œçš„åˆå§‹åŒ–æ–¹å¼æœ‰äº›ä¸åŒ, ä½¿ç”¨N * 4, ä¸€ä¸ªæ•´æ•°å æ®4ä¸ªå­—èŠ‚
    // ä¸èƒ½ä½¿ç”¨sizeof dist, å› ä¸º, äºŒç»´æ•°ç»„çš„åŸå› 
    memset(dist, 0x3f, N * 4);
    memset(st, false, sizeof st);
    priority_queue<PII, vector<PII>, greater<PII>> heap;
    dist[start] = 0;
    heap.push({0, start});
    while (heap.size()) {
        auto t = heap.top(); heap.pop();
        int v = t.y;
        st[v] = true;
        for (int i = h[v]; i != -1; i = ne[i]) {
            int j = e[i];
            if (!st[j] && dist[j] > dist[v] + w[i]) {
                dist[j] = dist[v] + w[i];
                heap.push({dist[j], j});
            }
        }
    }
    return;
}
/*
å‚æ•°:
    å‚æ•°1: å½“å‰å·²ç»è®¿é—®è¿‡çš„äº²æˆšæ•°é‡
    å‚æ•°2: å½“å‰æ­£åœ¨è®¿é—®çš„äº²æˆšç¼–å·
    å‚æ•°3: å½“å‰çš„èŠ±è´¹
*/
int dfs(int u, int start, int cost) {
    int res = INF;
    if (u == 5) {
        res = min(res, cost);
        return cost;
    }
    for (int i = 1; i <= 5; i ++ )
        if (!st[i]) {
            st[i] = true;
            int next = rel[i];
            res = min(res, dfs(u + 1, i, cost + dist[start][next]));
            st[i] = false;
        }
    return res;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    rel[0] = 1;
    // è®°å½•äº²æˆšæ‰€å¤„çš„è½¦ç«™ç¼–å·
    for (int i = 1; i <= 5; i ++ )
        scanf("%d", &rel[i]);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    // è®¡ç®—äº²æˆšæ‰€åœ¨çš„è½¦ç«™åˆ°å…¶ä»–è½¦ç«™çš„æœ€çŸ­è·¯å¾„
    for (int i = 0; i <= 5; i ++ )
        dijkstra(rel[i], dist[i]);
    memset(st, false,sizeof st);
    /*
    å‚æ•°:
        å‚æ•°1: å½“å‰å·²ç»è®¿é—®è¿‡çš„äº²æˆšæ•°é‡
        å‚æ•°2: å½“å‰æ­£åœ¨è®¿é—®çš„äº²æˆšç¼–å·
        å‚æ•°3: å½“å‰çš„èŠ±è´¹
    */
    cout << dfs(0, 0, 0) << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`Dijkstra`ã€`DFS`

**ç¼åˆæ€ª**

[AcWing 850. Dijkstraæ±‚æœ€çŸ­è·¯ II](#AcWing 850. Dijkstraæ±‚æœ€çŸ­è·¯ II)

### [AcWing 340. é€šä¿¡çº¿è·¯](https://www.acwing.com/problem/content/342/)

**é¢˜ç›®æè¿°**

>   åœ¨éƒŠåŒºæœ‰ `N` åº§é€šä¿¡åŸºç«™ï¼Œ`P` æ¡ **åŒå‘** ç”µç¼†ï¼Œç¬¬ `i` æ¡ç”µç¼†è¿æ¥åŸºç«™ $A_i$ å’Œ $B_i$ã€‚
>
>   ç‰¹åˆ«åœ°ï¼Œ`1` å·åŸºç«™æ˜¯é€šä¿¡å…¬å¸çš„æ€»ç«™ï¼Œ`N` å·åŸºç«™ä½äºä¸€åº§å†œåœºä¸­ã€‚
>
>   ç°åœ¨ï¼Œå†œåœºä¸»å¸Œæœ›å¯¹é€šä¿¡çº¿è·¯è¿›è¡Œå‡çº§ï¼Œå…¶ä¸­å‡çº§ç¬¬ `i` æ¡ç”µç¼†éœ€è¦èŠ±è´¹ $L_i$ã€‚
>
>   ç”µè¯å…¬å¸æ­£åœ¨ä¸¾è¡Œä¼˜æƒ æ´»åŠ¨ã€‚
>
>   å†œäº§ä¸»å¯ä»¥æŒ‡å®šä¸€æ¡ä» `1` å·åŸºç«™åˆ° `N` å·åŸºç«™çš„è·¯å¾„ï¼Œå¹¶æŒ‡å®šè·¯å¾„ä¸Šä¸è¶…è¿‡ `K` æ¡ç”µç¼†ï¼Œç”±ç”µè¯å…¬å¸å…è´¹æä¾›å‡çº§æœåŠ¡ã€‚
>
>   å†œåœºä¸»åªéœ€è¦æ”¯ä»˜åœ¨è¯¥è·¯å¾„ä¸Šå‰©ä½™çš„ç”µç¼†ä¸­ï¼Œå‡çº§ä»·æ ¼æœ€è´µçš„é‚£æ¡ç”µç¼†çš„èŠ±è´¹å³å¯ã€‚
>
>   æ±‚è‡³å°‘ç”¨å¤šå°‘é’±å¯ä»¥å®Œæˆå‡çº§ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œï¼šä¸‰ä¸ªæ•´æ•° `Nï¼ŒPï¼ŒK`ã€‚
>
>   ç¬¬ `2..P + 1` è¡Œï¼šç¬¬ `i + 1` è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $A_i,B_i,L_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   åŒ…å«ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºæœ€å°‘èŠ±è´¹ã€‚
>
>   è‹¥ `1` å·åŸºç«™ä¸ `N` å·åŸºç«™ä¹‹é—´ä¸å­˜åœ¨è·¯å¾„ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $0 â‰¤ K < N â‰¤ 1000,$
>   +   $1 â‰¤ P â‰¤ 10000,$
>   +   $1 â‰¤ L_i â‰¤ 1000000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 7 1
1 2 5
3 1 4
2 4 8
3 2 3
5 2 9
3 4 7
4 5 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
```

**æ‰‹å†™ç¨¿**

![4122101](img/4122101.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <deque>
using namespace std;
const int N = 1010, M = 20010;
int n, m, k, idx;
int h[N], e[M], w[M], ne[M], st[N], dist[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// åŒç«¯é˜Ÿåˆ—æ¨¡æ¿
bool check(int x) {
    deque<int> q;
    // åˆå§‹åŒ–
    memset(st, 0, sizeof st);
    memset(dist, 0x3f, sizeof dist);
    dist[1] = 0;
    q.push_back(1);
    st[1] = true;
    while (q.size()) {
        int t = q.front(); q.pop_front();
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i], v = w[i] > x; // æƒå€¼w > x
            if (!st[j] && dist[j] > dist[t] + v) {
                dist[j] = dist[t] + v;
                q.push_back(j);
            }
        }
    }
    return dist[n] <= k; // æ€§è´¨æ˜¯æœ€å°å€¼å°äºç­‰äºk
}
int main() {
    scanf("%d%d%d", &n, &m, &k);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    // äºŒåˆ†çš„æ˜¯ç­”æ¡ˆ
    int l = 0, r = 1e6 + 1;
    while (l < r) {
        int mid = l + r >> 1;
        // ç¬¦åˆæ¡ä»¶, è¯´æ˜æ˜¯åœ¨ç­”æ¡ˆå³è¾¹, æ•…, ç¼©å°èŒƒå›´
        // å…·ä½“æ‰‹å†™ç¨¿
        if (check(mid)) r = mid;
        else l = mid + 1;
    }
    if (r == 1e6 + 1) r = -1;
    cout << r << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(plogL)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`äºŒåˆ†`

**ç¼åˆæ€ª**



### [AcWing 342. é“è·¯ä¸èˆªçº¿](https://www.acwing.com/problem/content/344/)

**é¢˜ç›®æè¿°**

>   å†œå¤«çº¦ç¿°æ­£åœ¨ä¸€ä¸ªæ–°çš„é”€å”®åŒºåŸŸå¯¹ä»–çš„ç‰›å¥¶é”€å”®æ–¹æ¡ˆè¿›è¡Œè°ƒæŸ¥ã€‚
>
>   ä»–æƒ³æŠŠç‰›å¥¶é€åˆ° `T` ä¸ªåŸé•‡ï¼Œç¼–å·ä¸º `1 âˆ¼ T`ã€‚
>
>   è¿™äº›åŸé•‡ä¹‹é—´é€šè¿‡ `R` æ¡é“è·¯ (ç¼–å·ä¸º `1` åˆ° `R`) å’Œ `P` æ¡èˆªçº¿ (ç¼–å·ä¸º `1` åˆ° `P`) è¿æ¥ã€‚
>
>   æ¯æ¡é“è·¯ `i` æˆ–è€…èˆªçº¿ `i` è¿æ¥åŸé•‡ $A_i$ åˆ° $B_i$ï¼ŒèŠ±è´¹ä¸º $C_i$ã€‚
>
>   å¯¹äºé“è·¯ï¼Œ$0 â‰¤ C_i â‰¤ 10,000$;ç„¶è€Œèˆªçº¿çš„èŠ±è´¹å¾ˆç¥å¥‡ï¼ŒèŠ±è´¹ $C_i$ å¯èƒ½æ˜¯è´Ÿæ•°$(âˆ’10,000 â‰¤ C_i â‰¤ 10,000)$ã€‚
>
>   é“è·¯æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ä» $A_i$ åˆ° $B_i$ï¼Œä¹Ÿå¯ä»¥ä» $B_i$ åˆ° $A_i$ï¼ŒèŠ±è´¹éƒ½æ˜¯ $C_i$ã€‚
>
>   ç„¶è€Œèˆªçº¿ä¸ä¹‹ä¸åŒï¼Œåªå¯ä»¥ä» $A_i$ åˆ° $B_i$ã€‚
>
>   äº‹å®ä¸Šï¼Œç”±äºæœ€è¿‘ææ€–ä¸»ä¹‰å¤ªåš£å¼ ï¼Œä¸ºäº†ç¤¾ä¼šå’Œè°ï¼Œå‡ºå°äº†ä¸€äº›æ”¿ç­–ï¼šä¿è¯å¦‚æœæœ‰ä¸€æ¡èˆªçº¿å¯ä»¥ä» $A_i$ åˆ° $B_i$ï¼Œé‚£ä¹ˆä¿è¯ä¸å¯èƒ½é€šè¿‡ä¸€äº›é“è·¯å’Œèˆªçº¿ä» $B_i$ å›åˆ° $A_i$ã€‚
>
>   ç”±äºçº¦ç¿°çš„å¥¶ç‰›ä¸–ç•Œå…¬è®¤ååˆ†ç»™åŠ›ï¼Œä»–éœ€è¦è¿é€å¥¶ç‰›åˆ°æ¯ä¸€ä¸ªåŸé•‡ã€‚
>
>   ä»–æƒ³æ‰¾åˆ°ä»å‘é€ä¸­å¿ƒåŸé•‡ `S` æŠŠå¥¶ç‰›é€åˆ°æ¯ä¸ªåŸé•‡çš„æœ€ä¾¿å®œçš„æ–¹æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«å››ä¸ªæ•´æ•° `T,R,P,S`ã€‚
>
>   æ¥ä¸‹æ¥ `R` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•°ï¼ˆè¡¨ç¤ºä¸€ä¸ªé“è·¯ï¼‰$A_i,B_i,C_i$ã€‚
>
>   æ¥ä¸‹æ¥ `P` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•°ï¼ˆè¡¨ç¤ºä¸€æ¡èˆªçº¿ï¼‰$A_i,B_i,C_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   ç¬¬ $1 .. T$ è¡Œï¼šç¬¬ `i` è¡Œè¾“å‡ºä» `S` åˆ°è¾¾åŸé•‡ `i` çš„æœ€å°èŠ±è´¹ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `NO PATH`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ T â‰¤ 25000,$
>   +   $1 â‰¤ R, P â‰¤ 50000,$
>   +   $1 â‰¤ A_i, B_i, S â‰¤ T$

**è¾“å…¥æ ·ä¾‹**

```c++
6 3 3 4
1 2 5
3 4 5
5 6 10
3 5 -100
4 6 -100
1 3 -10
```

**è¾“å‡ºæ ·ä¾‹**

```c++
NO PATH
NO PATH
5
0
-95
-100
```

**æ‰‹å†™ç¨¿**

![4131154](img/4131154.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
#include <vector>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 25010, M = 150010, INF = 0x3f3f3f3f;
int n, mr, mp, S, idx, bcnt, hh, tt;
int h[N], e[M], w[M], ne[M], id[N], st[N], dist[N], q[N], din[N];
vector<int> block[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u, int bid) {
    id[u] = bid;
    st[u] = true;
    block[bid].push_back(u);
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœjæ²¡æœ‰è¢«è®¿é—®è¿‡å¹¶ä¸”jæ²¡æœ‰è¢«åˆ†ç»„
        if (!st[j] && !id[j])
            dfs(j, bid);
    }
    st[u] = false;
    return;
}
void dijkstra(int bid) {
    priority_queue<PII, vector<PII>, greater<PII>> heap;
    // å°†å½“å‰è¿é€šå—ä¸­çš„åŸé•‡å…¨éƒ¨å‹å…¥å°æ ¹å †ä¸­
    for (auto t : block[bid])
        heap.push({dist[t], t});
    // å †ä¼˜åŒ–ç‰ˆdijkstra
    while (heap.size()) {
        auto t = heap.top(); heap.pop();
        int v = t.y;
        if (st[v]) continue;
        st[v] = true;
        // è®¿é—®é‚»æ¥ç‚¹
        for (int i = h[v]; i != -1; i = ne[i]) {
            int j = e[i];
            // å¦‚æœå½“å‰ç‚¹vå’Œå…¶ä¸´æ¥ç‚¹jä¸å±äºåŒä¸€ä¸ªè¿é€šå—
            // è¯´æ˜jæ‰€åœ¨çš„è¿é€šå—id[j]çš„å…¥åº¦éœ€è¦â–1
            // å¦‚æœå‡åˆ°0, åˆ™åŠ å…¥é˜Ÿåˆ—q
            if (id[v] != id[j] && -- din[id[j]] == 0) q[++tt] = id[j];
            // æ›´æ–°è·ç¦»
            if (dist[j] > dist[v] + w[i]) {
                dist[j] = dist[v] + w[i];
                // æ³¨æ„: è¿™é‡Œåªæœ‰åŒå±ä¸€ä¸ªè¿é€šå—çš„æ—¶å€™æ‰åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—
                // åŒä¸€ä¸ªè¿é€šå—å†…éƒ¨éƒ½æ˜¯é“è·¯, é“è·¯çš„æƒå€¼æ˜¯éè´Ÿçš„
                if (id[j] == id[v]) heap.push({dist[j], j});
            }
        }
    }
    return;
}
void topsort() {
    hh = 0, tt = -1;
    // åˆå§‹åŒ–ä¸º+âˆ
    memset(dist, 0x3f, sizeof dist);
    // èµ·ç‚¹ä¸º0
    dist[S] = 0;
    for (int i = 1; i <= bcnt; i ++ )
        // å°†æ‰€æœ‰å…¥åº¦ä¸º0çš„ç‚¹åŠ å…¥é˜Ÿåˆ—q
        if (!din[i]) q[++ tt] = i;
    while (hh <= tt) {
        int t = q[hh ++ ];
        dijkstra(t);
    }
    return;
}
int main() {
    scanf("%d%d%d%d", &n, &mr, &mp, &S);
    memset(h, -1, sizeof h);
    for (int i = 0; i < mr; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    for (int i = 1; i <= n; i ++ )
        if (!id[i])
            // è¿é€šå—ç¼–å·ä»1å¼€å§‹
            dfs(i, ++ bcnt);
    for (int i = 0; i < mp; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        // båŸé•‡æ‰€åœ¨çš„è¿é€šå—å…¥åº¦â•1
        din[id[b]] ++;
        add(a, b, c);
    }
    topsort();
    for (int i = 1; i <= n; i ++ ) {
        // å› ä¸ºæœ‰è´Ÿæƒè¾¹, å› æ­¤, åˆ¤æ–­å…¶å¤§äºæŸä¸ªå¤§å€¼å³å¯
        if (dist[i] > INF / 2) puts("NO PATH");
        else cout << dist[i] << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(nm), mæ˜¯è¿é€šå—çš„æ•°é‡$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`æ‹“æ‰‘æ’åº`

**ç¼åˆæ€ª**



### [AcWing 341. æœ€ä¼˜è´¸æ˜“](https://www.acwing.com/problem/content/343/)

**é¢˜ç›®æè¿°**

>   `C` å›½æœ‰ `n` ä¸ªå¤§åŸå¸‚å’Œ `m` æ¡é“è·¯ï¼Œæ¯æ¡é“è·¯è¿æ¥è¿™ `n` ä¸ªåŸå¸‚ä¸­çš„æŸä¸¤ä¸ªåŸå¸‚ã€‚
>
>   ä»»æ„ä¸¤ä¸ªåŸå¸‚ä¹‹é—´æœ€å¤šåªæœ‰ä¸€æ¡é“è·¯ç›´æ¥ç›¸è¿ã€‚
>
>   è¿™ `m` æ¡é“è·¯ä¸­æœ‰ä¸€éƒ¨åˆ†ä¸ºå•å‘é€šè¡Œçš„é“è·¯ï¼Œä¸€éƒ¨åˆ†ä¸ºåŒå‘é€šè¡Œçš„é“è·¯ï¼ŒåŒå‘é€šè¡Œçš„é“è·¯åœ¨ç»Ÿè®¡æ¡æ•°æ—¶ä¹Ÿè®¡ä¸º `1` æ¡ã€‚
>
>   `C` å›½å¹…å‘˜è¾½é˜”ï¼Œå„åœ°çš„èµ„æºåˆ†å¸ƒæƒ…å†µå„ä¸ç›¸åŒï¼Œè¿™å°±å¯¼è‡´äº†åŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼ä¸ä¸€å®šç›¸åŒã€‚
>
>   ä½†æ˜¯ï¼ŒåŒä¸€ç§å•†å“åœ¨åŒä¸€ä¸ªåŸå¸‚çš„ä¹°å…¥ä»·å’Œå–å‡ºä»·å§‹ç»ˆæ˜¯ç›¸åŒçš„ã€‚
>
>   å•†äººé˜¿é¾™æ¥åˆ° `C` å›½æ—…æ¸¸ã€‚
>
>   å½“ä»–å¾—çŸ¥â€œåŒä¸€ç§å•†å“åœ¨ä¸åŒåŸå¸‚çš„ä»·æ ¼å¯èƒ½ä¼šä¸åŒâ€è¿™ä¸€ä¿¡æ¯ä¹‹åï¼Œä¾¿å†³å®šåœ¨æ—…æ¸¸çš„åŒæ—¶ï¼Œåˆ©ç”¨å•†å“åœ¨ä¸åŒåŸå¸‚ä¸­çš„å·®ä»·èµšä¸€ç‚¹æ—…è´¹ã€‚
>
>   è®¾ `C` å›½ `n` ä¸ªåŸå¸‚çš„æ ‡å·ä»` 1 âˆ¼ n`ï¼Œé˜¿é¾™å†³å®šä» `1` å·åŸå¸‚å‡ºå‘ï¼Œå¹¶æœ€ç»ˆåœ¨ `n` å·åŸå¸‚ç»“æŸè‡ªå·±çš„æ—…è¡Œã€‚
>
>   åœ¨æ—…æ¸¸çš„è¿‡ç¨‹ä¸­ï¼Œä»»ä½•åŸå¸‚å¯ä»¥è¢«é‡å¤ç»è¿‡å¤šæ¬¡ï¼Œä½†ä¸è¦æ±‚ç»è¿‡æ‰€æœ‰ `n` ä¸ªåŸå¸‚ã€‚
>
>   é˜¿é¾™é€šè¿‡è¿™æ ·çš„è´¸æ˜“æ–¹å¼èµšå–æ—…è´¹ï¼šä»–ä¼šé€‰æ‹©ä¸€ä¸ªç»è¿‡çš„åŸå¸‚ä¹°å…¥ä»–æœ€å–œæ¬¢çš„å•†å“â€”â€”æ°´æ™¶çƒï¼Œå¹¶åœ¨ä¹‹åç»è¿‡çš„å¦ä¸€ä¸ªåŸå¸‚å–å‡ºè¿™ä¸ªæ°´æ™¶çƒï¼Œç”¨èµšå–çš„å·®ä»·å½“åšæ—…è´¹ã€‚
>
>   å› ä¸ºé˜¿é¾™ä¸»è¦æ˜¯æ¥ `C` å›½æ—…æ¸¸ï¼Œä»–å†³å®šè¿™ä¸ªè´¸æ˜“åªè¿›è¡Œæœ€å¤šä¸€æ¬¡ï¼Œå½“ç„¶ï¼Œåœ¨èµšä¸åˆ°å·®ä»·çš„æƒ…å†µä¸‹ä»–å°±æ— éœ€è¿›è¡Œè´¸æ˜“ã€‚
>
>   ç°åœ¨ç»™å‡º `n` ä¸ªåŸå¸‚çš„æ°´æ™¶çƒä»·æ ¼ï¼Œ`m` æ¡é“è·¯çš„ä¿¡æ¯ï¼ˆæ¯æ¡é“è·¯æ‰€è¿æ¥çš„ä¸¤ä¸ªåŸå¸‚çš„ç¼–å·ä»¥åŠè¯¥æ¡é“è·¯çš„é€šè¡Œæƒ…å†µï¼‰ã€‚
>
>   è¯·ä½ å‘Šè¯‰é˜¿é¾™ï¼Œä»–æœ€å¤šèƒ½èµšå–å¤šå°‘æ—…è´¹ã€‚
>
>   æ³¨æ„ï¼šæœ¬é¢˜æ•°æ®æœ‰åŠ å¼ºã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å« `2` ä¸ªæ­£æ•´æ•° `n` å’Œ `m`ï¼Œä¸­é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ï¼Œåˆ†åˆ«è¡¨ç¤ºåŸå¸‚çš„æ•°ç›®å’Œé“è·¯çš„æ•°ç›®ã€‚
>
>   ç¬¬äºŒè¡Œ `n` ä¸ªæ­£æ•´æ•°ï¼Œæ¯ä¸¤ä¸ªæ•´æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ï¼ŒæŒ‰æ ‡å·é¡ºåºåˆ†åˆ«è¡¨ç¤ºè¿™ ``n`` ä¸ªåŸå¸‚çš„å•†å“ä»·æ ¼ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡Œæœ‰ `3` ä¸ªæ­£æ•´æ•°ï¼Œ`xï¼Œyï¼Œz`ï¼Œæ¯ä¸¤ä¸ªæ•´æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
>   å¦‚æœ `z = 1`ï¼Œè¡¨ç¤ºè¿™æ¡é“è·¯æ˜¯åŸå¸‚ `x` åˆ°åŸå¸‚ `y` ä¹‹é—´çš„å•å‘é“è·¯ï¼›å¦‚æœ `z = 2`ï¼Œè¡¨ç¤ºè¿™æ¡é“è·¯ä¸ºåŸå¸‚ `x` å’ŒåŸå¸‚ `y` ä¹‹é—´çš„åŒå‘é“è·¯ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºç­”æ¡ˆã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 100000,$
>   +   $1 â‰¤ m â‰¤ 500000,$
>   +   $1 â‰¤ å„åŸå¸‚æ°´æ™¶çƒä»·æ ¼ â‰¤ 100$

**è¾“å…¥æ ·ä¾‹**

```c++
5 5
4 3 5 6 1
1 2 1
1 4 1
2 3 2
3 5 1
4 5 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
5
```

**æ‰‹å†™ç¨¿**

![4131635](img/4131635.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010, M = 2000010;
int n, m, idx;
int w[N], h[N], rh[N], e[M], ne[M], fmin[N], fmax[N], q[N], st[N];
void add(int h[], int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void spfa(int dist[], int type) {
    memset(st, false, sizeof st);
    int hh = 0, tt = 0;
    if (type == 0) { // æ­£å‘éå†, æ±‚æœ€å°å€¼
        memset(dist, 0x3f, sizeof fmin);
        dist[1] = w[1];
        q[tt ++ ] = 1;
        st[1] = true;
    }
    else { // åå‘éå†, æ±‚æœ€å¤§å€¼
        memset(dist, -0x3f, sizeof fmax);
        dist[n] = w[n];
        q[tt ++ ] = n;
        st[n] = true;
    }
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        if (type == 0) { // æ­£å‘éå†, æ±‚æœ€å°å€¼
            for (int i = h[t]; i != -1; i = ne[i]) {
                int j = e[i];
                if (dist[j] > min(dist[t], w[j])) {
                    dist[j] = min(dist[t], w[j]);
                    if (!st[j]) { // å¦‚æœæ²¡æœ‰åŠ å…¥é˜Ÿåˆ—, åˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—
                        q[tt ++ ] = j;
                        if (tt == N) tt = 0;
                        st[j] = true;
                    }
                }
            }
        }
        else { // åå‘éå†, æ±‚æœ€å¤§å€¼
            for (int i = rh[t]; i != -1; i = ne[i]) {
                int j = e[i];
                if (dist[j] < max(dist[t], w[j])) { // å¦‚æœæ²¡æœ‰åŠ å…¥é˜Ÿåˆ—, åˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—
                    dist[j] = max(dist[t], w[j]);
                    if (!st[j]) {
                        q[tt ++ ] = j;
                        if (tt == N) tt = 0;
                        st[j] = true;
                    }
                }
            }
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    memset(rh, -1, sizeof rh);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &w[i]);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(h, a, b);
        add(rh, b, a);
        if (c == 2) {
            add(h, b, a);
            add(rh, a, b);
        }
    }
    spfa(fmin, 0);
    spfa(fmax, 1);
    int res = 0;
    for (int i = 1; i <= n; i ++ )
        res = max(res, fmax[i] - fmin[i]);
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$æœ€åæ—¶é—´å¤æ‚åº¦ O(nm), ä¸€èˆ¬æƒ…å†µä¸‹ä¸ºO(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`åŠ¨æ€è§„åˆ’`ã€`spfa`

**ç¼åˆæ€ª**

## å•æºæœ€çŸ­è·¯çš„æ‰©å±•åº”ç”¨

### [AcWing 1137. é€‰æ‹©æœ€ä½³çº¿è·¯](https://www.acwing.com/problem/content/1139/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸€å¤©ï¼Œçªçªæƒ³ä¹˜åå…¬äº¤è½¦å»æ‹œè®¿å¥¹çš„ä¸€ä½æœ‹å‹ã€‚
>
>   ç”±äºçªçªéå¸¸å®¹æ˜“æ™•è½¦ï¼Œæ‰€ä»¥å¥¹æƒ³å°½å¿«åˆ°è¾¾æœ‹å‹å®¶ã€‚
>
>   ç°åœ¨ç»™å®šä½ ä¸€å¼ åŸå¸‚äº¤é€šè·¯çº¿å›¾ï¼Œä¸Šé¢åŒ…å«åŸå¸‚çš„å…¬äº¤ç«™å°ä»¥åŠå…¬äº¤çº¿è·¯çš„å…·ä½“åˆ†å¸ƒã€‚
>
>   å·²çŸ¥åŸå¸‚ä¸­å…±åŒ…å« `n` ä¸ªè½¦ç«™ï¼ˆç¼–å·`1 ~ n`ï¼‰ä»¥åŠ `m` æ¡å…¬äº¤çº¿è·¯ã€‚
>
>   æ¯æ¡å…¬äº¤çº¿è·¯éƒ½æ˜¯ **å•å‘çš„**ï¼Œä»ä¸€ä¸ªè½¦ç«™å‡ºå‘ç›´æ¥åˆ°è¾¾å¦ä¸€ä¸ªè½¦ç«™ï¼Œä¸¤ä¸ªè½¦ç«™ä¹‹é—´å¯èƒ½å­˜åœ¨å¤šæ¡å…¬äº¤çº¿è·¯ã€‚
>
>   çªçªçš„æœ‹å‹ä½åœ¨ `s` å·è½¦ç«™é™„è¿‘ã€‚
>
>   çªçªå¯ä»¥åœ¨ä»»ä½•è½¦ç«™é€‰æ‹©æ¢ä¹˜å…¶å®ƒå…¬å…±æ±½è½¦ã€‚
>
>   è¯·æ‰¾å‡ºçªçªåˆ°è¾¾å¥¹çš„æœ‹å‹å®¶ï¼ˆé™„è¿‘çš„å…¬äº¤è½¦ç«™ï¼‰éœ€è¦èŠ±è´¹çš„æœ€å°‘æ—¶é—´ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚
>
>   æ¯ç»„æµ‹è¯•æ•°æ®ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `n,m,s`ï¼Œåˆ†åˆ«è¡¨ç¤ºè½¦ç«™æ•°é‡ï¼Œå…¬äº¤çº¿è·¯æ•°é‡ä»¥åŠæœ‹å‹å®¶é™„è¿‘è½¦ç«™çš„ç¼–å·ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `p,q,t`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡çº¿è·¯ä»è½¦ç«™ `p` åˆ°è¾¾è½¦ç«™ `q`ï¼Œç”¨æ—¶ä¸º `t`ã€‚
>
>   æ¥ä¸‹æ¥ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `w`ï¼Œè¡¨ç¤ºçªçªå®¶é™„è¿‘å…±æœ‰ `w` ä¸ªè½¦ç«™ï¼Œå¥¹å¯ä»¥åœ¨è¿™ `w` ä¸ªè½¦ç«™ä¸­é€‰æ‹©ä¸€ä¸ªè½¦ç«™ä½œä¸ºå§‹å‘ç«™ã€‚
>
>   å†ä¸€è¡Œï¼ŒåŒ…å« `w` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºçªçªå®¶é™„è¿‘çš„ `w` ä¸ªè½¦ç«™çš„ç¼–å·ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ä¸ªæµ‹è¯•æ•°æ®è¾“å‡ºä¸€ä¸ªæ•´æ•°ä½œä¸ºç»“æœï¼Œè¡¨ç¤ºæ‰€éœ€èŠ±è´¹çš„æœ€å°‘æ—¶é—´ã€‚
>
>   å¦‚æœæ— æ³•è¾¾åˆ°æœ‹å‹å®¶çš„è½¦ç«™ï¼Œåˆ™è¾“å‡º ``-1``ã€‚
>
>   æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $n â‰¤ 1000, m â‰¤ 20000,$
>   +   $1 â‰¤ s â‰¤ n,$
>   +   $0 < w < n,$
>   +   $0 < t â‰¤ 1000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 8 5
1 2 2
1 5 3
1 3 4
2 4 7
2 5 6
2 3 5
3 5 1
4 5 1
2
2 3
4 3 4
1 2 3
1 3 4
2 3 2
1
1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
-1
```

**æ‰‹å†™ç¨¿**

![4140934](img/4140934.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1010, M = 21010, INF = 0x3f3f3f3f;
int n, m, T, idx;
int h[N], e[M], w[M], ne[M], st[N], dist[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// SPFAæ¨¡æ¿
int spfa() {
    memset(dist, 0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    // ä½¿ç”¨å¾ªç¯é˜Ÿåˆ—
    int hh = 0, tt = 0;
    dist[0] = 0;
    q[tt ++ ] = 0;
    st[0] = true;
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] > dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                if (!st[j]) {
                    q[tt ++ ] = j;
                    if (tt == N) tt = 0;
                    st[j] = true;
                }
            }
        }
    }
    if (dist[T] == INF) return -1;
    return dist[T];
}
int main() {
    while (~scanf("%d%d%d", &n, &m, &T)) {
        memset(h, -1, sizeof h);
        idx = 0;
        for (int i = 0; i < m; i ++ ) {
            int a, b, c;
            scanf("%d%d%d", &a, &b, &c);
            add(a, b, c);
        }
        int k;
        scanf("%d", &k);
        for (int i = 0, station; i < k; i ++ ) {
            scanf("%d", &station);
            // å°†èµ·ç‚¹å’Œè™šæ‹Ÿæºç‚¹ä¹‹é—´å»ºç«‹ä¸€æ¡è¾¹, æƒå€¼ä¸º0
            add(0, station, 0);
        }
        cout << spfa() << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`è™šæ‹Ÿæºç‚¹`

**ç¼åˆæ€ª**



### [AcWing 1131. æ‹¯æ•‘å¤§å…µç‘æ©](https://www.acwing.com/problem/content/1133/)

**é¢˜ç›®æè¿°**

>   `1944` å¹´ï¼Œç‰¹ç§å…µéº¦å…‹æ¥åˆ°å›½é˜²éƒ¨çš„å‘½ä»¤ï¼Œè¦æ±‚ç«‹å³èµ¶èµ´å¤ªå¹³æ´‹ä¸Šçš„ä¸€ä¸ªå­¤å²›ï¼Œè¥æ•‘è¢«æ•Œå†›ä¿˜è™çš„å¤§å…µç‘æ©ã€‚
>
>   ç‘æ©è¢«å…³æŠ¼åœ¨ä¸€ä¸ªè¿·å®«é‡Œï¼Œè¿·å®«åœ°å½¢å¤æ‚ï¼Œä½†å¹¸å¥½éº¦å…‹å¾—åˆ°äº†è¿·å®«çš„åœ°å½¢å›¾ã€‚
>
>   è¿·å®«çš„å¤–å½¢æ˜¯ä¸€ä¸ªé•¿æ–¹å½¢ï¼Œå…¶å—åŒ—æ–¹å‘è¢«åˆ’åˆ†ä¸º `N` è¡Œï¼Œä¸œè¥¿æ–¹å‘è¢«åˆ’åˆ†ä¸º `M` åˆ—ï¼Œ äºæ˜¯æ•´ä¸ªè¿·å®«è¢«åˆ’åˆ†ä¸º `NÃ—M` ä¸ªå•å…ƒã€‚
>
>   æ¯ä¸€ä¸ªå•å…ƒçš„ä½ç½®å¯ç”¨ä¸€ä¸ªæœ‰åºæ•°å¯¹ (å•å…ƒçš„è¡Œå·, å•å…ƒçš„åˆ—å·) æ¥è¡¨ç¤ºã€‚
>
>   å—åŒ—æˆ–ä¸œè¥¿æ–¹å‘ç›¸é‚»çš„ `2` ä¸ªå•å…ƒä¹‹é—´å¯èƒ½äº’é€šï¼Œä¹Ÿå¯èƒ½æœ‰ä¸€æ‰‡é”ç€çš„é—¨ï¼Œæˆ–è€…æ˜¯ä¸€å µä¸å¯é€¾è¶Šçš„å¢™ã€‚
>
>   **æ³¨æ„ï¼š** é—¨å¯ä»¥ä»ä¸¤ä¸ªæ–¹å‘ç©¿è¿‡ï¼Œå³å¯ä»¥çœ‹æˆä¸€æ¡æ— å‘è¾¹ã€‚
>
>   è¿·å®«ä¸­æœ‰ä¸€äº›å•å…ƒå­˜æ”¾ç€é’¥åŒ™ï¼ŒåŒä¸€ä¸ªå•å…ƒå¯èƒ½å­˜æ”¾ **å¤šæŠŠé’¥åŒ™**ï¼Œå¹¶ä¸”æ‰€æœ‰çš„é—¨è¢«åˆ†æˆ `P` ç±»ï¼Œæ‰“å¼€åŒä¸€ç±»çš„é—¨çš„é’¥åŒ™ç›¸åŒï¼Œä¸åŒç±»é—¨çš„é’¥åŒ™ä¸åŒã€‚
>
>   å¤§å…µç‘æ©è¢«å…³æŠ¼åœ¨è¿·å®«çš„ä¸œå—è§’ï¼Œå³ `(N,M)` å•å…ƒé‡Œï¼Œå¹¶å·²ç»æ˜è¿·ã€‚
>
>   è¿·å®«åªæœ‰ä¸€ä¸ªå…¥å£ï¼Œåœ¨è¥¿åŒ—è§’ã€‚
>
>   ä¹Ÿå°±æ˜¯è¯´ï¼Œéº¦å…‹å¯ä»¥ç›´æ¥è¿›å…¥ `(1,1)` å•å…ƒã€‚
>
>   å¦å¤–ï¼Œéº¦å…‹ä»ä¸€ä¸ªå•å…ƒç§»åŠ¨åˆ°å¦ä¸€ä¸ªç›¸é‚»å•å…ƒçš„æ—¶é—´ä¸º `1`ï¼Œæ‹¿å–æ‰€åœ¨å•å…ƒçš„é’¥åŒ™çš„æ—¶é—´ä»¥åŠç”¨é’¥åŒ™å¼€é—¨çš„æ—¶é—´å¯å¿½ç•¥ä¸è®¡ã€‚
>
>   è¯•è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œå¸®åŠ©éº¦å…‹ä»¥æœ€å¿«çš„æ–¹å¼åˆ°è¾¾ç‘æ©æ‰€åœ¨å•å…ƒï¼Œè¥æ•‘å¤§å…µç‘æ©ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæœ‰ä¸‰ä¸ªæ•´æ•°,åˆ†åˆ«è¡¨ç¤º `N,M,P` çš„å€¼ã€‚
>
>   ç¬¬äºŒè¡Œæ˜¯ä¸€ä¸ªæ•´æ•° `k`ï¼Œè¡¨ç¤ºè¿·å®«ä¸­é—¨å’Œå¢™çš„æ€»æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `k` è¡Œï¼Œæ¯è¡ŒåŒ…å«äº”ä¸ªæ•´æ•°ï¼Œ$X_{i1}, Y_{i1}, X_{i2}, Y_{i2}, G_i$ï¼šå½“ $G_iâ‰¥1$ æ—¶ï¼Œè¡¨ç¤º $(X_{i1},Y_{i1})$ å•å…ƒä¸ $(X_{i2},Y_{i2}) $å•å…ƒä¹‹é—´æœ‰ä¸€æ‰‡ç¬¬ $G_i$ ç±»çš„é—¨ï¼Œå½“ $G_i=0$ æ—¶ï¼Œè¡¨ç¤º $(X_{i1},Y_{i1})$ å•å…ƒä¸ $(X_{i2},Y_{i2})$ å•å…ƒä¹‹é—´æœ‰ä¸€é¢ä¸å¯é€¾è¶Šçš„å¢™ã€‚
>
>   æ¥ä¸‹æ¥ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `S`ï¼Œè¡¨ç¤ºè¿·å®«ä¸­å­˜æ”¾çš„é’¥åŒ™çš„æ€»æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `S` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $X_{i1},Y_{i1},Q_i$ï¼Œè¡¨ç¤º $(X_{i1},Y_{i1})$ å•å…ƒé‡Œå­˜åœ¨ä¸€ä¸ªèƒ½å¼€å¯ç¬¬ $Q_i$ ç±»é—¨çš„é’¥åŒ™ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºéº¦å…‹è¥æ•‘åˆ°å¤§å…µç‘æ©çš„æœ€çŸ­æ—¶é—´ã€‚
>
>   å¦‚æœé—®é¢˜æ— è§£ï¼Œåˆ™è¾“å‡º `-1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $|X_{i1} âˆ’ X_{i2}| + |Y_{i1} âˆ’ Y_{i2}| = 1,$
>   +   $0 â‰¤ G_i â‰¤ P,$
>   +   $1 â‰¤ Q_i â‰¤ P,$
>   +   $1 â‰¤ N, M, P â‰¤ 10,$
>   +   $1 â‰¤ k â‰¤ 150$

**è¾“å…¥æ ·ä¾‹**

```c++
4 4 9
9
1 2 1 3 2
1 2 2 2 0
2 1 2 2 0
2 1 3 1 0 
2 3 3 3 0
2 4 3 4 1
3 2 3 3 0
3 3 4 3 0
4 3 4 4 0
2
2 1 2 
4 2 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
14
```

**æ ·ä¾‹è§£é‡Š**

>   è¿·å®«å¦‚ä¸‹æ‰€ç¤ºï¼š
>
>   ![1131.png](img/1_17c87ee400-1131.png)

**æ‰‹å†™ç¨¿**

![4151310](img/4151310.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <set>
#include <deque>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 15, M = 400, K = 1 << 10;
int n, m, p, k, idx;
int dx[4] = {-1, 0, 1, 0};
int dy[4] = {0, 1, 0, -1};
// æ³¨æ„: é˜Ÿå¤´æœ‰N * Nä¸ªç‚¹
int h[N * N], e[M], w[M], ne[M], key[N * N];
int g[N][N], dist[N * N][K];
bool st[N * N][K];
set <PII> edges;
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void build() {
    // éå†æ•´å¼ å›¾
    for (int x = 1; x <= n; x ++ )
        for (int y = 1; y <= m; y ++ )
            for (int i = 0; i < 4; i ++ ) { // éå†å››ä¸ªæ–¹å‘
                int tx = x + dx[i];
                int ty = y + dy[i];
                int a = g[x][y], b = g[tx][ty];
                // ç°åœ¨äºŒç»´éƒ½å·²ç»æ˜ å°„æˆä¸€ç»´äº†, å› æ­¤, æ˜¯ç‚¹aå’Œç‚¹bä¹‹é—´çš„è¾¹, ä¸æ˜¯txå’Œtyçš„è¾¹!!
                if (tx <= 0 || tx > n || ty <= 0 || ty > m || edges.count({a, b}))
                    continue;
                // éå†åˆ°açš„æ—¶å€™å»ºa -> b
                // éå†åˆ°bçš„æ—¶å€™å»ºb -> a
                // æ•…, å½“éå†åˆ°aæ—¶, åªéœ€å»ºa -> bçš„å•å‘è¾¹å³å¯
                add(a, b, 0);
                // è®°å½•å½“å‰è¾¹å·²ç»å»ºå®Œ
                edges.insert({a, b});
            }
    return;
}
int bfs() {
    memset(dist, 0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    deque<PII> q;
    // ç¬¬ä¸€ç»´: ç‚¹
    // ç¬¬äºŒç»´: ä»èµ·ç‚¹åˆ°å½“å‰ç‚¹çš„é’¥åŒ™çš„çŠ¶æ€, äºŒè¿›åˆ¶æ•°
    q.push_back({g[1][1], 0});
    dist[g[1][1]][0] = 0;
    while (q.size()) {
        auto t = q.front(); q.pop_front();
        int u = t.x, state = t.y;
        // åˆ°è¾¾ç»“å°¾, è¿”å›å³å¯
        if (u == g[n][m]) return dist[u][state];
        // å·²ç»è¢«è®¿é—®è¿‡, åˆ™è¿›è¡Œä¸‹ä¸€æ¬¡çš„å¾ªç¯
        if (st[u][state]) continue;
        // æ ‡è®°å½“å‰ç‚¹çš„çŠ¶æ€å·²ç»è¢«è®¿é—®è¿‡
        st[u][state] = true;
        if (key[u]) // å¦‚æœå½“å‰ç‚¹æœ‰é’¥åŒ™
            // å¦‚æœèƒ½æ›´æ–°, åˆ™è¿›è¡Œæ›´æ–°
            // æ³¨æ„: çŠ¶æ€è½¬ç§»æ–¹ç¨‹çš„å†™æ³•
            if (dist[u][key[u] | state] > dist[u][state]) {
                dist[u][key[u] | state] = dist[u][state];
                // è·ç¦»ä¸æ›´æ–°, æ›´æ–°é’¥åŒ™çš„çŠ¶æ€, æƒå€¼ä¸º0, æ•…, æ’å…¥åˆ°é˜Ÿå¤´
                q.push_front({u, key[u] | state});
            }
        // è®¿é—®é‚»è¾¹
        for (int i = h[u]; i != -1; i = ne[i]) {
            int j = e[i];
            // å¦‚æœå½“å‰ä½ç½®æœ‰é—¨, ä½†æ˜¯, æ²¡æœ‰å¯¹åº”çš„é’¥åŒ™, åˆ™è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯
            if (w[i] && !(state >> w[i] - 1 & 1)) continue;
            // å¦‚æœèƒ½æ›´æ–°, åˆ™è¿›è¡Œæ›´æ–°
            // æ³¨æ„: çŠ¶æ€è½¬ç§»æ–¹ç¨‹
            if (dist[j][state] > dist[u][state] + 1) {
                dist[j][state] = dist[u][state] + 1;
                // æƒå€¼ä¸º1, åŠ å…¥é˜Ÿå°¾
                q.push_back({j, state});
            }
        }
    }
    return -1;
}
int main() {
    scanf("%d%d%d%d", &n, &m, &p, &k);
    // ç¼–å·
    for (int i = 1, t = 0; i <= n; i ++ )
        for (int j = 1; j <= m; j ++ )
            g[i][j] = ++ t;
    memset(h, -1, sizeof h);
    for (int i = 0; i < k; i ++ ) {
        int x1, y1, x2, y2, type;
        scanf("%d%d%d%d%d", &x1, &y1, &x2, &y2, &type);
        // å°†äºŒç»´æ˜ å°„æˆä¸€ç»´
        int a = g[x1][y1], b = g[x2][y2];
        // è®°å½•å½“å‰è¾¹
        // å³ä½¿æ˜¯å¢™, ä¹Ÿå¾—è®°å½•[è™½ç„¶ä¸è¿è¾¹]
        // åŸå› : éœ€è¦å’Œç©ºåœ°åˆ†å¼€, æ‰€ä»¥, éœ€è¦è®°å½•, ä½†æ˜¯ä¸è¿è¾¹
        edges.insert({a, b});
        edges.insert({b, a});
        // å¦‚æœä¸æ˜¯å¢™, æ— å‘è¾¹
        if (type) {
            add(a, b, type);
            add(b, a, type);
        }
    }
    // å°†å…¶ä»–ç©ºåœ°, è¿›è¡Œå»ºè¾¹
    build();
    int s;
    scanf("%d", &s);
    for (int i = 0; i < s; i ++ ) {
        int x, y, type;
        scanf("%d%d%d", &x, &y, &type);
        int a = g[x][y];
        // é’¥åŒ™çš„å­˜å‚¨å·²ç»æ˜ å°„ä¸ºä¸€ç»´äº†, ç‚¹a
        key[a] |= 1 << type - 1;
    }
    cout << bfs() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2k)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯`ã€`åŒç«¯é˜Ÿåˆ—`ã€`åŠ¨æ€è§„åˆ’`

**ç¼åˆæ€ª**



### [AcWing 1134. æœ€çŸ­è·¯è®¡æ•°](https://www.acwing.com/problem/content/1136/)

**é¢˜ç›®æè¿°**

>   ç»™å‡ºä¸€ä¸ª `N` ä¸ªé¡¶ç‚¹ `M` æ¡è¾¹çš„æ— å‘æ— æƒå›¾ï¼Œé¡¶ç‚¹ç¼–å·ä¸º `1` åˆ° `N`ã€‚
>
>   é—®ä»é¡¶ç‚¹ `1` å¼€å§‹ï¼Œåˆ°å…¶ä»–æ¯ä¸ªç‚¹çš„æœ€çŸ­è·¯æœ‰å‡ æ¡ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å« `2` ä¸ªæ­£æ•´æ•° `N,M`ï¼Œä¸ºå›¾çš„é¡¶ç‚¹æ•°ä¸è¾¹æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ­£æ•´æ•° `x,y`ï¼Œè¡¨ç¤ºæœ‰ä¸€æ¡é¡¶ç‚¹ `x` è¿å‘é¡¶ç‚¹ `y` çš„è¾¹ï¼Œè¯·æ³¨æ„å¯èƒ½æœ‰è‡ªç¯ä¸é‡è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡º `N` è¡Œï¼Œæ¯è¡Œä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œç¬¬ `i` è¡Œè¾“å‡ºä»é¡¶ç‚¹ `1` åˆ°é¡¶ç‚¹ `i` æœ‰å¤šå°‘æ¡ä¸åŒçš„æœ€çŸ­è·¯ï¼Œç”±äºç­”æ¡ˆæœ‰å¯èƒ½ä¼šå¾ˆå¤§ï¼Œä½ åªéœ€è¦è¾“å‡ºå¯¹ `100003` å–æ¨¡åçš„ç»“æœå³å¯ã€‚
>
>   å¦‚æœæ— æ³•åˆ°è¾¾é¡¶ç‚¹ `i` åˆ™è¾“å‡º `0`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 10^5,$
>   +   $1 â‰¤ M â‰¤ 2 Ã— 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
5 7
1 2
1 3
2 4
3 4
2 3
4 5
4 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
1
1
2
4
```

**æ‰‹å†™ç¨¿**

![4160933](img/4160933.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010, M = 400010, mod = 100003;
int n, m, idx;
int h[N], e[M], ne[M], q[N], st[N], dist[N], cnt[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void bfs() {
    memset(dist, 0x3f, sizeof dist);
    memset(st, false, sizeof st);
    int hh = 0, tt = -1;
    dist[1] = 0;
    // èµ·ç‚¹åˆ°èµ·ç‚¹çš„æœ€çŸ­è·¯å¾„æ¡æ•°ä¸º1
    cnt[1] = 1;
    q[++ tt] = 1;
    while (hh <= tt) {
        int t = q[hh ++ ];
        if (st[t]) continue;
        st[t] = true;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] > dist[t] + 1) {
                dist[j] = dist[t] + 1;
                cnt[j] = cnt[t];
                q[++ tt] = j;
            }
            else if (dist[j] == dist[t] + 1)
                cnt[j] = (cnt[j] + cnt[t]) % mod;
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
        add(b, a);
    }
    bfs();
    for (int i = 1; i <= n; i ++ ) cout << cnt[i] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€çŸ­è·¯è®¡æ•°`ã€`BFS`ã€`DP`

**ç¼åˆæ€ª**



### [AcWing 383. è§‚å…‰](https://www.acwing.com/problem/content/385/)

**é¢˜ç›®æè¿°**

>   â€œæ‚¨çš„ä¸ªäººå‡æœŸâ€æ—…è¡Œç¤¾ç»„ç»‡äº†ä¸€æ¬¡æ¯”è·å¢ç»æµè”ç›Ÿçš„å·´å£«ä¹‹æ—…ã€‚
>
>   æ¯”è·å¢ç»æµè”ç›Ÿæœ‰å¾ˆå¤šå…¬äº¤çº¿è·¯ã€‚
>
>   æ¯å¤©å…¬å…±æ±½è½¦éƒ½ä¼šä»ä¸€åº§åŸå¸‚å¼€å¾€å¦ä¸€åº§åŸå¸‚ã€‚
>
>   æ²¿é€”æ±½è½¦å¯èƒ½ä¼šåœ¨ä¸€äº›åŸå¸‚ï¼ˆé›¶æˆ–æ›´å¤šï¼‰åœé ã€‚
>
>   æ—…è¡Œç¤¾è®¡åˆ’æ—…é€”ä» `S` åŸå¸‚å‡ºå‘ï¼Œåˆ° `F` åŸå¸‚ç»“æŸã€‚
>
>   ç”±äºä¸åŒæ—…å®¢çš„æ™¯ç‚¹åå¥½ä¸åŒï¼Œæ‰€ä»¥ä¸ºäº†è¿åˆæ›´å¤šæ—…å®¢ï¼Œæ—…è¡Œç¤¾å°†ä¸ºå®¢æˆ·æä¾›å¤šç§ä¸åŒçº¿è·¯ã€‚
>
>   æ¸¸å®¢å¯ä»¥é€‰æ‹©çš„è¡Œè¿›è·¯çº¿æœ‰æ‰€é™åˆ¶ï¼Œè¦ä¹ˆæ»¡è¶³æ‰€é€‰è·¯çº¿æ€»è·¯ç¨‹ä¸º `S` åˆ° `F` çš„æœ€å°è·¯ç¨‹ï¼Œè¦ä¹ˆæ»¡è¶³æ‰€é€‰è·¯çº¿æ€»è·¯ç¨‹ä»…æ¯”æœ€å°è·¯ç¨‹å¤šä¸€ä¸ªå•ä½é•¿åº¦ã€‚
>
>   ![3463_1.png](img/19_75361c2839-3463_1.png)
>
>   å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¦‚æœ `S = 1ï¼ŒF = 5`ï¼Œåˆ™è¿™é‡Œæœ‰ä¸¤æ¡æœ€çŸ­è·¯çº¿ `1 â†’ 2 â†’ 5, 1 â†’ 3 â†’ 5`ï¼Œé•¿åº¦ä¸º `6`ï¼›æœ‰ä¸€æ¡æ¯”æœ€çŸ­è·¯ç¨‹å¤šä¸€ä¸ªå•ä½é•¿åº¦çš„è·¯çº¿ `1 â†’ 3 â†’ 4 â†’ 5`ï¼Œé•¿åº¦ä¸º `7`ã€‚
>
>   ç°åœ¨ç»™å®šæ¯”è·å¢ç»æµè”ç›Ÿçš„å…¬äº¤è·¯çº¿å›¾ä»¥åŠä¸¤ä¸ªåŸå¸‚ `S` å’Œ `F`ï¼Œè¯·ä½ æ±‚å‡ºæ—…è¡Œç¤¾æœ€å¤šå¯ä»¥ä¸ºæ—…å®¢æä¾›å¤šå°‘ç§ä¸åŒçš„æ»¡è¶³é™åˆ¶æ¡ä»¶çš„çº¿è·¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `T`ï¼Œè¡¨ç¤ºå…±æœ‰ `T` ç»„æµ‹è¯•æ•°æ®ã€‚
>
>   æ¯ç»„æ•°æ®ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ï¼Œåˆ†åˆ«è¡¨ç¤ºæ€»åŸå¸‚æ•°é‡å’Œé“è·¯æ•°é‡ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `A, B, L`ï¼Œè¡¨ç¤ºæœ‰ä¸€æ¡çº¿è·¯ä»åŸå¸‚ `A` é€šå¾€åŸå¸‚ `B`ï¼Œé•¿åº¦ä¸º `L`ã€‚
>
>   éœ€æ³¨æ„ï¼Œçº¿è·¯æ˜¯ **å•å‘çš„**ï¼Œå­˜åœ¨ä» `A` åˆ° `B` çš„çº¿è·¯ä¸ä»£è¡¨ä¸€å®šå­˜åœ¨ä» `B` åˆ° `A` çš„çº¿è·¯ï¼Œå¦å¤–ä»åŸå¸‚ `A` åˆ°åŸå¸‚ `B` å¯èƒ½å­˜åœ¨å¤šä¸ªä¸åŒçš„çº¿è·¯ã€‚
>
>   æ¥ä¸‹æ¥ä¸€è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `S` å’Œ `F`ï¼Œæ•°æ®ä¿è¯ `S` å’Œ `F` ä¸åŒï¼Œå¹¶ä¸” `Sã€ F` ä¹‹é—´è‡³å°‘å­˜åœ¨ä¸€æ¡çº¿è·¯ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºä¸€ä¸ªç»“æœï¼Œæ¯ä¸ªç»“æœå ä¸€è¡Œã€‚
>
>   æ•°æ®ä¿è¯ç»“æœä¸è¶…è¿‡ $10^9$ã€‚

**æ•°æ®èŒƒå›´**

>   +   $2 â‰¤ N â‰¤ 1000,$
>   +   $1 â‰¤ M â‰¤ 10000,$
>   +   $1 â‰¤ L â‰¤ 1000ï¼Œ$
>   +   $1 â‰¤ A, B, S, F â‰¤ N$

**è¾“å…¥æ ·ä¾‹**

```c++
2
5 8
1 2 3
1 3 2
1 4 5
2 3 1
2 5 3
3 4 2
3 5 4
4 5 3
1 5
5 6
2 3 1
3 2 1
3 1 10
4 5 2
5 2 7
5 2 7
4 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
2
```

**æ‰‹å†™ç¨¿**

![4161316](img/4161316.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <queue>
using namespace std;
const int N = 1010, M = 10010, K = 5;
int n, m, T, idx;
int h[N], e[M], w[M], ne[M];
int st[N][K], cnt[N][K], dist[N][K];
struct Node {
    int ver, distance, type;
    // é‡è½½å¤§äºå·
    bool operator > (const Node &W) const {
        return distance > W.distance;
    }
};
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
int dijkstra(int start, int end) {
    // åˆå§‹åŒ–ä¸‰ä¸ªæ•°ç»„
    memset(st, false, sizeof st);
    memset(dist, 0x3f, sizeof dist);
    memset(cnt, 0, sizeof cnt);
    priority_queue<Node, vector<Node>, greater<Node>> heap;
    heap.push({start, 0, 0});
    dist[start][0] = 0;
    cnt[start][0] = 1;
    while (heap.size()) {
        auto t = heap.top(); heap.pop();
        int ver = t.ver, distance = t.distance, type = t.type;
        if (st[ver][type]) continue;
        st[ver][type] = true;
        for (int i = h[ver]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j][0] > distance + w[i]) {
                // æ›´æ–°æ¬¡çŸ­è·¯è·¯å¾„
                cnt[j][1] = cnt[j][0];
                dist[j][1] = dist[j][0];
                heap.push({j, dist[j][1], 1});
                // æ›´æ–°æœ€çŸ­è·¯å¾„
                // æ³¨æ„: è¿™é‡Œæ˜¯cnt[ver][type]ä¸æ˜¯cnt[ver][0]
                cnt[j][0] = cnt[ver][0];
                dist[j][0] = distance + w[i];
                heap.push({j, dist[j][0], 0});
            }
            else if (dist[j][0] == distance + w[i]) {
                // æ³¨æ„: è¿™é‡Œæ˜¯cnt[ver][type]ä¸æ˜¯cnt[ver][0]
                cnt[j][0] += cnt[ver][0];
            }
            else if (dist[j][1] > distance + w[i]) {
                // æ³¨æ„: è¿™é‡Œæ˜¯cnt[ver][type]ä¸æ˜¯cnt[ver][0]
                // è¿™é‡Œçš„ç±»å‹ä¸ä¸€å®šæ˜¯æ¬¡çŸ­è·¯å¾„, æœ‰å¯èƒ½æ˜¯è½è´¥çš„æœ€çŸ­è·¯å¾„, [æ‰‹å†™ç¨¿è§£é‡Š]
                cnt[j][1] = cnt[ver][type];
                dist[j][1] = distance + w[i];
                heap.push({j, dist[j][1], 1});
            }
            else if (dist[j][1] == distance + w[i]) {
                // æ³¨æ„: è¿™é‡Œæ˜¯cnt[ver][type]ä¸æ˜¯cnt[ver][0]
                // è¿™é‡Œçš„ç±»å‹ä¸ä¸€å®šæ˜¯æ¬¡çŸ­è·¯å¾„, æœ‰å¯èƒ½æ˜¯è½è´¥çš„æœ€çŸ­è·¯å¾„, [æ‰‹å†™ç¨¿è§£é‡Š]
                cnt[j][1] += cnt[ver][type];
            }
        }
    }
    int res = cnt[end][0];
    if (dist[end][0] + 1 == dist[end][1]) res += cnt[end][1];
    return res;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        // åˆå§‹åŒ–é˜Ÿå¤´
        memset(h, -1, sizeof h);
        // åˆå§‹åŒ–æŒ‡é’ˆ
        idx = 0;
        scanf("%d%d", &n, &m);
        for (int i = 0; i < m; i ++ ) {
            int a, b, c;
            scanf("%d%d%d", &a, &b, &c);
            // å»ºç«‹å•å‘è¾¹
            add(a, b, c);
        }
        int start, end;
        scanf("%d%d", &start, &end);
        // èµ·ç‚¹å’Œç»ˆç‚¹
        cout << dijkstra(start, end) << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`Dijkstra`ã€`æœ€çŸ­è·¯`ã€`æ¬¡çŸ­è·¯`

**ç¼åˆæ€ª**



## `Floyd` ç®—æ³•

### åŸç†ä»‹ç»

![4171051](img/4171051.png)

### [AcWing 854. Floydæ±‚æœ€çŸ­è·¯](https://www.acwing.com/problem/content/856/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œè¾¹æƒå¯èƒ½ä¸ºè´Ÿæ•°ã€‚
>
>   å†ç»™å®š `k` ä¸ªè¯¢é—®ï¼Œæ¯ä¸ªè¯¢é—®åŒ…å«ä¸¤ä¸ªæ•´æ•° `x` å’Œ `y`ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ€çŸ­è·ç¦»ï¼Œå¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `impossible`ã€‚
>
>   æ•°æ®ä¿è¯å›¾ä¸­ä¸å­˜åœ¨è´Ÿæƒå›è·¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `n, m, k`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `x, y ,z`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ‰å‘è¾¹ï¼Œè¾¹é•¿ä¸º `z`ã€‚
>
>   æ¥ä¸‹æ¥ `k` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `x, y`ï¼Œè¡¨ç¤ºè¯¢é—®ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ€çŸ­è·ç¦»ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…± `k` è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¯¢é—®çš„ç»“æœï¼Œè‹¥è¯¢é—®ä¸¤ç‚¹é—´ä¸å­˜åœ¨è·¯å¾„ï¼Œåˆ™è¾“å‡º `impossible`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 200,$
>   +   $1 â‰¤ k â‰¤ n^2$
>   +   $1 â‰¤ m â‰¤ 20000,$
>   +   $å›¾ä¸­æ¶‰åŠè¾¹é•¿ç»å¯¹å€¼å‡ä¸è¶…è¿‡ 10000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3 2
1 2 1
2 3 2
1 3 1
2 1
1 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
impossible
1
```

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ¿é¢˜, å‚è§[åŸç†ä»‹ç»](#åŸç†ä»‹ç»)
>   2.   æ³¨æ„: æšä¸¾çš„é¡ºåºå³å¯, `k -> i -> j`

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 210, INF = 0x3f3f3f3f;
int n, m, k;
int g[N][N];
int main() {
    scanf("%d%d%d", &n, &m, &k);
    memset(g, 0x3f, sizeof g);
    for (int i = 1; i <= n; i ++ ) g[i][i] = 0;
    for (int i = 0; i < m; i ++ ) {
        int u, v, w;
        scanf("%d%d%d", &u, &v, &w);
        // å¯èƒ½ä¼šæœ‰é‡è¾¹, é‡è¾¹çš„è¯å–æœ€å°å€¼å³å¯
        g[u][v] = min(g[u][v], w);
    }
    for (int k = 1; k <= n; k ++ )
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= n; j ++ )
                g[i][j] = min(g[i][j], g[i][k] + g[k][j]);
    while (k -- ) {
        int u, v;
        scanf("%d%d", &u, &v);
        // å¯èƒ½ä¼šæœ‰è´Ÿæ•°, å› æ­¤, å¦‚æœå½“å…¶å¤§äº INF / 2 çš„æ—¶å€™, åˆ™åˆ¤å®šå…¶æ— è§£
        if (g[u][v] > INF / 2) puts("impossible");
        else cout << g[u][v] << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n ^ 2)$

**æ ‡ç­¾**

`Floyd`ã€`åŠ¨æ€è§„åˆ’`

**ç¼åˆæ€ª**



### [AcWing 1125. ç‰›çš„æ—…è¡Œ](https://www.acwing.com/problem/content/1127/)

**é¢˜ç›®æè¿°**

>   å†œæ°‘ `John` çš„å†œåœºé‡Œæœ‰å¾ˆå¤šç‰§åŒºï¼Œæœ‰çš„è·¯å¾„è¿æ¥ä¸€äº›ç‰¹å®šçš„ç‰§åŒºã€‚
>
>   ä¸€ç‰‡æ‰€æœ‰è¿é€šçš„ç‰§åŒºç§°ä¸ºä¸€ä¸ªç‰§åœºã€‚
>
>   ä½†æ˜¯å°±ç›®å‰è€Œè¨€ï¼Œä½ èƒ½çœ‹åˆ°è‡³å°‘æœ‰ä¸¤ä¸ªç‰§åŒºä¸è¿é€šã€‚
>
>   ç°åœ¨ï¼Œ`John` æƒ³åœ¨å†œåœºé‡Œæ·»åŠ ä¸€æ¡è·¯å¾„ï¼ˆæ³¨æ„ï¼Œæ°å¥½ä¸€æ¡ï¼‰ã€‚
>
>   ä¸€ä¸ªç‰§åœºçš„ç›´å¾„å°±æ˜¯ç‰§åœºä¸­æœ€è¿œçš„ä¸¤ä¸ªç‰§åŒºçš„è·ç¦»ï¼ˆæœ¬é¢˜ä¸­æ‰€æåˆ°çš„æ‰€æœ‰è·ç¦»æŒ‡çš„éƒ½æ˜¯æœ€çŸ­çš„è·ç¦»ï¼‰ã€‚
>
>   è€ƒè™‘å¦‚ä¸‹çš„ä¸¤ä¸ªç‰§åœºï¼Œæ¯ä¸€ä¸ªç‰§åŒºéƒ½æœ‰è‡ªå·±çš„åæ ‡ï¼š
>
>   ![1.png](img/19_2da2200cfa-1.gif)
>
>   å›¾ `1` æ˜¯æœ‰ `5` ä¸ªç‰§åŒºçš„ç‰§åœºï¼Œç‰§åŒºç”¨`â€œ*â€`è¡¨ç¤ºï¼Œè·¯å¾„ç”¨ç›´çº¿è¡¨ç¤ºã€‚
>
>   å›¾ `1` æ‰€ç¤ºçš„ç‰§åœºçš„ç›´å¾„å¤§çº¦æ˜¯ `12.07106`, æœ€è¿œçš„ä¸¤ä¸ªç‰§åŒºæ˜¯ `A` å’Œ `E`ï¼Œå®ƒä»¬ä¹‹é—´çš„æœ€çŸ­è·¯å¾„æ˜¯ `A-B-E`ã€‚
>
>   å›¾ `2` æ˜¯å¦ä¸€ä¸ªç‰§åœºã€‚
>
>   è¿™ä¸¤ä¸ªç‰§åœºéƒ½åœ¨ `John` çš„å†œåœºä¸Šã€‚
>
>   `John` å°†ä¼šåœ¨ä¸¤ä¸ªç‰§åœºä¸­å„é€‰ä¸€ä¸ªç‰§åŒºï¼Œç„¶åç”¨ä¸€æ¡è·¯å¾„è¿èµ·æ¥ï¼Œä½¿å¾—è¿é€šåè¿™ä¸ªæ–°çš„æ›´å¤§çš„ç‰§åœºæœ‰æœ€å°çš„ç›´å¾„ã€‚
>
>   æ³¨æ„ï¼Œå¦‚æœä¸¤æ¡è·¯å¾„ä¸­é€”ç›¸äº¤ï¼Œæˆ‘ä»¬ä¸è®¤ä¸ºå®ƒä»¬æ˜¯è¿é€šçš„ã€‚
>
>   åªæœ‰ä¸¤æ¡è·¯å¾„åœ¨åŒä¸€ä¸ªç‰§åŒºç›¸äº¤ï¼Œæˆ‘ä»¬æ‰è®¤ä¸ºå®ƒä»¬æ˜¯è¿é€šçš„ã€‚
>
>   ç°åœ¨è¯·ä½ ç¼–ç¨‹æ‰¾å‡ºä¸€æ¡è¿æ¥ä¸¤ä¸ªä¸åŒç‰§åœºçš„è·¯å¾„ï¼Œä½¿å¾—è¿ä¸Šè¿™æ¡è·¯å¾„åï¼Œæ‰€æœ‰ç‰§åœºï¼ˆç”Ÿæˆçš„æ–°ç‰§åœºå’ŒåŸæœ‰ç‰§åœºï¼‰ä¸­ç›´å¾„æœ€å¤§çš„ç‰§åœºçš„ç›´å¾„å°½å¯èƒ½å°ã€‚
>
>   è¾“å‡ºè¿™ä¸ªç›´å¾„æœ€å°å¯èƒ½å€¼ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œï¼šä¸€ä¸ªæ•´æ•° `N`, è¡¨ç¤ºç‰§åŒºæ•°ï¼›
>
>   ç¬¬ `2` åˆ° `N + 1` è¡Œï¼šæ¯è¡Œä¸¤ä¸ªæ•´æ•° `X,Y`ï¼Œ è¡¨ç¤º `N` ä¸ªç‰§åŒºçš„åæ ‡ã€‚æ¯ä¸ªç‰§åŒºçš„åæ ‡éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚
>
>   ç¬¬ `N + 2` è¡Œåˆ°ç¬¬ `2 * N + 1` è¡Œï¼šæ¯è¡ŒåŒ…æ‹¬ `N` ä¸ªæ•°å­— ( `0`æˆ–`1` ) è¡¨ç¤ºä¸€ä¸ªå¯¹ç§°é‚»æ¥çŸ©é˜µã€‚
>
>   ä¾‹å¦‚ï¼Œé¢˜ç›®æè¿°ä¸­çš„ä¸¤ä¸ªç‰§åœºçš„çŸ©é˜µæè¿°å¦‚ä¸‹ï¼š
>
>   ```c++
>     A B C D E F G H 
>   A 0 1 0 0 0 0 0 0 
>   B 1 0 1 1 1 0 0 0 
>   C 0 1 0 0 1 0 0 0 
>   D 0 1 0 0 1 0 0 0 
>   E 0 1 1 1 0 0 0 0 
>   F 0 0 0 0 0 0 1 0 
>   G 0 0 0 0 0 1 0 1 
>   H 0 0 0 0 0 0 1 0
>   ```
>
>   è¾“å…¥æ•°æ®ä¸­è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ªä¸è¿é€šçš„ç‰§åŒºã€‚

**è¾“å‡ºæ ¼å¼**

>   åªæœ‰ä¸€è¡Œï¼ŒåŒ…æ‹¬ä¸€ä¸ªå®æ•°ï¼Œè¡¨ç¤ºæ‰€æ±‚ç­”æ¡ˆã€‚
>
>   æ•°å­—ä¿ç•™å…­ä½å°æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 150,$
>   +   $0 â‰¤ X, Y â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
8
10 10
15 10
20 10
15 15
20 15
30 15
25 10
30 10
01000000
10111000
01001000
01001000
01110000
00000010
00000101
00000010
```

**è¾“å‡ºæ ·ä¾‹**

```c++
22.071068
```

**æ‰‹å†™ç¨¿**

![4171451](img/4171451.png)

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 155;
const double INF = 1e20;
int n;
PII q[N];
double Max[N];
double dist[N][N];
char g[N][N];
// è®¡ç®—æ¬§å¼è·ç¦»
double get_dist(PII a, PII b) {
    int dx = a.x - b.x;
    int dy = a.y - b.y;
    return sqrt(dx * dx + dy * dy);
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ ) scanf("%d%d", &q[i].x, &q[i].y);
    for (int i = 0; i < n; i ++ ) scanf("%s", g[i]);
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            // æ›´æ–°ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»
            if (g[i][j] == '1') dist[i][j] = get_dist(q[i], q[j]);
            else if (i == j) dist[i][j] = 0;
            else dist[i][j] = INF;
    // Floydç®—æ³•æ¨¡æ¿
    for (int k = 0; k < n; k ++ )
        for (int i = 0; i < n; i ++ )
            for (int j = 0; j < n; j ++ )
                dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j]);
    // è®¡ç®—è¿é€šå—å†…éƒ¨ä»»æ„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„æœ€é•¿è·ç¦», å³è®¡ç®—ç¬¬ä¸€ç§æƒ…å†µ
    // åˆå§‹åŒ–ä¸º-âˆ
    double res1 = -INF;
    for (int i = 0; i < n; i ++ ) {
        for (int j = 0; j < n; j ++ )
            if (dist[i][j] < INF / 2)
                Max[i] = max(Max[i], dist[i][j]);
        res1 = max(res1, Max[i]);
    }
    // è®¡ç®—ç¬¬äºŒç§æƒ…å†µ
    // åˆå§‹åŒ–ä¸º+âˆ
    double res2 = INF;
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < n; j ++ )
            if (dist[i][j] > INF / 2) // ä¸è¿é€š
                res2 = min(res2, Max[i] + Max[j] + get_dist(q[i], q[j]));
    // ä¸¤ç§æƒ…å†µå–maxå³å¯
    printf("%lf\n", max(res1, res2));
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

`O(n^2)`

**æ ‡ç­¾**

`Floyd`ã€`ä¼ é€’é—­åŒ…`

**ç¼åˆæ€ª**



### [PTA L2-010 æ’åº§ä½](https://pintia.cn/problem-sets/994805046380707840/problems/994805066135879680)

**é¢˜ç›®æè¿°**

>   å¸ƒç½®å®´å¸­æœ€å¾®å¦™çš„äº‹æƒ…ï¼Œå°±æ˜¯ç»™å‰æ¥å‚å®´çš„å„ä½å®¾å®¢å®‰æ’åº§ä½ã€‚æ— è®ºå¦‚ä½•ï¼Œæ€»ä¸èƒ½æŠŠä¸¤ä¸ªæ­»å¯¹å¤´æ’åˆ°åŒä¸€å¼ å®´ä¼šæ¡Œæ—ï¼è¿™ä¸ªè‰°å·¨ä»»åŠ¡ç°åœ¨å°±äº¤ç»™ä½ ï¼Œå¯¹ä»»ä½•ä¸€å¯¹å®¢äººï¼Œè¯·ç¼–å†™ç¨‹åºå‘Šè¯‰ä¸»äººä»–ä»¬æ˜¯å¦èƒ½è¢«å®‰æ’åŒå¸­ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥ç¬¬ä¸€è¡Œç»™å‡º3ä¸ªæ­£æ•´æ•°ï¼š`N`ï¼ˆ`â‰¤100`ï¼‰ï¼Œå³å‰æ¥å‚å®´çš„å®¾å®¢æ€»äººæ•°ï¼Œåˆ™è¿™äº›äººä»`1`åˆ°`N`ç¼–å·ï¼›`M`ä¸ºå·²çŸ¥ä¸¤ä¸¤å®¾å®¢ä¹‹é—´çš„å…³ç³»æ•°ï¼›`K`ä¸ºæŸ¥è¯¢çš„æ¡æ•°ã€‚éšå`M`è¡Œï¼Œæ¯è¡Œç»™å‡ºä¸€å¯¹å®¾å®¢ä¹‹é—´çš„å…³ç³»ï¼Œæ ¼å¼ä¸ºï¼š`å®¾å®¢1 å®¾å®¢2 å…³ç³»`ï¼Œå…¶ä¸­`å…³ç³»`ä¸º`1`è¡¨ç¤ºæ˜¯æœ‹å‹ï¼Œ`-1`è¡¨ç¤ºæ˜¯æ­»å¯¹å¤´ã€‚æ³¨æ„ä¸¤ä¸ªäººä¸å¯èƒ½æ—¢æ˜¯æœ‹å‹åˆæ˜¯æ•Œäººã€‚æœ€å`K`è¡Œï¼Œæ¯è¡Œç»™å‡ºä¸€å¯¹éœ€è¦æŸ¥è¯¢çš„å®¾å®¢ç¼–å·ã€‚
>
>   è¿™é‡Œå‡è®¾æœ‹å‹çš„æœ‹å‹ä¹Ÿæ˜¯æœ‹å‹ã€‚ä½†æ•Œäººçš„æ•Œäººå¹¶ä¸ä¸€å®šå°±æ˜¯æœ‹å‹ï¼Œæœ‹å‹çš„æ•Œäººä¹Ÿä¸ä¸€å®šæ˜¯æ•Œäººã€‚åªæœ‰å•çº¯ç›´æ¥çš„æ•Œå¯¹å…³ç³»æ‰æ˜¯ç»å¯¹ä¸èƒ½åŒå¸­çš„ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹æ¯ä¸ªæŸ¥è¯¢è¾“å‡ºä¸€è¡Œç»“æœï¼šå¦‚æœä¸¤ä½å®¾å®¢ä¹‹é—´æ˜¯æœ‹å‹ï¼Œä¸”æ²¡æœ‰æ•Œå¯¹å…³ç³»ï¼Œåˆ™è¾“å‡º`No problem`ï¼›å¦‚æœä»–ä»¬ä¹‹é—´å¹¶ä¸æ˜¯æœ‹å‹ï¼Œä½†ä¹Ÿä¸æ•Œå¯¹ï¼Œåˆ™è¾“å‡º`OK`ï¼›å¦‚æœä»–ä»¬ä¹‹é—´æœ‰æ•Œå¯¹ï¼Œç„¶è€Œä¹Ÿæœ‰å…±åŒçš„æœ‹å‹ï¼Œåˆ™è¾“å‡º`OK but...`ï¼›å¦‚æœä»–ä»¬ä¹‹é—´åªæœ‰æ•Œå¯¹å…³ç³»ï¼Œåˆ™è¾“å‡º`No way`ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
7 8 4
5 6 1
2 7 -1
1 3 1
3 4 1
6 7 -1
1 2 1
1 4 1
2 3 -1
3 4
5 7
2 3
7 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
No problem
OK
OK but...
No way
```

**æ‰‹å†™ç¨¿**

![4281609](img/4281609.png)

**ä»£ç ä¸€:ä¼ é€’é—­åŒ…**

```c++
#include <iostream>
using namespace std;
const int N = 110;
int n, m, k;
int friends[N][N], enemy[N][N];
void floyd() {
    for (int k = 1; k <= n; k ++ )
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= n; j ++ )
                // |= ä¸æ˜¯ =
                // å¦‚æœiå’Œjå·²ç»æ˜¯æœ‹å‹, åˆ™ä¸ç®¡iå’Œkå·²ç»kå’Œjæ˜¯å¦æ˜¯æœ‹å‹
                // éƒ½ä¸èƒ½å½±å“iå’Œjå·²ç»æ˜¯æœ‹å‹è¿™ä»¶äº‹å®, æ•…ä½¿ç”¨ |= è€Œä¸æ˜¯ =
                friends[i][j] |= friends[i][k] && friends[k][j];
    return;
}
int main() {
    scanf("%d%d%d", &n, &m, &k);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        // æœ‹å‹çš„æœ‹å‹è¿˜æ˜¯æœ‹å‹
        if (c == 1) friends[a][b] = friends[b][a] = 1;
        else enemy[a][b] = enemy[b][a] = 1;
    }
    floyd();
    while (k -- ) {
        int a, b;
        scanf("%d%d", &a, &b);
        if (friends[a][b] && !enemy[a][b]) puts("No problem");
        else if (!friends[a][b] && !enemy[a][b]) puts("OK");
        else if (friends[a][b] && enemy[a][b]) puts("OK but...");
        else if (!friends[a][b] && enemy[a][b]) puts("No way");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n ^ 3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**ä»£ç äºŒ: å¹¶æŸ¥é›†**

```c++
#include <iostream>
using namespace std;
const int N = 110;
int n, m, k;
int f[N];
int enemy[N][N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d%d", &n, &m, &k);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        // æœ‹å‹çš„æœ‹å‹è¿˜æ˜¯æœ‹å‹
        if (c == 1) {
            int fa = find(a);
            int fb = find(b);
            if (fa == fb) continue;
            f[fb] = fa;
        }
        else enemy[a][b] = enemy[b][a] = 1;
    }
    while (k -- ) {
        int a, b;
        scanf("%d%d", &a, &b);
        int fa = find(a);
        int fb = find(b);
        if (fa == fb && !enemy[a][b]) puts("No problem");
        else if (fa != fb && !enemy[a][b]) puts("OK");
        else if (fa == fb && enemy[a][b]) puts("OK but...");
        else if (fa != fb && enemy[a][b]) puts("No way");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`å¹¶æŸ¥é›†`ã€`ä¼ é€’é—­åŒ…`

**ç¼åˆæ€ª**



### [AcWing 343. æ’åº](https://www.acwing.com/problem/content/345/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` ä¸ªå˜é‡å’Œ `m` ä¸ªä¸ç­‰å¼ã€‚å…¶ä¸­ `n` å°äºç­‰äº `26`ï¼Œå˜é‡åˆ†åˆ«ç”¨å‰ `n` çš„å¤§å†™è‹±æ–‡å­—æ¯è¡¨ç¤ºã€‚
>
>   ä¸ç­‰å¼ä¹‹é—´å…·æœ‰ä¼ é€’æ€§ï¼Œå³è‹¥ `A > B` ä¸” `B > C`ï¼Œåˆ™ `A > C`ã€‚
>
>   è¯·ä»å‰å¾€åéå†æ¯å¯¹å…³ç³»ï¼Œæ¯æ¬¡éå†æ—¶åˆ¤æ–­ï¼š
>
>   -   å¦‚æœèƒ½å¤Ÿç¡®å®šå…¨éƒ¨å…³ç³»ä¸”æ— çŸ›ç›¾ï¼Œåˆ™ç»“æŸå¾ªç¯ï¼Œè¾“å‡ºç¡®å®šçš„æ¬¡åºï¼›
>   -   å¦‚æœå‘ç”ŸçŸ›ç›¾ï¼Œåˆ™ç»“æŸå¾ªç¯ï¼Œè¾“å‡ºæœ‰çŸ›ç›¾ï¼›
>   -   å¦‚æœå¾ªç¯ç»“æŸæ—¶æ²¡æœ‰å‘ç”Ÿä¸Šè¿°ä¸¤ç§æƒ…å†µï¼Œåˆ™è¾“å‡ºæ— å®šè§£ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚
>
>   æ¯ç»„æµ‹è¯•æ•°æ®ï¼Œç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªä¸ç­‰å¼ï¼Œä¸ç­‰å¼å…¨éƒ¨ä¸ºå°äºå…³ç³»ã€‚
>
>   å½“è¾“å…¥ä¸€è¡Œ `0 0` æ—¶ï¼Œè¡¨ç¤ºè¾“å…¥ç»ˆæ­¢ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºä¸€ä¸ªå ä¸€è¡Œçš„ç»“æœã€‚
>
>   ç»“æœå¯èƒ½ä¸ºä¸‹åˆ—ä¸‰ç§ä¹‹ä¸€ï¼š
>
>   1.  å¦‚æœå¯ä»¥ç¡®å®šä¸¤ä¸¤ä¹‹é—´çš„å…³ç³»ï¼Œåˆ™è¾“å‡º `"Sorted sequence determined after t relations: yyy...y."`,å…¶ä¸­`'t'`æŒ‡è¿­ä»£æ¬¡æ•°ï¼Œ`'yyy...y'`æ˜¯æŒ‡å‡åºæ’åˆ—çš„æ‰€æœ‰å˜é‡ã€‚
>   2.  å¦‚æœæœ‰çŸ›ç›¾ï¼Œåˆ™è¾“å‡ºï¼š `"Inconsistency found after t relations."`ï¼Œå…¶ä¸­`'t'`æŒ‡è¿­ä»£æ¬¡æ•°ã€‚
>   3.  å¦‚æœæ²¡æœ‰çŸ›ç›¾ï¼Œä¸”ä¸èƒ½ç¡®å®šä¸¤ä¸¤ä¹‹é—´çš„å…³ç³»ï¼Œåˆ™è¾“å‡º `"Sorted sequence cannot be determined."`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $2 â‰¤ n â‰¤ 26ï¼Œå˜é‡åªå¯èƒ½ä¸ºå¤§å†™å­—æ¯ A âˆ¼ Zã€‚$

**è¾“å…¥æ ·ä¾‹1**

```c++
4 6
A<B
A<C
B<C
C<D
B<D
A<B
3 2
A<B
B<A
26 1
A<Z
0 0
```

**è¾“å‡ºæ ·ä¾‹1**

```c++
Sorted sequence determined after 4 relations: ABCD.
Inconsistency found after 2 relations.
Sorted sequence cannot be determined.
```

**è¾“å…¥æ ·ä¾‹2**

```c++
6 6
A<F
B<D
C<E
F<D
D<E
E<F
0 0
```

**è¾“å‡ºæ ·ä¾‹2**

```c++
Inconsistency found after 6 relations.
```

**è¾“å…¥æ ·ä¾‹3**

```c++
5 5
A<B
B<C
C<D
D<E
E<A
0 0
```

**è¾“å‡ºæ ·ä¾‹3**

```c++
Sorted sequence determined after 4 relations: ABCDE.
```

**æ‰‹å†™ç¨¿**

>   1.   åŸå§‹æ‰‹å†™ç¨¿
>
>        ![4181728](img/4181728.png)
>
>   2.   è¡¥å……è¯´æ˜
>
>        ![4272041](img/4272041.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 30;
int n, m;
int st[N];
int g[N][N];
void floyd() {
    for (int k = 0; k < n; k ++ )
        for (int i = 0; i < n; i ++ )
            for (int j = 0; j < n; j ++ )
                g[i][j] |= g[i][k] && g[k][j];
    return;
}
int check() {
    for (int i = 0; i < n; i ++ )
        if (g[i][i]) return 2;
    for (int i = 0; i < n; i ++ )
        for (int j = i + 1; j < n; j ++ )
            // æ³¨æ„: æ‰‹å†™ç¨¿è¯´æ˜
            if (!g[i][j] && !g[j][i]) return 3;
    return 1;
}
int main() {
    while (~scanf("%d%d", &n, &m), n || m) {
        memset(g, 0, sizeof g);
        char str[5];
        int tms, t = 3;
        for (int i = 1; i <= m; i ++ ) {
            scanf("%s", str);
            int a = str[0] - 'A';
            int b = str[2] - 'A';
            // ç¬¬ä¸‰ç§æƒ…å†µ, ä¹Ÿå°±æ˜¯ä¸ç¡®å®šçš„æ—¶å€™, æ‰ç»§ç»­è¿è¾¹
            // ç¬¬ä¸€ã€äºŒç§æƒ…å†µ, ä¹Ÿå°±æ˜¯è¯´å·²ç»å¾—å‡ºç»“è®ºäº†, åˆ™ç›´æ¥è·³è¿‡, ä¸éœ€è¦è¿è¾¹, ä¹Ÿä¸éœ€è¦è¿›è¡Œåˆ¤æ–­
            if (t == 3) {
                g[a][b] = 1;
                floyd();
                int k = check();
                t = k;
                tms = i;
            }
        }
        if (t == 1) {
            printf("Sorted sequence determined after %d relations: ", tms);
            memset(st, false, sizeof st);
         	// æ‰¾åˆ°nä¸ªç‚¹, æ•…å¾ªç¯næ¬¡
            for (int k = 0; k < n; k ++ )
                // éå†æ¯ä¸€åˆ—
                for (int j = 0; j < n; j ++ ) {
                    if (st[j]) continue;
                    int flag = true;
                    // éå†æ¯ä¸€è¡Œ
                    for (int i = 0; i < n; i ++ ) {
                        if (st[i]) continue;
                        if (g[i][j]) {
                            flag = false;
                            break;
                        }
                    }
                    if (flag) {
                        st[j] = true;
                        printf("%c", j + 'A');
                        break;
                    }
                }
            puts(".");
        }
        else if (t == 2) printf("Inconsistency found after %d relations.\n", tms);
        else printf("Sorted sequence cannot be determined.\n");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mn^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`Floyd`ã€`é—­åŒ…`ã€`ä¼ é€’é—­åŒ…`

**ç¼åˆæ€ª**



### [AcWing 344. è§‚å…‰ä¹‹æ—…](https://www.acwing.com/problem/content/346/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€å¼ æ— å‘å›¾ï¼Œæ±‚å›¾ä¸­ä¸€ä¸ªè‡³å°‘åŒ…å« `3` ä¸ªç‚¹çš„ç¯ï¼Œç¯ä¸Šçš„èŠ‚ç‚¹ä¸é‡å¤ï¼Œå¹¶ä¸”ç¯ä¸Šçš„è¾¹çš„é•¿åº¦ä¹‹å’Œæœ€å°ã€‚
>
>   è¯¥é—®é¢˜ç§°ä¸ºæ— å‘å›¾çš„æœ€å°ç¯é—®é¢˜ã€‚
>
>   ä½ éœ€è¦è¾“å‡ºæœ€å°ç¯çš„æ–¹æ¡ˆï¼Œè‹¥æœ€å°ç¯ä¸å”¯ä¸€ï¼Œè¾“å‡ºä»»æ„ä¸€ä¸ªå‡å¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ï¼Œè¡¨ç¤ºæ— å‘å›¾æœ‰ `N` ä¸ªç‚¹ï¼Œ`M` æ¡è¾¹ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `uï¼Œvï¼Œl`ï¼Œè¡¨ç¤ºç‚¹ `u` å’Œç‚¹ `v` ä¹‹é—´æœ‰ä¸€æ¡è¾¹ï¼Œè¾¹é•¿ä¸º `l`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå ä¸€è¡Œï¼ŒåŒ…å«æœ€å°ç¯çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆæŒ‰é¡ºåºè¾“å‡ºï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º `No solution.`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 100,$
>   +   $1 â‰¤ M â‰¤ 10000,$
>   +   $1 â‰¤ l < 500$

**è¾“å…¥æ ·ä¾‹**

```c++
5 7
1 4 1
1 3 300
3 1 10
1 2 16
2 3 100
2 5 15
5 3 20
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 3 5 2
```

**æ‰‹å†™ç¨¿**

![4191406](img/4191406.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110, INF = 0x3f3f3f3f;
int n, m, cnt;
int path[N];
int g[N][N], dist[N][N], pos[N][N];
void dfs(int i, int j) {
    if (pos[i][j] == 0) return;
    // æšä¸¾iå’Œjçš„åˆ†ç•Œç‚¹
    int k = pos[i][j];
    // é€’å½’å·¦åŠè¾¹
    dfs(i, k);
    // è®°å½•ä¸­é—´ç‚¹
    path[cnt ++ ] = k;
    // é€’å½’å³åŠè¾¹
    dfs(k, j);
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(g, 0x3f, sizeof g);
    for (int i = 1; i <= n; i ++ ) g[i][i] = 0;
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d",&a, &b, &c);
        g[a][b] = g[b][a] = min(g[a][b], c);
    }
    memcpy(dist, g, sizeof g);
    int res = INF;
    for (int k = 1; k <= n; k ++ ) {
        for (int i = 1; i < k; i ++ )
            for (int j = i + 1; j < k; j ++ )
                // g[i][k]æ˜¯iå’Œkä¹‹é—´çš„æƒå€¼
                // g[k][j]æ˜¯kå’Œjä¹‹é—´çš„æƒå€¼
                if ((long long)dist[i][j] + g[i][k] + g[k][j] < res) {
                    cnt = 0;
                    res = dist[i][j] + g[i][k] + g[k][j];
                    path[cnt ++ ] = k;
                    path[cnt ++ ] = i;
                    dfs(i, j);
                    path[cnt ++ ] = j;
                }
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= n; j ++ )
                if (dist[i][j] > dist[i][k] + dist[k][j]) {
                    dist[i][j] = dist[i][k] + dist[k][j];
                    // è®°å½•åˆ†ç•Œç‚¹
                    pos[i][j] = k;
                }
    }
    if (res == INF) puts("No solution.");
    else
        for (int i = 0; i < cnt; i ++ ) cout << path[i] << " ";
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€å°ç¯`ã€`Floyd`

**ç¼åˆæ€ª**



### [AcWing 345. ç‰›ç«™](https://www.acwing.com/problem/content/347/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€å¼ ç”± `T` æ¡è¾¹æ„æˆçš„æ— å‘å›¾ï¼Œç‚¹çš„ç¼–å·ä¸º `1 âˆ¼ 1000` ä¹‹é—´çš„æ•´æ•°ã€‚
>
>   æ±‚ä»èµ·ç‚¹ `S` åˆ°ç»ˆç‚¹ `E` æ°å¥½ç»è¿‡ `N` æ¡è¾¹ï¼ˆå¯ä»¥é‡å¤ç»è¿‡ï¼‰çš„æœ€çŸ­è·¯ã€‚
>
>   **æ³¨æ„**: æ•°æ®ä¿è¯ä¸€å®šæœ‰è§£ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œï¼šåŒ…å«å››ä¸ªæ•´æ•° `Nï¼ŒTï¼ŒSï¼ŒE`ã€‚
>
>   ç¬¬ `2..T + 1` è¡Œï¼šæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•°ï¼Œæè¿°ä¸€æ¡è¾¹çš„è¾¹é•¿ä»¥åŠæ„æˆè¾¹çš„ä¸¤ä¸ªç‚¹çš„ç¼–å·ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€çŸ­è·¯çš„é•¿åº¦ã€‚

**æ•°æ®èŒƒå›´**

>   +   $2 â‰¤ T â‰¤ 100,$
>   +   $2 â‰¤ N â‰¤ 10^6$

**è¾“å…¥æ ·ä¾‹**

```c++
2 6 6 4
11 4 6
4 4 8
8 4 9
6 6 8
2 6 9
3 8 9
```

**è¾“å‡ºæ ·ä¾‹**

```c++
10
```

**æ‰‹å†™ç¨¿**

![4211039](img/4211039.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <unordered_map>
using namespace std;
const int N = 210;
int n, m, k, S, E;
int g[N][N], res[N][N];
unordered_map<int, int> id;
void mul(int c[][N], int a[][N], int b[][N]) {
    // ç”±äºcå’Œaæˆ–è€…bç›¸ç­‰, ä¸ºé˜²æ­¢è¯»å†™å†²çª
    // å› æ­¤, ä½¿ç”¨tmpä½œä¸ºæ–°çš„ä¸´æ—¶æ•°ç»„
    static int tmp[N][N];
    memset(tmp, 0x3f, sizeof tmp);
    // Floydæ¨¡æ¿
    for (int k = 1; k <= n; k ++ )
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= n; j ++ )
                tmp[i][j] = min(tmp[i][j], a[i][k] + b[k][j]);
    memcpy(c, tmp, sizeof tmp);
    return;
}
void qmi() {
    // resè¡¨ç¤ºç»è¿‡0æ¡è¾¹, ä»Såˆ°Eçš„æœ€çŸ­è·¯å¾„
    // æ•…: res[i][i]åˆå§‹åŒ–ä¸º0
    memset(res, 0x3f, sizeof res);
    for (int i = 1; i <= n; i ++ ) res[i][i] = 0;
    while (k) {
        if (k & 1) mul(res, res, g);
        // gå€å¢ä¸€æ¬¡, è¡¨ç¤ºç»è¿‡2æ¡è¾¹, ä»Sèµ°åˆ°Eçš„æœ€çŸ­è·ç¦»
        // gå€å¢ä¸¤æ¬¡, è¡¨ç¤ºç»è¿‡4æ¡è¾¹, ä»Sèµ°åˆ°Eçš„æœ€çŸ­è·ç¦»
        // ... ä¾æ¬¡ç±»æ¨
        mul(g, g, g);
        k >>= 1;
    }
    return;
}
int main() {
    // gæ•°ç»„è¡¨ç¤ºç»è¿‡1æ¡è¾¹, ä»Sèµ°åˆ°Eçš„æœ€çŸ­è·ç¦»
    memset(g, 0x3f, sizeof g);
    scanf("%d%d%d%d", &k, &m, &S, &E);
    if (!id.count(S)) id[S] = ++ n;
    if (!id.count(E)) id[E] = ++ n;
    // ç¦»æ•£åŒ–
    S = id[S], E = id[E];
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &c, &a, &b);
        if (!id.count(a)) id[a] = ++ n;
        if (!id.count(b)) id[b] = ++ n;
        a = id[a], b = id[b];
        // é˜²æ­¢é‡è¾¹
        g[a][b] = g[b][a] = min(g[a][b], c);
    }
    qmi();
    cout << res[S][E] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3log_k)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`Floyd`ã€`å€å¢`

**ç¼åˆæ€ª**



## æœ€å°ç”Ÿæˆæ ‘

### æ­£ç¡®æ€§è¯æ˜

#### `Prim`

![4231017](img/4231017.png)

#### `Kruskal`

>   1.   åŒ `prim` è¯æ˜æ–¹æ³•

### [AcWing 858. Primç®—æ³•æ±‚æœ€å°ç”Ÿæˆæ ‘](https://www.acwing.com/problem/content/860/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æ— å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œè¾¹æƒå¯èƒ½ä¸ºè´Ÿæ•°ã€‚
>
>   æ±‚æœ€å°ç”Ÿæˆæ ‘çš„æ ‘è¾¹æƒé‡ä¹‹å’Œï¼Œå¦‚æœæœ€å°ç”Ÿæˆæ ‘ä¸å­˜åœ¨åˆ™è¾“å‡º `impossible`ã€‚
>
>   ç»™å®šä¸€å¼ è¾¹å¸¦æƒçš„æ— å‘å›¾ `G=(V,E)`ï¼Œå…¶ä¸­ `V` è¡¨ç¤ºå›¾ä¸­ç‚¹çš„é›†åˆï¼Œ`E` è¡¨ç¤ºå›¾ä¸­è¾¹çš„é›†åˆï¼Œ`n=|V|`ï¼Œ`m=|E|`ã€‚
>
>   ç”± `V` ä¸­çš„å…¨éƒ¨ `n` ä¸ªé¡¶ç‚¹å’Œ `E` ä¸­ `n âˆ’ 1` æ¡è¾¹æ„æˆçš„æ— å‘è¿é€šå­å›¾è¢«ç§°ä¸º `G` çš„ä¸€æ£µç”Ÿæˆæ ‘ï¼Œå…¶ä¸­è¾¹çš„æƒå€¼ä¹‹å’Œæœ€å°çš„ç”Ÿæˆæ ‘è¢«ç§°ä¸ºæ— å‘å›¾ `G` çš„æœ€å°ç”Ÿæˆæ ‘ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `u,v,w`ï¼Œè¡¨ç¤ºç‚¹ `u` å’Œç‚¹ `v` ä¹‹é—´å­˜åœ¨ä¸€æ¡æƒå€¼ä¸º `w` çš„è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼Œè‹¥å­˜åœ¨æœ€å°ç”Ÿæˆæ ‘ï¼Œåˆ™è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°ç”Ÿæˆæ ‘çš„æ ‘è¾¹æƒé‡ä¹‹å’Œï¼Œå¦‚æœæœ€å°ç”Ÿæˆæ ‘ä¸å­˜åœ¨åˆ™è¾“å‡º `impossible`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 500,$
>   +   $1 â‰¤ m â‰¤ 10^5,$
>   +   $å›¾ä¸­æ¶‰åŠè¾¹çš„è¾¹æƒçš„ç»å¯¹å€¼å‡ä¸è¶…è¿‡ 10000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
4 5
1 2 1
1 3 2
1 4 3
2 3 2
3 4 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
6
```

**æ‰‹å†™ç¨¿**

![4211434](img/4211434.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 510, INF = 0x3f3f3f3f;
int n, m;
int dist[N], st[N];
int g[N][N];
int prim() {
    // dist[i]è¡¨ç¤ºç‚¹iåˆ°[é›†åˆ]çš„ç‚¹çš„è·ç¦»
    memset(dist, 0x3f, sizeof dist);
    // st[i]è¡¨ç¤ºç‚¹iæ˜¯å¦åŠ å…¥åˆ°é›†åˆä¸­
    memset(st, false, sizeof st);
    int res = 0;
    // ä¸€å…±å–nä¸ªç‚¹, æ•…, å¾ªç¯næ¬¡
    for (int i = 0; i < n; i ++ ) {
        int t = -1;
        for (int j = 1; j <= n; j ++ )
            // å¯»æ‰¾è·ç¦»[é›†åˆ]çš„ç‚¹çš„æœ€å°è·ç¦»
            if (!st[j] && (t == -1 || dist[t] > dist[j]))
                t = j;
        // æ ‡è®°å½“å‰ç‚¹å·²ç»å¤„äº[é›†åˆ]å†…
        st[t] = true;
        // ä¸è¿é€š, è¿”å›false
        if (i && dist[t] == INF) return INF;
        if (i) res += dist[t];
        for (int j = 1; j <= n; j ++ )
            // å¦‚æœå½“å‰ç‚¹å¤„äº[é›†åˆ]å¤–å¹¶ä¸”å½“å‰ç‚¹åˆ°[é›†åˆ]å†…çš„ç‚¹çš„è·ç¦»æ›´å°, åˆ™æ›´æ–°
            if (!st[j] && dist[j] > g[t][j]) dist[j] = g[t][j];
    }
    return res;
}
int main() {
    scanf("%d%d", &n, &m);
    // æœ€å°ç”Ÿæˆæ ‘ä¸å«æœ‰è‡ªç¯
    // å› æ­¤, å°†g[i][i]ä¹‹é—´çš„è·ç¦»ä¹Ÿåˆå§‹åŒ–ä¸º+âˆ
    memset(g, 0x3f, sizeof g);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        // å–é‡è¾¹çš„æœ€å°å€¼å³å¯
        g[a][b] = g[b][a] = min(g[a][b], c);
    }
    int t = prim();
    if (t == INF) puts("impossible");
    else cout << t << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€å°ç”Ÿæˆæ ‘`ã€`prim`

**ç¼åˆæ€ª**



### [AcWing 859. Kruskalç®—æ³•æ±‚æœ€å°ç”Ÿæˆæ ‘](https://www.acwing.com/problem/content/861/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æ— å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ï¼Œè¾¹æƒå¯èƒ½ä¸ºè´Ÿæ•°ã€‚
>
>   æ±‚æœ€å°ç”Ÿæˆæ ‘çš„æ ‘è¾¹æƒé‡ä¹‹å’Œï¼Œå¦‚æœæœ€å°ç”Ÿæˆæ ‘ä¸å­˜åœ¨åˆ™è¾“å‡º `impossible`ã€‚
>
>   ç»™å®šä¸€å¼ è¾¹å¸¦æƒçš„æ— å‘å›¾ `G=(V,E)`ï¼Œå…¶ä¸­ `V` è¡¨ç¤ºå›¾ä¸­ç‚¹çš„é›†åˆï¼Œ`E` è¡¨ç¤ºå›¾ä¸­è¾¹çš„é›†åˆï¼Œ`n=|V|`ï¼Œ`m=|E|`ã€‚
>
>   ç”± `V` ä¸­çš„å…¨éƒ¨ `n` ä¸ªé¡¶ç‚¹å’Œ `E` ä¸­ `n âˆ’ 1` æ¡è¾¹æ„æˆçš„æ— å‘è¿é€šå­å›¾è¢«ç§°ä¸º `G` çš„ä¸€æ£µç”Ÿæˆæ ‘ï¼Œå…¶ä¸­è¾¹çš„æƒå€¼ä¹‹å’Œæœ€å°çš„ç”Ÿæˆæ ‘è¢«ç§°ä¸ºæ— å‘å›¾ `G` çš„æœ€å°ç”Ÿæˆæ ‘ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `u,v,w`ï¼Œè¡¨ç¤ºç‚¹ `u` å’Œç‚¹ `v` ä¹‹é—´å­˜åœ¨ä¸€æ¡æƒå€¼ä¸º `w` çš„è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼Œè‹¥å­˜åœ¨æœ€å°ç”Ÿæˆæ ‘ï¼Œåˆ™è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°ç”Ÿæˆæ ‘çš„æ ‘è¾¹æƒé‡ä¹‹å’Œï¼Œå¦‚æœæœ€å°ç”Ÿæˆæ ‘ä¸å­˜åœ¨åˆ™è¾“å‡º `impossible`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 10^5,$
>   +   $1 â‰¤ m â‰¤ 2 âˆ— 10^5,$
>   +   $å›¾ä¸­æ¶‰åŠè¾¹çš„è¾¹æƒçš„ç»å¯¹å€¼å‡ä¸è¶…è¿‡ 1000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
4 5
1 2 1
1 3 2
1 4 3
2 3 2
3 4 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
6
```

**æ‰‹å†™ç¨¿**

>   1.   ç®—æ³•æµç¨‹:
>        +   å°†æ‰€æœ‰è¾¹æŒ‰ç…§æƒå€¼ä»å°åˆ°å¤§è¿›è¡Œæ’åº
>        +   ä¾æ¬¡éå†æ¯æ¡è¾¹, å¦‚æœè¾¹ä¸¤ç«¯çš„ç‚¹ `a` å’Œ `b` ä¸åœ¨ä¸€ä¸ªé›†åˆ`[å¹¶æŸ¥é›†]`, åˆ™å°†å…¶åŠ å…¥æœ€å°ç”Ÿæˆæ ‘å³å¯
>        +   é‡å¤ä¸Šè¿°æ­¥éª¤, ç›´åˆ°ç»“æŸ

**ä»£ç **

````c++
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 100010, M = 200010;
int n, m;
int f[N];
struct Edge {
    int u, v, w;
    bool operator < (const Edge &W) const {
        // æŒ‰ç…§æƒå€¼ä»å°åˆ°å¤§è¿›è¡Œæ’åº
        return w < W.w;
    }
}edges[M];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        edges[i] = {a, b, c};
    }
    sort(edges, edges + m);
    // resæ˜¯æœ€å°ç”Ÿæˆæ ‘çš„æƒå€¼
    // cntæ˜¯æœ€å°ç”Ÿæˆæ ‘çš„è¾¹æ•°
    int res = 0, cnt = 0;
    for (int i = 0; i < m; i ++ ) {
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        int fa = find(a);
        int fb = find(b);
        if (fa != fb) { // å¦‚æœä¸å¤„äºä¸€ä¸ªé›†åˆå½“ä¸­
            res += c; // æƒå€¼ç›¸åŠ 
            f[fb] = fa; // å¼ºè¡Œèåˆä¸ºä¸€ä¸ªå’Œå’Œç¦ç¦çš„å¤§å®¶åº­
            cnt ++; // è¾¹æ•° ++
        }
    }
    // å¦‚æœæœ€å°ç”Ÿæˆæ ‘çš„è¾¹çš„ä¸ªæ•°å°äº n - 1, åˆ™è¯´æ˜ä¸è¿é€š, è¾“å‡º "impossible"
    if (cnt < n - 1) puts("impossible");
    else cout << res << endl;
    return 0;
}
````

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`kruskal`ã€`æœ€å°ç”Ÿæˆæ ‘`

**ç¼åˆæ€ª**

[AcWing 837. è¿é€šå—ä¸­ç‚¹çš„æ•°é‡](#AcWing 837. è¿é€šå—ä¸­ç‚¹çš„æ•°é‡)

### [AcWing 1140. æœ€çŸ­ç½‘ç»œ](https://www.acwing.com/problem/content/1142/)

**é¢˜ç›®æè¿°**

>   å†œå¤«çº¦ç¿°è¢«é€‰ä¸ºä»–ä»¬é•‡çš„é•‡é•¿ï¼
>
>   ä»–å…¶ä¸­ä¸€ä¸ªç«é€‰æ‰¿è¯ºå°±æ˜¯åœ¨é•‡ä¸Šå»ºç«‹èµ·äº’è”ç½‘ï¼Œå¹¶è¿æ¥åˆ°æ‰€æœ‰çš„å†œåœºã€‚
>
>   çº¦ç¿°å·²ç»ç»™ä»–çš„å†œåœºå®‰æ’äº†ä¸€æ¡é«˜é€Ÿçš„ç½‘ç»œçº¿è·¯ï¼Œä»–æƒ³æŠŠè¿™æ¡çº¿è·¯å…±äº«ç»™å…¶ä»–å†œåœºã€‚
>
>   çº¦ç¿°çš„å†œåœºçš„ç¼–å·æ˜¯ `1`ï¼Œå…¶ä»–å†œåœºçš„ç¼–å·æ˜¯ `2 âˆ¼ n`ã€‚
>
>   ä¸ºäº†ä½¿èŠ±è´¹æœ€å°‘ï¼Œä»–å¸Œæœ›ç”¨äºè¿æ¥æ‰€æœ‰çš„å†œåœºçš„å…‰çº¤æ€»é•¿åº¦å°½å¯èƒ½çŸ­ã€‚
>
>   ä½ å°†å¾—åˆ°ä¸€ä»½å„å†œåœºä¹‹é—´è¿æ¥è·ç¦»çš„åˆ—è¡¨ï¼Œä½ å¿…é¡»æ‰¾å‡ºèƒ½è¿æ¥æ‰€æœ‰å†œåœºå¹¶ä½¿æ‰€ç”¨å…‰çº¤æœ€çŸ­çš„æ–¹æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `n`ï¼Œè¡¨ç¤ºå†œåœºä¸ªæ•°ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼Œè¾“å…¥ä¸€ä¸ªå¯¹è§’çº¿ä¸Šå…¨æ˜¯ `0` çš„å¯¹ç§°çŸ©é˜µã€‚
>   å…¶ä¸­ç¬¬ `x + 1` è¡Œ `y` åˆ—çš„æ•´æ•°è¡¨ç¤ºè¿æ¥å†œåœº `x` å’Œå†œåœº `y` æ‰€éœ€è¦çš„å…‰çº¤é•¿åº¦ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€éœ€çš„æœ€å°å…‰çº¤é•¿åº¦ã€‚

**æ•°æ®èŒƒå›´**

>   +   $3 â‰¤ n â‰¤ 100$
>   +   $æ¯ä¸¤ä¸ªå†œåœºé—´çš„è·ç¦»å‡æ˜¯éè´Ÿæ•´æ•°ä¸”ä¸è¶…è¿‡100000ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
4
0  4  9  21
4  0  8  17
9  8  0  16
21 17 16  0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
28
```

**æ‰‹å†™ç¨¿**

>   1.   è£¸çš„ `prim` ç®—æ³•

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110;
int n;
int dist[N], st[N];
int g[N][N];
int prim() {
    memset(dist, 0x3f, sizeof dist);
    memset(st, false, sizeof st);
    int res = 0;
    for (int i = 0; i < n; i ++ ) {
        int t = -1;
        for (int j = 1; j <= n; j ++ )
            if (!st[j] && (t == -1 || dist[t] > dist[j]))
                t = j;
        st[t] = true;
        if (i) res += dist[t];
        for (int j = 1; j <= n; j ++ )
            dist[j] = min(dist[j], g[t][j]);
    }
    return res;
}
int main() {
    scanf("%d", &n);
    // ä¸‹æ ‡ä»1å¼€å§‹
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= n; j ++ )
            scanf("%d", &g[i][j]);
    cout << prim() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`prim`ã€`æœ€å°ç”Ÿæˆæ ‘`

**ç¼åˆæ€ª**



### [AcWing 1141. å±€åŸŸç½‘](https://www.acwing.com/problem/content/1143/)

**é¢˜ç›®æè¿°**

>   æŸä¸ªå±€åŸŸç½‘å†…æœ‰ `n` å°è®¡ç®—æœºå’Œ `k` æ¡ **åŒå‘** ç½‘çº¿ï¼Œè®¡ç®—æœºçš„ç¼–å·æ˜¯ `1 âˆ¼ n`ã€‚ç”±äºæ­å»ºå±€åŸŸç½‘æ—¶å·¥ä½œäººå‘˜çš„ç–å¿½ï¼Œç°åœ¨å±€åŸŸç½‘å†…çš„è¿æ¥å½¢æˆäº†å›è·¯ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœå±€åŸŸç½‘å½¢æˆå›è·¯é‚£ä¹ˆæ•°æ®å°†ä¸åœçš„åœ¨å›è·¯å†…ä¼ è¾“ï¼Œé€ æˆç½‘ç»œå¡çš„ç°è±¡ã€‚
>
>   **æ³¨æ„**ï¼š
>
>   -   å¯¹äºæŸä¸€ä¸ªè¿æ¥ï¼Œè™½ç„¶å®ƒæ˜¯åŒå‘çš„ï¼Œä½†æˆ‘ä»¬ä¸å°†å…¶å½“åšå›è·¯ã€‚æœ¬é¢˜ä¸­æ‰€æè¿°çš„å›è·¯è‡³å°‘è¦åŒ…å«ä¸¤æ¡ä¸åŒçš„è¿æ¥ã€‚
>   -   ä¸¤å°è®¡ç®—æœºä¹‹é—´æœ€å¤šåªä¼šå­˜åœ¨ä¸€æ¡è¿æ¥ã€‚
>   -   ä¸å­˜åœ¨ä¸€æ¡è¿æ¥ï¼Œå®ƒæ‰€è¿æ¥çš„ä¸¤ç«¯æ˜¯åŒä¸€å°è®¡ç®—æœºã€‚
>
>   å› ä¸ºè¿æ¥è®¡ç®—æœºçš„ç½‘çº¿æœ¬èº«ä¸åŒï¼Œæ‰€ä»¥æœ‰ä¸€äº›è¿çº¿ä¸æ˜¯å¾ˆç•…é€šï¼Œæˆ‘ä»¬ç”¨ `f(i, j)` è¡¨ç¤º `i, j` ä¹‹é—´è¿æ¥çš„ç•…é€šç¨‹åº¦ï¼Œ`f(i, j)` å€¼è¶Šå°è¡¨ç¤º `i, j`ä¹‹é—´è¿æ¥è¶Šé€šç•…ã€‚
>
>   ç°åœ¨æˆ‘ä»¬éœ€è¦è§£å†³å›è·¯é—®é¢˜ï¼Œæˆ‘ä»¬å°†é™¤å»ä¸€äº›è¿çº¿ï¼Œä½¿å¾—ç½‘ç»œä¸­æ²¡æœ‰å›è·¯ä¸”ä¸å½±å“è¿é€šæ€§ï¼ˆå³å¦‚æœä¹‹å‰æŸä¸¤ä¸ªç‚¹æ˜¯è¿é€šçš„ï¼Œå»å®Œä¹‹åä¹Ÿå¿…é¡»æ˜¯è¿é€šçš„ï¼‰ï¼Œå¹¶ä¸”è¢«é™¤å»ç½‘çº¿çš„ `Î£f(i, j)` æœ€å¤§ï¼Œè¯·æ±‚å‡ºè¿™ä¸ªæœ€å¤§å€¼ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ­£æ•´æ•° `n, k`ã€‚
>
>   æ¥ä¸‹æ¥çš„ `k` è¡Œæ¯è¡Œä¸‰ä¸ªæ­£æ•´æ•° `i, j, m` è¡¨ç¤º `i, j` ä¸¤å°è®¡ç®—æœºä¹‹é—´æœ‰ç½‘çº¿è”é€šï¼Œé€šç•…ç¨‹åº¦ä¸º `m`ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºè¢«é™¤å»ç½‘çº¿çš„ `Î£f(i, j)` çš„æœ€å¤§å€¼ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 100$
>   +   $0 â‰¤ k â‰¤ 200$
>   +   $1 â‰¤ f(i, j) â‰¤ 1000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 5
1 2 8
1 3 1
1 5 3
2 4 5
3 4 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
8
```

**æ‰‹å†™ç¨¿**

![4231250](img/4231250.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 110, M = 210;
struct Edge {
    int u, v, w;
    bool operator < (const Edge &W) const {
        // æŒ‰ç…§æƒå€¼ä»å°åˆ°å¤§æ’åº
        return w < W.w;
    }
}edges[M];
int n, m;
int f[N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        edges[i] = {a, b, c};
    }
    sort(edges, edges + m);
    int res = 0;
    for (int i = 0; i < m; i ++ ) {
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        int fa = find(a); // æ‰¾åˆ°å…¶ç¥–å…ˆ
        int fb = find(b); // æ‰¾åˆ°å…¶ç¥–å…ˆ
        if (fa != fb) f[fb] = fa;
        // å½“å…¶å·²ç»å¤„äºä¸€ä¸ªè¿é€šå—ä¸­, åˆ™è¯´æ˜å¯ä»¥å°†å…¶åˆ é™¤, åŒæ—¶, ç´¯åŠ å…¶å€¼
        else res += c;
    }
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€å°ç”Ÿæˆæ ‘`ã€`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



### [AcWing 1142. ç¹å¿™çš„éƒ½å¸‚](https://www.acwing.com/problem/content/1144/)

**é¢˜ç›®æè¿°**

>   åŸå¸‚ `C` æ˜¯ä¸€ä¸ªéå¸¸ç¹å¿™çš„å¤§éƒ½å¸‚ï¼ŒåŸå¸‚ä¸­çš„é“è·¯ååˆ†çš„æ‹¥æŒ¤ï¼Œäºæ˜¯å¸‚é•¿å†³å®šå¯¹å…¶ä¸­çš„é“è·¯è¿›è¡Œæ”¹é€ ã€‚
>
>   åŸå¸‚ `C` çš„é“è·¯æ˜¯è¿™æ ·åˆ†å¸ƒçš„ï¼š
>
>   åŸå¸‚ä¸­æœ‰ `n` ä¸ªäº¤å‰è·¯å£ï¼Œç¼–å·æ˜¯ `1 âˆ¼ n`ï¼Œæœ‰äº›äº¤å‰è·¯å£ä¹‹é—´æœ‰é“è·¯ç›¸è¿ï¼Œä¸¤ä¸ªäº¤å‰è·¯å£ä¹‹é—´æœ€å¤šæœ‰ä¸€æ¡é“è·¯ç›¸è¿æ¥ã€‚
>
>   è¿™äº›é“è·¯æ˜¯ **åŒå‘** çš„ï¼Œä¸”æŠŠæ‰€æœ‰çš„äº¤å‰è·¯å£ç›´æ¥æˆ–é—´æ¥çš„è¿æ¥èµ·æ¥äº†ã€‚
>
>   æ¯æ¡é“è·¯éƒ½æœ‰ä¸€ä¸ªåˆ†å€¼ï¼Œåˆ†å€¼è¶Šå°è¡¨ç¤ºè¿™ä¸ªé“è·¯è¶Šç¹å¿™ï¼Œè¶Šéœ€è¦è¿›è¡Œæ”¹é€ ã€‚
>
>   ä½†æ˜¯å¸‚æ”¿åºœçš„èµ„é‡‘æœ‰é™ï¼Œå¸‚é•¿å¸Œæœ›è¿›è¡Œæ”¹é€ çš„é“è·¯è¶Šå°‘è¶Šå¥½ï¼Œäºæ˜¯ä»–æå‡ºä¸‹é¢çš„è¦æ±‚ï¼š
>
>   1ï¼æ”¹é€ çš„é‚£äº›é“è·¯èƒ½å¤ŸæŠŠæ‰€æœ‰çš„äº¤å‰è·¯å£ç›´æ¥æˆ–é—´æ¥çš„è¿é€šèµ·æ¥ã€‚
>
>   2ï¼åœ¨æ»¡è¶³è¦æ±‚ `1` çš„æƒ…å†µä¸‹ï¼Œæ”¹é€ çš„é“è·¯å°½é‡å°‘ã€‚
>
>   3ï¼åœ¨æ»¡è¶³è¦æ±‚ `1ã€2` çš„æƒ…å†µä¸‹ï¼Œæ”¹é€ çš„é‚£äº›é“è·¯ä¸­åˆ†å€¼æœ€å¤§å€¼å°½é‡å°ã€‚
>
>   ä½œä¸ºå¸‚è§„åˆ’å±€çš„ä½ ï¼Œåº”å½“ä½œå‡ºæœ€ä½³çš„å†³ç­–ï¼Œé€‰æ‹©å“ªäº›é“è·¯åº”å½“è¢«ä¿®å»ºã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° `n, m` è¡¨ç¤ºåŸå¸‚æœ‰ `n` ä¸ªäº¤å‰è·¯å£ï¼Œ`m` æ¡é“è·¯ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œæ˜¯å¯¹æ¯æ¡é“è·¯çš„æè¿°ï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `u, v, c` è¡¨ç¤ºäº¤å‰è·¯å£ `u` å’Œ `v` ä¹‹é—´æœ‰é“è·¯ç›¸è¿ï¼Œåˆ†å€¼ä¸º `c`ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸¤ä¸ªæ•´æ•° `s, max`ï¼Œè¡¨ç¤ºä½ é€‰å‡ºäº†å‡ æ¡é“è·¯ï¼Œåˆ†å€¼æœ€å¤§çš„é‚£æ¡é“è·¯çš„åˆ†å€¼æ˜¯å¤šå°‘ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 300,$
>   +   $1 â‰¤ m â‰¤ 8000,$
>   +   $1 â‰¤ c â‰¤ 10000$

**è¾“å…¥æ ·ä¾‹**

```c++
4 5
1 2 3
1 4 5
2 4 7
2 3 6
3 4 8
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3 6
```

**æ‰‹å†™ç¨¿**

![4231351](img/4231351.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 310, M = 8010;
struct Edge {
    int u, v, w;
    bool operator < (const Edge &W) const {
        // æŒ‰ç…§æƒå€¼ä»å°åˆ°å¤§è¿›è¡Œæ’åº
        return w < W.w;
    }
}edges[M];
int n, m;
int f[N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        edges[i] = {a, b, c};
    }
    sort(edges, edges + m);
    int Max = 0;
    for (int i = 0; i < m; i ++ ) {
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        int fa = find(a);
        int fb = find(b);
        if (fa != fb) {
            f[fb] = fa;
            Max = c;
        }
    }
    cout << n - 1 << " " << Max << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**



**ç¼åˆæ€ª**



### [AcWing 1143. è”ç»œå‘˜](https://www.acwing.com/problem/content/1145/)

**é¢˜ç›®æè¿°**

>   `Tyvj` å·²ç»ä¸€å²äº†ï¼Œç½‘ç«™ä¹Ÿç”±æœ€åˆçš„å‡ ä¸ªç”¨æˆ·å¢åŠ åˆ°äº†ä¸Šä¸‡ä¸ªç”¨æˆ·ï¼Œéšç€ `Tyvj` ç½‘ç«™çš„é€æ­¥å£®å¤§ï¼Œç®¡ç†å‘˜çš„æ•°ç›®ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œç°åœ¨ä½ èº«ä¸º `Tyvj` ç®¡ç†å±‚çš„è”ç»œå‘˜ï¼Œå¸Œæœ›ä½ æ‰¾åˆ°ä¸€äº›é€šä¿¡æ¸ é“ï¼Œä½¿å¾—ç®¡ç†å‘˜ä¸¤ä¸¤éƒ½å¯ä»¥è”ç»œï¼ˆç›´æ¥æˆ–è€…æ˜¯é—´æ¥éƒ½å¯ä»¥ï¼‰ã€‚æœ¬é¢˜ä¸­æ‰€æ¶‰åŠçš„é€šä¿¡æ¸ é“éƒ½æ˜¯ **åŒå‘** çš„ã€‚
>
>   `Tyvj` æ˜¯ä¸€ä¸ªå…¬ç›Šæ€§çš„ç½‘ç«™ï¼Œæ²¡æœ‰è¿‡å¤šçš„åˆ©æ¶¦ï¼Œæ‰€ä»¥ä½ è¦å°½å¯èƒ½çš„ä½¿è´¹ç”¨å°‘æ‰å¯ä»¥ã€‚
>
>   ç›®å‰ä½ å·²ç»çŸ¥é“ï¼Œ`Tyvj` çš„é€šä¿¡æ¸ é“åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œä¸€ç±»æ˜¯å¿…é€‰é€šä¿¡æ¸ é“ï¼Œæ— è®ºä»·æ ¼å¤šå°‘ï¼Œä½ éƒ½éœ€è¦æŠŠæ‰€æœ‰çš„éƒ½é€‰æ‹©ä¸Šï¼›è¿˜æœ‰ä¸€ç±»æ˜¯é€‰æ‹©æ€§çš„é€šä¿¡æ¸ é“ï¼Œä½ å¯ä»¥ä»ä¸­æŒ‘é€‰ä¸€äº›ä½œä¸ºæœ€ç»ˆç®¡ç†å‘˜è”ç»œçš„é€šä¿¡æ¸ é“ã€‚
>
>   æ•°æ®ä¿è¯ç»™å‡ºçš„é€šä¿¡æ¸ é“å¯ä»¥è®©æ‰€æœ‰çš„ç®¡ç†å‘˜è”é€šã€‚
>
>   **æ³¨æ„ï¼š** å¯¹äºæŸä¸¤ä¸ªç®¡ç†å‘˜ `u, v`ï¼Œä»–ä»¬ä¹‹é—´å¯èƒ½å­˜åœ¨å¤šæ¡é€šä¿¡æ¸ é“ï¼Œä½ çš„ç¨‹åºåº”è¯¥ç´¯åŠ æ‰€æœ‰ `u, v` ä¹‹é—´çš„å¿…é€‰é€šè¡Œæ¸ é“ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `nï¼Œm` è¡¨ç¤º `Tyvj` ä¸€å…±æœ‰ `n` ä¸ªç®¡ç†å‘˜ï¼Œæœ‰ `m` ä¸ªé€šä¿¡æ¸ é“;
>
>   ç¬¬äºŒè¡Œåˆ° `m + 1` è¡Œï¼Œæ¯è¡Œå››ä¸ªéè´Ÿæ•´æ•°ï¼Œ`p, u, v, w` å½“ `p = 1` æ—¶ï¼Œè¡¨ç¤ºè¿™ä¸ªé€šä¿¡æ¸ é“ä¸ºå¿…é€‰é€šä¿¡æ¸ é“ï¼›å½“ `p = 2` æ—¶ï¼Œè¡¨ç¤ºè¿™ä¸ªé€šä¿¡æ¸ é“ä¸ºé€‰æ‹©æ€§é€šä¿¡æ¸ é“ï¼›`u, v, w` è¡¨ç¤ºæœ¬æ¡ä¿¡æ¯æè¿°çš„æ˜¯ `uï¼Œv` ç®¡ç†å‘˜ä¹‹é—´çš„é€šä¿¡æ¸ é“ï¼Œ`u` å¯ä»¥æ”¶åˆ° `v` çš„ä¿¡æ¯ï¼Œ`v` ä¹Ÿå¯ä»¥æ”¶åˆ° `u` çš„ä¿¡æ¯ï¼Œ`w` è¡¨ç¤ºè´¹ç”¨ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°çš„é€šä¿¡è´¹ç”¨ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 2000$
>   +   $1 â‰¤ m â‰¤ 10000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 6
1 1 2 1
1 2 3 1
1 3 4 1
1 4 1 1
2 2 5 10
2 2 5 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
9
```

**æ‰‹å†™ç¨¿**

![4240954](img/4240954.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 2010, M = 10010;
struct Edge {
    int u, v, w;
    bool operator < (const Edge &W) const {
        return w < W.w;
    }
}edges[M];
int n, m;
int f[N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    int res = 0, cnt = 0;
    for (int i = 0; i < m; i ++ ) {
        int p, a, b, c;
        scanf("%d%d%d%d", &p, &a, &b, &c);
        // åªè¦æ˜¯å¿…é€‰é€šé“, åˆ™å¿…é¡»åŠ ä¸Š, ä¸ç®¡ä¹‹å‰æ˜¯å¦å¤„äºåŒä¸€ä¸ªè¿é€šå—å†…
        if (p == 1) {
            int fa = find(a);
            int fb = find(b);
            f[fb] = fa;
            res += c;
        }
        else edges[cnt ++ ] = {a, b, c};
    }
    sort(edges, edges + cnt);
    for (int i = 0; i < cnt; i ++ ) {
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        int fa = find(a);
        int fb = find(b);
        // å¯é€‰é€šé“, å¦‚æœå·²ç»å¤„äºåŒä¸€ä¸ªè¿é€šå—å†…, åˆ™ä¸éœ€è¦åœ¨ç´¯åŠ æƒå€¼
        if (fa == fb) continue;
        f[fb] = fa;
        res += c;
    }
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`Kruskal`ã€`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



### [AcWing 1144. è¿æ¥æ ¼ç‚¹](https://www.acwing.com/problem/content/1146/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸€ä¸ª `m` è¡Œ `n` åˆ—çš„ç‚¹é˜µï¼Œç›¸é‚»ä¸¤ç‚¹å¯ä»¥ç›¸è¿ã€‚
>
>   ä¸€æ¡çºµå‘çš„è¿çº¿èŠ±è´¹ä¸€ä¸ªå•ä½ï¼Œä¸€æ¡æ¨ªå‘çš„è¿çº¿èŠ±è´¹ä¸¤ä¸ªå•ä½ã€‚
>
>   æŸäº›ç‚¹ä¹‹é—´å·²ç»æœ‰è¿çº¿äº†ï¼Œè¯•é—®è‡³å°‘è¿˜éœ€è¦èŠ±è´¹å¤šå°‘ä¸ªå•ä½æ‰èƒ½ä½¿æ‰€æœ‰çš„ç‚¹å…¨éƒ¨è¿é€šã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•° `m` å’Œ `n`ã€‚
>
>   ä»¥ä¸‹è‹¥å¹²è¡Œæ¯è¡Œå››ä¸ªæ­£æ•´æ•° $x_1,y_1,x_2,y_2$ï¼Œè¡¨ç¤ºç¬¬ $x_1$ è¡Œç¬¬ $y_1$ åˆ—çš„ç‚¹å’Œç¬¬ $x_2$ è¡Œç¬¬ $y_2$ åˆ—çš„ç‚¹å·²ç»æœ‰è¿çº¿ã€‚
>
>   è¾“å…¥ä¿è¯$|x_1 âˆ’ x_2| + |y_1 âˆ’ y_2| = 1$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä½¿å¾—è¿é€šæ‰€æœ‰ç‚¹è¿˜éœ€è¦çš„æœ€å°èŠ±è´¹ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ m, n â‰¤ 1000$
>   +   $0 â‰¤ å·²ç»å­˜åœ¨çš„è¿çº¿æ•° â‰¤ 10000$

**è¾“å…¥æ ·ä¾‹**

```c++
2 2
1 1 2 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![4241408](img/4241408.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 1010, M = N * N, K = 2 * N * N;
struct Edge {
    int u, v, w;
}edges[K];
int n, m, k;
int f[M];
int g[N][N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
void get_edges() {
    int dx[4] = {-1, 0, 1, 0};
    int dy[4] = {0, 1, 0, -1};
    // å››ä¸ªæ–¹å‘ä¸Šçš„æƒå€¼
    int dw[4] = {1, 2, 1, 2};
    // éå†ä¸¤ç§æƒ…å†µ, ä¸€ç§æ˜¯æ¨ªå‘, å¦ä¸€ç§æ˜¯çºµå‘
    for (int z = 0; z < 2; z ++ )
        for (int x = 1; x <= n; x ++ )
            for (int y = 1; y <= m; y ++ )
                for (int u = 0; u < 4; u ++ ) {
                    int tx = x + dx[u];
                    int ty = y + dy[u];
                    // è¶Šç•Œ, åˆ™è¿”å›å³å¯
                    if (tx <= 0 || tx > n || ty <= 0 || ty > m) continue;
                    // è·å–äºŒç»´åæ ‡å¯¹åº”çš„ä¸€ç»´åæ ‡
                    int a = g[x][y];
                    int b = g[tx][ty];
                    // å¦‚æœ 3 -> 5 æœ‰æ¡è¾¹ç›¸è¿æ¥, åˆ™ 5 -> 3 ä¸éœ€è¦å†è¿›è¡Œè¿è¾¹
                    // å¦‚æœéè¦è¿›è¡Œè¿è¾¹, åˆ™è®°å¾—Kéœ€è¦å†å¤§æ‰“ä¸€å€, 4 * N * N
                    if (a > b) continue;
                    // å¦‚æœå½“å‰çš„æƒ…å†µç­‰äºz, z = 0 ä»£è¡¨æ¨ªå‘, 1 ä»£è¡¨çºµå‘
                    if (u % 2 == z) edges[k ++ ] = {a, b, dw[z]};
                }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n * m; i ++ ) f[i] = i;
    for (int i = 1, t = 0; i <= n; i ++ )
        for (int j = 1; j <= m; j ++ )
            g[i][j] = ++ t;
    int x1, y1, x2, y2;
    while (~scanf("%d%d%d%d", &x1, &y1, &x2, &y2)) {
        int a = g[x1][y1];
        int b = g[x2][y2];
        int fa = find(a);
        int fb = find(b);
        if (fa == fb) continue;
        f[fb] = fa;
    }
    get_edges();
    int res = 0;
    for (int i = 0; i < k; i ++ ) {
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        int fa = find(a);
        int fb = find(b);
        if (fa == fb) continue;
        f[fb] = fa;
        res += c;
    }
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n ^ 2)$

**æ ‡ç­¾**

`æœ€å°ç”Ÿæˆæ ‘`ã€`Kruskal`ã€`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



## æœ€å°ç”Ÿæˆæ ‘çš„æ‰©å±•åº”ç”¨

### [AcWing 1146. æ–°çš„å¼€å§‹](https://www.acwing.com/problem/content/1148/)

**é¢˜ç›®æè¿°**

>   å‘å±•é‡‡çŸ¿ä¸šå½“ç„¶é¦–å…ˆå¾—æœ‰çŸ¿äº•ï¼Œå° `F` èŠ±äº†ä¸Šæ¬¡æ¢é™©è·å¾—çš„åƒåˆ†ä¹‹ä¸€çš„è´¢å¯Œè¯·äººåœ¨å²›ä¸ŠæŒ–äº† `n` å£çŸ¿äº•ï¼Œä½†ä»–ä¼¼ä¹å¿˜è®°äº†è€ƒè™‘çŸ¿äº•ä¾›ç”µé—®é¢˜ã€‚
>
>   ä¸ºäº†ä¿è¯ç”µåŠ›çš„ä¾›åº”ï¼Œå° `F` æƒ³åˆ°äº†ä¸¤ç§åŠæ³•ï¼š
>
>   1.  åœ¨çŸ¿äº• `i` ä¸Šå»ºç«‹ä¸€ä¸ªå‘ç”µç«™ï¼Œè´¹ç”¨ä¸º $v_i$ï¼ˆå‘ç”µç«™çš„è¾“å‡ºåŠŸç‡å¯ä»¥ä¾›ç»™ä»»æ„å¤šä¸ªçŸ¿äº•ï¼‰ã€‚
>   2.  å°†è¿™å£çŸ¿äº• `i` ä¸å¦å¤–çš„å·²ç»æœ‰ç”µåŠ›ä¾›åº”çš„çŸ¿äº• `j` ä¹‹é—´å»ºç«‹ç”µç½‘ï¼Œè´¹ç”¨ä¸º $p_{i,j}$ã€‚
>
>   å° `F` å¸Œæœ›ä½ å¸®ä»–æƒ³å‡ºä¸€ä¸ªä¿è¯æ‰€æœ‰çŸ¿äº•ç”µåŠ›ä¾›åº”çš„æœ€å°èŠ±è´¹æ–¹æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `n`ï¼Œè¡¨ç¤ºçŸ¿äº•æ€»æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œç¬¬ `i` ä¸ªæ•° $v_i$ è¡¨ç¤ºåœ¨ç¬¬ `i` å£çŸ¿äº•ä¸Šå»ºç«‹å‘ç”µç«™çš„è´¹ç”¨ã€‚
>
>   æ¥ä¸‹æ¥ä¸ºä¸€ä¸ª `n Ã— n` çš„çŸ©é˜µ `P`ï¼Œå…¶ä¸­ $p_{i,j}$ è¡¨ç¤ºåœ¨ç¬¬ `i` å£çŸ¿äº•å’Œç¬¬ `j` å£çŸ¿äº•ä¹‹é—´å»ºç«‹ç”µç½‘çš„è´¹ç”¨ã€‚
>
>   æ•°æ®ä¿è¯ $p_{i,j} = p_{j,i}$ï¼Œä¸” $p_{i,i} = 0$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè®©æ‰€æœ‰çŸ¿äº•è·å¾—å……è¶³ç”µèƒ½çš„æœ€å°èŠ±è´¹ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 300,$
>   +   $0 â‰¤ v_i, p_{i, j} â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
4
5
4
4
3
0 2 2 2
2 0 3 3
2 3 0 4
2 3 4 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
9
```

**æ‰‹å†™ç¨¿**

![4250928](img/4250928.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 310;
int n;
int dist[N], st[N];
int g[N][N];
// primæ¨¡æ¿
int prim() {
    memset(dist, 0x3f, sizeof dist);
    memset(st, false, sizeof st);
    int res = 0;
    // æ³¨æ„æœ‰ n + 1 ä¸ªç‚¹, èŒƒå›´0 ~ n
    for (int i = 0; i < n + 1; i ++ ) {
        int t = -1;
        for (int j = 0; j <= n; j ++ )
            if (!st[j] && (t == -1 || dist[t] > dist[j]))
                t = j;
        st[t] = true;
        if (t) res += dist[t];
        for (int j = 0; j <= n; j ++ ) {
            if (st[j]) continue;
            dist[j] = min(dist[j], g[t][j]);
        }
    }
    return res;
}
int main() {
    scanf("%d", &n);
    // å°†æ‰€æœ‰èƒ½å¤Ÿè‡ªå·±å‘ç”µçš„çŸ¿äº•å’Œè™šæ‹Ÿæºç‚¹è¿ä¸€æ¡è¾¹å³å¯
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d", &g[0][i]);
        g[i][0] = g[0][i];
    }
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= n; j ++ ) {
            scanf("%d", &g[i][j]);
            g[j][i] = g[i][j];
        }
    cout << prim() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`è™šæ‹Ÿæºç‚¹`ã€`Prim`ã€`æœ€å°ç”Ÿæˆæ ‘`

**ç¼åˆæ€ª**



### [AcWing 1145. åŒ—æé€šè®¯ç½‘ç»œ](https://www.acwing.com/problem/content/1147/)

**é¢˜ç›®æè¿°**

>   åŒ—æçš„æŸåŒºåŸŸå…±æœ‰ `n` åº§æ‘åº„ï¼Œæ¯åº§æ‘åº„çš„åæ ‡ç”¨ä¸€å¯¹æ•´æ•° `(x, y)` è¡¨ç¤ºã€‚
>
>   ä¸ºäº†åŠ å¼ºè”ç³»ï¼Œå†³å®šåœ¨æ‘åº„ä¹‹é—´å»ºç«‹é€šè®¯ç½‘ç»œï¼Œä½¿æ¯ä¸¤åº§æ‘åº„ä¹‹é—´éƒ½å¯ä»¥ç›´æ¥æˆ–é—´æ¥é€šè®¯ã€‚
>
>   é€šè®¯å·¥å…·å¯ä»¥æ˜¯æ— çº¿ç”µæ”¶å‘æœºï¼Œä¹Ÿå¯ä»¥æ˜¯å«æ˜Ÿè®¾å¤‡ã€‚
>
>   æ— çº¿ç”µæ”¶å‘æœºæœ‰å¤šç§ä¸åŒå‹å·ï¼Œä¸åŒå‹å·çš„æ— çº¿ç”µæ”¶å‘æœºæœ‰ä¸€ä¸ªä¸åŒçš„å‚æ•° `d`ï¼Œä¸¤åº§æ‘åº„ä¹‹é—´çš„è·ç¦»å¦‚æœä¸è¶…è¿‡ `d`ï¼Œå°±å¯ä»¥ç”¨è¯¥å‹å·çš„æ— çº¿ç”µæ”¶å‘æœºç›´æ¥é€šè®¯ï¼Œ`d` å€¼è¶Šå¤§çš„å‹å·ä»·æ ¼è¶Šè´µã€‚ç°åœ¨è¦å…ˆé€‰æ‹©æŸä¸€ç§å‹å·çš„æ— çº¿ç”µæ”¶å‘æœºï¼Œç„¶åç»Ÿä¸€ç»™æ‰€æœ‰æ‘åº„é…å¤‡ï¼Œ**æ•°é‡ä¸é™**ï¼Œä½†å‹å·éƒ½æ˜¯ **ç›¸åŒçš„**ã€‚
>
>   é…å¤‡å«æ˜Ÿè®¾å¤‡çš„ä¸¤åº§æ‘åº„æ— è®ºç›¸è·å¤šè¿œéƒ½å¯ä»¥ç›´æ¥é€šè®¯ï¼Œä½†å«æ˜Ÿè®¾å¤‡æ˜¯ **æœ‰é™çš„**ï¼Œåªèƒ½ç»™ä¸€éƒ¨åˆ†æ‘åº„é…å¤‡ã€‚
>
>   ç°åœ¨æœ‰ `k` å°å«æ˜Ÿè®¾å¤‡ï¼Œè¯·ä½ ç¼–ä¸€ä¸ªç¨‹åºï¼Œè®¡ç®—å‡ºåº”è¯¥å¦‚ä½•åˆ†é…è¿™ `k` å°å«æ˜Ÿè®¾å¤‡ï¼Œæ‰èƒ½ä½¿æ‰€é…å¤‡çš„æ— çº¿ç”µæ”¶å‘æœºçš„ `d` å€¼æœ€å°ã€‚
>
>   ä¾‹å¦‚ï¼Œå¯¹äºä¸‹é¢ä¸‰åº§æ‘åº„ï¼š
>
>   ![1.png](img/19_61a45e3c01-1.png)
>
>   å…¶ä¸­ï¼Œ$|AB| = 10, |BC| = 20, |AC| = 10\sqrt{5} â‰ˆ 22.36$ã€‚
>
>   å¦‚æœæ²¡æœ‰ä»»ä½•å«æ˜Ÿè®¾å¤‡æˆ–åªæœ‰ `1` å°å«æ˜Ÿè®¾å¤‡ (`k = 0` æˆ– `k = 1`)ï¼Œåˆ™æ»¡è¶³æ¡ä»¶çš„æœ€å°çš„ `d = 20`ï¼Œå› ä¸º `A` å’Œ `B`ï¼Œ`B` å’Œ `C` å¯ä»¥ç”¨æ— çº¿ç”µç›´æ¥é€šè®¯ï¼›è€Œ `A` å’Œ `C` å¯ä»¥ç”¨ `B` ä¸­è½¬å®ç°é—´æ¥é€šè®¯ (å³æ¶ˆæ¯ä» `A` ä¼ åˆ° `B`ï¼Œå†ä» `B` ä¼ åˆ° `C`)ï¼›
>
>   å¦‚æœæœ‰ `2` å°å«æ˜Ÿè®¾å¤‡ (`k = 2`)ï¼Œåˆ™å¯ä»¥æŠŠè¿™ä¸¤å°è®¾å¤‡åˆ†åˆ«åˆ†é…ç»™ `B` å’Œ `C` ï¼Œè¿™æ ·æœ€å°çš„ `d` å¯å– `10`ï¼Œå› ä¸º `A` å’Œ `B` ä¹‹é—´å¯ä»¥ç”¨æ— çº¿ç”µç›´æ¥é€šè®¯ï¼›`B` å’Œ `C` ä¹‹é—´å¯ä»¥ç”¨å«æ˜Ÿç›´æ¥é€šè®¯ï¼›`A` å’Œ `C` å¯ä»¥ç”¨ `B` ä¸­è½¬å®ç°é—´æ¥é€šè®¯ã€‚
>
>   å¦‚æœæœ‰ `3` å°å«æ˜Ÿè®¾å¤‡ï¼Œåˆ™ `A,B,C` ä¸¤ä¸¤ä¹‹é—´éƒ½å¯ä»¥ç›´æ¥ç”¨å«æ˜Ÿé€šè®¯ï¼Œæœ€å°çš„ `d` å¯å– `0`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸ºç”±ç©ºæ ¼éš”å¼€çš„ä¸¤ä¸ªæ•´æ•° `n, k`;
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œç¬¬ `i` è¡Œçš„ $x_i, y_i$ è¡¨ç¤ºç¬¬ `i` åº§æ‘åº„çš„åæ ‡ $(x_i, y_i)$ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªå®æ•°ï¼Œè¡¨ç¤ºæœ€å°çš„ `d` å€¼ï¼Œç»“æœä¿ç•™ `2` ä½å°æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 500,$
>   +   $0 â‰¤ x, y â‰¤ 10^4,$
>   +   $0 â‰¤ k â‰¤ 100$

**è¾“å…¥æ ·ä¾‹**

```c++
3 2
10 10
10 0
30 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
10.00
```

**æ‰‹å†™ç¨¿**

![4251129](img/4251129.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
#include <cmath>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 510, M = N * N / 2;
struct Edge {
    int u, v;
    // è·ç¦»æ˜¯ double ç±»å‹
    double w;
    bool operator < (const Edge& W) const {
        return w < W.w;
    }
}edges[M];
int n, m, k;
int f[N];
PII g[N];
double get_dist(PII a, PII b) {
    int dx = a.x - b.x;
    int dy = a.y - b.y;
    return sqrt(dx * dx + dy * dy);
}
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d", &n, &k);
    for (int i = 0; i < n; i ++ ) f[i] = i;
    for (int i = 0; i < n; i ++ )
        scanf("%d%d", &g[i].x, &g[i].y);
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < i; j ++ )
            edges[m ++ ] = {i, j, get_dist(g[i], g[j])};
    sort(edges, edges + m);
    // ä¸€å¼€å§‹æ‰€æœ‰ç‚¹å„è‡ªä¸ºæ”¿, æ•…, è¿é€šå—çš„æ•°é‡ä¸ºn
    int cnt = n;
    double res = 0;
    for (int i = 0; i < m; i ++ ) {
        if (cnt <= k) break;
        int a = edges[i].u;
        int b = edges[i].v;
        double c = edges[i].w;
        int fa = find(a);
        int fb = find(b);
        if (fa == fb) continue;
        // æ¯æ¬¡åŠ å…¥ä¸€æ¡è¾¹, è¯´æ˜è¿é€šå—çš„æ•°é‡ --
        f[fb] = fa;
        cnt --;
        res = c;
    }
    printf("%.2lf\n", res);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æœ€å°ç”Ÿæˆæ ‘`ã€`Kruskal`

**ç¼åˆæ€ª**



### [AcWing 346. èµ°å»Šæ³¼æ°´èŠ‚](https://www.acwing.com/problem/content/348/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€æ£µ `N` ä¸ªèŠ‚ç‚¹çš„æ ‘ï¼Œè¦æ±‚å¢åŠ è‹¥å¹²æ¡è¾¹ï¼ŒæŠŠè¿™æ£µæ ‘æ‰©å……ä¸ºå®Œå…¨å›¾ï¼Œå¹¶æ»¡è¶³å›¾çš„å”¯ä¸€æœ€å°ç”Ÿæˆæ ‘ä»ç„¶æ˜¯è¿™æ£µæ ‘ã€‚
>
>   æ±‚å¢åŠ çš„è¾¹çš„æƒå€¼æ€»å’Œæœ€å°æ˜¯å¤šå°‘ã€‚
>
>   **æ³¨æ„ï¼š** æ ‘ä¸­çš„æ‰€æœ‰è¾¹æƒå‡ä¸ºæ•´æ•°ï¼Œä¸”æ–°åŠ çš„æ‰€æœ‰è¾¹æƒä¹Ÿå¿…é¡»ä¸ºæ•´æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `t`ï¼Œè¡¨ç¤ºå…±æœ‰ `t` ç»„æµ‹è¯•æ•°æ®ã€‚
>
>   å¯¹äºæ¯ç»„æµ‹è¯•æ•°æ®ï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `N`ã€‚
>
>   æ¥ä¸‹æ¥ `N âˆ’ 1` è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•° `X, Y, Z`ï¼Œè¡¨ç¤º `X` èŠ‚ç‚¹ä¸ `Y` èŠ‚ç‚¹ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ï¼Œé•¿åº¦ä¸º `Z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæƒå€¼æ€»å’Œæœ€å°å€¼ã€‚
>
>   æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 6000$
>   +   $1 â‰¤ Z â‰¤ 100$

**è¾“å…¥æ ·ä¾‹**

```c++
2
3
1 2 2
1 3 3
4
1 2 3
2 3 4
3 4 5 
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
17 
```

**æ‰‹å†™ç¨¿**

![4271312](img/4271312.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 6010;
struct Edge {
    int u, v, w;
    bool operator < (const Edge &W) const {
        return w < W.w;
    }
}edges[N];
int n, T;
int f[N], cnt[N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        scanf("%d", &n);
        for (int i = 1; i <= n; i ++ ) f[i] = i, cnt[i] = 1;
        for (int i = 0; i < n - 1; i ++ ) {
            int a, b, c;
            scanf("%d%d%d", &a, &b, &c);
            edges[i] = {a, b, c};
        }
        sort(edges, edges + n - 1);
        int res = 0;
        for (int i = 0; i < n - 1; i ++ ) {
            int a = edges[i].u;
            int b = edges[i].v;
            int c = edges[i].w;
            int fa = find(a);
            int fb = find(b);
            if (fa == fb) continue;
            // å®Œå…¨å›¾è¾¹æ•°
            res += (cnt[fa] * cnt[fb] - 1) * (c + 1);
            f[fb] = fa;
            // ç»Ÿè®¡ä¸ªæ•°
            cnt[fa] += cnt[fb];
        }
        cout << res << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æœ€å°ç”Ÿæˆæ ‘`

**ç¼åˆæ€ª**



### [AcWing 1148. ç§˜å¯†çš„ç‰›å¥¶è¿è¾“](https://www.acwing.com/problem/content/1150/)

**é¢˜ç›®æè¿°**

>   å†œå¤«çº¦ç¿°è¦æŠŠä»–çš„ç‰›å¥¶è¿è¾“åˆ°å„ä¸ªé”€å”®ç‚¹ã€‚
>
>   è¿è¾“è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å…ˆæŠŠç‰›å¥¶è¿è¾“åˆ°ä¸€äº›é”€å”®ç‚¹ï¼Œå†ç”±è¿™äº›é”€å”®ç‚¹åˆ†åˆ«è¿è¾“åˆ°å…¶ä»–é”€å”®ç‚¹ã€‚
>
>   è¿è¾“çš„æ€»è·ç¦»è¶Šå°ï¼Œè¿è¾“çš„æˆæœ¬ä¹Ÿå°±è¶Šä½ã€‚
>
>   ä½æˆæœ¬çš„è¿è¾“æ˜¯å†œå¤«çº¦ç¿°æ‰€å¸Œæœ›çš„ã€‚
>
>   ä¸è¿‡ï¼Œä»–å¹¶ä¸æƒ³è®©ä»–çš„ç«äº‰å¯¹æ‰‹çŸ¥é“ä»–å…·ä½“çš„è¿è¾“æ–¹æ¡ˆï¼Œæ‰€ä»¥ä»–å¸Œæœ›é‡‡ç”¨è´¹ç”¨ç¬¬äºŒå°çš„è¿è¾“æ–¹æ¡ˆè€Œä¸æ˜¯æœ€å°çš„ã€‚
>
>   ç°åœ¨è¯·ä½ å¸®å¿™æ‰¾åˆ°è¯¥è¿è¾“æ–¹æ¡ˆã€‚
>
>   **æ³¨æ„ï¼š**
>
>   -   å¦‚æœä¸¤ä¸ªæ–¹æ¡ˆè‡³å°‘æœ‰ä¸€æ¡è¾¹ä¸åŒï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºæ˜¯ä¸åŒæ–¹æ¡ˆï¼›
>   -   è´¹ç”¨ç¬¬äºŒå°çš„æ–¹æ¡ˆåœ¨æ•°å€¼ä¸Šä¸€å®šè¦ä¸¥æ ¼å¤§äºè´¹ç”¨æœ€å°çš„æ–¹æ¡ˆï¼›
>   -   ç­”æ¡ˆä¿è¯ä¸€å®šæœ‰è§£ï¼›

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•° `N, M`ï¼Œè¡¨ç¤ºé”€å”®ç‚¹æ•°å’Œäº¤é€šçº¿è·¯æ•°ï¼›
>
>   æ¥ä¸‹æ¥ `M` è¡Œæ¯è¡Œ `3` ä¸ªæ•´æ•° `x, y, z`ï¼Œè¡¨ç¤ºé”€å”®ç‚¹ `x` å’Œé”€å”®ç‚¹ `y` ä¹‹é—´å­˜åœ¨çº¿è·¯ï¼Œé•¿åº¦ä¸º `z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºè´¹ç”¨ç¬¬äºŒå°çš„è¿è¾“æ–¹æ¡ˆçš„è¿è¾“æ€»è·ç¦»ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 500,$
>   +   $1 â‰¤ M â‰¤ 10^4,$
>   +   $1 â‰¤ z â‰¤ 10^9,$
>   +   $æ•°æ®ä¸­å¯èƒ½åŒ…å«é‡è¾¹ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
4 4
1 2 100
2 4 200
2 3 250
3 4 100
```

**è¾“å‡ºæ ·ä¾‹**

```c++
450
```

**æ‰‹å†™ç¨¿**

![4281408](img/4281408.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
typedef long long LL;
const int N = 510, M = 10010, K = N * 2;
struct Edge {
    int u, v, w;
    bool flag;
    bool operator < (const Edge &W) const {
        return w < W.w;
    }
}edges[M];
int n, m, idx;
int f[N], h[N], e[K], w[K], ne[K];
int dist1[N][N], dist2[N][N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u, int father, int Max1, int Max2, int dist1[], int dist2[]) {
    dist1[u] = Max1, dist2[u] = Max2;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (j == father) continue;
        // å¿…é¡»æ–°å¼€å˜é‡è¿›è¡Œè®°å½•, åŸå› : [æ‰‹å†™ç¨¿]
        int tMax1 = Max1, tMax2 = Max2;
        if (w[i] > tMax1) {
            tMax2 = tMax1;
            tMax1 = w[i];
        }
        // æœ€å¤§å€¼å¿…é¡»è¦ä¸¥æ ¼å¤§äºæ¬¡å¤§å€¼, å› æ­¤, è¿™é‡Œå¿…é¡»åˆ¤æ–­w[i] < tMax1
        // ä¸åŠ åˆ¤æ–­çš„è¯, åˆ™æœ‰å¯èƒ½ä¼šå‡ºç° w[i] == tMax1çš„æƒ…å†µ
        else if (w[i] < tMax1 && w[i] > tMax2) tMax2 = w[i];
        dfs(j, u, tMax1, tMax2, dist1, dist2);
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        edges[i] = {a, b, c};
    }
    sort(edges, edges + m);
    // long long ç±»å‹
    LL sum = 0;
    for (int i = 0; i < m; i ++ ) {
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        int fa = find(a);
        int fb = find(b);
        if (fa == fb) continue;
        f[fb] = fa;
        edges[i].flag = true;
        sum += c;
        // ç»™æœ€å°ç”Ÿæˆæ ‘åŠ è¾¹
        add(a, b, c);
        add(b, a, c);
    }
    for (int i = 1; i <= n; i ++ ) dfs(i, -1, 0, 0, dist1[i], dist2[i]);
    // long long ç±»å‹
    LL res = 1e18;
    for (int i = 0; i < m; i ++ ) {
        // å¦‚æœæ˜¯æ ‘è¾¹, åˆ™è·³è¿‡æ­¤æ¬¡å¾ªç¯
        if (edges[i].flag) continue;
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        // æœ€çŸ­è·¯å¾„
        if (c > dist1[a][b]) res = min(res, sum - dist1[a][b] + c);
        // æ¬¡çŸ­è·¯å¾„
        else if (c > dist2[a][b]) res = min(res, sum - dist2[a][b] + c);
    }
    printf("%lld\n", res);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_m)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æ¬¡å°ç”Ÿæˆæ ‘`

**ç¼åˆæ€ª**



## è´Ÿç¯

### æ¦‚è¿°

![4290951](img/4290951.png)

### [AcWing 904. è™«æ´](https://www.acwing.com/problem/content/906/)

**é¢˜ç›®æè¿°**

>   å†œå¤«çº¦ç¿°åœ¨å·¡è§†ä»–çš„ä¼—å¤šå†œåœºæ—¶ï¼Œå‘ç°äº†å¾ˆå¤šä»¤äººæƒŠå¹çš„è™«æ´ã€‚
>
>   è™«æ´éå¸¸å¥‡ç‰¹ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ¡ **å•å‘** è·¯å¾„ï¼Œé€šè¿‡å®ƒå¯ä»¥ä½¿ä½ å›åˆ°è¿‡å»çš„æŸä¸ªæ—¶åˆ»ï¼ˆç›¸å¯¹äºä½ è¿›å…¥è™«æ´ä¹‹å‰ï¼‰ã€‚
>
>   å†œå¤«çº¦ç¿°çš„æ¯ä¸ªå†œåœºä¸­åŒ…å« `N` ç‰‡ç”°åœ°ï¼Œ`M` æ¡è·¯å¾„ï¼ˆ**åŒå‘**ï¼‰ä»¥åŠ `W` ä¸ªè™«æ´ã€‚
>
>   ç°åœ¨å†œå¤«çº¦ç¿°å¸Œæœ›èƒ½å¤Ÿä»å†œåœºä¸­çš„æŸç‰‡ç”°åœ°å‡ºå‘ï¼Œç»è¿‡ä¸€äº›è·¯å¾„å’Œè™«æ´å›åˆ°è¿‡å»ï¼Œå¹¶åœ¨ä»–çš„å‡ºå‘æ—¶åˆ»ä¹‹å‰èµ¶åˆ°ä»–çš„å‡ºå‘åœ°ã€‚
>
>   ä»–å¸Œæœ›èƒ½å¤Ÿçœ‹åˆ°å‡ºå‘ä¹‹å‰çš„è‡ªå·±ã€‚
>
>   è¯·ä½ åˆ¤æ–­ä¸€ä¸‹çº¦ç¿°èƒ½å¦åšåˆ°è¿™ä¸€ç‚¹ã€‚
>
>   ä¸‹é¢æˆ‘ä»¬å°†ç»™ä½ æä¾›çº¦ç¿°æ‹¥æœ‰çš„å†œåœºæ•°é‡ `F`ï¼Œä»¥åŠæ¯ä¸ªå†œåœºçš„å®Œæ•´ä¿¡æ¯ã€‚
>
>   å·²çŸ¥èµ°è¿‡ä»»ä½•ä¸€æ¡è·¯å¾„æ‰€èŠ±è´¹çš„æ—¶é—´éƒ½ä¸è¶…è¿‡ `10000` ç§’ï¼Œä»»ä½•è™«æ´å°†ä»–å¸¦å›çš„æ—¶é—´éƒ½ä¸ä¼šè¶…è¿‡ `10000` ç§’ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `F`ï¼Œè¡¨ç¤ºçº¦ç¿°å…±æœ‰ `F` ä¸ªå†œåœºã€‚
>
>   å¯¹äºæ¯ä¸ªå†œåœºï¼Œç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `N,M,W`ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `S,E,T`ï¼Œè¡¨ç¤ºç”°åœ° `S` å’Œ `E` ä¹‹é—´å­˜åœ¨ä¸€æ¡è·¯å¾„ï¼Œç»è¿‡è¿™æ¡è·¯å¾„æ‰€èŠ±çš„æ—¶é—´ä¸º `T`ã€‚
>
>   å†æ¥ä¸‹æ¥ `W` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `S,E,T`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç”°åœ° `S` èµ°åˆ°ç”°åœ° `E` çš„è™«æ´ï¼Œèµ°è¿‡è¿™æ¡è™«æ´ï¼Œå¯ä»¥å›åˆ° `T` ç§’ä¹‹é—´ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå…± `F` è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªç»“æœã€‚
>
>   å¦‚æœçº¦ç¿°èƒ½å¤Ÿåœ¨å‡ºå‘æ—¶åˆ»ä¹‹å‰å›åˆ°å‡ºå‘åœ°ï¼Œåˆ™è¾“å‡º `YES`ï¼Œå¦åˆ™è¾“å‡º `NO`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ F â‰¤ 5$
>   +   $1 â‰¤ N â‰¤ 500,$
>   +   $1 â‰¤ M â‰¤ 2500,$
>   +   $1 â‰¤ W â‰¤ 200,$
>   +   $1 â‰¤ T â‰¤ 10000,$
>   +   $1 â‰¤ S, E â‰¤ N$

**è¾“å…¥æ ·ä¾‹**

```c++
2
3 3 1
1 2 2
1 3 4
2 3 1
3 1 3
3 2 1
1 2 3
2 3 4
3 1 8
```

**è¾“å‡ºæ ·ä¾‹**

```c++
NO
YES
```

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ¿é¢˜, çœ‹æœ¬ç« å¼€å¤´æ¦‚è¿°

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 510, M = 5210;
int n, m1, m2, T, idx;
int h[N], e[M], w[M], ne[M], dist[N], st[N], q[N], cnt[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
bool spfa() {
    memset(dist, 0, sizeof dist);
    memset(st, 0, sizeof st);
    memset(cnt, 0, sizeof cnt);
    int hh = 0, tt = 0;
    // ç”±äºä¸çŸ¥é“å“ªä¸ªç‚¹ä½œä¸ºèµ·ç‚¹, å› æ­¤, å°†æ‰€æœ‰ç‚¹å…¥é˜Ÿ, æ ‡è®°å½“å‰ç‚¹å·²ç»åœ¨é˜Ÿåˆ—ä¸­
    for (int i = 1; i <= n; i ++ ) {
        q[tt ++ ] = i;
        st[i] = true;
    }
    while (hh != tt) {
        int t = q[hh ++ ];
        st[t] = false;
        if (hh == N) hh = 0;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] > dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                cnt[j] = cnt[t] + 1;
                if (cnt[j] >= n) return true;
                if (!st[j]) {
                    q[tt ++ ] = j;
                    st[j] = true;
                    if (tt == N) tt = 0;
                }
            }
        }
    }
    return false;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        memset(h, -1, sizeof h);
        idx = 0;
        scanf("%d%d%d", &n, &m1, &m2);
        for (int i = 0; i < m1; i ++ ) {
            int a, b, c;
            scanf("%d%d%d", &a, &b, &c);
            add(a, b, c);
            add(b, a, c);
        }
        for (int i = 0; i < m2; i ++ ) {
            int a, b, c;
            scanf("%d%d%d", &a, &b, &c);
            add(a, b, -c);
        }
        if (spfa()) puts("YES");
        else puts("NO");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$spfaæ±‚è´Ÿç¯, æ—¶é—´å¤æ‚åº¦ä¸€èˆ¬ä¸ºO(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`spfa`

**ç¼åˆæ€ª**

[AcWing 852. spfaåˆ¤æ–­è´Ÿç¯](#AcWing 852. spfaåˆ¤æ–­è´Ÿç¯)

### [AcWing 361. è§‚å…‰å¥¶ç‰›](https://www.acwing.com/problem/content/363/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€å¼  `L` ä¸ªç‚¹ã€`P` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œæ¯ä¸ªç‚¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼ `f[i]`ï¼Œæ¯æ¡è¾¹éƒ½æœ‰ä¸€ä¸ªæƒå€¼ `t[i]`ã€‚
>
>   æ±‚å›¾ä¸­çš„ä¸€ä¸ªç¯ï¼Œä½¿â€œç¯ä¸Šå„ç‚¹çš„æƒå€¼ä¹‹å’Œâ€é™¤ä»¥â€œç¯ä¸Šå„è¾¹çš„æƒå€¼ä¹‹å’Œâ€æœ€å¤§ã€‚
>
>   è¾“å‡ºè¿™ä¸ªæœ€å¤§å€¼ã€‚
>
>   **æ³¨æ„**ï¼šæ•°æ®ä¿è¯è‡³å°‘å­˜åœ¨ä¸€ä¸ªç¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `L` å’Œ `P`ã€‚
>
>   æ¥ä¸‹æ¥ `L` è¡Œæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤º `f[i]`ã€‚
>
>   å†æ¥ä¸‹æ¥ `P` è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•° `aï¼Œbï¼Œt[i]`ï¼Œè¡¨ç¤ºç‚¹ `a` å’Œ `b` ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ï¼Œè¾¹çš„æƒå€¼ä¸º `t[i]`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•°è¡¨ç¤ºç»“æœï¼Œä¿ç•™ä¸¤ä½å°æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $2 â‰¤ L â‰¤ 1000,$
>   +   $2 â‰¤ P â‰¤ 5000,$
>   +   $1 â‰¤ f[i], t[i] â‰¤ 1000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 7
30
10
10
5
10
1 2 3
2 3 2
3 4 5
3 5 2
4 5 5
5 1 3
5 2 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
6.00
```

**æ‰‹å†™ç¨¿**

![4291143](img/4291143.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1010, M = 10010;
int n, m, idx;
int f[N], h[N], e[M], w[M], ne[M], st[N], q[N], cnt[N];
// æ³¨æ„: doubleç±»å‹
double dist[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// æ³¨æ„: doubleç±»å‹
// SPFAæ±‚ç¯æ¨¡æ¿
bool check(double mid) {
    memset(st, 0, sizeof st);
    memset(cnt, 0, sizeof cnt);
    int hh = 0, tt = 0;
    for (int i = 1; i <= n; i ++ ) {
        q[tt ++ ] = i;
        st[i] = true;
    }
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // æ±‚æ­£ç¯, ä½¿ç”¨å°äºå·<, è€Œä¸æ˜¯å¤§äºå·>
            if (dist[j] < dist[t] + f[j] - mid * w[i]) {
                dist[j] = dist[t] + f[j] - mid * w[i];
                cnt[j] = cnt[t] + 1;
                if (cnt[j] >= n) return true;
                if (!st[j]) {
                    q[tt ++ ] = j;
                    if (tt == N) tt = 0;
                    st[j] = true;
                }
            }
        }
    }
    return false;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &f[i]);
    for (int i = 1; i <= m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
    }
    double l = 0, r = 1010;
    while (r - l > 1e-4) {
        double mid = (l + r) / 2;
        if (check(mid)) l = mid;
        else r = mid;
    }
    printf("%.2lf\n", r);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nmlog_{1000})$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`01è§„åˆ’é—®é¢˜`ã€`SPFA`

**ç¼åˆæ€ª**



### [AcWing 1165. å•è¯ç¯](https://www.acwing.com/problem/content/1167/)

**é¢˜ç›®æè¿°**

>   æˆ‘ä»¬æœ‰ `n` ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ç”± `aâˆ¼z` çš„å°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„ã€‚
>
>   å¦‚æœå­—ç¬¦ä¸² `A` çš„ç»“å°¾ä¸¤ä¸ªå­—ç¬¦åˆšå¥½ä¸å­—ç¬¦ä¸² `B` çš„å¼€å¤´ä¸¤ä¸ªå­—ç¬¦ç›¸åŒ¹é…ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§° `A` ä¸ `B` èƒ½å¤Ÿç›¸è¿ï¼ˆæ³¨æ„ï¼š`A` èƒ½ä¸ `B` ç›¸è¿ä¸ä»£è¡¨ `B` èƒ½ä¸ `A` ç›¸è¿ï¼‰ã€‚
>
>   æˆ‘ä»¬å¸Œæœ›ä»ç»™å®šçš„å­—ç¬¦ä¸²ä¸­æ‰¾å‡ºä¸€äº›ï¼Œä½¿å¾—å®ƒä»¬é¦–å°¾ç›¸è¿å½¢æˆä¸€ä¸ªç¯ä¸²ï¼ˆä¸€ä¸ªä¸²é¦–å°¾ç›¸è¿ä¹Ÿç®—ï¼‰ï¼Œæˆ‘ä»¬æƒ³è¦ä½¿è¿™ä¸ªç¯ä¸²çš„å¹³å‡é•¿åº¦æœ€å¤§ã€‚
>
>   å¦‚ä¸‹ä¾‹ï¼š
>
>   ```c++
>   ababc
>   bckjaca
>   caahoynaab
>   ```
>
>   ç¬¬ä¸€ä¸ªä¸²èƒ½ä¸ç¬¬äºŒä¸ªä¸²ç›¸è¿ï¼Œç¬¬äºŒä¸ªä¸²èƒ½ä¸ç¬¬ä¸‰ä¸ªä¸²ç›¸è¿ï¼Œç¬¬ä¸‰ä¸ªä¸²èƒ½ä¸ç¬¬ä¸€ä¸ªä¸²ç›¸è¿ï¼Œæˆ‘ä»¬æŒ‰ç…§æ­¤é¡ºåºç›¸è¿ï¼Œä¾¿å½¢æˆäº†ä¸€ä¸ªç¯ä¸²ï¼Œé•¿åº¦ä¸º `5+7+10=22`ï¼ˆé‡å¤éƒ¨åˆ†ç®—ä¸¤æ¬¡ï¼‰ï¼Œæ€»å…±ä½¿ç”¨äº† `3` ä¸ªä¸²ï¼Œæ‰€ä»¥å¹³å‡é•¿åº¦æ˜¯ $\frac{22}{3}â‰ˆ7.33$ã€‚

**è¾“å…¥æ ¼å¼**

>   æœ¬é¢˜æœ‰å¤šç»„æ•°æ®ã€‚
>
>   æ¯ç»„æ•°æ®çš„ç¬¬ä¸€è¡Œï¼Œä¸€ä¸ªæ•´æ•° `n`ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²æ•°é‡ï¼›
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡Œä¸€ä¸ªé•¿åº¦å°äºç­‰äº `1000` çš„å­—ç¬¦ä¸²ã€‚
>
>   è¯»å…¥ä»¥ `n=0` ç»“æŸã€‚

**è¾“å‡ºæ ¼å¼**

>   è‹¥ä¸å­˜åœ¨ç¯ä¸²ï¼Œè¾“å‡º`â€No solutionâ€`ï¼Œå¦åˆ™è¾“å‡ºæœ€é•¿çš„ç¯ä¸²çš„å¹³å‡é•¿åº¦ã€‚
>
>   åªè¦ç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆçš„å·®ä¸è¶…è¿‡ `0.01`ï¼Œå°±è§†ä¸ºç­”æ¡ˆæ­£ç¡®ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
3
intercommunicational
alkylbenzenesulfonate
tetraiodophenolphthalein
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
21.66
```

**æ‰‹å†™ç¨¿**

>   è®²è§£
>
>   ![511127](img/511127.png)
>
>   è¡¥å……è¯´æ˜
>
>   ![521153](img/521153.png)



**ä»£ç ä¸€:ç„å­¦ä¼˜åŒ–**

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 700, M = 100010, K = 1010;
// ä¸€å…±åªæœ‰676ä¸ªç‚¹, nè®¾ç½®ä¸º676
int n = 676, m, idx;
char str[K];
int h[N], e[M], w[M], ne[M], st[N], q[N], cnt[N];
double dist[N];
// åŠ è¾¹çš„æ¨¡æ¿[å¤´æ’æ³•]
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// SPFAæ¨¡æ¿
bool check(double mid) {
    memset(st, false, sizeof st);
    memset(cnt, 0, sizeof cnt);
    int hh = 0, tt = 0;
    // æ³¨æ„: ä¸€å…±åªæœ‰676ä¸ªç‚¹
    for (int i = 0; i < n; i ++ ) {
        q[tt ++ ] = i;
        st[i] = true;
    }
    int count = 0;
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // æƒå€¼ä¸ºw[i] - mid
            if (dist[j] < dist[t] + w[i] - mid) {
                dist[j] = dist[t] + w[i] - mid;
                cnt[j] = cnt[t] + 1;
                if (++ count > 5000) return true; // ç»éªŒä¸Šçš„trick, ç‚¹æ•°çš„è‹¥å¹²å€
                if (cnt[j] >= n) return true;
                if (!st[j]) {
                    q[tt ++ ] = j;
                    if (tt == N) tt = 0;
                    st[j] = true;
                }
            }
        }
    }
    return false;
}
int main() {
    while (scanf("%d", &m), m) {
        memset(h, -1, sizeof h);
        idx = 0;
        for (int i = 0; i < m; i ++ ) {
            scanf("%s", str);
            int len = strlen(str);
            if (len >= 2) {
                int a = (str[0] - 'a') * 26 + (str[1] - 'a');
                int b = (str[len - 2] - 'a') * 26 + (str[len - 1] - 'a');
                add(a, b, len);
            }
        }
        if (!check(0)) puts("No solution");
        else {
            double l = 0, r = 1000;
            while (r - l > 1e-4) {
                double mid = (l + r) / 2;
                if (check(mid)) l = mid;
                else r = mid;
            }
            printf("%lf\n", r);
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸å¥½åˆ†æ), ç„å­¦ä¼˜åŒ–$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**ä»£ç äºŒ:æ ˆä¼˜åŒ–**

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 700, M = 100010, K = 1010;
// ä¸€å…±åªæœ‰676ä¸ªç‚¹, nè®¾ç½®ä¸º676
int n = 676, m, idx;
char str[K];
int h[N], e[M], w[M], ne[M], st[N], stk[N], cnt[N];
double dist[N];
// åŠ è¾¹çš„æ¨¡æ¿[å¤´æ’æ³•]
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// SPFAæ¨¡æ¿
bool check(double mid) {
    memset(st, false, sizeof st);
    memset(cnt, 0, sizeof cnt);
    int tt = -1;
    // æ³¨æ„: ä¸€å…±åªæœ‰676ä¸ªç‚¹
    for (int i = 0; i < n; i ++ ) {
        stk[++ tt] = i;
        st[i] = true;
    }
    int count = 0;
    // ä½¿ç”¨æ ˆä¸æ˜¯é˜Ÿåˆ—!!
    while (tt != -1) {
        int t = stk[tt -- ];
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // æƒå€¼ä¸ºw[i] - mid
            if (dist[j] < dist[t] + w[i] - mid) {
                dist[j] = dist[t] + w[i] - mid;
                cnt[j] = cnt[t] + 1;
                if (cnt[j] >= n) return true;
                if (!st[j]) {
                    stk[++ tt] = j;
                    st[j] = true;
                }
            }
        }
    }
    return false;
}
int main() {
    while (scanf("%d", &m), m) {
        memset(h, -1, sizeof h);
        idx = 0;
        for (int i = 0; i < m; i ++ ) {
            scanf("%s", str);
            int len = strlen(str);
            if (len >= 2) {
                int a = (str[0] - 'a') * 26 + (str[1] - 'a');
                int b = (str[len - 2] - 'a') * 26 + (str[len - 1] - 'a');
                add(a, b, len);
            }
        }
        if (!check(0)) puts("No solution");
        else {
            double l = 0, r = 1000;
            while (r - l > 1e-4) {
                double mid = (l + r) / 2;
                if (check(mid)) l = mid;
                else r = mid;
            }
            printf("%lf\n", r);
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(ä¸å¥½è®¡ç®—), å› ä¸ºæœ‰æ ˆå­˜åœ¨ä¸”å‰ªæ$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`SPFA`ã€`è´Ÿç¯`ã€`ç„å­¦ä¼˜åŒ–`

**ç¼åˆæ€ª**

## å·®åˆ†çº¦æŸ

### åŸç†

![531143](img/531143.png)

### [AcWing 1169. ç³–æœ](https://www.acwing.com/problem/content/1171/)

**é¢˜ç›®æè¿°**

>   å¹¼å„¿å›­é‡Œæœ‰ `N` ä¸ªå°æœ‹å‹ï¼Œè€å¸ˆç°åœ¨æƒ³è¦ç»™è¿™äº›å°æœ‹å‹ä»¬åˆ†é…ç³–æœï¼Œè¦æ±‚æ¯ä¸ªå°æœ‹å‹éƒ½è¦åˆ†åˆ°ç³–æœã€‚
>
>   ä½†æ˜¯å°æœ‹å‹ä»¬ä¹Ÿæœ‰å«‰å¦’å¿ƒï¼Œæ€»æ˜¯ä¼šæå‡ºä¸€äº›è¦æ±‚ï¼Œæ¯”å¦‚å°æ˜ä¸å¸Œæœ›å°çº¢åˆ†åˆ°çš„ç³–æœæ¯”ä»–çš„å¤šï¼Œäºæ˜¯åœ¨åˆ†é…ç³–æœçš„æ—¶å€™ï¼Œ è€å¸ˆéœ€è¦æ»¡è¶³å°æœ‹å‹ä»¬çš„ `K` ä¸ªè¦æ±‚ã€‚
>
>   å¹¼å„¿å›­çš„ç³–æœæ€»æ˜¯æœ‰é™çš„ï¼Œè€å¸ˆæƒ³çŸ¥é“ä»–è‡³å°‘éœ€è¦å‡†å¤‡å¤šå°‘ä¸ªç³–æœï¼Œæ‰èƒ½ä½¿å¾—æ¯ä¸ªå°æœ‹å‹éƒ½èƒ½å¤Ÿåˆ†åˆ°ç³–æœï¼Œå¹¶ä¸”æ»¡è¶³å°æœ‹å‹ä»¬æ‰€æœ‰çš„è¦æ±‚ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥çš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•° `N,K`ã€‚
>
>   æ¥ä¸‹æ¥ `K` è¡Œï¼Œè¡¨ç¤ºåˆ†é…ç³–æœæ—¶éœ€è¦æ»¡è¶³çš„å…³ç³»ï¼Œæ¯è¡Œ `3` ä¸ªæ•°å­— `X,A,B`ã€‚
>
>   -   å¦‚æœ `X=1`ï¼è¡¨ç¤ºç¬¬ `A` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœå¿…é¡»å’Œç¬¬ `B` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœä¸€æ ·å¤šã€‚
>   -   å¦‚æœ `X=2`ï¼Œè¡¨ç¤ºç¬¬ `A` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœå¿…é¡»å°‘äºç¬¬ `B` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœã€‚
>   -   å¦‚æœ `X=3`ï¼Œè¡¨ç¤ºç¬¬ `A` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœå¿…é¡»ä¸å°‘äºç¬¬ `B` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœã€‚
>   -   å¦‚æœ `X=4`ï¼Œè¡¨ç¤ºç¬¬ `A` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœå¿…é¡»å¤šäºç¬¬ `B` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœã€‚
>   -   å¦‚æœ `X=5`ï¼Œè¡¨ç¤ºç¬¬ `A` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœå¿…é¡»ä¸å¤šäºç¬¬ `B` ä¸ªå°æœ‹å‹åˆ†åˆ°çš„ç³–æœã€‚
>
>   å°æœ‹å‹ç¼–å·ä» `1` åˆ° `N`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€è¡Œï¼Œè¡¨ç¤ºè€å¸ˆè‡³å°‘éœ€è¦å‡†å¤‡çš„ç³–æœæ•°ï¼Œå¦‚æœä¸èƒ½æ»¡è¶³å°æœ‹å‹ä»¬çš„æ‰€æœ‰è¦æ±‚ï¼Œå°±è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N < 10^5,$
>   +   $1 â‰¤ K â‰¤ 10^5,$
>   +   $1 â‰¤ X â‰¤ 5,$
>   +   $1 â‰¤ A, B â‰¤ N$

**è¾“å…¥æ ·ä¾‹**

```c++
5 7
1 1 2
2 3 2
4 4 1
3 4 5
5 4 5
2 3 5
4 5 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
11
```

**æ‰‹å†™ç¨¿**

![531146](img/531146.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
typedef long long LL;
const int N = 100010, M = 300010;
int n, m, idx;
int h[N], e[M], w[M], ne[M], stk[N], dist[N], st[N], cnt[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
bool spfa() {
    int tt = -1;
    memset(dist, -0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    memset(cnt, 0, sizeof cnt);
    // æ±‚ç¯çš„æ—¶å€™, ä½¿ç”¨æ ˆçš„æ•ˆæœæ¯”è¾ƒå¥½[åŸå› :ç¼åˆæ€ªé“¾æ¥]
    stk[ ++ tt] = 0;
    st[0] = true;
    dist[0] = 0;
    while (tt != -1) {
        int t = stk[tt -- ];
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // æ±‚çš„æ˜¯æ­£ç¯!![æ³¨æ„]
            if (dist[j] < dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                cnt[j] = cnt[t] + 1;
                if (cnt[j] >= n + 1) return true;
                if (!st[j]) {
                    stk[ ++ tt] = j;
                    st[j] = true;
                }
            }
        }
    }
    return false;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int x, a, b;
        scanf("%d%d%d", &x, &a, &b);
        if (x == 1) add(b, a, 0), add(a, b, 0);
        else if (x == 2) add(a, b, 1);
        else if (x == 3) add(b, a, 0);
        else if (x == 4) add(b, a, 1);
        else add(a, b, 0);
    }
    // å°†æ¯ä¸ªç‚¹éƒ½å’Œè¶…çº§æºç‚¹è¿ä¸€æ¡è¾¹, æƒå€¼ä¸º1
    for (int i = 1; i <= n; i ++ ) add(0, i, 1);
    LL res = 0; // æœ‰å¯èƒ½çˆ†int
    // æ±‚çš„æ˜¯æ­£ç¯
    if (spfa()) puts("-1");
    else {
        for (int i = 1; i <= n; i ++ ) res += dist[i];
        printf("%lld\n", res);
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å·®åˆ†çº¦æŸ`ã€`æ­£ç¯`

**ç¼åˆæ€ª**

[AcWing 1165. å•è¯ç¯](#AcWing 1165. å•è¯ç¯)

### [AcWinng 362. åŒºé—´](https://www.acwing.com/problem/content/364/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` ä¸ªåŒºé—´ $[a_i, b_i]$ å’Œ `n` ä¸ªæ•´æ•° $c_i$ã€‚
>
>   ä½ éœ€è¦æ„é€ ä¸€ä¸ªæ•´æ•°é›†åˆ `Z`ï¼Œä½¿å¾— $âˆ€iâˆˆ[1,n]$ï¼Œ`Z` ä¸­æ»¡è¶³ $a_i â‰¤ x â‰¤ b_i$ çš„æ•´æ•° `x` ä¸å°‘äº $c_i$ ä¸ªã€‚
>
>   æ±‚è¿™æ ·çš„æ•´æ•°é›†åˆ `Z` æœ€å°‘åŒ…å«å¤šå°‘ä¸ªæ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ª    æ•´æ•° $a_i, b_i, c_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç»“æœã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n â‰¤ 50000,$
>   +   $0 â‰¤ a_i, b_i â‰¤ 50000,$
>   +   $1 â‰¤ c_i â‰¤ b_i âˆ’ a_i + 1$

**è¾“å…¥æ ·ä¾‹**

```c++
5
3 7 3
8 10 3
6 8 1
1 3 1
10 11 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
6
```

**æ‰‹å†™ç¨¿**

![541009](img/541009.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 50010, M = 150010;
int n, idx;
int h[N], e[M], w[M], ne[M], dist[N], st[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// spfaæ¨¡æ¿
void spfa() {
    memset(dist, -0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    int hh = 0, tt = 0;
    dist[0] = 0;
    q[tt ++ ] = 0;
    st[0] = true;
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] < dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                if (!st[j]) {
                    q[tt ++ ] = j;
                    if (tt == N) tt = 0;
                    st[j] = true;
                }
            }
        }
    }
    return;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= 50001; i ++ ) {
        // ç¬¬ä¸€å’Œç¬¬äºŒä¸ªæ¡ä»¶
        add(i - 1, i, 0);
        add(i, i - 1, -1);
    }
    for (int i = 0; i < n; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        // æ³¨æ„: ä¸‹æ ‡ + 1
        a ++, b ++;
        add(a - 1, b, c);
    }
    spfa();
    // è¾“å‡ºç»“æœå³å¯
    cout << dist[50001] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å·®åˆ†çº¦æŸ`ã€`spfa`

**ç¼åˆæ€ª**



### [AcWing 1170. æ’é˜Ÿå¸ƒå±€](https://www.acwing.com/problem/content/1172/)

**é¢˜ç›®æè¿°**

>   å½“æ’é˜Ÿç­‰å€™å–‚é£Ÿæ—¶ï¼Œå¥¶ç‰›å–œæ¬¢å’Œå®ƒä»¬çš„æœ‹å‹ç«™å¾—é è¿‘äº›ã€‚
>
>   å†œå¤«çº¦ç¿°æœ‰ `N` å¤´å¥¶ç‰›ï¼Œç¼–å·ä» `1` åˆ° `N`ï¼Œæ²¿ä¸€æ¡ç›´çº¿ç«™ç€ç­‰å€™å–‚é£Ÿã€‚
>
>   å¥¶ç‰›æ’åœ¨é˜Ÿä¼ä¸­çš„é¡ºåºå’Œå®ƒä»¬çš„ç¼–å·æ˜¯ç›¸åŒçš„ã€‚
>
>   å› ä¸ºå¥¶ç‰›ç›¸å½“è‹—æ¡ï¼Œæ‰€ä»¥å¯èƒ½æœ‰ä¸¤å¤´æˆ–è€…æ›´å¤šå¥¶ç‰›ç«™åœ¨åŒä¸€ä½ç½®ä¸Šã€‚
>
>   å¦‚æœæˆ‘ä»¬æƒ³è±¡å¥¶ç‰›æ˜¯ç«™åœ¨ä¸€æ¡æ•°è½´ä¸Šçš„è¯ï¼Œå…è®¸æœ‰ä¸¤å¤´æˆ–æ›´å¤šå¥¶ç‰›æ‹¥æœ‰ç›¸åŒçš„æ¨ªåæ ‡ã€‚
>
>   ä¸€äº›å¥¶ç‰›ç›¸äº’é—´å­˜æœ‰å¥½æ„Ÿï¼Œå®ƒä»¬å¸Œæœ›ä¸¤è€…ä¹‹é—´çš„è·ç¦»ä¸è¶…è¿‡ä¸€ä¸ªç»™å®šçš„æ•° `L`ã€‚
>
>   å¦ä¸€æ–¹é¢ï¼Œä¸€äº›å¥¶ç‰›ç›¸äº’é—´éå¸¸åæ„Ÿï¼Œå®ƒä»¬å¸Œæœ›ä¸¤è€…é—´çš„è·ç¦»ä¸å°äºä¸€ä¸ªç»™å®šçš„æ•° `D`ã€‚
>
>   ç»™å‡º $M_L$ æ¡å…³äºä¸¤å¤´å¥¶ç‰›é—´æœ‰å¥½æ„Ÿçš„æè¿°ï¼Œå†ç»™å‡º $M_D$ æ¡å…³äºä¸¤å¤´å¥¶ç‰›é—´å­˜æœ‰åæ„Ÿçš„æè¿°ã€‚
>
>   ä½ çš„å·¥ä½œæ˜¯ï¼šå¦‚æœä¸å­˜åœ¨æ»¡è¶³è¦æ±‚çš„æ–¹æ¡ˆï¼Œè¾“å‡º`-1`ï¼›å¦‚æœ `1` å·å¥¶ç‰›å’Œ `N` å·å¥¶ç‰›é—´çš„è·ç¦»å¯ä»¥ä»»æ„å¤§ï¼Œè¾“å‡º`-2`ï¼›å¦åˆ™ï¼Œè®¡ç®—å‡ºåœ¨æ»¡è¶³æ‰€æœ‰è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œ`1` å·å¥¶ç‰›å’Œ `N` å·å¥¶ç‰›é—´å¯èƒ½çš„æœ€å¤§è·ç¦»ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $N,M_L,M_D$ã€‚
>
>   æ¥ä¸‹æ¥ $M_L$ è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ­£æ•´æ•° $A,B,L$ï¼Œè¡¨ç¤ºå¥¶ç‰› `A` å’Œå¥¶ç‰› `B` è‡³å¤šç›¸éš” `L` çš„è·ç¦»ã€‚
>
>   å†æ¥ä¸‹æ¥ $M_D$ è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ­£æ•´æ•° $A,B,D$ï¼Œè¡¨ç¤ºå¥¶ç‰› `A` å’Œå¥¶ç‰› `B` è‡³å°‘ç›¸éš” `D` çš„è·ç¦»ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æœä¸å­˜åœ¨æ»¡è¶³è¦æ±‚çš„æ–¹æ¡ˆï¼Œè¾“å‡º`-1`ï¼›å¦‚æœ `1` å·å¥¶ç‰›å’Œ `N` å·å¥¶ç‰›é—´çš„è·ç¦»å¯ä»¥ä»»æ„å¤§ï¼Œè¾“å‡º`-2`ï¼›å¦åˆ™ï¼Œè¾“å‡ºåœ¨æ»¡è¶³æ‰€æœ‰è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œ`1` å·å¥¶ç‰›å’Œ `N` å·å¥¶ç‰›é—´å¯èƒ½çš„æœ€å¤§è·ç¦»ã€‚

**æ•°æ®èŒƒå›´**

>   +   $2â‰¤Nâ‰¤1000,$
>   +   $1 â‰¤ M_L, M_D â‰¤ 10 ^ 4,$
>   +   $1â‰¤L,Dâ‰¤10^6$

**è¾“å…¥æ ·ä¾‹**

```c++
4 2 1
1 3 10
2 4 20
2 3 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
27
```

**æ‰‹å†™ç¨¿**

![541201](img/541201.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 1010, M = 21010, INF = 0x3f3f3f3f;
int n, m1, m2, idx;
int h[N], e[M], w[M], ne[M], dist[N], cnt[N], st[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// spfaæ¨¡æ¿
bool spfa(int size) {
    memset(dist, 0x3f, sizeof dist);
    memset(cnt, 0, sizeof cnt);
    memset(st, 0, sizeof st);
    int hh = 0, tt = 0;
    for (int i = 1; i <= size; i ++ ) {
        q[tt ++ ] = i;
        st[i] = true;
        dist[i] = 0;
    }
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] > dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                cnt[j] = cnt[t] + 1;
                if (cnt[j] >= n) return true;
                if (!st[j]) {
                    q[tt ++ ] = j;
                    if (tt == N) tt = 0;
                    st[j] = true;
                }
            }
        }
    }
    return false;
}
int main() {
    scanf("%d%d%d", &n, &m1, &m2);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) add(i + 1, i, 0);
    for (int i = 0; i < m1; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        // æ³¨æ„: aå’Œbçš„å¤§å°ä¸ç¡®å®š
        if (a < b) swap(a, b);
        add(b, a, c);
    }
    for (int i = 0; i < m2; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        // æ³¨æ„: aå’Œbçš„å¤§å°ä¸ç¡®å®š
        if (a < b) swap(a, b);
        add(a, b, -c);
    }
    // å°†æ‰€æœ‰ç‚¹å…¥é˜Ÿ[è™šæ‹Ÿæºç‚¹ä½œç”¨]
    if (spfa(n)) { // å­˜åœ¨ç¯
        puts("-1");
    }
    else {
        // å°†ç¬¬ä¸€ä¸ªç‚¹å…¥é˜Ÿ
        spfa(1);
        // æ— ç©·å¤§,è¿”å›-2
        if (dist[n] == INF) puts("-2");
        // è¿”å›æœ€å¤§è·ç¦»
        else cout << dist[n] << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å·®åˆ†çº¦æŸ`ã€`spfa`

**ç¼åˆæ€ª**



### [AcWing 393. é›‡ä½£æ”¶é“¶å‘˜](https://www.acwing.com/problem/content/395/)

**é¢˜ç›®æè¿°**

>   ä¸€å®¶è¶…å¸‚è¦æ¯å¤© `24` å°æ—¶è¥ä¸šï¼Œä¸ºäº†æ»¡è¶³è¥ä¸šéœ€æ±‚ï¼Œéœ€è¦é›‡ä½£ä¸€å¤§æ‰¹æ”¶é“¶å‘˜ã€‚
>
>   å·²çŸ¥ä¸åŒæ—¶é—´æ®µéœ€è¦çš„æ”¶é“¶å‘˜æ•°é‡ä¸åŒï¼Œä¸ºäº†èƒ½å¤Ÿé›‡ä½£å°½å¯èƒ½å°‘çš„äººå‘˜ï¼Œä»è€Œå‡å°‘æˆæœ¬ï¼Œè¿™å®¶è¶…å¸‚çš„ç»ç†è¯·ä½ æ¥å¸®å¿™å‡ºè°‹åˆ’ç­–ã€‚
>
>   ç»ç†ä¸ºä½ æä¾›äº†ä¸€ä¸ªå„ä¸ªæ—¶é—´æ®µæ”¶é“¶å‘˜æœ€å°éœ€æ±‚æ•°é‡çš„æ¸…å• $R(0),R(1),R(2),â€¦,R(23)$ã€‚
>
>   `R(0)` è¡¨ç¤ºåˆå¤œ `00:00` åˆ°å‡Œæ™¨ `01:00` çš„æœ€å°éœ€æ±‚æ•°é‡ï¼Œ`R(1)` è¡¨ç¤ºå‡Œæ™¨ `01:00` åˆ°å‡Œæ™¨ `02:00` çš„æœ€å°éœ€æ±‚æ•°é‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚
>
>   ä¸€å…±æœ‰ `N` ä¸ªåˆæ ¼çš„ç”³è¯·äººç”³è¯·å²—ä½ï¼Œç¬¬ `i` ä¸ªç”³è¯·äººå¯ä»¥ä» $t_i$ æ—¶åˆ»å¼€å§‹è¿ç»­å·¥ä½œ `8` å°æ—¶ã€‚
>
>   æ”¶é“¶å‘˜ä¹‹é—´ä¸å­˜åœ¨æ›¿æ¢ï¼Œä¸€å®šä¼šå®Œæ•´åœ°å·¥ä½œ `8` å°æ—¶ï¼Œæ”¶é“¶å°çš„æ•°é‡ä¸€å®šè¶³å¤Ÿã€‚
>
>   ç°åœ¨ç»™å®šä½ æ”¶é“¶å‘˜çš„éœ€æ±‚æ¸…å•ï¼Œè¯·ä½ è®¡ç®—æœ€å°‘éœ€è¦é›‡ä½£å¤šå°‘åæ”¶é“¶å‘˜ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªä¸è¶…è¿‡ `20` çš„æ•´æ•°ï¼Œè¡¨ç¤ºæµ‹è¯•æ•°æ®çš„ç»„æ•°ã€‚
>
>   å¯¹äºæ¯ç»„æµ‹è¯•æ•°æ®ï¼Œç¬¬ä¸€è¡ŒåŒ…å« `24` ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«è¡¨ç¤º `R(0),R(1),R(2),â€¦,R(23)`ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å«æ•´æ•° `N`ã€‚
>
>   æ¥ä¸‹æ¥ `N` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° $t_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºä¸€ä¸ªç»“æœï¼Œæ¯ä¸ªç»“æœå ä¸€è¡Œã€‚
>
>   å¦‚æœæ²¡æœ‰æ»¡è¶³éœ€æ±‚çš„å®‰æ’ï¼Œè¾“å‡º `No Solution`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $0â‰¤R(0)â‰¤1000,$
>   +   $0â‰¤Nâ‰¤1000,$
>   +   $0â‰¤t_iâ‰¤23$

**è¾“å…¥æ ·ä¾‹**

```c++
1
1 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1
5
0
23
22
1
10
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
```

**æ‰‹å†™ç¨¿**

![560926](img/560926.png)

**ä»£ç ä¸€:å·®åˆ†çº¦æŸ + æš´åŠ›æšä¸¾**

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 30, M = 110;
int n, T, idx;
int r[N], num[N], h[N], e[M], w[M], ne[M], cnt[N], st[N], dist[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// å·®åˆ†çº¦æŸå»ºè¾¹[æ‰‹å†™ç¨¿]
void build(int c) {
    memset(h, -1, sizeof h);
    idx = 0;
    for (int i = 1; i <= 24; i ++ ) {
        add(i - 1, i, 0);
        add(i, i - 1, -num[i]);
    }
    for (int i = 1; i <= 7; i ++ ) add(16 + i, i, -c + r[i]);
    for (int i = 8; i <= 24; i ++ ) add(i - 8, i, r[i]);
    add(0, 24, c);
    add(24, 0, -c);
    return;
}
// spfaæ¨¡æ¿
bool spfa(int c) {
    build(c);
    memset(dist, -0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    memset(cnt, 0, sizeof cnt);
    int hh = 0, tt = 0;
    q[tt ++ ] = 0;
    st[0] = true;
    dist[0] = 0;
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] < dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                cnt[j] = cnt[t] + 1;
                // æ³¨æ„: å›¾ä¸­çš„ç‚¹ä¸æ˜¯n + 1ä¸ª, n + 1æ˜¯ç”³è¯·äººçš„ä¸ªæ•°
                // å›¾ä¸­ç‚¹çš„æ•°é‡ä¸º25ä¸ª, 0 ~ 24
                if (cnt[j] >= 25) return true;
                if (!st[j]) {
                    q[tt ++ ] = j;
                    if (tt == N) tt = 0;
                    st[j] = true;
                }
            }
        }
    }
    return false;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        // æ³¨æ„: ç€é‡ç†è§£ræ•°ç»„çš„å«ä¹‰
        for (int i = 1; i <= 24; i ++ ) scanf("%d", &r[i]);
        scanf("%d", &n);
        // æ³¨æ„: ç€é‡ç†è§£numæ•°ç»„çš„å«ä¹‰
        // num[i]æ•°ç»„è¡¨ç¤ºiæ—¶åˆ»åˆ°åº—çš„äººæ•°, æœ¬é¢˜ä¸ºæ–¹ä¾¿å°†æ‰€æœ‰æ—¶åˆ»å‘åç§»åŠ¨ä¸€ä½ ++
        memset(num, 0, sizeof num);
        for (int i = 0; i < n; i ++ ) {
            int t;
            scanf("%d", &t);
            num[t + 1] ++;
        }
        int flag = false;
        // æšä¸¾s[24]çš„å€¼
        for (int i = 0; i <= n; i ++ )
            // å¦‚æœæ‰¾åˆ°ç­”æ¡ˆ
            if (!spfa(i)) {
                cout << i << endl;
                flag = true;
                break;
            }
        if (!flag) puts("No Solution");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(Tn2500)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**ä»£ç äºŒ: å·®åˆ†çº¦æŸ + äºŒåˆ†**

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 30, M = 110;
int n, T, idx;
int r[N], num[N], h[N], e[M], w[M], ne[M], cnt[N], st[N], dist[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// å·®åˆ†çº¦æŸå»ºè¾¹[æ‰‹å†™ç¨¿]
void build(int c) {
    memset(h, -1, sizeof h);
    idx = 0;
    for (int i = 1; i <= 24; i ++ ) {
        add(i - 1, i, 0);
        add(i, i - 1, -num[i]);
    }
    for (int i = 1; i <= 7; i ++ ) add(16 + i, i, -c + r[i]);
    for (int i = 8; i <= 24; i ++ ) add(i - 8, i, r[i]);
    add(0, 24, c);
    add(24, 0, -c);
    return;
}
// spfaæ¨¡æ¿
bool spfa(int c) {
    build(c);
    memset(dist, -0x3f, sizeof dist);
    memset(st, 0, sizeof st);
    memset(cnt, 0, sizeof cnt);
    int hh = 0, tt = 0;
    q[tt ++ ] = 0;
    st[0] = true;
    dist[0] = 0;
    while (hh != tt) {
        int t = q[hh ++ ];
        if (hh == N) hh = 0;
        st[t] = false;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (dist[j] < dist[t] + w[i]) {
                dist[j] = dist[t] + w[i];
                cnt[j] = cnt[t] + 1;
                // æ³¨æ„: å›¾ä¸­çš„ç‚¹ä¸æ˜¯n + 1ä¸ª, n + 1æ˜¯ç”³è¯·äººçš„ä¸ªæ•°
                // å›¾ä¸­ç‚¹çš„æ•°é‡ä¸º25ä¸ª, 0 ~ 24
                if (cnt[j] >= 25) return true;
                if (!st[j]) {
                    q[tt ++ ] = j;
                    if (tt == N) tt = 0;
                    st[j] = true;
                }
            }
        }
    }
    return false;
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        // æ³¨æ„: ç€é‡ç†è§£ræ•°ç»„çš„å«ä¹‰
        for (int i = 1; i <= 24; i ++ ) scanf("%d", &r[i]);
        scanf("%d", &n);
        // æ³¨æ„: ç€é‡ç†è§£numæ•°ç»„çš„å«ä¹‰
        // num[i]æ•°ç»„è¡¨ç¤ºiæ—¶åˆ»åˆ°åº—çš„äººæ•°, æœ¬é¢˜ä¸ºæ–¹ä¾¿å°†æ‰€æœ‰æ—¶åˆ»å‘åç§»åŠ¨ä¸€ä½ ++
        memset(num, 0, sizeof num);
        for (int i = 0; i < n; i ++ ) {
            int t;
            scanf("%d", &t);
            num[t + 1] ++;
        }
        int flag = false;
        // æšä¸¾s[24]çš„å€¼
        // æ³¨æ„: äºŒåˆ†çš„èŒƒå›´[0, n]
        int l = 0, r = n;
        while (l < r) {
            int mid = l + r >> 1;
            if (!spfa(mid)) r = mid;
            else l = mid + 1;
        }
        if (spfa(l)) puts("No Solution");
        else cout << l << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(Tlog_n2500)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`å·®åˆ†çº¦æŸ`ã€`spfa`ã€`äºŒåˆ†`

**ç¼åˆæ€ª**



## æœ€è¿‘å…¬å…±ç¥–å…ˆ

### åŸç†

![581323](img/581323.png)

### [AcWing 1172. ç¥–å­™è¯¢é—®](https://www.acwing.com/problem/content/1174/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€æ£µåŒ…å« `n` ä¸ªèŠ‚ç‚¹çš„æœ‰æ ¹æ— å‘æ ‘ï¼ŒèŠ‚ç‚¹ç¼–å·äº’ä¸ç›¸åŒï¼Œä½†ä¸ä¸€å®šæ˜¯ `1 âˆ¼ n`ã€‚
>
>   æœ‰ `m` ä¸ªè¯¢é—®ï¼Œæ¯ä¸ªè¯¢é—®ç»™å‡ºäº†ä¸€å¯¹èŠ‚ç‚¹çš„ç¼–å· `x` å’Œ `y`ï¼Œè¯¢é—® `x` ä¸ `y` çš„ç¥–å­™å…³ç³»ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸€ä¸ªæ•´æ•° è¡¨ç¤ºèŠ‚ç‚¹ä¸ªæ•°ï¼›
>
>   æ¥ä¸‹æ¥ `n` è¡Œæ¯è¡Œä¸€å¯¹æ•´æ•° `a` å’Œ `b`ï¼Œè¡¨ç¤º `a` å’Œ `b` ä¹‹é—´æœ‰ä¸€æ¡æ— å‘è¾¹ã€‚å¦‚æœ `b` æ˜¯ `âˆ’1`ï¼Œé‚£ä¹ˆ `a` å°±æ˜¯æ ‘çš„æ ¹ï¼›
>
>   ç¬¬ `n + 2` è¡Œæ˜¯ä¸€ä¸ªæ•´æ•° `m` è¡¨ç¤ºè¯¢é—®ä¸ªæ•°ï¼›
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªä¸åŒçš„æ­£æ•´æ•° `x` å’Œ `y`ï¼Œè¡¨ç¤ºä¸€ä¸ªè¯¢é—®ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ä¸€ä¸ªè¯¢é—®ï¼Œè‹¥ `x` æ˜¯ `y` çš„ç¥–å…ˆåˆ™è¾“å‡º `1`ï¼Œè‹¥ `y` æ˜¯ `x` çš„ç¥–å…ˆåˆ™è¾“å‡º `2`ï¼Œå¦åˆ™è¾“å‡º `0`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤4Ã—10^4,$
>   +   $1â‰¤æ¯ä¸ªèŠ‚ç‚¹çš„ç¼–å·â‰¤4Ã—10^4$

**è¾“å…¥æ ·ä¾‹**

```c++
10
234 -1
12 234
13 234
14 234
15 234
16 234
17 234
18 234
19 234
233 19
5
234 233
233 12
233 13
233 15
233 19
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
0
0
0
2
```

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ¿é¢˜,æŸ¥çœ‹æœ€è¿‘å…¬å…±ç¥–å…ˆ => åŸç† => ç®—æ³•äºŒ

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 40010, M = 80010, K = 16;
int n, m, idx;
int h[N], e[M], ne[M], depth[N], st[N], q[N];
int fa[N][K];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void bfs(int u) {
    memset(depth, 0x3f, sizeof depth);
    memset(st, false, sizeof st);
    int hh = 0, tt = -1;
    depth[u] = 1;
    q[++ tt] = u;
    while (hh <= tt) {
        int t = q[hh ++ ];
        st[t] = true;
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (!st[j]) {
                depth[j] = depth[t] + 1;
                q[++ tt] = j;
                // ä»jèµ°1æ­¥åˆ°è¾¾t
                fa[j][0] = t;
                // é€’æ¨å…¬å¼
                for (int k = 1; k <= 15; k ++ ) fa[j][k] = fa[fa[j][k - 1]][k - 1];
            }
        }
    }
    return;
}
int lca(int a, int b) {
    // è®¾ç½®å“¨å…µ
    depth[0] = 0;
    // ä¸ºäº†æ–¹ä¾¿ç¼–ç ,å§‹ç»ˆä¿æŒaçš„æ·±åº¦depth[a] >= bçš„æ·±åº¦depth[b]
    // æ³¨æ„: swap(a, b) ä¸æ˜¯ swap(depth[a], depth[b])
    if (depth[a] < depth[b]) swap(a, b);
    // å°†aå’Œbè·³åˆ°åŒä¸€å±‚
    for (int k = 15; k >= 0; k -- )
        // å“¨å…µçš„ä½œç”¨ä¸€:
        // å¦‚æœè·³å‡ºç•Œ,åˆ™fa[a][k] = 0, æ­¤æ—¶depth[0] = 0, æ­¤æ¡ä»¶ä¸€å®šä¸ä¼šæˆç«‹
        // åŸå› :æ ‘ä¸­çš„æ·±åº¦è‡³å°‘ä¸º1
        if (depth[fa[a][k]] >= depth[b]) a = fa[a][k];
    // å¦‚æœaå’Œbå·²ç»ç›¸ç­‰, åˆ™è¿”å›å³å¯
    if (a == b) return a;
    for (int k = 15; k >= 0; k -- )
        // å¦‚æœaå’Œbç›¸ç­‰, åˆ™ä¸€ç›´è·³
        // å‡è®¾aå’Œbæ­¤æ—¶å¤„äºæœ€è¿‘å…¬å…±ç¥–å…ˆçš„ä¸‹ä¸€å±‚, åˆ™ä¸ä¼šè¿›è¡Œè·³è·ƒ
        // å“¨å…µçš„ä½œç”¨äºŒ:
        // å¦‚æœè·³å‡ºç•Œ,åˆ™fa[a][k]å’Œfa[b][k]éƒ½ä¸º0, æ­¤æ—¶depth[0] = depth[0] = 0
        // ä¸¤è€…ç›¸ç­‰,æ­¤æ¡ä»¶ä¹Ÿä¸ä¼šæˆç«‹
        if (fa[a][k] != fa[b][k]) {
            a = fa[a][k];
            b = fa[b][k];
        }
    // å‘ä¸Šèµ°ä¸€æ­¥,å°±æ˜¯æœ€è¿‘å…¬å…±ç¥–å…ˆ
    return fa[a][0];
}
int main() {
    int root;
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 0; i < n; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        if (b == -1) root = a;
        else {
            add(a, b);
            add(b, a);
        }
    }
    bfs(root);
    scanf("%d", &m);
    while (m -- ) {
        int a, b;
        scanf("%d%d", &a, &b);
        int rt = lca(a, b);
        if (rt == a) puts("1");
        else if (rt == b) puts("2");
        else puts("0");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_n + mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(nlog_n)$

**æ ‡ç­¾**

`LCA`ã€`å€å¢`

**ç¼åˆæ€ª**



### [AcWing 1171. è·ç¦»](https://www.acwing.com/problem/content/1173/)

**é¢˜ç›®æè¿°**

>   ç»™å‡º `n` ä¸ªç‚¹çš„ä¸€æ£µæ ‘ï¼Œå¤šæ¬¡è¯¢é—®ä¸¤ç‚¹ä¹‹é—´çš„æœ€çŸ­è·ç¦»ã€‚
>
>   æ³¨æ„ï¼š
>
>   -   è¾¹æ˜¯**æ— å‘**çš„ã€‚
>   -   æ‰€æœ‰èŠ‚ç‚¹çš„ç¼–å·æ˜¯ `1, 2, â€¦, n`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸ºä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚`n` è¡¨ç¤ºç‚¹æ•°ï¼Œ`m` è¡¨ç¤ºè¯¢é—®æ¬¡æ•°ï¼›
>
>   ä¸‹æ¥ `n âˆ’ 1` è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•° `x, y, k`ï¼Œè¡¨ç¤ºç‚¹ `x` å’Œç‚¹ `y` ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹é•¿åº¦ä¸º `k`ï¼›
>
>   å†æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° `x, y`ï¼Œè¡¨ç¤ºè¯¢é—®ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ€çŸ­è·ç¦»ã€‚
>
>   æ ‘ä¸­ç»“ç‚¹ç¼–å·ä» `1` åˆ° `n`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…± `m` è¡Œï¼Œå¯¹äºæ¯æ¬¡è¯¢é—®ï¼Œè¾“å‡ºä¸€è¡Œè¯¢é—®ç»“æœã€‚

**æ•°æ®èŒƒå›´**

>   +   $2â‰¤nâ‰¤10^4,$
>   +   $1â‰¤mâ‰¤2Ã—10^4,$
>   +   $0<kâ‰¤100,$
>   +   $1â‰¤x,yâ‰¤n$

**è¾“å…¥æ ·ä¾‹1**

```c++
2 2 
1 2 100 
1 2 
2 1
```

**è¾“å‡ºæ ·ä¾‹1**

```c++
100
100
```

**è¾“å…¥æ ·ä¾‹2**

```c++
3 2
1 2 10
3 1 15
1 2
3 2
```

**è¾“å‡ºæ ·ä¾‹2**

```c++
10
25
```

**æ‰‹å†™ç¨¿**

![581331](img/581331.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <vector>
using namespace std;
typedef pair<int, int> PII;
const int N = 10010, M = 20010;
int n, m, idx;
int h[N], e[M], w[M], ne[M], dist[N], res[M], st[N], f[N];
vector<PII> query[N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// è®¡ç®—è·ç¦»
void dfs(int u, int father) {
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (j == father) continue;
        // è®¡ç®—è·ç¦»ä¸æ˜¯è®¡ç®—é«˜åº¦!!!
        dist[j] = dist[u] + w[i];
        dfs(j, u);
    }
    return;
}
void tarjan(int u) {
    // æ ‡è®°å½“å‰æ­£åœ¨è®¿é—®uèŠ‚ç‚¹
    st[u] = 1;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœèŠ‚ç‚¹jè¿˜æ²¡æœ‰è¢«è®¿é—®è¿‡
        if (!st[j]) {
            tarjan(j);
            // å°†jçš„çˆ¶äº²æ ‡ä¸ºu[æ‰‹å†™ç¨¿è¿›ä¸€æ­¥è§£é‡Š]
            f[j] = u;
        }
    }
    // ç§‹åç®—è´¦
    // æ¯éå†å®Œä¸€ä¸ªå­æ ‘,éƒ½éœ€è¦è¿›è¡Œè¯¢é—®[åŸå› : æ‰‹å†™ç¨¿]
    for (auto [b, i] : query[u]) // éå†æ‰€æœ‰å’Œuç›¸å…³çš„è¯¢é—®
        // å¦‚æœbå·²ç»è¢«è®¿é—®è¿‡[åç»­ä¸ä¼šå†æ¬¡è¢«è®¿é—®]
        if (st[b] == 2) {
            // æ‰¾åˆ°å…¶æœ€è¿‘å…¬å…±ç¥–å…ˆ
            int anc = find(b);
            // å…¬å¼
            res[i] = dist[u] + dist[b] - 2 * dist[anc];
        }
    // æ ‡ä¸ºuä¸ºå·²ç»è¢«è®¿é—®è¿‡
    st[u] = 2;
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    for (int i = 0; i < n - 1; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        // ä¸¤è¾¹æŸ¥è¯¢éƒ½è¦å»ºç«‹[åŸå› : æ‰‹å†™ç¨¿]
        // ç¬¬ä¸€ç»´å­˜èŠ‚ç‚¹ç¼–å·
        // ç¬¬äºŒç»´å­˜æŸ¥è¯¢ç¼–å·
        query[a].push_back({b, i});
        query[b].push_back({a, i});
    }
    // ä»»æ„æ ¹ç»“ç‚¹, å¦‚1
    dfs(1, -1);
    // ä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†
    tarjan(1);
    for (int i = 0; i < m; i ++ ) cout << res[i] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`Tarjan`ã€`æ¬¡å°ç”Ÿæˆæ ‘`

**ç¼åˆæ€ª**



### [AcWing 356. æ¬¡å°ç”Ÿæˆæ ‘](https://www.acwing.com/problem/content/description/358/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€å¼  `N` ä¸ªç‚¹ `M` æ¡è¾¹çš„æ— å‘å›¾ï¼Œæ±‚æ— å‘å›¾çš„ä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘ã€‚
>
>   è®¾æœ€å°ç”Ÿæˆæ ‘çš„è¾¹æƒä¹‹å’Œä¸º `sum`ï¼Œä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘å°±æ˜¯æŒ‡è¾¹æƒä¹‹å’Œå¤§äº `sum` çš„ç”Ÿæˆæ ‘ä¸­æœ€å°çš„ä¸€ä¸ªã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `xï¼Œyï¼Œz`ï¼Œè¡¨ç¤ºç‚¹ `x` å’Œç‚¹ `y` ä¹‹å‰å­˜åœ¨ä¸€æ¡è¾¹ï¼Œè¾¹çš„æƒå€¼ä¸º `z`ã€‚

**è¾“å‡ºæ ¼å¼**

>   åŒ…å«ä¸€è¡Œï¼Œä»…ä¸€ä¸ªæ•°ï¼Œè¡¨ç¤ºä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘çš„è¾¹æƒå’Œã€‚(æ•°æ®ä¿è¯å¿…å®šå­˜åœ¨ä¸¥æ ¼æ¬¡å°ç”Ÿæˆæ ‘)

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤10^5,Mâ‰¤3Ã—10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
5 6
1 2 1
1 3 2
2 4 3
3 5 4
3 4 3
4 5 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
11
```

**æ‰‹å†™ç¨¿**

![591300](img/591300.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <algorithm>
using namespace std;
typedef long long LL;
const int N = 100010, M = 300010, K = 18, INF = 0x3f3f3f3f;
int n, m, idx;
int p[N], h[N], e[M], w[M], ne[M], depth[N], q[N], st[N];
int fa[N][K], d1[N][K], d2[N][K];
struct Edge {
    int u, v, w;
    bool used;
    bool operator < (const Edge &W) const {
        return w < W.w;
    }
}edges[M];
int find(int x) {
    if (p[x] == x) return p[x];
    return p[x] = find(p[x]);
}
// Kruskalæ¨¡æ¿
LL kruskal() {
    sort(edges, edges + m);
    LL res = 0, cnt = 0;
    for (int i = 1; i <= n; i ++ ) p[i] = i;
    for (int i = 0; i < m; i ++ ) {
        if (cnt == n - 1) break;
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        int fa = find(a);
        int fb = find(b);
        if (fa == fb) continue;
        // æ ‡è®°å½“å‰è¾¹æ˜¯æ ‘è¾¹
        edges[i].used = true;
        p[fb] = fa;
        res += c;
        cnt ++;
    }
    return res;
}
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void build() {
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ )
        if (edges[i].used) {
            int a = edges[i].u;
            int b = edges[i].v;
            int c = edges[i].w;
            // å»ºç«‹åŒå‘è¾¹
            add(a, b, c);
            add(b, a, c);
        }
    return;
}
// BFSæ¨¡æ¿
void bfs() {
    memset(depth, 0x3f, sizeof depth);
    memset(st, false, sizeof st);
    int hh = 0, tt = -1;
    // 0æ˜¯å“¨å…µ, 1æ˜¯æ ¹ç»“ç‚¹
    depth[0] = 0, depth[1] = 1;
    q[++ tt] = 1;
    st[1] = true;
    while (hh <= tt) {
        int t = q[hh ++ ];
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (!st[j]) {
                st[j] = true;
                // æ›´æ–°è·ç¦»
                depth[j] = depth[t] + 1;
                q[++ tt] = j;
                // ä»jå‘ä¸Šèµ°ä¸€æ­¥æ˜¯t
                fa[j][0] = t;
                // åˆå§‹åŒ–, ä¸€å¼€å§‹æœ€å¤§å€¼æ˜¯w[i], ç”±äºæ˜¯ä¸¥æ ¼æ¬¡å°å€¼, æ•…æ¬¡å°å€¼ä¸º-INF
                d1[j][0] = w[i];
                d2[j][0] = -INF;
                for (int k = 1; k < 18; k ++ ) {
                    int anc = fa[j][k - 1];
                    fa[j][k] = fa[anc][k - 1];
                    // æ³¨æ„: æ­¤å¤„å®¹æ˜“å‡ºé”™, å››ä¸ªå€¼ä¸è¦å†™é”™äº†
                    int distance[4] = {d1[j][k - 1], d1[anc][k - 1], d2[j][k - 1], d2[anc][k - 1]};
                    d1[j][k] = d2[j][k] = -INF;
                    for (int u = 0; u < 4; u ++ ) {
                        int d = distance[u];
                        if (d > d1[j][k]) {
                            d2[j][k] = d1[j][k];
                            d1[j][k] = d;
                        }
                        // ä¸¥æ ¼æ¬¡å°å€¼, æ•…, éœ€åˆ¤æ–­d != d1[j][k]
                        else if (d != d1[j][k] && d > d2[j][k]) d2[j][k] = d;
                    }
                }
            }
        }
    }
    return;
}
int lca(int a, int b, int c) {
    // ç»Ÿè®¡æ ‘ä¸­aåˆ°bè·¯å¾„ä¸Šçš„æ‰€æœ‰çš„æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼
    static int distance[M];
    int cnt = 0;
    if (depth[a] < depth[b]) swap(a, b);
    for (int k = 17; k >= 0; k -- )
        if (depth[fa[a][k]] >= depth[b]) {
            distance[cnt ++ ] = d1[a][k];
            distance[cnt ++ ] = d2[a][k];
            a = fa[a][k];
        }
    if (a != b) {
        for (int k = 17; k >= 0; k -- )
            if (fa[a][k] != fa[b][k]) {
                distance[cnt ++ ] = d1[a][k];
                distance[cnt ++ ] = d2[a][k];
                distance[cnt ++ ] = d1[b][k];
                distance[cnt ++ ] = d2[b][k];
                a = fa[a][k];
                b = fa[b][k];
            }
        // åŠ ä¸Šæœ€åä¸€æ­¥çš„æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼
        distance[cnt ++ ] = d1[a][0];
        distance[cnt ++ ] = d2[a][0];
        distance[cnt ++ ] = d1[b][0];
        distance[cnt ++ ] = d2[b][0];
    }
    // æ‰¾åˆ°å…¨å±€çš„æœ€å¤§å€¼å’Œæ¬¡å¤§å€¼
    int dist1 = -INF, dist2 = -INF;
    for (int i = 0; i < cnt; i ++ ) {
        int d = distance[i];
        if (d > dist1) {
            dist2 = dist1;
            dist1 = d;
        }
        else if (d != dist1 && d > dist2) dist2 = d;
    }
    if (c > dist1) return c - dist1;
    if (c > dist2) return c - dist2;
    return INF;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        edges[i] = {a, b, c};
    }
    // Kruskalæ±‚æœ€å°ç”Ÿæˆæ ‘
    LL sum = kruskal();
    // å°†æœ€å°ç”Ÿæˆæ ‘è¿›è¡Œå»ºå›¾, æ–¹ä¾¿æ±‚lca
    build();
    // æ±‚lcaæ‰€éœ€çš„depthå’Œfaæ•°ç»„
    bfs();
    LL res = 1e18;
    // æšä¸¾æ‰€æœ‰éæ ‘è¾¹
    for (int i = 0; i < m; i ++ ) {
        // å¦‚æœæ˜¯æ ‘è¾¹, åˆ™è·³è¿‡
        if (edges[i].used) continue;
        int a = edges[i].u;
        int b = edges[i].v;
        int c = edges[i].w;
        res = min(res, sum + lca(a, b, c));
    }
    printf("%lld\n", res);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`LCA`ã€`æ¬¡å°ç”Ÿæˆæ ‘`

**ç¼åˆæ€ª**

[AcWing 1148. ç§˜å¯†çš„ç‰›å¥¶è¿è¾“](#AcWing 1148. ç§˜å¯†çš„ç‰›å¥¶è¿è¾“)

### [AcWing 352. é—‡ã®ï¦šé–](https://www.acwing.com/problem/content/description/354/)

**é¢˜ç›®æè¿°**

>   ä¼ è¯´ä¸­çš„æš—ä¹‹è¿é”è¢«äººä»¬ç§°ä¸º `Dark`ã€‚
>
>   `Dark` æ˜¯äººç±»å†…å¿ƒçš„é»‘æš—çš„äº§ç‰©ï¼Œå¤ä»Šä¸­å¤–çš„å‹‡è€…ä»¬éƒ½è¯•å›¾æ‰“å€’å®ƒã€‚
>
>   ç»è¿‡ç ”ç©¶ï¼Œä½ å‘ç° `Dark` å‘ˆç°æ— å‘å›¾çš„ç»“æ„ï¼Œå›¾ä¸­æœ‰ `N` ä¸ªèŠ‚ç‚¹å’Œä¸¤ç±»è¾¹ï¼Œä¸€ç±»è¾¹è¢«ç§°ä¸ºä¸»è¦è¾¹ï¼Œè€Œå¦ä¸€ç±»è¢«ç§°ä¸ºé™„åŠ è¾¹ã€‚
>
>   `Dark` æœ‰ `N â€“ 1` æ¡ä¸»è¦è¾¹ï¼Œå¹¶ä¸” `Dark` çš„ä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´éƒ½å­˜åœ¨ä¸€æ¡åªç”±ä¸»è¦è¾¹æ„æˆçš„è·¯å¾„ã€‚
>
>   å¦å¤–ï¼Œ`Dark` è¿˜æœ‰ `M` æ¡é™„åŠ è¾¹ã€‚
>
>   ä½ çš„ä»»åŠ¡æ˜¯æŠŠ `Dark` æ–©ä¸ºä¸è¿é€šçš„ä¸¤éƒ¨åˆ†ã€‚
>
>   ä¸€å¼€å§‹ `Dark` çš„é™„åŠ è¾¹éƒ½å¤„äºæ— æ•ŒçŠ¶æ€ï¼Œä½ åªèƒ½é€‰æ‹©ä¸€æ¡ä¸»è¦è¾¹åˆ‡æ–­ã€‚
>
>   ä¸€æ—¦ä½ åˆ‡æ–­äº†ä¸€æ¡ä¸»è¦è¾¹ï¼Œ`Dark` å°±ä¼šè¿›å…¥é˜²å¾¡æ¨¡å¼ï¼Œä¸»è¦è¾¹ä¼šå˜ä¸ºæ— æ•Œçš„è€Œé™„åŠ è¾¹å¯ä»¥è¢«åˆ‡æ–­ã€‚
>
>   ä½†æ˜¯ä½ çš„èƒ½åŠ›åªèƒ½å†åˆ‡æ–­ `Dark` çš„ä¸€æ¡é™„åŠ è¾¹ã€‚
>
>   ç°åœ¨ä½ æƒ³è¦çŸ¥é“ï¼Œä¸€å…±æœ‰å¤šå°‘ç§æ–¹æ¡ˆå¯ä»¥å‡»è´¥ `Dark`ã€‚
>
>   æ³¨æ„ï¼Œå°±ç®—ä½ ç¬¬ä¸€æ­¥åˆ‡æ–­ä¸»è¦è¾¹ä¹‹åå°±å·²ç»æŠŠ `Dark` æ–©ä¸ºä¸¤æˆªï¼Œä½ ä¹Ÿéœ€è¦åˆ‡æ–­ä¸€æ¡é™„åŠ è¾¹æ‰ç®—å‡»è´¥äº† `Dark`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
>   ä¹‹å `N â€“ 1` è¡Œï¼Œæ¯è¡ŒåŒ…æ‹¬ä¸¤ä¸ªæ•´æ•° `A` å’Œ `B`ï¼Œè¡¨ç¤º `A` å’Œ `B` ä¹‹é—´æœ‰ä¸€æ¡ä¸»è¦è¾¹ã€‚
>
>   ä¹‹å `M` è¡Œä»¥åŒæ ·çš„æ ¼å¼ç»™å‡ºé™„åŠ è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤100000,Mâ‰¤200000ï¼Œæ•°æ®ä¿è¯ç­”æ¡ˆä¸è¶…è¿‡2^{31}âˆ’1$

**è¾“å…¥æ ·ä¾‹**

```c++
4 1
1 2
2 3
1 4
3 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![5101201](img/5101201.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010, M = 200010, K = 18;
int n, m, idx, ans;
int h[N], e[M], ne[M], depth[N], st[N], q[N], d[N];
int fa[N][K];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// æ±‚depthå’Œfaæ¨¡æ¿
void bfs() {
    memset(depth, 0x3f, sizeof depth);
    memset(st, false, sizeof st);
    int hh = 0, tt = -1;
    q[ ++ tt ] = 1;
    st[1] = true;
    depth[0] = 0, depth[1] = 1;
    while (hh <= tt) {
        int t = q[hh ++ ];
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (!st[j]) {
                depth[j] = depth[t] + 1;
                q[ ++ tt ] = j;
                st[j] = true;
                fa[j][0] = t;
                for (int k = 1; k <= 17; k ++ ) fa[j][k] = fa[fa[j][k - 1]][k - 1];
            }
        }
    }
    return;
}
// lcaæ¨¡æ¿
int lca(int a, int b) {
    if (depth[a] < depth[b]) swap(a, b);
    for (int k = 17; k >= 0; k -- )
        if (depth[fa[a][k]] >= depth[b])
            a = fa[a][k];
    if (a == b) return a;
    for (int k = 17; k >= 0; k -- )
        if (fa[a][k] != fa[b][k]) {
            a = fa[a][k];
            b = fa[b][k];
        }
    return fa[a][0];
}
int dfs(int u, int father) {
    int res = d[u];
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (j == father) continue;
        int s = dfs(j, u);
        // è®¡ç®—åˆ°uåˆ°jè¿™æ¡è¾¹
        // åªéœ€ç´¯åŠ åˆ°jå³å¯ä¸éœ€è¦ç´¯åŠ åˆ°u[æ‰‹å†™ç¨¿è¯¦ç»†è§£é‡Š]
        if (s == 0) ans += m;
        else if (s == 1) ans ++;
        res += s;
    }
    return res;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < n - 1; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        // åŒå‘è¾¹
        add(a, b);
        add(b, a);
    }
    // æ±‚è§£lcaæ‰€éœ€è¦çš„depthå’Œfaå‡½æ•°
    bfs();
    for (int i = 0; i < m; i ++ ) {
        int a, b, root;
        scanf("%d%d", &a, &b);
        root = lca(a, b);
        // æ ‘ä¸Šå·®åˆ†
        d[a] ++, d[b] ++, d[root] -= 2;
    }
    // æ±‚è§£ç­”æ¡ˆ
    dfs(1, -1);
    cout << ans << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`lca`ã€`æ ‘ä¸Šå·®åˆ†`

**ç¼åˆæ€ª**



## æœ‰å‘å›¾çš„å¼ºè¿é€šåˆ†é‡

### åŸç†

![5121137](img/5121137.png)

### [AcWing 1174. å—æ¬¢è¿çš„ç‰›](https://www.acwing.com/problem/content/1176/)

**é¢˜ç›®æè¿°**

>   æ¯ä¸€å¤´ç‰›çš„æ„¿æœ›å°±æ˜¯å˜æˆä¸€å¤´æœ€å—æ¬¢è¿çš„ç‰›ã€‚
>
>   ç°åœ¨æœ‰ `N` å¤´ç‰›ï¼Œç¼–å·ä» `1` åˆ° `N`ï¼Œç»™ä½  `M` å¯¹æ•´æ•° `(A,B)`ï¼Œè¡¨ç¤ºç‰› `A` è®¤ä¸ºç‰› `B` å—æ¬¢è¿ã€‚
>
>   è¿™ç§å…³ç³»æ˜¯å…·æœ‰ä¼ é€’æ€§çš„ï¼Œå¦‚æœ `A` è®¤ä¸º `B` å—æ¬¢è¿ï¼Œ`B` è®¤ä¸º `C` å—æ¬¢è¿ï¼Œé‚£ä¹ˆç‰› `A` ä¹Ÿè®¤ä¸ºç‰› `C` å—æ¬¢è¿ã€‚
>
>   ä½ çš„ä»»åŠ¡æ˜¯æ±‚å‡ºæœ‰å¤šå°‘å¤´ç‰›è¢«é™¤è‡ªå·±ä¹‹å¤–çš„æ‰€æœ‰ç‰›è®¤ä¸ºæ˜¯å—æ¬¢è¿çš„ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•° `N,M`ï¼›
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•° `A,B`ï¼Œæ„æ€æ˜¯ `A` è®¤ä¸º `B` æ˜¯å—æ¬¢è¿çš„ï¼ˆç»™å‡ºçš„ä¿¡æ¯æœ‰å¯èƒ½é‡å¤ï¼Œå³æœ‰å¯èƒ½å‡ºç°å¤šä¸ª `A,B`ï¼‰ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºè¢«é™¤è‡ªå·±ä¹‹å¤–çš„æ‰€æœ‰ç‰›è®¤ä¸ºæ˜¯å—æ¬¢è¿çš„ç‰›çš„æ•°é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤10^4,$
>   +   $1â‰¤Mâ‰¤5Ã—10^4$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2
2 1
2 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
```

**æ ·ä¾‹è§£é‡Š**

>   åªæœ‰ç¬¬ä¸‰å¤´ç‰›è¢«é™¤è‡ªå·±ä¹‹å¤–çš„æ‰€æœ‰ç‰›è®¤ä¸ºæ˜¯å—æ¬¢è¿çš„ã€‚

**æ‰‹å†™ç¨¿**

![5121205](img/5121205.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 10010, M = 50010;
int n, m, idx, timestamp, top, scc_cnt;
int h[N], e[M], ne[M], dfn[N], low[N], stk[N], in_stk[N], id[N], sze[N], dout[N];
// é“¾å¼å‰å‘æ˜Ÿ
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// æ¨¡æ¿
void tarjan(int u) {
    dfn[u] = low[u] = ++ timestamp;
    // å°†uè¿›æ ˆå¹¶ä¸”å°†uæ ‡è®°ä¸ºå·²ç»å¤„äºæ ˆä¸­
    stk[top ++ ] = u, in_stk[u] = true;
    // éå†uçš„æ‰€æœ‰é‚»æ¥ç‚¹
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœè¿˜æ²¡æœ‰è¢«éå†è¿‡
        if (!dfn[j]) {
            // éå†
            tarjan(j);
            // å–æœ€å°å€¼
            low[u] = min(low[u], low[j]);
        }
        // å¦‚æœå·²ç»å¤„äºæ ˆä¸­, æ›´æ–°low[u]çš„å€¼
        else if (in_stk[j]) low[u] = min(low[u], dfn[j]);
    }
    // å¦‚æœå½“å‰çš„å¼ºè¿é€šåˆ†é‡å†…æ‰€æœ‰ç‚¹éƒ½å·²ç»è¢«éå†è¿‡
    if (low[u] == dfn[u]) {
        ++ scc_cnt; // è¿é€šåˆ†é‡ä¸ªæ•° ++
        int y;
        do {
            y = stk[ -- top]; // å–å‡ºæ ˆé¡¶
            in_stk[y] = false; // æ ‡è®°ä¸ºfalse, è¡¨æ˜å·²ç»å‡ºæ ˆ
            id[y] = scc_cnt; // æ ‡è®°å½“å‰ç‚¹å¤„äºå“ªä¸ªè¿é€šå—
            sze[scc_cnt] ++; // å½“å‰è¿é€šå—å†…éƒ¨ç‚¹ ++ 
        } while(y != u); // å½“ä¸¤è€…ç›¸ç­‰æ—¶ç»“æŸ
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
    }
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœiè¿˜æ²¡æœ‰è¢«éå†è¿‡, åˆ™éå†
        if (!dfn[i])
            tarjan(i);
    for (int i = 1; i <= n; i ++ )
        for (int j = h[i]; j != -1; j = ne[j]) {
            int k = e[j];
            // è·å–ç‚¹iæ‰€åœ¨çš„è¿é€šå—ç¼–å·
            // è·å–ç‚¹kæ‰€åœ¨çš„è¿é€šå—ç¼–å·
            int a = id[i], b = id[k];
            // å¦‚æœç‚¹iå’Œç‚¹kä¸åœ¨åŒä¸€ä¸ªè¿é€šå—å†…,åˆ™æ›´æ–°açš„å‡ºåº¦
            if (a != b) dout[a] ++;
        }
    int zero = 0, sum = 0;
    for (int i = 1; i <= scc_cnt; i ++ ) {
        // å¦‚æœè¿é€šå—içš„å‡ºåº¦ä¸ä¸º0, åˆ™è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯
        if (dout[i]) continue;
        // å‡ºåº¦ä¸º0çš„è¿é€šå—æ•°é‡ ++
        zero ++;
        // ç‚¹æ•°é‡ + sze[i]
        sum += sze[i];
        // å¦‚æœå‡ºåº¦ä¸º0çš„è¿é€šå—çš„æ•°é‡å¤šäº1ä¸ª, åˆ™è¯´æ˜ä¸å­˜åœ¨åˆæ³•æ¡ä»¶
        if (zero > 1) {
            sum = 0;
            break;
        }
    }
    cout << sum << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`Tarjan`ã€`å¼ºè¿é€šåˆ†é‡`

**ç¼åˆæ€ª**



### [AcWing 367. å­¦æ ¡ç½‘ç»œ](https://www.acwing.com/problem/content/369/)

**é¢˜ç›®æè¿°**

>   ä¸€äº›å­¦æ ¡è¿æ¥åœ¨ä¸€ä¸ªè®¡ç®—æœºç½‘ç»œä¸Šï¼Œå­¦æ ¡ä¹‹é—´å­˜åœ¨è½¯ä»¶æ”¯æ´åè®®ï¼Œæ¯ä¸ªå­¦æ ¡éƒ½æœ‰å®ƒåº”æ”¯æ´çš„å­¦æ ¡åå•ï¼ˆå­¦æ ¡ `A` æ”¯æ´å­¦æ ¡ `B`ï¼Œå¹¶ä¸è¡¨ç¤ºå­¦æ ¡ `B` ä¸€å®šè¦æ”¯æ´å­¦æ ¡ `A`ï¼‰ã€‚
>
>   å½“æŸæ ¡è·å¾—ä¸€ä¸ªæ–°è½¯ä»¶æ—¶ï¼Œæ— è®ºæ˜¯ç›´æ¥è·å¾—è¿˜æ˜¯é€šè¿‡ç½‘ç»œè·å¾—ï¼Œè¯¥æ ¡éƒ½åº”ç«‹å³å°†è¿™ä¸ªè½¯ä»¶é€šè¿‡ç½‘ç»œä¼ é€ç»™å®ƒåº”æ”¯æ´çš„å­¦æ ¡ã€‚
>
>   å› æ­¤ï¼Œä¸€ä¸ªæ–°è½¯ä»¶è‹¥æƒ³è®©æ‰€æœ‰å­¦æ ¡éƒ½èƒ½ä½¿ç”¨ï¼Œåªéœ€å°†å…¶æä¾›ç»™ä¸€äº›å­¦æ ¡å³å¯ã€‚
>
>   ç°åœ¨è¯·é—®æœ€å°‘éœ€è¦å°†ä¸€ä¸ªæ–°è½¯ä»¶ç›´æ¥æä¾›ç»™å¤šå°‘ä¸ªå­¦æ ¡ï¼Œæ‰èƒ½ä½¿è½¯ä»¶èƒ½å¤Ÿé€šè¿‡ç½‘ç»œè¢«ä¼ é€åˆ°æ‰€æœ‰å­¦æ ¡ï¼Ÿ
>
>   æœ€å°‘éœ€è¦æ·»åŠ å‡ æ¡æ–°çš„æ”¯æ´å…³ç³»ï¼Œä½¿å¾—å°†ä¸€ä¸ªæ–°è½¯ä»¶æä¾›ç»™ä»»ä½•ä¸€ä¸ªå­¦æ ¡ï¼Œå…¶ä»–æ‰€æœ‰å­¦æ ¡å°±éƒ½å¯ä»¥é€šè¿‡ç½‘ç»œè·å¾—è¯¥è½¯ä»¶ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡ŒåŒ…å«æ•´æ•° `N`ï¼Œè¡¨ç¤ºå­¦æ ¡æ•°é‡ã€‚
>
>   ç¬¬ `2..N+1` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ•´æ•°ï¼Œç¬¬ `i+1` è¡Œè¡¨ç¤ºå­¦æ ¡ `i` åº”è¯¥æ”¯æ´çš„å­¦æ ¡åå•ï¼Œæ¯è¡Œæœ€åéƒ½æœ‰ä¸€ä¸ª `0` è¡¨ç¤ºåå•ç»“æŸï¼ˆåªæœ‰ä¸€ä¸ª `0` å³è¡¨ç¤ºè¯¥å­¦æ ¡æ²¡æœ‰éœ€è¦æ”¯æ´çš„å­¦æ ¡ï¼‰ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸¤ä¸ªé—®é¢˜çš„ç»“æœï¼Œæ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $2â‰¤Nâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
5
2 4 3 0
4 5 0
0
0
1 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
2 
```

**æ‰‹å†™ç¨¿**

![5131034](img/5131034.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110, M = 10010;
int n, idx, top, timestamp, scc_cnt;
int h[N], e[M], ne[M], dfn[N], low[N], stk[N], in_stk[N], id[N], din[N], dout[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// tarjanæ¨¡æ¿
void tarjan(int u) {
    dfn[u] = low[u] = ++ timestamp;
    stk[ ++ top ] = u, in_stk[u] = true;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (!dfn[j]) {
            tarjan(j);
            low[u] = min(low[u], low[j]);
        }
        else if (in_stk[j]) low[u] = min(low[u], dfn[j]);
    }
    if (low[u] == dfn[u]) {
        // è¿é€šå—ä¸‹æ ‡ä»1å¼€å§‹
        ++ scc_cnt;
        int y;
        do {
            y = stk[top -- ];
            in_stk[y] = false;
            id[y] = scc_cnt;
        } while (y != u);
    }
    return;
}

int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 1, a; i <= n; i ++ )
        while (~scanf("%d", &a), a)
            add(i, a);
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœå½“å‰ç‚¹è¿˜æ²¡æœ‰è¢«éå†è¿‡, åˆ™éå†æ­¤ç‚¹
        if (!dfn[i])
            tarjan(i);
    for (int i = 1; i <= n; i ++ )
        for (int j = h[i]; j != -1; j = ne[j]) {
            int k = e[j];
            int a = id[i], b = id[k];
            if (a == b) continue;
            dout[a] ++;
            din[b] ++;
        }
    int a = 0, b = 0;
    // éå†æ‰€æœ‰çš„è¿é€šå—, ä¸‹æ ‡ä»1å¼€å§‹
    for (int i = 1; i <= scc_cnt; i ++ ) {
        if (!dout[i]) a ++;
        if (!din[i]) b ++;
    }
    cout << b << endl;
    if (scc_cnt == 1) puts("0");
    else cout << max(a, b) << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`Tarjan`ã€`å¼ºè¿é€šåˆ†é‡`

**ç¼åˆæ€ª**



### [AcWing 1175. æœ€å¤§åŠè¿é€šå­å›¾](https://www.acwing.com/problem/content/1177/)

**é¢˜ç›®æè¿°**

>   ä¸€ä¸ª**æœ‰å‘**å›¾ `G=(V,E)` ç§°ä¸ºåŠè¿é€šçš„ `(Semi-Connected)`ï¼Œå¦‚æœæ»¡è¶³ï¼š`âˆ€u,vâˆˆV`ï¼Œæ»¡è¶³ `uâ†’v` æˆ– `vâ†’u`ï¼Œå³å¯¹äºå›¾ä¸­ä»»æ„ä¸¤ç‚¹ `u,v`ï¼Œå­˜åœ¨ä¸€æ¡ `u` åˆ° `v` çš„æœ‰å‘è·¯å¾„æˆ–è€…ä» `v` åˆ° `u` çš„æœ‰å‘è·¯å¾„ã€‚
>
>   è‹¥ `Gâ€²=(Vâ€²,Eâ€²)` æ»¡è¶³ï¼Œ`Eâ€²` æ˜¯ `E` ä¸­æ‰€æœ‰å’Œ `Vâ€²` æœ‰å…³çš„è¾¹ï¼Œåˆ™ç§° `Gâ€²` æ˜¯ `G` çš„ä¸€ä¸ªå¯¼å‡ºå­å›¾ã€‚
>
>   è‹¥ `Gâ€²` æ˜¯ `G` çš„å¯¼å‡ºå­å›¾ï¼Œä¸” `Gâ€²` åŠè¿é€šï¼Œåˆ™ç§° `Gâ€²` ä¸º `G` çš„åŠè¿é€šå­å›¾ã€‚
>
>   è‹¥ `Gâ€²` æ˜¯ `G` æ‰€æœ‰åŠè¿é€šå­å›¾ä¸­åŒ…å«èŠ‚ç‚¹æ•°æœ€å¤šçš„ï¼Œåˆ™ç§° `Gâ€²` æ˜¯ `G` çš„æœ€å¤§åŠè¿é€šå­å›¾ã€‚
>
>   ç»™å®šä¸€ä¸ªæœ‰å‘å›¾ `G`ï¼Œè¯·æ±‚å‡º `G` çš„æœ€å¤§åŠè¿é€šå­å›¾æ‹¥æœ‰çš„èŠ‚ç‚¹æ•° `K`ï¼Œä»¥åŠä¸åŒçš„æœ€å¤§åŠè¿é€šå­å›¾çš„æ•°ç›® `C`ã€‚
>
>   ç”±äº `C` å¯èƒ½æ¯”è¾ƒå¤§ï¼Œä»…è¦æ±‚è¾“å‡º `C` å¯¹ `X` çš„ä½™æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `N,M,X`ã€‚`N,M` åˆ†åˆ«è¡¨ç¤ºå›¾ `G` çš„ç‚¹æ•°ä¸è¾¹æ•°ï¼Œ`X` çš„æ„ä¹‰å¦‚ä¸Šæ–‡æ‰€è¿°ï¼›
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ­£æ•´æ•° `a,b`ï¼Œè¡¨ç¤ºä¸€æ¡æœ‰å‘è¾¹ `(a,b)`ã€‚
>
>   å›¾ä¸­çš„æ¯ä¸ªç‚¹å°†ç¼–å·ä¸º `1` åˆ° `N`ï¼Œä¿è¯è¾“å…¥ä¸­åŒä¸€ä¸ª `(a,b)` ä¸ä¼šå‡ºç°ä¸¤æ¬¡ã€‚

**è¾“å‡ºæ ¼å¼**

>   åº”åŒ…å«ä¸¤è¡Œã€‚
>
>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `K`ï¼Œç¬¬äºŒè¡ŒåŒ…å«æ•´æ•° `C mod X`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤10^5,$
>   +   $1â‰¤Mâ‰¤10^6,$
>   +   $1â‰¤Xâ‰¤10^8$

**è¾“å…¥æ ·ä¾‹**

```c++
6 6 20070603
1 2
2 1
1 3
2 4
5 6
6 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
3
```

**æ‰‹å†™ç¨¿**

![5241418](img/5241418.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <unordered_set>
using namespace std;
typedef long long LL;
const int N = 100010, M = 2000010;
int n, m, mod, idx, timestamp, top, scc_cnt;
int h[N], hs[N], e[M], ne[M], dfn[N], low[N], stk[N], in_stk[N], id[N], scc_size[N], f[N], g[N];
unordered_set<LL> hx;
// åŠ è¾¹æ¨¡æ¿
void add(int h[], int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// Tarjanæ¨¡æ¿
void tarjan(int u) {
    // æ—¶é—´æˆ³
    dfn[u] = low[u] = ++ timestamp;
    // å…¥æ ˆå¹¶æ ‡è®°å…¶å·²åœ¨æ ˆä¸­
    stk[ ++ top] = u, in_stk[u] = true;
    // éå†uçš„æ‰€æœ‰é‚»è¾¹
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœjè¿˜æ²¡æœ‰è¢«éå†è¿‡
        if (!dfn[j]) {
            // éå†j
            tarjan(j);
            // æ›´æ–°uèƒ½èµ°åˆ°çš„æœ€æ—§çš„æ—¶é—´æˆ³
            low[u] = min(low[u], low[j]);
        }
        // å¦‚æœjå·²åœ¨æ ˆä¸­, åˆ™ç›´æ¥æ›´æ–°uèƒ½èµ°åˆ°çš„æœ€æ—§çš„æ—¶é—´æˆ³
        else if (in_stk[j]) low[u] = min(low[u], dfn[j]);
    }
    // å¦‚æœä¸€ä¸ªè¿é€šå—å·²è¢«éå†å®Œ
    if (dfn[u] == low[u]) {
        int y;
        // ++ è¿é€šå—ç¼–å·
        ++ scc_cnt;
        do {
            // å–å‡ºæ ˆé¡¶
            y = stk[top -- ];
            // æ ‡è®°ä¸ºä¸åœ¨æ ˆä¸­
            in_stk[y] = false;
            // æ ‡è®°å½“å‰ç‚¹çš„è¿é€šå—çš„ç¼–å·
            id[y] = scc_cnt;
            // å½“å‰è¿é€šå—çš„æ•°é‡ ++
            scc_size[scc_cnt] ++;
        } while (y != u);
    }
    return;
}
int main() {
    scanf("%d%d%d", &n, &m, &mod);
    memset(h, -1, sizeof h);
    memset(hs, -1, sizeof hs);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(h, a, b);
    }
    for (int i = 1; i <= n; i ++ )
        if (!dfn[i])
            tarjan(i);
    for (int i = 1; i <= n; i ++ )
        for (int j = h[i]; j != -1; j = ne[j]) {
            int k = e[j];
            // è·å–ç‚¹içš„è¿é€šå—ç¼–å·
            // è·å–ç‚¹kçš„è¿é€šå—ç¼–å·
            int a = id[i], b = id[k];
            // å“ˆå¸Œ
            LL t = a * 1000000ll + b;
            if (a != b && !hx.count(t)) {
                add(hs, a, b);
                hx.insert(t);
            }
        }
    // å€’åºä¸€å®šå°±æ˜¯æ‹“æ‰‘åº[æ‰‹å†™ç¨¿è§£é‡Š]
    for (int i = scc_cnt; i; i -- ) {
        // å¦‚æœè¿é€šå—iæ²¡æœ‰è¢«æ›´æ–°, åˆ™æ›´æ–°
        if (!f[i]) {
            // æ›´æ–°æœ€é•¿è·¯å¾„
            f[i] = scc_size[i];
            // æ›´æ–°ä¸ªæ•°
            g[i] = 1;
        }
        // éå†è¿é€šå—içš„æ‰€æœ‰é‚»è¾¹
        for (int j = hs[i]; j != -1; j = ne[j]) {
            int k = e[j];
            // æ›´æ–°çœ‹[æ‰‹å†™ç¨¿]
            if (f[i] + scc_size[k] > f[k]) {
                f[k] = f[i] + scc_size[k];
                g[k] = g[i];
            }
            else if (f[i] + scc_size[k] == f[k])
                g[k] = (g[k] + g[i]) % mod;
        }
    }
    int maxf = -1, sum = 0;
    for (int i = 1; i <= scc_cnt; i ++ )
        if (f[i] > maxf) {
            maxf = f[i];
            sum = g[i];
        }
        else if (f[i] == maxf) sum = (sum + g[i]) % mod;
    printf("%d\n%d\n", maxf, sum);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`Tarjan`ã€`æ‹“æ‰‘æ’åº`

**ç¼åˆæ€ª**



### [AcWing 368. é“¶æ²³](https://www.acwing.com/problem/content/370/)

**é¢˜ç›®æè¿°**

>   é“¶æ²³ä¸­çš„æ’æ˜Ÿæµ©å¦‚çƒŸæµ·ï¼Œä½†æ˜¯æˆ‘ä»¬åªå…³æ³¨é‚£äº›æœ€äº®çš„æ’æ˜Ÿã€‚
>
>   æˆ‘ä»¬ç”¨ä¸€ä¸ªæ­£æ•´æ•°æ¥è¡¨ç¤ºæ’æ˜Ÿçš„äº®åº¦ï¼Œæ•°å€¼è¶Šå¤§åˆ™æ’æ˜Ÿå°±è¶Šäº®ï¼Œæ’æ˜Ÿçš„äº®åº¦æœ€æš—æ˜¯ `1`ã€‚
>
>   ç°åœ¨å¯¹äº `N` é¢—æˆ‘ä»¬å…³æ³¨çš„æ’æ˜Ÿï¼Œæœ‰ `M` å¯¹äº®åº¦ä¹‹é—´çš„ç›¸å¯¹å…³ç³»å·²ç»åˆ¤æ˜ã€‚
>
>   ä½ çš„ä»»åŠ¡å°±æ˜¯æ±‚å‡ºè¿™ `N` é¢—æ’æ˜Ÿçš„äº®åº¦å€¼æ€»å’Œè‡³å°‘æœ‰å¤šå¤§ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œç»™å‡ºä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
>   ä¹‹å `M` è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•° `T,A,B`ï¼Œè¡¨ç¤ºä¸€å¯¹æ’æ˜Ÿ `(A,B)` ä¹‹é—´çš„äº®åº¦å…³ç³»ã€‚æ’æ˜Ÿçš„ç¼–å·ä» `1` å¼€å§‹ã€‚
>
>   å¦‚æœ `T=1`ï¼Œè¯´æ˜ `A` å’Œ `B` äº®åº¦ç›¸ç­‰ã€‚
>   å¦‚æœ `T=2`ï¼Œè¯´æ˜ `A` çš„äº®åº¦å°äº `B` çš„äº®åº¦ã€‚
>   å¦‚æœ `T=3`ï¼Œè¯´æ˜ `A` çš„äº®åº¦ä¸å°äº `B` çš„äº®åº¦ã€‚
>   å¦‚æœ `T=4`ï¼Œè¯´æ˜ `A` çš„äº®åº¦å¤§äº `B` çš„äº®åº¦ã€‚
>   å¦‚æœ `T=5`ï¼Œè¯´æ˜ `A` çš„äº®åº¦ä¸å¤§äº `B` çš„äº®åº¦ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç»“æœã€‚
>
>   è‹¥æ— è§£ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤100000,Mâ‰¤100000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 7 
1 1 2 
2 3 2 
4 4 1 
3 4 5 
5 4 5 
2 3 5 
4 5 1 
```

**è¾“å‡ºæ ·ä¾‹**

```c++
11
```

**æ‰‹å†™ç¨¿**

![5251436](img/5251436.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
#include <cstring>
using namespace std;
typedef long long LL;
const int N = 100010, M = 600010;
int n, m, idx, top, timestamp, scc_cnt;
int h[N], hs[N], e[M], w[M], ne[M], dfn[N], low[N], stk[N], in_stk[N], id[N], sz[N], dist[N];
// åŠ è¾¹å‡½æ•°
void add(int h[], int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// Tarjanæ¨¡æ¿
void tarjan(int u) {
    dfn[u] = low[u] = ++ timestamp;
    stk[ ++ top ] = u, in_stk[u] = true;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (!dfn[j]) {
            tarjan(j);
            low[u] = min(low[u], low[j]);
        }
        else if (in_stk[j]) low[u] = min(low[u], dfn[j]);
    }
    if (low[u] == dfn[u]) {
        ++ scc_cnt;
        int y;
        do {
            y = stk[top -- ];
            in_stk[y] = false;
            id[y] = scc_cnt;
            sz[scc_cnt] ++;
        } while (y != u);
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    memset(hs, -1, sizeof hs);
    // å»ºç«‹è¶…çº§æºç‚¹
    for (int i = 1; i <= n; i ++ ) add(h, 0, i, 1);
    // çº¦æŸæ¡ä»¶
    for (int i = 0; i < m; i ++ ) {
        int t, a, b;
        scanf("%d%d%d", &t, &a, &b);
        if (t == 1) add(h, b, a, 0), add(h, a, b, 0);
        else if (t == 2) add(h, a, b, 1);
        else if (t == 3) add(h, b, a, 0);
        else if (t == 4) add(h, b, a, 1);
        else add(h, a, b, 0);
    }
    // æ±‚å¼ºè¿é€šåˆ†é‡
    tarjan(0);
    int flag = true;
    // éå†æ‰€æœ‰ç‚¹, ä»0å¼€å§‹
    for (int i = 0; i <= n; i ++ ) {
        // éå†æ‰€æœ‰é‚»è¾¹
        for (int j = h[i]; j != -1; j = ne[j]) {
            int k = e[j];
            // è·å–ç‚¹içš„è¿é€šå—ç¼–å·
            // è·å–ç‚¹kçš„è¿é€šå—ç¼–å·
            int a = id[i], b = id[k];
            // å¦‚æœåœ¨åŒä¸€ä¸ªè¿é€šå—å†…éƒ¨ä¸”æƒå€¼å¤§äº0, åˆ™æ— è§£[æ‰‹å†™ç¨¿]
            if (a == b && w[j] > 0) {
                flag = false;
                break;
            }
            // ä¸¤ä¸ªè¿é€šå—ä¹‹é—´å¯èƒ½ä¼šæœ‰å¤šæ¡è¾¹è¿›è¡Œè¿æ¥, æ¯æ¡è¾¹éƒ½éœ€è¦æ·»åŠ [æ‰‹å†™ç¨¿]
            if (a != b) add(hs, a, b, w[j]);
        }
        if (!flag) break;
    }
    if (!flag) puts("-1");
    else {
        // å€’åºéå†æ¯ä¸ªè¿é€šå—[å³ä¸ºæ‹“æ‰‘é¡ºåº]
        for (int i = scc_cnt; i; i -- )
            // éå†è¿é€šå—çš„æ¯ä¸ªé‚»è¿é€šå—
            for (int j = hs[i]; j != -1; j = ne[j]) {
                int k = e[j];
                // æ›´æ–°è·ç¦»
                dist[k] = max(dist[k], dist[i] + w[j]);
            }
        LL res = 0;
        // å…¬å¼[æ‰‹å†™ç¨¿]
        for (int i = 1; i <= scc_cnt; i ++ ) res += (LL)dist[i] * sz[i];
        printf("%lld\n", res);
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`Tarjan`ã€`å·®åˆ†çº¦æŸ`ã€`å¼ºè¿é€šåˆ†é‡`

**ç¼åˆæ€ª**



## æ— å‘å›¾çš„åŒè¿é€šåˆ†é‡

### åŸç†

![5281631](img/5281631.png)

### [AcWing 395. å†—ä½™è·¯å¾„](https://www.acwing.com/problem/content/397/)

**é¢˜ç›®æè¿°**

>   ä¸ºäº†ä» `F` ä¸ªè‰åœºä¸­çš„ä¸€ä¸ªèµ°åˆ°å¦ä¸€ä¸ªï¼Œå¥¶ç‰›ä»¬æœ‰æ—¶ä¸å¾—ä¸è·¯è¿‡ä¸€äº›å¥¹ä»¬è®¨åŒçš„å¯æ€•çš„æ ‘ã€‚
>
>   å¥¶ç‰›ä»¬å·²ç»åŒå€¦äº†è¢«è¿«èµ°æŸä¸€æ¡è·¯ï¼Œæ‰€ä»¥å¥¹ä»¬æƒ³å»ºä¸€äº›æ–°è·¯ï¼Œä½¿æ¯ä¸€å¯¹è‰åœºä¹‹é—´éƒ½ä¼šè‡³å°‘æœ‰ä¸¤æ¡ç›¸äº’åˆ†ç¦»çš„è·¯å¾„ï¼Œè¿™æ ·å¥¹ä»¬å°±æœ‰å¤šä¸€äº›é€‰æ‹©ã€‚
>
>   æ¯å¯¹è‰åœºä¹‹é—´å·²ç»æœ‰è‡³å°‘ä¸€æ¡è·¯å¾„ã€‚
>
>   ç»™å‡ºæ‰€æœ‰ `R` æ¡åŒå‘è·¯çš„æè¿°ï¼Œæ¯æ¡è·¯è¿æ¥äº†ä¸¤ä¸ªä¸åŒçš„è‰åœºï¼Œè¯·è®¡ç®—æœ€å°‘çš„æ–°å»ºé“è·¯çš„æ•°é‡ï¼Œè·¯å¾„ç”±è‹¥å¹²é“è·¯é¦–å°¾ç›¸è¿è€Œæˆã€‚
>
>   ä¸¤æ¡è·¯å¾„ç›¸äº’åˆ†ç¦»ï¼Œæ˜¯æŒ‡ä¸¤æ¡è·¯å¾„æ²¡æœ‰ä¸€æ¡é‡åˆçš„é“è·¯ã€‚
>
>   ä½†æ˜¯ï¼Œä¸¤æ¡åˆ†ç¦»çš„è·¯å¾„ä¸Šå¯ä»¥æœ‰ä¸€äº›ç›¸åŒçš„è‰åœºã€‚
>
>   å¯¹äºåŒä¸€å¯¹è‰åœºä¹‹é—´ï¼Œå¯èƒ½å·²ç»æœ‰ä¸¤æ¡ä¸åŒçš„é“è·¯ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´å†å»ºä¸€æ¡é“è·¯ï¼Œä½œä¸ºå¦ä¸€æ¡ä¸åŒçš„é“è·¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œè¾“å…¥ `F` å’Œ `R`ã€‚
>
>   æ¥ä¸‹æ¥ `R` è¡Œï¼Œæ¯è¡Œè¾“å…¥ä¸¤ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸¤ä¸ªè‰åœºï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä¸€æ¡é“è·¯ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å°‘çš„éœ€è¦æ–°å»ºçš„é“è·¯æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Fâ‰¤5000,$
>   +   $Fâˆ’1â‰¤Râ‰¤10000$

**è¾“å…¥æ ·ä¾‹**

```c++
7 7
1 2
2 3
3 4
2 5
4 5
5 6
5 7
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
```

**æ‰‹å†™ç¨¿**

![5261306](img/5261306.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 5010, M = 20010;
int n, m, idx, timestamp, top, dcc_cnt;
int h[N], e[M], ne[M], dfn[N], low[N], stk[N], is_bridge[M], id[N], d[N];
// åŠ è¾¹å‡½æ•°
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// fromè®°å½•çš„æ˜¯è¾¹, ä¸æ˜¯ç‚¹
void tarjan(int u, int from) {
    // æ—¶é—´æˆ³
    dfn[u] = low[u] = ++ timestamp;
    // å…¥æ ˆ
    stk[++ top] = u;
    // éå†uçš„æ‰€æœ‰é‚»è¾¹
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœç‚¹jæ²¡æœ‰è¢«éå†è¿‡
        if (!dfn[j]) {
            // æ³¨æ„: è¿™é‡Œçš„fromä¸æ˜¯u, ä¸æ˜¯çˆ¶èŠ‚ç‚¹father
            // è€Œæ˜¯, è¿™é‡Œçš„fromè®°å½•çš„æ˜¯è¾¹
            tarjan(j, i);
            // æ›´æ–°lowå€¼
            low[u] = min(low[u], low[j]);
            // å¦‚æœç‚¹jæ— è®ºå¦‚ä½•ä¹Ÿèµ°ä¸åˆ°uä¹‹å‰, åˆ™è¯´æ˜å…¶æ˜¯æ¡¥
            if (low[j] > dfn[u])
                // æ³¨æ„: è¿™é‡Œçš„è¾¹æ˜¯æˆå¯¹å‡ºç°çš„
                // å³: 0 -> 1, å…¶ä¸‹æ ‡ä¸º0, 1 -> 0, å…¶ä¸‹æ ‡ä¸º1, å¥‡å¶äº¤æ›¿
                // æ•…: æ ‡è®°æ¡¥çš„è¯, ä¸¤æ¡è¾¹éƒ½è¦è¿›è¡Œæ ‡è®°
                is_bridge[i] = is_bridge[i ^ 1] = true;
        }
        // äº¤æ›¿
        // å¥‡æ•° ^ 1 == å¥‡æ•° - 1 ==> 1 ^ 1 == 0, 1çš„åå‘è¾¹æ­£å¥½ä¸º0
        // å¶æ•° ^ 1 == å¶æ•° + 1 ==> 0 ^ 1 == 1, 0çš„åå‘è¾¹æ­£å¥½ä¸º1
        // å®Œç¾ç¬¦åˆæ¡ä»¶
        // æ›´æ–°lowçš„å€¼
        // æ¯æ¡è¾¹åªèƒ½èµ°ä¸€æ¬¡, è¦ä¹ˆèµ°æ­£å‘è¾¹è¦ä¹ˆèµ°åå‘è¾¹
        // å¦åˆ™, 0-1ä¹Ÿæ˜¯è¾¹åŒè¿é€šåˆ†é‡äº†, ä½†æ˜¯, æ˜¾ç¤ºä¸æ˜¯
        // äººå®¶å°±ä¸€æ¡è¾¹, ä½ éå½“æˆä¸¤æ¡è¾¹æ¥ç”¨, æ˜æ˜¾ä¸åˆç†
        else if (i != (from ^ 1)) low[u] = min(low[u], dfn[j]);
    }
    // åªèƒ½èµ°åˆ°è‡ªå·±, è¯´æ˜æ˜¯æ¡¥
    if (dfn[u] == low[u]) {
        // åŒè¿é€šåˆ†é‡çš„ä¸ªæ•° ++
        ++ dcc_cnt;
        int y;
        do {
            // å–å‡ºæ ˆé¡¶
            y = stk[top -- ];
            // æ ‡è®°å½“å‰å…ƒç´ æ‰€åœ¨çš„è¿é€šå—ç¼–å·ä¸ºdcc_cnt
            id[y] = dcc_cnt;
        } while(y != u);
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
        add(b, a);
    }
    tarjan(1, -1);
    // éå†æ‰€æœ‰è¾¹, åŒ…æ‹¬æ­£å‘è¾¹å’Œåå‘è¾¹
    // ä¾‹å¦‚: a - b, åˆ™æœ‰, açš„åº¦æ•°ä¸º1, bçš„åº¦æ•°ä¹Ÿä¸º1, æ— å‘å›¾åªæœ‰åº¦æ•°, æ²¡æœ‰å…¥åº¦å’Œå‡ºåº¦ä¹‹è¯´
    // a -> bè¯´æ˜bçš„åº¦æ•°++
    // b -> aè¯´æ˜açš„åº¦æ•°++
    // å®Œç¾ç¬¦åˆæ¡ä»¶
    for (int i = 0; i < idx; i ++ )
        // å¦‚æœæ˜¯æ¡¥, åˆ™ç»Ÿè®¡åº¦æ•°
        if (is_bridge[i])
            d[id[e[i]]] ++;
    int cnt = 0;
    for (int i = 1; i <= dcc_cnt; i ++ )
        // ç»Ÿè®¡æ‰€æœ‰åº¦ä¸º1çš„èŠ‚ç‚¹, ä¹Ÿå°±æ˜¯å¶å­èŠ‚ç‚¹
        if (d[i] == 1) cnt ++;
    // ç»“è®º
    cout << ++ cnt / 2 << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`Tarjan`ã€`è¾¹åŒè¿é€šåˆ†é‡`

**ç¼åˆæ€ª**



### [AcWing 1183. ç”µåŠ›](https://www.acwing.com/problem/content/1185/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªç”± `n` ä¸ªç‚¹ `m` æ¡è¾¹æ„æˆçš„**æ— å‘**å›¾ï¼Œè¯·ä½ æ±‚å‡ºè¯¥å›¾åˆ é™¤ä¸€ä¸ªç‚¹ä¹‹åï¼Œè¿é€šå—æœ€å¤šæœ‰å¤šå°‘ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æ•°æ®ã€‚
>
>   æ¯ç»„æ•°æ®ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n,m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `a,b`ï¼Œè¡¨ç¤º `a,b` ä¸¤ç‚¹ä¹‹é—´æœ‰è¾¹è¿æ¥ã€‚
>
>   æ•°æ®ä¿è¯æ— é‡è¾¹ã€‚
>
>   ç‚¹çš„ç¼–å·ä» `0` åˆ° `nâˆ’1`ã€‚
>
>   è¯»å…¥ä»¥ä¸€è¡Œ `0 0` ç»“æŸã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºä¸€ä¸ªç»“æœï¼Œå ä¸€è¡Œï¼Œè¡¨ç¤ºè¿é€šå—çš„æœ€å¤§æ•°é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10000,$
>   +   $0â‰¤mâ‰¤15000,$
>   +   $0â‰¤a,b<n$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
0 1
0 2
2 1
4 2
0 1
2 3
3 1
1 0
0 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
2
2
```

**æ‰‹å†™ç¨¿**

![5271314](img/5271314.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 10010, M = 30010;
int n, m, idx, timestamp, ans, root;
int h[N], e[M], ne[M], dfn[N], low[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void tarjan(int u) {
    dfn[u] = low[u] = ++ timestamp;
    int cnt = 0;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (!dfn[j]) {
            tarjan(j);
            low[u] = min(low[u], low[j]);
            // æ»¡è¶³å‰²ç‚¹çš„æ¡ä»¶
            // æ¯äº§ç”Ÿä¸€ä¸ªè¢«å µåœ¨uä¹‹å‰çš„èŠ‚ç‚¹, åˆ™è¿é€šå—æ•°é‡ ++
            // è¯´æ˜uæ˜¯å‰²ç‚¹, åŸå› : jè¢«å µåœ¨uä¹‹å‰, è¿‡ä¸æ¥
            // æ‰‹å†™ç¨¿è¯´æ˜
            if (low[j] >= dfn[u]) cnt ++;
        }
        else low[u] = min(low[u], dfn[j]);
    }
    // æ‰‹å†™ç¨¿è¯´æ˜
    if (u != root && cnt) cnt ++;
    ans = max(ans, cnt);
    return;
}
int main() {
    while (scanf("%d%d", &n, &m), n || m) {
        memset(h, -1, sizeof h);
        memset(dfn, 0, sizeof dfn);
        memset(low, 0, sizeof low);
        idx = timestamp = 0;
        for (int i = 0; i < m; i ++) {
            int a, b;
            scanf("%d%d", &a, &b);
            add(a, b);
            add(b, a);
        }
        // ç»Ÿè®¡æ‰€æœ‰è¿é€šå—æ•°é‡, å› ä¸º, å›¾å¯èƒ½ä¸è¿é€š
        int cnt = 0;
        // é‡ç½®å˜é‡
        ans = 0;
        for (root = 0; root < n; root ++ )
            if (!dfn[root]) {
                // è¿é€šå—æ•°é‡ ++
                cnt ++;
                tarjan(root);
            }
        printf("%d\n", cnt + ans - 1);
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`Tarjan`ã€`å‰²ç‚¹`

**ç¼åˆæ€ª**



### [AcWing 396. çŸ¿åœºæ­å»º](https://www.acwing.com/problem/content/398/)

**é¢˜ç›®æè¿°**

>   ç…¤çŸ¿å·¥åœ°å¯ä»¥çœ‹æˆæ˜¯ç”±éš§é“è¿æ¥æŒ–ç…¤ç‚¹ç»„æˆçš„æ— å‘å›¾ã€‚
>
>   ä¸ºå®‰å…¨èµ·è§ï¼Œå¸Œæœ›åœ¨å·¥åœ°å‘ç”Ÿäº‹æ•…æ—¶æ‰€æœ‰æŒ–ç…¤ç‚¹çš„å·¥äººéƒ½èƒ½æœ‰ä¸€æ¡å‡ºè·¯é€ƒåˆ°æ•‘æ´å‡ºå£å¤„ã€‚
>
>   äºæ˜¯çŸ¿ä¸»å†³å®šåœ¨æŸäº›æŒ–ç…¤ç‚¹è®¾ç«‹æ•‘æ´å‡ºå£ï¼Œä½¿å¾—æ— è®ºå“ªä¸€ä¸ªæŒ–ç…¤ç‚¹åå¡Œä¹‹åï¼Œå…¶ä»–æŒ–ç…¤ç‚¹çš„å·¥äººéƒ½æœ‰ä¸€æ¡é“è·¯é€šå‘æ•‘æ´å‡ºå£ã€‚
>
>   è¯·å†™ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥è®¡ç®—è‡³å°‘éœ€è¦è®¾ç½®å‡ ä¸ªæ•‘æ´å‡ºå£ï¼Œä»¥åŠä¸åŒæœ€å°‘æ•‘æ´å‡ºå£çš„è®¾ç½®æ–¹æ¡ˆæ€»æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ–‡ä»¶æœ‰è‹¥å¹²ç»„æ•°æ®ï¼Œæ¯ç»„æ•°æ®çš„ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ­£æ•´æ•° `N`ï¼Œè¡¨ç¤ºå·¥åœ°çš„éš§é“æ•°ã€‚
>
>   æ¥ä¸‹æ¥çš„ `N` è¡Œæ¯è¡Œæ˜¯ç”¨ç©ºæ ¼éš”å¼€çš„ä¸¤ä¸ªæ•´æ•° `S` å’Œ `T`ï¼Œè¡¨ç¤ºæŒ–ç…¤ç‚¹ `S` ä¸æŒ–ç…¤ç‚¹ `T` ç”±éš§é“ç›´æ¥è¿æ¥ã€‚
>
>   æ³¨æ„ï¼Œæ¯ç»„æ•°æ®çš„æŒ–ç…¤ç‚¹çš„ç¼–å·ä¸º `1âˆ¼Max`ï¼Œå…¶ä¸­ `Max` è¡¨ç¤ºç”±éš§é“è¿æ¥çš„æŒ–ç…¤ç‚¹ä¸­ï¼Œç¼–å·æœ€å¤§çš„æŒ–ç…¤ç‚¹çš„ç¼–å·ï¼Œå¯èƒ½å­˜åœ¨æ²¡æœ‰è¢«éš§é“è¿æ¥çš„æŒ–ç…¤ç‚¹ã€‚
>
>   è¾“å…¥æ•°æ®ä»¥ `0` ç»“å°¾ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºç»“æœå ä¸€è¡Œã€‚
>
>   å…¶ä¸­ç¬¬ `i` è¡Œä»¥ `Case i:` å¼€å§‹ï¼ˆæ³¨æ„å¤§å°å†™ï¼Œ`Case` ä¸ `i` ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œ`i` ä¸ `:` ä¹‹é—´æ— ç©ºæ ¼ï¼Œ`:` ä¹‹åæœ‰ç©ºæ ¼ï¼‰ã€‚
>
>   å…¶åæ˜¯ç”¨ç©ºæ ¼éš”å¼€çš„ä¸¤ä¸ªæ­£æ•´æ•°ï¼Œç¬¬ä¸€ä¸ªæ­£æ•´æ•°è¡¨ç¤ºå¯¹äºç¬¬ `i` ç»„è¾“å…¥æ•°æ®è‡³å°‘éœ€è¦è®¾ç½®å‡ ä¸ªæ•‘æ´å‡ºå£ï¼Œç¬¬äºŒä¸ªæ­£æ•´æ•°è¡¨ç¤ºå¯¹äºç¬¬ `i` ç»„è¾“å…¥æ•°æ®ä¸åŒæœ€å°‘æ•‘æ´å‡ºå£çš„è®¾ç½®æ–¹æ¡ˆæ€»æ•°ã€‚
>
>   è¾“å…¥æ•°æ®ä¿è¯ç­”æ¡ˆå°äº $2^{64}$ï¼Œè¾“å‡ºæ ¼å¼å‚ç…§ä»¥ä¸‹è¾“å…¥è¾“å‡ºæ ·ä¾‹ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤500ï¼Œ$
>   +   $1â‰¤Maxâ‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
9
1  3
4  1
3  5
1  2
2  6
1  5
6  3
1  6
3  2
6
1  2
1  3
2  4
2  5
3  6
3  7
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
Case 1: 2 4
Case 2: 4 1
```

**æ‰‹å†™ç¨¿**

![5281618](img/5281618.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <algorithm>
#include <vector>
using namespace std;
typedef unsigned long long ULL;
const int N = 1010, M = 2010;
int T, n, m, idx, timestamp, top, dcc_cnt, root;
int h[N], e[M], ne[M], dfn[N], low[N], stk[N], cut[N];
vector<int> dcc[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void tarjan(int u) {
    dfn[u] = low[u] = ++ timestamp;
    stk[ ++ top] = u;
    if (u == root && h[u] == -1) { // å­¤ç«‹ç‚¹, å•ä¸ªç‚¹ä¹Ÿæ˜¯ç‚¹åŒè¿é€šåˆ†é‡
        // è¿é€šå—ç¼–å· â• 1  
        dcc_cnt ++;
        // å°†å½“å‰ç‚¹æ·»åŠ åˆ°å½“å‰è¿é€šå—å†…éƒ¨
        dcc[dcc_cnt].push_back(u);
        // è¿”å›å³å¯
        return;
    }
    int cnt = 0; // ç»Ÿè®¡å¹²æ‰å‰²ç‚¹åçš„è¿é€šå—ä¸ªæ•°
    // éå†æ‰€æœ‰é‚»è¾¹
    for (int i = h[u]; i != -1; i = ne[i]) {
        // è·å–ç‚¹
        int j = e[i];
        // å¦‚æœç‚¹jæ²¡æœ‰è¢«è®¿é—®è¿‡
        if (!dfn[j]) {
            // æå®ƒ
            tarjan(j);
            // æ›´æ–°uçš„lowå€¼
            low[u] = min(low[u], low[j]);
            // å¦‚æœç‚¹jæ— è®ºå¦‚ä½•ä¹Ÿèµ°ä¸åˆ°uçš„ä¸Šéƒ¨
            // åˆ™è¯´æ˜ç‚¹jæ‰€åœ¨çš„è¿é€šå—æ˜¯uçš„æ–°ğŸ (æ–°åˆ†æ”¯)
            if (low[j] >= dfn[u]) {
                // è¿é€šå—æ•°é‡ ++ 
                cnt ++;
                // å¦‚æœuä¸æ˜¯æ ¹ç»“ç‚¹æˆ–è€…uçš„åˆ†æ”¯æ•°é‡ > 1, åˆ™è¯´æ˜æ˜¯å‰²ç‚¹
                if (u != root || cnt > 1) cut[u] = true;
                // ç¼©ç‚¹ä¹‹åçš„è¿é€šå—æ•°é‡ ++ 
                ++ dcc_cnt;
                int y;
                do {
                    // å–å‡ºæ ˆé¡¶
                    y = stk[top -- ];
                    // å°†yæ’å…¥åˆ°å½“å‰çš„è¿é€šå—dcc_cntå†…éƒ¨
                    dcc[dcc_cnt].push_back(y);
                } while (y != j);
                // å°†å‰²ç‚¹ä¹ŸåŠ å…¥å½“å‰è¿é€šå—, ä½†æ˜¯ä¸è¦å°†å…¶å¼¹å‡ºæ ˆ[æ‰‹å†™ç¨¿åŸå› ]
                dcc[dcc_cnt].push_back(u);
            }
        }
        // æ›´æ–°uçš„lowå€¼
        else low[u] = min(low[u], dfn[j]);
    }
    return;
}
int main() {
    while (scanf("%d", &m), m) {
        // æ¸…ç©ºè¿é€šå—å†…éƒ¨ç‚¹
        for (int i = 1; i <= dcc_cnt; i ++ ) dcc[i].clear();
        // æ¸…ç©ºç›¸å…³å˜é‡
        n = idx = timestamp = top = dcc_cnt = 0;
        memset(h, -1, sizeof h);
        memset(dfn, 0, sizeof dfn);
        memset(low, 0, sizeof low);
        memset(stk, 0, sizeof stk);
        memset(cut, 0, sizeof cut);
        for (int i = 0; i < m; i ++ ) {
            int a, b;
            scanf("%d%d", &a, &b);
            // å¯»æ‰¾æœ€å¤§ç¼–å·
            n = max(n, max(a, b));
            add(a, b);
            add(b, a);
        }
        // Tarjanç¼©ç‚¹
        for (root = 1; root <= n; root ++ )
            // å¦‚æœrootè¿˜æ²¡æœ‰è¢«æè¿‡
            if (!dfn[root])
                // æå®ƒ
                tarjan(root);
        int res = 0;
        ULL num = 1;
        // éå†æ¯ä¸ªè¿é€šå—
        for (int i = 1; i <= dcc_cnt; i ++ ) {
            int cnt = 0, len = dcc[i].size();
            for (int j = 0; j < len; j ++ )
                // å¦‚æœå½“å‰ç‚¹æ˜¯å‰²ç‚¹, åˆ™ç»Ÿè®¡æ•°é‡
                if (cut[dcc[i][j]]) cnt ++;
            // å¦‚æœå‰²ç‚¹æ•°é‡ä¸º0
            if (cnt == 0) {
                // ç‰¹åˆ¤, å¦‚æœä¸æ˜¯å­¤ç«‹ç‚¹, ä¸Šå…¬å¼[æ‰‹å†™ç¨¿]
                if (len > 1) res += 2, num *= len * (len - 1) / 2;
                // ç‰¹åˆ¤, å¦‚æœæ˜¯å­¤ç«‹ç‚¹, åˆ™åªéœ€è¦æ·»åŠ ä¸€ä¸ªå‡ºå£å³å¯
                else res ++;
            }
            // å¦‚æœå‰²ç‚¹æ•°é‡ä½1, ä¸Šå…¬å¼[æ‰‹å†™ç¨¿]
            else if (cnt == 1) res ++, num *= len - 1;
        }
        printf("Case %d: %d %llu\n", ++ T, res, num);
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`Tarjan`ã€`ç‚¹åŒè¿é€šåˆ†é‡`

**ç¼åˆæ€ª**



## äºŒåˆ†å›¾

### æŸ“è‰²æ³•

#### [AcWing 860. æŸ“è‰²æ³•åˆ¤å®šäºŒåˆ†å›¾](https://www.acwing.com/problem/content/862/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æ— å‘å›¾ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ã€‚
>
>   è¯·ä½ åˆ¤æ–­è¿™ä¸ªå›¾æ˜¯å¦æ˜¯äºŒåˆ†å›¾ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `u` å’Œ `v`ï¼Œè¡¨ç¤ºç‚¹ `u` å’Œç‚¹ `v` ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¦‚æœç»™å®šå›¾æ˜¯äºŒåˆ†å›¾ï¼Œåˆ™è¾“å‡º `Yes`ï¼Œå¦åˆ™è¾“å‡º `No`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n, m â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
4 4
1 3
1 4
2 3
2 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
Yes
```

**æ‰‹å†™ç¨¿**

![4141657](img/4141657.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010, M = 200010;
int n, m, idx;
int h[N], e[M], ne[M], color[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
bool dfs(int u, int c) {
    color[u] = c;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        if (!color[j]) { // å¦‚æœå½“å‰ç‚¹æ²¡æŸ“é¢œè‰², åˆ™å°†å…¶æŸ“è‰²
            // å¦‚æœå½“å‰ç‚¹jæŸ“è‰²å¤±è´¥, åˆ™äº§ç”Ÿè¿é”ååº”, éƒ½å¤±è´¥
            if (!dfs(j, 3 - c)) return false;
        }
        else {
            // å¦‚æœå½“å‰ç‚¹jæŸ“çš„é¢œè‰²å’ŒuæŸ“çš„é¢œè‰²ä¸ä¸€æ ·, è¿”å›false
            if (color[j] == c) return false;
        }
    }
    return true;
}
int main() {
    memset(h, -1, sizeof h);
    scanf("%d%d", &n, &m);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
        add(b, a);
    }
    int flag = true;
    // æ³¨æ„: å›¾å¯èƒ½ä¸æ˜¯è¿é€š
    for (int i = 1; i <= n; i ++ )
        if (!color[i])
            if (!dfs(i, 1)) {
                flag = false;
                break;
            }
    if (flag) puts("Yes");
    else puts("No");
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n + m), næ˜¯ç‚¹æ•°, mæ˜¯è¾¹æ•°$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`äºŒåˆ†å›¾`ã€`æŸ“è‰²æ³•`

**ç¼åˆæ€ª**



#### [AcWing 257. å…³æŠ¼ç½ªçŠ¯](https://www.acwing.com/problem/content/259/)

**é¢˜ç›®æè¿°**

>   `S` åŸç°æœ‰ä¸¤åº§ç›‘ç‹±ï¼Œä¸€å…±å…³æŠ¼ç€ `N` åç½ªçŠ¯ï¼Œç¼–å·åˆ†åˆ«ä¸º `1âˆ¼N`ã€‚
>
>   ä»–ä»¬ä¹‹é—´çš„å…³ç³»è‡ªç„¶ä¹Ÿæä¸å’Œè°ã€‚
>
>   å¾ˆå¤šç½ªçŠ¯ä¹‹é—´ç”šè‡³ç§¯æ€¨å·²ä¹…ï¼Œå¦‚æœå®¢è§‚æ¡ä»¶å…·å¤‡åˆ™éšæ—¶å¯èƒ½çˆ†å‘å†²çªã€‚
>
>   æˆ‘ä»¬ç”¨â€œæ€¨æ°”å€¼â€ï¼ˆä¸€ä¸ªæ­£æ•´æ•°å€¼ï¼‰æ¥è¡¨ç¤ºæŸä¸¤åç½ªçŠ¯ä¹‹é—´çš„ä»‡æ¨ç¨‹åº¦ï¼Œæ€¨æ°”å€¼è¶Šå¤§ï¼Œåˆ™è¿™ä¸¤åç½ªçŠ¯ä¹‹é—´çš„ç§¯æ€¨è¶Šå¤šã€‚
>
>   å¦‚æœä¸¤åæ€¨æ°”å€¼ä¸º `c` çš„ç½ªçŠ¯è¢«å…³æŠ¼åœ¨åŒä¸€ç›‘ç‹±ï¼Œä»–ä»¬ä¿©ä¹‹é—´ä¼šå‘ç”Ÿæ‘©æ“¦ï¼Œå¹¶é€ æˆå½±å“åŠ›ä¸º `c` çš„å†²çªäº‹ä»¶ã€‚
>
>   æ¯å¹´å¹´æœ«ï¼Œè­¦å¯Ÿå±€ä¼šå°†æœ¬å¹´å†…ç›‘ç‹±ä¸­çš„æ‰€æœ‰å†²çªäº‹ä»¶æŒ‰å½±å“åŠ›ä»å¤§åˆ°å°æ’æˆä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åä¸ŠæŠ¥åˆ° `S` åŸ `Z` å¸‚é•¿é‚£é‡Œã€‚
>
>   å…¬åŠ¡ç¹å¿™çš„ `Z` å¸‚é•¿åªä¼šå»çœ‹åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªäº‹ä»¶çš„å½±å“åŠ›ï¼Œå¦‚æœå½±å“å¾ˆåï¼Œä»–å°±ä¼šè€ƒè™‘æ’¤æ¢è­¦å¯Ÿå±€é•¿ã€‚
>
>   åœ¨è¯¦ç»†è€ƒå¯Ÿäº† `N` åç½ªçŠ¯é—´çš„çŸ›ç›¾å…³ç³»åï¼Œè­¦å¯Ÿå±€é•¿è§‰å¾—å‹åŠ›å·¨å¤§ã€‚
>
>   ä»–å‡†å¤‡å°†ç½ªçŠ¯ä»¬åœ¨ä¸¤åº§ç›‘ç‹±å†…é‡æ–°åˆ†é…ï¼Œä»¥æ±‚äº§ç”Ÿçš„å†²çªäº‹ä»¶å½±å“åŠ›éƒ½è¾ƒå°ï¼Œä»è€Œä¿ä½è‡ªå·±çš„ä¹Œçº±å¸½ã€‚
>
>   å‡è®¾åªè¦å¤„äºåŒä¸€ç›‘ç‹±å†…çš„æŸä¸¤ä¸ªç½ªçŠ¯é—´æœ‰ä»‡æ¨ï¼Œé‚£ä¹ˆä»–ä»¬ä¸€å®šä¼šåœ¨æ¯å¹´çš„æŸä¸ªæ—¶å€™å‘ç”Ÿæ‘©æ“¦ã€‚
>
>   é‚£ä¹ˆï¼Œåº”å¦‚ä½•åˆ†é…ç½ªçŠ¯ï¼Œæ‰èƒ½ä½¿ `Z` å¸‚é•¿çœ‹åˆ°çš„é‚£ä¸ªå†²çªäº‹ä»¶çš„å½±å“åŠ›æœ€å°ï¼Ÿè¿™ä¸ªæœ€å°å€¼æ˜¯å¤šå°‘ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸ºä¸¤ä¸ªæ­£æ•´æ•° `N` å’Œ `M`ï¼Œåˆ†åˆ«è¡¨ç¤ºç½ªçŠ¯çš„æ•°ç›®ä»¥åŠå­˜åœ¨ä»‡æ¨çš„ç½ªçŠ¯å¯¹æ•°ã€‚
>
>   æ¥ä¸‹æ¥çš„ `M` è¡Œæ¯è¡Œä¸ºä¸‰ä¸ªæ­£æ•´æ•° $a_jï¼Œb_jï¼Œc_j$ï¼Œè¡¨ç¤º $a_j$ å·å’Œ $b_j$ å·ç½ªçŠ¯ä¹‹é—´å­˜åœ¨ä»‡æ¨ï¼Œå…¶æ€¨æ°”å€¼ä¸º $c_j$ã€‚
>
>   æ•°æ®ä¿è¯ $1â‰¤a_j<b_j<N,0<c_jâ‰¤10^9$ ä¸”æ¯å¯¹ç½ªçŠ¯ç»„åˆåªå‡ºç°ä¸€æ¬¡ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå…± `1` è¡Œï¼Œä¸º `Z` å¸‚é•¿çœ‹åˆ°çš„é‚£ä¸ªå†²çªäº‹ä»¶çš„å½±å“åŠ›ã€‚
>
>   å¦‚æœæœ¬å¹´å†…ç›‘ç‹±ä¸­æœªå‘ç”Ÿä»»ä½•å†²çªäº‹ä»¶ï¼Œè¯·è¾“å‡º `0`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤20000,Mâ‰¤100000$

**è¾“å…¥æ ·ä¾‹**

```c++
4 6
1 4 2534
2 3 3512
1 2 28351
1 3 6618
2 4 1805
3 4 12884
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3512
```

**æ‰‹å†™ç¨¿**

![5291103](img/5291103.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 20010, M = 200010;
int n, m, idx;
int h[N], e[M], w[M], ne[M], color[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
bool dfs(int u, int c, int mid) {
    color[u] = c;
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœå½“å‰ç‚¹å°äºç­‰äºmid, åˆ™è¿”å›
        if (w[i] <= mid) continue;
        // å½“å‰ç‚¹æ²¡æœ‰è¢«æŸ“è‰²å¹¶ä¸”ç»™å½“å‰ç‚¹æŸ“è‰²äº§ç”ŸçŸ›ç›¾, åˆ™è¿”å›false
        if (!color[j] && !dfs(j, 3 - c, mid)) return false;
        // å¦‚æœå·²ç»æŸ“è‰²å¹¶ä¸”é¢œè‰²ç›¸åŒ, è¿”å›false
        else if (c == color[j]) return false;
    }
    return true;
}
bool check(int mid) {
    // è®°å¾—æ¯ä¸€æ¬¡éƒ½éœ€è¦è¿›è¡Œåˆå§‹åŒ–
    memset(color, 0, sizeof color);
    // éå†æ¯ä¸ªç‚¹
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœå½“å‰ç‚¹æ²¡æœ‰è¢«æŸ“è‰²å¹¶ä¸”ç»™å½“å‰ç‚¹è¿›è¡ŒæŸ“è‰²ä¸å¯èƒ½æˆåŠŸ, åˆ™è¿”å›false
        if (!color[i] && !dfs(i, 1, mid)) return false;
    return true;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        add(b, a, c);
    }
    int l = 0, r = 1e9;
    while (l < r) {
        int mid = l + r >> 1;
        if (check(mid)) r = mid;
        else l = mid + 1;
    }
    cout << r << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(log(1e9)*(n + m))$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æŸ“è‰²æ³•åˆ¤æ–­äºŒåˆ†å›¾`ã€`äºŒåˆ†`

**ç¼åˆæ€ª**



### åŒˆç‰™åˆ©ç®—æ³•

#### åŸç†

>   1.   æ­¥éª¤å’ŒåŸç†åœ¨ [AcWing 861. äºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…](#AcWing 861. äºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…) çš„æ‰‹å†™ç¨¿

#### [AcWing 861. äºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…](https://www.acwing.com/problem/content/863/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªäºŒåˆ†å›¾ï¼Œå…¶ä¸­å·¦åŠéƒ¨åŒ…å« $n_1$ ä¸ªç‚¹ï¼ˆç¼–å· $1 âˆ¼ n_1$ï¼‰ï¼Œå³åŠéƒ¨åŒ…å« $n_2$ ä¸ªç‚¹ï¼ˆç¼–å· $1 âˆ¼ n_2$ï¼‰ï¼ŒäºŒåˆ†å›¾å…±åŒ…å« `m` æ¡è¾¹ã€‚
>
>   æ•°æ®ä¿è¯ä»»æ„ä¸€æ¡è¾¹çš„ä¸¤ä¸ªç«¯ç‚¹éƒ½ä¸å¯èƒ½åœ¨åŒä¸€éƒ¨åˆ†ä¸­ã€‚
>
>   è¯·ä½ æ±‚å‡ºäºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…æ•°ã€‚
>
>   >   äºŒåˆ†å›¾çš„åŒ¹é…ï¼šç»™å®šä¸€ä¸ªäºŒåˆ†å›¾ `G`ï¼Œåœ¨ `G` çš„ä¸€ä¸ªå­å›¾ `M` ä¸­ï¼Œ`M` çš„è¾¹é›† `{E}` ä¸­çš„ä»»æ„ä¸¤æ¡è¾¹éƒ½ä¸ä¾é™„äºåŒä¸€ä¸ªé¡¶ç‚¹ï¼Œåˆ™ç§° `M` æ˜¯ä¸€ä¸ªåŒ¹é…ã€‚
>   >
>   >   äºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…ï¼šæ‰€æœ‰åŒ¹é…ä¸­åŒ…å«è¾¹æ•°æœ€å¤šçš„ä¸€ç»„åŒ¹é…è¢«ç§°ä¸ºäºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…ï¼Œå…¶è¾¹æ•°å³ä¸ºæœ€å¤§åŒ¹é…æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° $n_1ã€ n_2$ å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `u` å’Œ `v`ï¼Œè¡¨ç¤ºå·¦åŠéƒ¨ç‚¹é›†ä¸­çš„ç‚¹ `u` å’Œå³åŠéƒ¨ç‚¹é›†ä¸­çš„ç‚¹ `v` ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºäºŒåˆ†å›¾çš„æœ€å¤§åŒ¹é…æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n_1, n_2 â‰¤ 500,$
>   +   $1 â‰¤ u â‰¤ n_1,$
>   +   $1 â‰¤ v â‰¤ n_2,$
>   +   $1 â‰¤ m â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
2 2 4
1 1
1 2
2 1
2 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
```

**æ‰‹å†™ç¨¿**

>   1.   é¢˜è§£
>
>        ![4182143](img/4182143.png)
>
>   2.   è¡¥å……
>
>        ![641346](img/641346.png)
>

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 510, M = 100010;
int n1, n2, m, idx;
int h[N], e[M], ne[M], match[N], st[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
// stæ•°ç»„ä¿è¯åœ¨æ¯å±€çš„åŒ¹é…ä¸­æ¯ä¸ªå§‘å¨˜åªä¼šè¢«éå†ä¸€æ¬¡
bool dfs(int u) {
    for (int i = h[u]; i != -1; i = ne[i]) {
        int j = e[i];
        // å¦‚æœå½“å‰å§‘å¨˜åœ¨æœ¬å±€å½“ä¸­è¿˜æ²¡æœ‰è¢«è®¿é—®è¿‡, åˆ™è®¿é—®
        if (!st[j]) {
            // æ ‡è®°ä¸ºå·²ç»è®¿é—®è¿‡
            st[j] = true;
            // å¦‚æœæ²¡æœ‰åŒ¹é…æˆ–è€…å½“å‰å§‘å¨˜çš„ç”·æœ‹å‹å¯ä»¥æ‰¾åˆ°å…¶ä»–çš„å¥³å­©å­, åˆ™çš†å¤§æ¬¢å–œ
            if (!match[j] || dfs(match[j])) {
                match[j] = u;
                return true;
            }
        }
    }
    return false;
}
int main() {
    memset(h, -1, sizeof h);
    scanf("%d%d%d", &n1, &n2, &m);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
    }
    int res = 0;
    for (int i = 1; i <= n1; i ++ ) {
        // stæ•°ç»„ä¿è¯åœ¨æ¯å±€çš„åŒ¹é…ä¸­æ¯ä¸ªå§‘å¨˜åªä¼šè¢«éå†ä¸€æ¬¡
        // æ¯æ¬¡æ–°å¼€ä¸€å±€éƒ½éœ€è¦é‡æ–°åˆå§‹åŒ–
        // åŸå› : å‡è®¾å½“å‰ç”·å­©Aå’Œå¥³å­©Gä¸åˆé€‚, é‚£ä½ èƒ½ç¡®å®šä¸‹ä¸€ä¸ªç”·å­©å’Œå¥³å­©Gä¸åˆé€‚??
        // å‡­å•¥ç”·å­©Aè®¿é—®è¿‡å¥³å­©Gä¹‹å, å°±ä¸è®©ä¸‹ä¸€ä¸ªç”·å­©è®¿é—®äº†???
        // è¿˜æœ‰ç‹æ³•å—???è¿˜æœ‰æ³•å¾‹å—???
        memset(st, false, sizeof st);
        if (dfs(i)) res ++;
    }
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n_1m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`åŒˆç‰™åˆ©ç®—æ³•`ã€`äºŒåˆ†å›¾åŒ¹é…`

**ç¼åˆæ€ª**



#### [AcWing 372. æ£‹ç›˜è¦†ç›–](https://www.acwing.com/problem/content/374/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `N` è¡Œ `N` åˆ—çš„æ£‹ç›˜ï¼Œå·²çŸ¥æŸäº›æ ¼å­ç¦æ­¢æ”¾ç½®ã€‚
>
>   æ±‚æœ€å¤šèƒ½å¾€æ£‹ç›˜ä¸Šæ”¾å¤šå°‘å—çš„é•¿åº¦ä¸º `2`ã€å®½åº¦ä¸º `1` çš„éª¨ç‰Œï¼Œéª¨ç‰Œçš„è¾¹ç•Œä¸æ ¼çº¿é‡åˆï¼ˆéª¨ç‰Œå ç”¨ä¸¤ä¸ªæ ¼å­ï¼‰ï¼Œå¹¶ä¸”ä»»æ„ä¸¤å¼ éª¨ç‰Œéƒ½ä¸é‡å ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `t`ï¼Œå…¶ä¸­ `t` ä¸ºç¦æ­¢æ”¾ç½®çš„æ ¼å­çš„æ•°é‡ã€‚
>
>   æ¥ä¸‹æ¥ `t` è¡Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `x` å’Œ `y`ï¼Œè¡¨ç¤ºä½äºç¬¬ `x` è¡Œç¬¬ `y` åˆ—çš„æ ¼å­ç¦æ­¢æ”¾ç½®ï¼Œè¡Œåˆ—æ•°ä» `1` å¼€å§‹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºç»“æœã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤100,$
>   +   $0â‰¤tâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
8 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
32
```

**æ‰‹å†™ç¨¿**

![5291244](img/5291244.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 110;
int n, m;
int dx[4] = {1, 0, -1, 0}, dy[4] = {0, 1, 0, -1};
int g[N][N], st[N][N];
PII match[N][N];
bool dfs(int x, int y) {
    for (int i = 0; i < 4; i ++ ) {
        int tx = x + dx[i];
        int ty = y + dy[i];
        // è¶Šç•Œæˆ–è€…å½“å‰æ ¼å­æœ‰éšœç¢ç‰©æˆ–è€…å½“å‰æ ¼å­è¢«è®¿é—®è¿‡, åˆ™ç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯
        if (tx < 1 || tx > n || ty < 1 || ty > n || g[tx][ty] || st[tx][ty])
            continue;
        // æ ‡è®°å½“å‰æ ¼å­å·²ç»è¢«è®¿é—®è¿‡
        st[tx][ty] = true;
        PII t = match[tx][ty];
        // å¦‚æœå½“å‰æ ¼å­æ²¡æœ‰è¢«åŒ¹é…æˆ–è€…å½“å‰å¦¹å­èƒ½æ‰¾åˆ°åˆ«çš„å¸…å“¥, åˆ™å¹²å°±å®Œäº†
        if (t.x == -1 || dfs(t.x, t.y)) {
            match[tx][ty] = {x, y};
            return true; // åŒ¹é…æˆåŠŸ
        }
    }
    return false;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < m; i ++ ) {
        int x, y;
        scanf("%d%d", &x, &y);
        g[x][y] = true;
    }
    // åˆå§‹åŒ–ä¸º-1, è¡¨ç¤ºæ²¡æœ‰è¿›è¡ŒåŒ¹é…
    memset(match, -1, sizeof match);
    int res = 0;
    // æšä¸¾æ¯ä¸€ä¸ªç‚¹(i, j), å…¶æ¨ªåæ ‡å’Œçºµåæ ‡åŠ èµ·æ¥ä¸ºå¥‡æ•°çš„æ ¼å­
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= n; j ++ )
            if ((i + j) & 1 && !g[i][j]) {
                // æ¯æ¬¡åŒ¹é…è®°å¾—åˆå§‹åŒ–
                memset(st, 0, sizeof st);
                if (dfs(i, j)) res ++;
            }
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n ^ 2)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`åŒˆç‰™åˆ©ç®—æ³•`ã€`äºŒåˆ†å›¾æ±‚æœ€å¤§åŒ¹é…`

**ç¼åˆæ€ª**



#### [AcWing 376. æœºå™¨ä»»åŠ¡](https://www.acwing.com/problem/content/378/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸¤å°æœºå™¨ `Aï¼ŒB` ä»¥åŠ `K` ä¸ªä»»åŠ¡ã€‚
>
>   æœºå™¨ `A` æœ‰ `N` ç§ä¸åŒçš„æ¨¡å¼ï¼ˆæ¨¡å¼ `0âˆ¼Nâˆ’1`ï¼‰ï¼Œæœºå™¨ `B` æœ‰ `M` ç§ä¸åŒçš„æ¨¡å¼ï¼ˆæ¨¡å¼ `0âˆ¼Mâˆ’1`ï¼‰ã€‚
>
>   **ä¸¤å°æœºå™¨æœ€å¼€å§‹éƒ½å¤„äºæ¨¡å¼ 0ã€‚**
>
>   æ¯ä¸ªä»»åŠ¡æ—¢å¯ä»¥åœ¨ `A` ä¸Šæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ `B` ä¸Šæ‰§è¡Œã€‚
>
>   å¯¹äºæ¯ä¸ªä»»åŠ¡ `i`ï¼Œç»™å®šä¸¤ä¸ªæ•´æ•° `a[i]` å’Œ `b[i]`ï¼Œè¡¨ç¤ºå¦‚æœè¯¥ä»»åŠ¡åœ¨ `A` ä¸Šæ‰§è¡Œï¼Œéœ€è¦è®¾ç½®æ¨¡å¼ä¸º `a[i]`ï¼Œå¦‚æœåœ¨ `B` ä¸Šæ‰§è¡Œï¼Œéœ€è¦æ¨¡å¼ä¸º `b[i]`ã€‚
>
>   ä»»åŠ¡å¯ä»¥ä»¥ä»»æ„é¡ºåºè¢«æ‰§è¡Œï¼Œä½†æ¯å°æœºå™¨è½¬æ¢ä¸€æ¬¡æ¨¡å¼å°±è¦é‡å¯ä¸€æ¬¡ã€‚
>
>   æ±‚æ€æ ·åˆ†é…ä»»åŠ¡å¹¶åˆç†å®‰æ’é¡ºåºï¼Œèƒ½ä½¿æœºå™¨é‡å¯æ¬¡æ•°æœ€å°‘ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚
>
>   æ¯ç»„æ•°æ®ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `N,M,K`ã€‚
>
>   æ¥ä¸‹æ¥ `K` è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•´æ•° `i,a[i]` å’Œ `b[i]`ï¼Œ`i` ä¸ºä»»åŠ¡ç¼–å·ï¼Œä» `0` å¼€å§‹ã€‚
>
>   å½“è¾“å…¥ä¸€è¡Œä¸º `0` æ—¶ï¼Œè¡¨ç¤ºè¾“å…¥ç»ˆæ­¢ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ç»„æ•°æ®è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€éœ€çš„æœºå™¨æœ€å°‘é‡å¯æ¬¡æ•°ï¼Œæ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $N,M<100,K<1000$
>   +   $0â‰¤a[i]<N$
>   +   $0â‰¤b[i]<M$

**è¾“å…¥æ ·ä¾‹**

```c++
5 5 10
0 1 1
1 1 2
2 1 3
3 1 4
4 2 1
5 2 2
6 2 3
7 2 4
8 3 3
9 4 3
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![660847](img/660847.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110;
int n, m, k;
int st[N], match[N];
int g[N][N];
bool dfs(int u) {
    for (int i = 1; i < m; i ++ )
        // å¦‚æœå½“å‰ç‚¹iæ²¡æœ‰è¢«è®¿é—®è¿‡å¹¶ä¸”ä»uåˆ°iæœ‰ä¸€æ¡è¾¹
        if (!st[i] && g[u][i]) {
            st[i] = true;
            if (!match[i] || dfs(match[i])) {
                match[i] = u;
                return true;
            }
        }
    return false;
}
int main() {
    while (scanf("%d%d%d", &n, &m, &k), n) {
        memset(match, 0, sizeof match);
        memset(g, 0, sizeof g);
        for (int i = 0; i < k; i ++ ) {
            int c, a, b;
            scanf("%d%d%d", &c, &a, &b);
            // å¦‚æœå¤„äºæ¨¡å¼0, åˆ™ç›´æ¥è¿”å›, ä¸éœ€è¦ä»»ä½•ä»£ä»·
            if (!a || !b) continue;
            // æ ‡è®°è¾¹
            g[a][b] = true;
        }
        int res = 0;
        for (int i = 1; i < n; i ++ ) {
            // æ¯æ¬¡éƒ½åˆå§‹åŒ–æ•°ç»„
            memset(st, 0, sizeof st);
            // å¦‚æœå½“å‰ç‚¹iå¯ä»¥åŒ¹é…åˆ°å¯¹è±¡, åˆ™åŒ¹é…æ•°é‡ ++
            if (dfs(i)) res ++;
        }
        cout << res << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nVE)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€å°ç‚¹è¦†ç›–`ã€`åŒˆç‰™åˆ©ç®—æ³•`ã€`æœ€å¤§åŒ¹é…æ•°`

**ç¼åˆæ€ª**



#### [AcWing 378. éª‘å£«æ”¾ç½®](https://www.acwing.com/problem/content/380/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `NÃ—M` çš„æ£‹ç›˜ï¼Œæœ‰ä¸€äº›æ ¼å­ç¦æ­¢æ”¾æ£‹å­ã€‚
>
>   é—®æ£‹ç›˜ä¸Šæœ€å¤šèƒ½æ”¾å¤šå°‘ä¸ªä¸èƒ½äº’ç›¸æ”»å‡»çš„éª‘å£«ï¼ˆå›½é™…è±¡æ£‹çš„â€œéª‘å£«â€ï¼Œç±»ä¼¼äºä¸­å›½è±¡æ£‹çš„â€œé©¬â€ï¼ŒæŒ‰ç…§â€œæ—¥â€å­—æ”»å‡»ï¼Œä½†æ²¡æœ‰ä¸­å›½è±¡æ£‹â€œåˆ«é©¬è…¿â€çš„è§„åˆ™ï¼‰ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `N,M,T`ï¼Œå…¶ä¸­ `T` è¡¨ç¤ºç¦æ­¢æ”¾ç½®çš„æ ¼å­çš„æ•°é‡ã€‚
>
>   æ¥ä¸‹æ¥ `T` è¡Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `x` å’Œ `y`ï¼Œè¡¨ç¤ºä½äºç¬¬ `x` è¡Œç¬¬ `y` åˆ—çš„æ ¼å­ç¦æ­¢æ”¾ç½®ï¼Œè¡Œåˆ—æ•°ä» `1` å¼€å§‹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç»“æœã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤N,Mâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
2 3 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
```

**æ‰‹å†™ç¨¿**

![661056](img/661056.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#define x first
#define y second
using namespace std;
typedef pair<int, int> PII;
const int N = 110;
int n, m, k;
int dx[] = {-2, -1, 1, 2, 2, 1, -1, -2};
int dy[] = {1, 2, 2, 1, -1, -2, -2, -1};
PII match[N][N];
int g[N][N], st[N][N];
bool dfs(int x, int y) {
    // éå†8ä¸ªæ–¹å‘
    for (int i = 0; i < 8; i ++ ) {
        int tx = x + dx[i];
        int ty = y + dy[i];
        // å¦‚æœè¶Šç•Œæˆ–è€…å½“å‰æ ¼å­æ˜¯åæ ¼å­æˆ–è€…å½“å‰æ ¼å­å·²è¢«è®¿é—®è¿‡, åˆ™continue;
        if (tx < 1 || tx > n || ty < 1 || ty > m || g[tx][ty] || st[tx][ty]) continue;
        // æ ‡è®°å½“å‰æ ¼å­å·²è¢«è®¿é—®è¿‡
        st[tx][ty] = true;
        PII t = match[tx][ty];
        // å¦‚æœç‚¹(tx, ty)æ²¡è¢«è®¿é—®è¿‡æˆ–è€…å…¶è¢«è®¿é—®è¿‡ä½†æ˜¯å…¶èƒ½å¤Ÿæ‰¾åˆ°å¤‡èƒ
        if (t.x == 0 || dfs(t.x, t.y)) {
            // æ ‡è®°
            match[tx][ty] = {x, y};
            return true;
        }
    }
    return false;
}
int main() {
    scanf("%d%d%d", &n, &m, &k);
    for (int i = 0; i < k; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        // æ ‡è®°åæ ¼å­
        g[a][b] = 1;
    }
    int res = 0;
    // æšä¸¾æ‰€æœ‰åæ ‡å’Œx + yä¸ºå¶æ•°çš„æ ¼å­
    for (int i = 1; i <= n; i ++ ) {
        for (int j = 1; j <= m; j ++ ) {
            // å¦‚æœåæ ‡å’Œä¸ºå¥‡æ•°æˆ–è€…å½“å‰æ ¼å­æ˜¯åæ ¼å­, åˆ™continue;
            if ((i + j) & 1 || g[i][j]) continue;
            // åˆå§‹åŒ–stæ•°ç»„
            memset(st, 0, sizeof st);
            // å¦‚æœç‚¹(i, j)å¯ä»¥æˆåŠŸæ‰¾åˆ°å¯¹è±¡, åˆ™åŒ¹é…æ•° ++
            if (dfs(i, j)) res ++;
        }
    }
    // æ€»ç‚¹æ•° - åç‚¹ - æœ€å°ç‚¹è¦†ç›–æ•°
    cout << n * m - k - res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^2VE)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€å¤§ç‹¬ç«‹é›†`ã€`äºŒåˆ†å›¾`ã€`åŒˆç‰™åˆ©ç®—æ³•`

**ç¼åˆæ€ª**



#### [AcWing 379. æ‰è¿·è—](https://www.acwing.com/problem/content/381/)

**é¢˜ç›®æè¿°**

>   `Vani` å’Œ `cl2` åœ¨ä¸€ç‰‡æ ‘æ—é‡Œæ‰è¿·è—ã€‚
>
>   è¿™ç‰‡æ ‘æ—é‡Œæœ‰ `N` åº§æˆ¿å­ï¼Œ`M` æ¡æœ‰å‘é“è·¯ï¼Œç»„æˆäº†ä¸€å¼ æœ‰å‘æ— ç¯å›¾ã€‚
>
>   æ ‘æ—é‡Œçš„æ ‘éå¸¸èŒ‚å¯†ï¼Œè¶³ä»¥é®æŒ¡è§†çº¿ï¼Œä½†æ˜¯æ²¿ç€é“è·¯æœ›å»ï¼Œå´æ˜¯è§†é‡å¼€é˜”ã€‚
>
>   å¦‚æœä»æˆ¿å­ `A` æ²¿ç€è·¯èµ°ä¸‹å»èƒ½å¤Ÿåˆ°è¾¾ `B`ï¼Œé‚£ä¹ˆåœ¨ `A` å’Œ `B` é‡Œçš„äººæ˜¯èƒ½å¤Ÿç›¸äº’æœ›è§çš„ã€‚
>
>   ç°åœ¨ `cl2` è¦åœ¨è¿™ `N` åº§æˆ¿å­é‡Œé€‰æ‹© `K` åº§ä½œä¸ºè—èº«ç‚¹ï¼ŒåŒæ—¶ `Vani` ä¹Ÿä¸“æŒ‘ `cl2` ä½œä¸ºè—èº«ç‚¹çš„æˆ¿å­è¿›å»å¯»æ‰¾ï¼Œä¸ºäº†é¿å…è¢« `Vani` çœ‹è§ï¼Œ`cl2` è¦æ±‚è¿™ `K` ä¸ªè—èº«ç‚¹çš„ä»»æ„ä¸¤ä¸ªä¹‹é—´éƒ½æ²¡æœ‰è·¯å¾„ç›¸è¿ã€‚
>
>   ä¸ºäº†è®© `Vani` æ›´éš¾æ‰¾åˆ°è‡ªå·±ï¼Œ`cl2` æƒ³çŸ¥é“æœ€å¤šèƒ½é€‰å‡ºå¤šå°‘ä¸ªè—èº«ç‚¹ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ•°æ®çš„ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° `x,y`ï¼Œè¡¨ç¤ºä¸€æ¡ä» `x` åˆ° `y` çš„æœ‰å‘é“è·¯ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœ€å¤šèƒ½é€‰å–çš„è—èº«ç‚¹ä¸ªæ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤200,Mâ‰¤30000$

**è¾“å…¥æ ·ä¾‹**

```c++
7 5
1 2
3 2
2 4
4 5
4 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![681150](img/681150.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 210;
int n, m;
int st[N], match[N];
int g[N][N];
// åŒˆç‰™åˆ©ç®—æ³•æ¨¡æ¿
bool dfs(int u) {
    for (int i = 1; i <= n; i ++ )
        if (g[u][i] && !st[i]) {
            st[i] = true;
            if (!match[i] || dfs(match[i])) {
                match[i] = u;
                return true;
            }
        }
    return false;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        // æœ‰å‘è¾¹
        g[a][b] = true;
    }
    // ä¼ é€’é—­åŒ…
    for (int k = 1; k <= n; k ++ )
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= n; j ++ )
                // æ˜¯|=è€Œä¸æ˜¯=
                g[i][j] |= g[i][k] && g[k][j];
    int res = 0;
    for (int i = 1; i <= n; i ++ ) {
        memset(st, 0, sizeof st);
        if (dfs(i)) res ++;
    }
    // æœ€å°é‡å¤ç‚¹è¦†ç›–å…¬å¼
    cout << n - res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nVE)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æœ€å°è·¯å¾„é‡å¤ç‚¹è¦†ç›–`ã€`åŒˆç‰™åˆ©ç®—æ³•`

**ç¼åˆæ€ª**



## æ¬§æ‹‰å›è·¯å’Œæ¬§æ‹‰è·¯å¾„

### åŸç†

![691108](img/691108.png)

### [AcWing 1123. é“²é›ªè½¦](https://www.acwing.com/problem/content/1125/)

**é¢˜ç›®æè¿°**

>   éšç€ç™½å¤©è¶Šæ¥è¶ŠçŸ­å¤œæ™šè¶Šæ¥è¶Šé•¿ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘é“²é›ªé—®é¢˜äº†ã€‚
>
>   æ•´ä¸ªåŸå¸‚æ‰€æœ‰çš„é“è·¯éƒ½æ˜¯åŒå‘è½¦é“,é“è·¯çš„ä¸¤ä¸ªæ–¹å‘å‡éœ€è¦é“²é›ªã€‚å› ä¸ºåŸå¸‚é¢„ç®—çš„å‰Šå‡ï¼Œæ•´ä¸ªåŸå¸‚åªæœ‰ `1` è¾†é“²é›ªè½¦ã€‚
>
>   é“²é›ªè½¦åªèƒ½æŠŠå®ƒå¼€è¿‡çš„åœ°æ–¹ï¼ˆè½¦é“ï¼‰çš„é›ªé“²å¹²å‡€ï¼Œæ— è®ºå“ªå„¿æœ‰é›ªï¼Œé“²é›ªè½¦éƒ½å¾—ä»åœæ”¾çš„åœ°æ–¹å‡ºå‘ï¼Œæ¸¸å†æ•´ä¸ªåŸå¸‚çš„è¡—é“ã€‚
>
>   ç°åœ¨çš„é—®é¢˜æ˜¯ï¼šæœ€å°‘è¦èŠ±å¤šå°‘æ—¶é—´å»é“²æ‰æ‰€æœ‰é“è·¯ä¸Šçš„é›ªå‘¢ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ•°æ®çš„ç¬¬ `1` è¡Œè¡¨ç¤ºé“²é›ªè½¦çš„åœæ”¾åæ ‡ `(x,y)`ï¼Œ`x,y` ä¸ºæ•´æ•°ï¼Œå•ä½ä¸ºç±³ã€‚
>
>   ä¸‹é¢æœ€å¤šæœ‰`4000`è¡Œï¼Œæ¯è¡Œç»™å‡ºäº†ä¸€æ¡è¡—é“çš„èµ·ç‚¹åæ ‡å’Œç»ˆç‚¹åæ ‡ï¼Œåæ ‡å‡ä¸ºæ•´æ•°ï¼Œæ‰€æœ‰è¡—é“éƒ½æ˜¯ç¬”ç›´çš„ï¼Œä¸”éƒ½æ˜¯åŒå‘è½¦é“ã€‚
>
>   é“²é›ªè½¦å¯ä»¥åœ¨ä»»æ„äº¤å‰å£ã€æˆ–ä»»ä½•è¡—é“çš„æœ«å°¾ä»»æ„è½¬å‘ï¼ŒåŒ…æ‹¬è½¬ `U` å‹å¼¯ã€‚
>
>   é“²é›ªè½¦é“²é›ªæ—¶å‰è¿›é€Ÿåº¦ä¸º `2020` åƒç±³/æ—¶ï¼Œä¸é“²é›ªæ—¶å‰è¿›é€Ÿåº¦ä¸º `5050` åƒç±³/æ—¶ã€‚
>
>   ä¿è¯ï¼šé“²é›ªè½¦ä»èµ·ç‚¹ä¸€å®šå¯ä»¥åˆ°è¾¾ä»»ä½•è¡—é“ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºé“²æ‰æ‰€æœ‰è¡—é“ä¸Šçš„é›ªå¹¶ä¸”è¿”å›å‡ºå‘ç‚¹çš„æœ€çŸ­æ—¶é—´ï¼Œç²¾ç¡®åˆ°åˆ†é’Ÿï¼Œå››èˆäº”å…¥åˆ°æ•´æ•°ã€‚
>
>   è¾“å‡ºæ ¼å¼ä¸º`â€hours:minutesâ€`ï¼Œ`minutes`ä¸è¶³ä¸¤ä½æ•°æ—¶éœ€è¦è¡¥å‰å¯¼é›¶ã€‚
>   å…·ä½“æ ¼å¼å‚ç…§æ ·ä¾‹ã€‚

**æ•°æ®èŒƒå›´**

>   +   $âˆ’10^6â‰¤x,yâ‰¤10^6$
>   +   $æ‰€æœ‰ä½ç½®åæ ‡ç»å¯¹å€¼ä¸è¶…è¿‡ 10^6ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
0 0
0 0 10000 10000
5000 -10000 5000 10000
5000 10000 10000 10000
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3:55
```

**æ ·ä¾‹è§£é‡Š**

>   è¾“å‡ºç»“æœè¡¨ç¤ºå…±éœ€`3`å°æ—¶`55`åˆ†é’Ÿã€‚

**æ‰‹å†™ç¨¿**

![691242](img/691242.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
#include <cmath>
using namespace std;
int x, y;
int main() {
    int x1, y1, x2, y2;
    // æ³¨æ„ä½¿ç”¨doubleç±»å‹
    double sum = 0;
    scanf("%d%d", &x, &y);
    while (~scanf("%d%d%d%d", &x1, &y1, &x2, &y2)) {
        // æ³¨æ„ä½¿ç”¨doubleç±»å‹
        double dx = x1 - x2;
        // æ³¨æ„ä½¿ç”¨doubleç±»å‹
        double dy = y1 - y2;
        // è®¡ç®—æ‰€æœ‰è¡—é“æ€»å’Œ
        sum += sqrt(dx * dx + dy * dy) * 2;
    }
    // è®¡ç®—åˆ†é’Ÿæ€»æ•°, å››èˆäº”å…¥(roundå‡½æ•°)
    int minutes = round(sum / 1000 / 20 * 60);
    printf("%d:%02d\n", minutes / 60, minutes % 60);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`æ¬§æ‹‰è·¯å¾„`ã€`æ¬§æ‹‰å›è·¯`

**ç¼åˆæ€ª**



### [AcWing 1184. æ¬§æ‹‰å›è·¯](https://www.acwing.com/problem/content/1186/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€å¼ å›¾ï¼Œè¯·ä½ æ‰¾å‡ºæ¬§æ‹‰å›è·¯ï¼Œå³åœ¨å›¾ä¸­æ‰¾ä¸€ä¸ªç¯ä½¿å¾—æ¯æ¡è¾¹éƒ½åœ¨ç¯ä¸Šå‡ºç°æ°å¥½ä¸€æ¬¡ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `t`ï¼Œ`tâˆˆ{1,2}`ï¼Œå¦‚æœ `t=1`ï¼Œè¡¨ç¤ºæ‰€ç»™å›¾ä¸º**æ— å‘**å›¾ï¼Œå¦‚æœ `t=2`ï¼Œè¡¨ç¤ºæ‰€ç»™å›¾ä¸º**æœ‰å‘**å›¾ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n,m`ï¼Œè¡¨ç¤ºå›¾çš„ç»“ç‚¹æ•°å’Œè¾¹æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œä¸­ï¼Œç¬¬ `i` è¡Œä¸¤ä¸ªæ•´æ•° $v_i,u_i$ï¼Œè¡¨ç¤ºç¬¬ `i` æ¡è¾¹ï¼ˆä» `1` å¼€å§‹ç¼–å·ï¼‰ã€‚
>
>   -   å¦‚æœ `t=1` åˆ™è¡¨ç¤º $v_i$ åˆ° $u_i$ æœ‰ä¸€æ¡æ— å‘è¾¹ã€‚
>   -   å¦‚æœ `t=2` åˆ™è¡¨ç¤º $v_i$ åˆ° $u_i$ æœ‰ä¸€æ¡æœ‰å‘è¾¹ã€‚
>
>   å›¾ä¸­å¯èƒ½æœ‰é‡è¾¹ä¹Ÿå¯èƒ½æœ‰è‡ªç¯ã€‚
>
>   ç‚¹çš„ç¼–å·ä» `1` åˆ° `n`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¦‚æœæ— æ³•ä¸€ç¬”ç”»å‡ºæ¬§æ‹‰å›è·¯ï¼Œåˆ™è¾“å‡ºä¸€è¡Œï¼š`NO`ã€‚
>
>   å¦åˆ™ï¼Œè¾“å‡ºä¸€è¡Œï¼š`YES`ï¼Œæ¥ä¸‹æ¥ä¸€è¡Œè¾“å‡º **ä»»æ„ä¸€ç»„** åˆæ³•æ–¹æ¡ˆå³å¯ã€‚
>
>   -   å¦‚æœ `t=1`ï¼Œè¾“å‡º `m` ä¸ªæ•´æ•° $p_1,p_2,â€¦,p_m$ã€‚ä»¤ $e=|p_i|$ï¼Œé‚£ä¹ˆ `e` è¡¨ç¤ºç»è¿‡çš„ç¬¬ `i` æ¡è¾¹çš„ç¼–å·ã€‚å¦‚æœ $p_i$ ä¸ºæ­£æ•°è¡¨ç¤ºä» $v_e$ èµ°åˆ° $u_e$ï¼Œå¦åˆ™è¡¨ç¤ºä» $u_e$ èµ°åˆ° $v_e$ã€‚
>   -   å¦‚æœ `t=2`ï¼Œè¾“å‡º `m` ä¸ªæ•´æ•° $p_1,p_2,â€¦,p_m$ã€‚å…¶ä¸­ $p_i$ è¡¨ç¤ºç»è¿‡çš„ç¬¬ `i` æ¡è¾¹çš„ç¼–å·ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10^5,$
>   +   $0â‰¤mâ‰¤2Ã—10^5$

**è¾“å…¥æ ·ä¾‹1**

```c++
1
3 3
1 2
2 3
1 3
```

**è¾“å‡ºæ ·ä¾‹1**

```c++
YES
1 2 -3
```

**è¾“å…¥æ ·ä¾‹2**

```c++
2
5 6
2 3
2 5
3 4
1 2
4 2
5 1
```

**è¾“å‡ºæ ·ä¾‹2**

```c++
YES
4 1 3 5 2 6
```

**æ‰‹å†™ç¨¿**

![6120817](img/6120817.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010, M = 400010;
int type, n, m, idx, cnt;
int h[N], e[M], ne[M], din[N], dout[N], ans[M], st[M];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void dfs(int u) {
    // éå†ã€æ¯æ¡è¾¹ã€‘, æ³¨æ„: i = h[u]ä¸æ˜¯i = ne[i], åŸå› : [æ‰‹å†™ç¨¿]
    for (int i = h[u]; i != -1; i = h[u]) {
        // å¦‚æœã€å½“å‰è¾¹ã€‘å·²ç»è¢«è®¿é—®è¿‡, åˆ™ã€åˆ é™¤ã€‘æ­¤æ¡è¾¹, åŸå› : [æ‰‹å†™ç¨¿]
        if (st[i]) {
            // åˆ é™¤å½“å‰è¾¹
            h[u] = ne[i];
            continue;
        }
        // æ ‡è®°ã€å½“å‰è¾¹ã€‘å·²ç»è¢«è®¿é—®è¿‡
        // å·²ç»åˆ é™¤äº†, ä¸ºå•¥è¿˜è¦æ ‡è®°?
        // åŸå› : é˜²æ­¢åå‘è¾¹,a - bå¯ä»¥åˆ†æˆa -> bå’Œb -> aå®é™…ä¸Šä¸¤è€…æ˜¯åŒä¸€æ¡è¾¹
        st[i] = true;
        // æ— å‘å›¾, åˆ™æ ‡è®°å¦å¤–ä¸€æ¡è¾¹i ^ 1, åŸå› : [æ‰‹å†™ç¨¿]
        if (type == 1) st[i ^ 1] = true;
        int t;
        // æ— å‘å›¾, åˆ™æ‰¾åˆ°å½“å‰è¾¹çš„ç¼–å·, å…¬å¼: [æ‰‹å†™ç¨¿]
        if (type == 1) {
            t = i / 2 + 1;
            // å¦‚æœæ˜¯å¥‡æ•°, åˆ™åå‘
            if (i & 1) t = -t;
        }
        // å…¬å¼: [æ‰‹å†™ç¨¿]
        else t = i + 1;
        // ç‚¹
        int j = e[i];
        // åˆ é™¤ã€å½“å‰è¾¹ã€‘
        h[u] = ne[i];
        // éå†ã€å½“å‰ç‚¹ã€‘
        dfs(j);
        // å°†ã€å½“å‰è¾¹ã€‘çš„ç¼–å·åŠ å…¥åˆ°ç­”æ¡ˆ
        ans[++ cnt] = t;
    }
    return;
}
int main() {
    scanf("%d%d%d", &type, &n, &m);
    memset(h, -1, sizeof h);
    // éå†æ¯æ¡è¾¹
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
        // æ— å‘å›¾, åˆ™æ·»åŠ åå‘è¾¹
        if (type == 1) add(b, a);
        // è®°å½•å…¥åº¦å’Œå‡ºåº¦
        // å¯¹äºæ— å‘å›¾ä¹Ÿé€‚ç”¨[æ‰‹å†™ç¨¿è¯´æ˜]
        din[b] ++, dout[a] ++;
    }
    if (type == 1) { // æ— å‘å›¾
        // éå†æ¯ä¸ªç‚¹
        for (int i = 1; i <= n; i ++ )
            // å…¬å¼
            if (din[i] + dout[i] & 1) {
                puts("NO");
                return 0;
            }
    }
    else { // æœ‰å‘å›¾
        // éå†æ¯ä¸ªç‚¹
        for (int i = 1; i <= n; i ++ )
            // å…¬å¼
            if (din[i] != dout[i]) {
                puts("NO");
                return 0;
            }
    }
    // éå†æ¯ä¸ªç‚¹
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœå½“å‰ç‚¹æœ‰è¾¹, åˆ™éå†ä»å½“å‰ç‚¹å¼€å§‹èƒ½åˆ°è¾¾çš„æ‰€æœ‰è¾¹
        if (h[i] != -1) {
            dfs(i);
            // è·³å‡ºå¾ªç¯å³å¯, åŸå› : ä¸€ç¬”ç”»é—®é¢˜, å¦‚æœå‡ºç°å­¤ç«‹ç‚¹, ä¸æ»¡è¶³ä¸€ç¬”ç”»
            break;
        }
    // å¦‚æœè¾¹æ•°ä¸è¶³mæ¡
    if (cnt < m) {
        puts("NO");
        return 0;
    }
    puts("YES");
    // å€’åºè¾“å‡ºç­”æ¡ˆ
    for (int i = cnt; i; i -- ) printf("%d ", ans[i]);
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ¬§æ‹‰å›è·¯`

**ç¼åˆæ€ª**



### [AcWing 1124. éª‘é©¬ä¿®æ …æ ](https://www.acwing.com/problem/content/1126/)

**é¢˜ç›®æè¿°**

>   å†œæ°‘`John`æ¯å¹´æœ‰å¾ˆå¤šæ …æ è¦ä¿®ç†ã€‚
>
>   ä»–æ€»æ˜¯éª‘ç€é©¬ç©¿è¿‡æ¯ä¸€ä¸ªæ …æ å¹¶ä¿®å¤å®ƒç ´æŸçš„åœ°æ–¹ã€‚
>
>   `John`æ˜¯ä¸€ä¸ªä¸å…¶ä»–å†œæ°‘ä¸€æ ·æ‡’çš„äººã€‚
>
>   ä»–è®¨åŒéª‘é©¬ï¼Œå› æ­¤ä»æ¥ä¸ä¸¤æ¬¡ç»è¿‡ä¸€ä¸ªæ …æ ã€‚
>
>   ä½ å¿…é¡»ç¼–ä¸€ä¸ªç¨‹åºï¼Œè¯»å…¥æ …æ ç½‘ç»œçš„æè¿°ï¼Œå¹¶è®¡ç®—å‡ºä¸€æ¡ä¿®æ …æ çš„è·¯å¾„ï¼Œä½¿æ¯ä¸ªæ …æ éƒ½æ°å¥½è¢«ç»è¿‡ä¸€æ¬¡ã€‚
>
>   `John`èƒ½ä»ä»»ä½•ä¸€ä¸ªé¡¶ç‚¹(å³ä¸¤ä¸ªæ …æ çš„äº¤ç‚¹)å¼€å§‹éª‘é©¬ï¼Œåœ¨ä»»æ„ä¸€ä¸ªé¡¶ç‚¹ç»“æŸã€‚
>
>   æ¯ä¸€ä¸ªæ …æ è¿æ¥ä¸¤ä¸ªé¡¶ç‚¹ï¼Œé¡¶ç‚¹ç”¨ `1` åˆ° `500` æ ‡å·(è™½ç„¶æœ‰çš„å†œåœºå¹¶æ²¡æœ‰ `500` ä¸ªé¡¶ç‚¹)ã€‚
>
>   ä¸€ä¸ªé¡¶ç‚¹ä¸Šå¯è¿æ¥ä»»æ„å¤š( `â‰¥1` )ä¸ªæ …æ ã€‚
>
>   æ‰€æœ‰æ …æ éƒ½æ˜¯è¿é€šçš„(ä¹Ÿå°±æ˜¯ä½ å¯ä»¥ä»ä»»æ„ä¸€ä¸ªæ …æ åˆ°è¾¾å¦å¤–çš„æ‰€æœ‰æ …æ )ã€‚
>
>   ä½ çš„ç¨‹åºå¿…é¡»è¾“å‡ºéª‘é©¬çš„è·¯å¾„(ç”¨è·¯ä¸Šä¾æ¬¡ç»è¿‡çš„é¡¶ç‚¹å·ç è¡¨ç¤º)ã€‚
>
>   æˆ‘ä»¬å¦‚æœæŠŠè¾“å‡ºçš„è·¯å¾„çœ‹æˆæ˜¯ä¸€ä¸ª`500`è¿›åˆ¶çš„æ•°ï¼Œé‚£ä¹ˆå½“å­˜åœ¨å¤šç»„è§£çš„æƒ…å†µä¸‹ï¼Œè¾“å‡º`500`è¿›åˆ¶è¡¨ç¤ºæ³•ä¸­æœ€å°çš„ä¸€ä¸ª (ä¹Ÿå°±æ˜¯è¾“å‡ºç¬¬ä¸€ä¸ªæ•°è¾ƒå°çš„ï¼Œå¦‚æœè¿˜æœ‰å¤šç»„è§£ï¼Œè¾“å‡ºç¬¬äºŒä¸ªæ•°è¾ƒå°çš„ï¼Œç­‰ç­‰)ã€‚
>
>   è¾“å…¥æ•°æ®ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªè§£ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œ:ä¸€ä¸ªæ•´æ•° `F`ï¼Œè¡¨ç¤ºæ …æ çš„æ•°ç›®;
>
>   ç¬¬ `2` åˆ° `F+1` è¡Œ:æ¯è¡Œä¸¤ä¸ªæ•´æ•° `i,j` è¡¨ç¤ºè¿™æ¡æ …æ è¿æ¥ `i` ä¸ `j` å·é¡¶ç‚¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºåº”å½“æœ‰ `F+1` è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæ•´æ•°ï¼Œä¾æ¬¡è¡¨ç¤ºè·¯å¾„ç»è¿‡çš„é¡¶ç‚¹å·ã€‚
>
>   æ³¨æ„æ•°æ®å¯èƒ½æœ‰å¤šç»„è§£ï¼Œä½†æ˜¯åªæœ‰ä¸Šé¢é¢˜ç›®è¦æ±‚çš„é‚£ä¸€ç»„è§£æ˜¯è®¤ä¸ºæ­£ç¡®çš„ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Fâ‰¤1024,$
>   +   $1â‰¤i,jâ‰¤500$

**è¾“å…¥æ ·ä¾‹**

```c++
9
1 2
2 3
3 4
4 2
4 5
2 5
5 6
5 7
4 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
2
3
4
2
5
4
6
5
7
```

**æ‰‹å†™ç¨¿**

![6130906](img/6130906.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 510, M = 1100;
int n = 500, m, cnt;
int d[N], ans[M];
int g[N][N];
void dfs(int u) {
    // éå†æ‰€æœ‰ç‚¹
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœuåˆ°iæœ‰æ¡è¾¹
        if (g[u][i]) {
            // å¹²æ‰åå‘è¾¹, ä¸¤ä¸ªæ–¹å‘
            g[u][i] --, g[i][u] --;
            // é€’å½’
            dfs(i);
        }
    // åŠ å…¥ç­”æ¡ˆ
    ans[++ cnt] = u;
    return;
}
int main() {
    scanf("%d", &m);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        // æ ‡è®°æ— å‘è¾¹ a -> bå’Œb -> a
        g[a][b] ++, g[b][a] ++;
        // açš„åº¦æ•° ++, bçš„åº¦æ•° ++
        d[a] ++, d[b] ++;
    }
    // å–æœ€å¤§å€¼
    int start = 1e9;
    // éå†æ‰€æœ‰ç‚¹
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœè¯¥ç‚¹å­˜åœ¨
        if (d[i]) {
            // å¦‚æœåº¦æ•°ä¸ºå¥‡æ•°
            if (d[i] & 1) {
                // æ ‡è®°èµ·ç‚¹
                start = i;
                // é€€å‡ºå¾ªç¯
                break;
            }
            // å¦‚æœåº¦æ•°ä¸ºå¶æ•°, å–æœ€å°å€¼
            else start = min(start, i);
        }
    // ä»èµ·ç‚¹å¼€å§‹æœ, æ•°æ®ä¿è¯ä¸€å®šæœ‰è§£
    dfs(start);
    // é€†åºè¾“å‡º
    for (int i = cnt; i; i -- ) cout << ans[i] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æ¬§æ‹‰è·¯å¾„`

**ç¼åˆæ€ª**



### [AcWing 1185. å•è¯æ¸¸æˆ](https://www.acwing.com/problem/content/1187/)

**é¢˜ç›®æè¿°**

>   æœ‰ `N` ä¸ªç›˜å­ï¼Œæ¯ä¸ªç›˜å­ä¸Šå†™ç€ä¸€ä¸ªä»…ç”±å°å†™å­—æ¯ç»„æˆçš„è‹±æ–‡å•è¯ã€‚
>
>   ä½ éœ€è¦ç»™è¿™äº›ç›˜å­å®‰æ’ä¸€ä¸ªåˆé€‚çš„é¡ºåºï¼Œä½¿å¾—ç›¸é‚»ä¸¤ä¸ªç›˜å­ä¸­ï¼Œå‰ä¸€ä¸ªç›˜å­ä¸Šå•è¯çš„æœ«å­—æ¯ç­‰äºåä¸€ä¸ªç›˜å­ä¸Šå•è¯çš„é¦–å­—æ¯ã€‚
>
>   è¯·ä½ ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œåˆ¤æ–­æ˜¯å¦èƒ½è¾¾åˆ°è¿™ä¸€è¦æ±‚ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `T`ï¼Œè¡¨ç¤ºå…±æœ‰ `T` ç»„æµ‹è¯•æ•°æ®ã€‚
>
>   æ¯ç»„æ•°æ®ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `N`ï¼Œè¡¨ç¤ºç›˜å­æ•°é‡ã€‚
>
>   æ¥ä¸‹æ¥ `N` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªå°å†™å­—æ¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºä¸€ä¸ªç›˜å­ä¸Šçš„å•è¯ã€‚
>
>   ä¸€ä¸ªå•è¯å¯èƒ½å‡ºç°å¤šæ¬¡ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¦‚æœå­˜åœ¨åˆæ³•è§£ï¼Œåˆ™è¾“å‡º`â€Ordering is possible.â€`ï¼Œå¦åˆ™è¾“å‡º`â€The door cannot be opened.â€`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Nâ‰¤10^5,$
>   +   $å•è¯é•¿åº¦å‡ä¸è¶…è¿‡1000$

**è¾“å…¥æ ·ä¾‹**

```c++
3
2
acm
ibm
3
acm
malform
mouse
2
ok
ok
```

**è¾“å‡ºæ ·ä¾‹**

```c++
The door cannot be opened.
Ordering is possible.
The door cannot be opened.
```

**æ‰‹å†™ç¨¿**

![6131017](img/6131017.png)

**ä»£ç **

```c++
#include<iostream>
#include <cstring>
using namespace std;
const int N = 30, K = 1010;
int n, T;
int din[N], dout[N], p[N], st[N];
int find(int x) {
    if (p[x] == x) return p[x];
    return p[x] = find(p[x]);
}
int main() {
    char str[K];
    scanf("%d", &T);
    // Tç»„æµ‹è¯•æ•°æ®
    while (T -- ) {
        // é‡ç½®
        memset(din, 0, sizeof din);
        memset(dout, 0, sizeof dout);
        memset(st, 0, sizeof st);
        // åˆå§‹åŒ–å¹¶æŸ¥é›†æ•°ç»„
        for (int i = 0; i < 26; i ++ ) p[i] = i;
        scanf("%d", &n);
        for (int i = 0; i < n; i ++ ) {
            scanf("%s", str);
            int len = strlen(str);
            int a = str[0] - 'a', b = str[len - 1] - 'a';
            // æ ‡è®°å½“å‰å­—æ¯å·²è¢«ä½¿ç”¨è¿‡
            st[a] = st[b] = true;
            // ç»Ÿè®¡å…¥åº¦å’Œå‡ºåº¦
            dout[a] ++, din[b] ++;
            int pa = find(a);
            int pb = find(b);
            // åˆå¹¶
            if (pa != pb) p[pb] = pa;
        }
        int start = 0, end = 0, succeed = true;
        for (int i = 0; i < 26; i ++ ) {
            // å¦‚æœåº¦æ•°ä¸ç›¸ç­‰
            if (din[i] != dout[i]) {
                if (din[i] + 1 == dout[i]) start ++;
                else if (dout[i] + 1 == din[i]) end ++;
                else {
                    succeed = false;
                    break;
                }
            }
        }
        int cnt = 0;
        for (int i = 0; i < 26; i ++ )
            // å¦‚æœå½“å‰ç‚¹å·²è¢«ç”¨è¿‡å¹¶ç»Ÿè®¡è¿é€šå—ä¸ªæ•°
            if (st[i] && p[i] == i) cnt ++;
        // å¦‚æœè¿é€šå—ä¸ªæ•°å¤§äº1, è¯´æ˜ä¸æˆåŠŸ
        if (cnt > 1) succeed = false;
        if (succeed) puts("Ordering is possible.");
        else puts("The door cannot be opened.");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ¬§æ‹‰å›è·¯`ã€`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



## æ‹“æ‰‘æ’åº

### [U107394. æ‹“æ‰‘æ’åºæ¨¡æ¿](https://www.luogu.com.cn/problem/U107394)

**é¢˜ç›®æè¿°**

>   æœ‰å‘æ— ç¯å›¾ä¸Šæœ‰ `n` ä¸ªç‚¹ï¼Œ`m` æ¡è¾¹ã€‚æ±‚è¿™å¼ å›¾å­—å…¸åºæœ€å°çš„æ‹“æ‰‘æ’åºçš„ç»“æœã€‚å­—å…¸åºæœ€å°æŒ‡å¸Œæœ›æ’å¥½åºçš„ç»“æœä¸­ï¼Œæ¯”è¾ƒé å‰çš„æ•°å­—å°½å¯èƒ½å°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ç”¨ç©ºæ ¼éš”å¼€çš„ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ï¼Œè¡¨ç¤º `n` ä¸ªç‚¹å’Œ `m` æ¡è¾¹ã€‚
>
>   æ¥ä¸‹æ¥æ˜¯ `m` è¡Œï¼Œæ¯è¡Œç”¨ç©ºæ ¼éš”å¼€çš„ä¸¤ä¸ªæ•° `u` å’Œ `v`ï¼Œè¡¨ç¤ºæœ‰ä¸€æ¡ä» `u` åˆ° `v` çš„è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€è¡Œï¼Œæ‹“æ‰‘æ’åºçš„ç»“æœï¼Œæ•°å­—ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€

**è¾“å…¥æ ·ä¾‹**

```c++
5 3
1 2
2 4
4 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 2 4 3 5
```

**è¯´æ˜/æç¤º**

>   +   $1 \leq n,m \leq 10^5$
>
>   +   $æ³¨æ„ï¼šå›¾ä¸Šå¯èƒ½æœ‰é‡è¾¹$

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



### [LeetCode 207. è¯¾ç¨‹è¡¨](https://leetcode-cn.com/problems/course-schedule/)

**é¢˜ç›®æè¿°**

>   ä½ è¿™ä¸ªå­¦æœŸå¿…é¡»é€‰ä¿® `numCourses` é—¨è¯¾ç¨‹ï¼Œè®°ä¸º `0` åˆ° `numCourses - 1` ã€‚
>
>   åœ¨é€‰ä¿®æŸäº›è¯¾ç¨‹ä¹‹å‰éœ€è¦ä¸€äº›å…ˆä¿®è¯¾ç¨‹ã€‚ å…ˆä¿®è¯¾ç¨‹æŒ‰æ•°ç»„ `prerequisites` ç»™å‡ºï¼Œå…¶ä¸­ $prerequisites[i] = [a_i, b_i]$ ï¼Œè¡¨ç¤ºå¦‚æœè¦å­¦ä¹ è¯¾ç¨‹ $a_i$ åˆ™ å¿…é¡» å…ˆå­¦ä¹ è¯¾ç¨‹  $b_i$ ã€‚
>
>   ä¾‹å¦‚ï¼Œå…ˆä¿®è¯¾ç¨‹å¯¹ `[0, 1]` è¡¨ç¤ºï¼šæƒ³è¦å­¦ä¹ è¯¾ç¨‹ `0` ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ `1` ã€‚
>   è¯·ä½ åˆ¤æ–­æ˜¯å¦å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ ï¼Ÿå¦‚æœå¯ä»¥ï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`numCourses = 2, prerequisites = [[1,0]]`
>   è¾“å‡ºï¼š`true`
>   è§£é‡Šï¼šæ€»å…±æœ‰ `2` é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ `1` ä¹‹å‰ï¼Œä½ éœ€è¦å®Œæˆè¯¾ç¨‹ `0` ã€‚è¿™æ˜¯å¯èƒ½çš„ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`numCourses = 2, prerequisites = [[1,0],[0,1]]`
>   è¾“å‡ºï¼š`false`
>   è§£é‡Šï¼šæ€»å…±æœ‰ `2` é—¨è¯¾ç¨‹ã€‚å­¦ä¹ è¯¾ç¨‹ `1` ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ `0` ï¼›å¹¶ä¸”å­¦ä¹ è¯¾ç¨‹ `0` ä¹‹å‰ï¼Œä½ è¿˜åº”å…ˆå®Œæˆè¯¾ç¨‹ `1` ã€‚è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚

**æç¤º**

>   +   $1 <= numCourses <= 10^5$
>   +   $0 <= prerequisites.length <= 5000$
>   +   $prerequisites[i].length == 2$
>   +   $0 <= a_i, b_i < numCourses$
>   +   $prerequisites[i] ä¸­çš„æ‰€æœ‰è¯¾ç¨‹å¯¹ äº’ä¸ç›¸åŒ$

**æ‰‹å†™ç¨¿**

![4111523](img/4111523.png)

**ä»£ç **

```c++
class Solution {
public:
    bool canFinish(int n, vector<vector<int>>& gc) {
        queue<int> q;
        vector<int> d(n + 5);
        vector<vector<int>> g(n + 5);
        for (int i = 0; i < gc.size(); i ++ ) {
            int a = gc[i][0], b = gc[i][1];
            // å°†bæ’å…¥aä¸­
            g[b].push_back(a);
            // açš„å…¥åº¦++
            d[a] ++;
        }
        for (int i = 0; i < n; i ++ )
            // ç»Ÿè®¡æ‰€æœ‰å…¥åº¦ä¸º0çš„èŠ‚ç‚¹
            if (!d[i]) q.push(i);
        while (q.size()) {
            int t = q.front(); q.pop();
            for (int i = 0; i < g[t].size(); i ++ ) {
                // å…¥åº¦ä¸º0, ç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯
                if (!d[g[t][i]]) continue;
                // å…¥åº¦ --
                d[g[t][i]] --;
                // å¦‚æœåº¦ä¸º0, åˆ™åŠ å…¥é˜Ÿåˆ—
                if (!d[g[t][i]]) q.push(g[t][i]);
            }
        }
        // ç»Ÿè®¡æ‰€æœ‰åº¦ä¸º0çš„èŠ‚ç‚¹
        int res = 0;
        for (int i = 0; i < n; i ++ ) res += (d[i] == 0);
        return res == n;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



### [LeetCode 210. è¯¾ç¨‹è¡¨ II](https://leetcode-cn.com/problems/course-schedule-ii/)

**é¢˜ç›®æè¿°**

>   ç°åœ¨ä½ æ€»å…±æœ‰ `numCourses` é—¨è¯¾éœ€è¦é€‰ï¼Œè®°ä¸º `0` åˆ° `numCourses - 1`ã€‚ç»™ä½ ä¸€ä¸ªæ•°ç»„ `prerequisites `ï¼Œå…¶ä¸­ $prerequisites[i] = [a_i, b_i]$ ï¼Œè¡¨ç¤ºåœ¨é€‰ä¿®è¯¾ç¨‹ $a_i$ å‰ å¿…é¡» å…ˆé€‰ä¿® $b_i$ ã€‚
>
>   ä¾‹å¦‚ï¼Œæƒ³è¦å­¦ä¹ è¯¾ç¨‹ `0` ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ `1` ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¹é…æ¥è¡¨ç¤ºï¼š`[0,1]` ã€‚
>   è¿”å›ä½ ä¸ºäº†å­¦å®Œæ‰€æœ‰è¯¾ç¨‹æ‰€å®‰æ’çš„å­¦ä¹ é¡ºåºã€‚å¯èƒ½ä¼šæœ‰å¤šä¸ªæ­£ç¡®çš„é¡ºåºï¼Œä½ åªè¦è¿”å› ä»»æ„ä¸€ç§ å°±å¯ä»¥äº†ã€‚å¦‚æœä¸å¯èƒ½å®Œæˆæ‰€æœ‰è¯¾ç¨‹ï¼Œè¿”å› ä¸€ä¸ªç©ºæ•°ç»„ ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`numCourses = 2, prerequisites = [[1,0]]`
>   è¾“å‡ºï¼š`[0,1]`
>   è§£é‡Šï¼šæ€»å…±æœ‰ `2` é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ `1`ï¼Œä½ éœ€è¦å…ˆå®Œæˆè¯¾ç¨‹ `0`ã€‚å› æ­¤ï¼Œæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºä¸º `[0,1]` ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`numCourses = 4, prerequisites = [[1,0],[2,0],[3,1],[3,2]]`
>   è¾“å‡ºï¼š`[0,2,1,3]`
>   è§£é‡Šï¼šæ€»å…±æœ‰ `4` é—¨è¯¾ç¨‹ã€‚è¦å­¦ä¹ è¯¾ç¨‹ `3`ï¼Œä½ åº”è¯¥å…ˆå®Œæˆè¯¾ç¨‹ `1` å’Œè¯¾ç¨‹ `2`ã€‚å¹¶ä¸”è¯¾ç¨‹ `1` å’Œè¯¾ç¨‹ `2` éƒ½åº”è¯¥æ’åœ¨è¯¾ç¨‹ `0` ä¹‹åã€‚
>   å› æ­¤ï¼Œä¸€ä¸ªæ­£ç¡®çš„è¯¾ç¨‹é¡ºåºæ˜¯ `[0,1,2,3]` ã€‚å¦ä¸€ä¸ªæ­£ç¡®çš„æ’åºæ˜¯ `[0,2,1,3]` ã€‚

**ç¤ºä¾‹ 3**

>   è¾“å…¥ï¼š`numCourses = 1, prerequisites = []`
>   è¾“å‡ºï¼š`[0]`

**æç¤º**

>   +   $1 <= numCourses <= 2000$
>   +   $0 <= prerequisites.length <= numCourses * (numCourses - 1)$
>   +   $prerequisites[i].length == 2$
>   +   $0 <= a_i, b_i < numCourses$
>   +   $a_i != b_i$
>   +   $æ‰€æœ‰[a_i, b_i] äº’ä¸ç›¸åŒ$

**æ‰‹å†™ç¨¿**

>   1.   è¯¦ç»†æ‰‹å†™ç¨¿, è¯·çœ‹ä¸Šä¸€é¢˜
>   2.   è®°å½•ç­”æ¡ˆå³å¯

**ä»£ç **

```c++
class Solution {
public:
    vector<int> findOrder(int n, vector<vector<int>>& g) {
        queue<int> q;
        vector<int> d(n + 5);
        vector<vector<int>> course(n + 5);
        for (int i = 0; i < g.size(); i ++ ) {
            int a = g[i][0], b = g[i][1];
            course[b].push_back(a);
            d[a] ++;
        }
        vector<int> res;
        for (int i = 0; i < n; i ++ )
            // å°†æ‰€æœ‰å…¥åº¦ä¸º0çš„ç‚¹å…¨éƒ¨åŠ å…¥ç­”æ¡ˆ
            if (!d[i]) {
                q.push(i);
                res.push_back(i);
            }
        while (q.size()) {
            int t = q.front(); q.pop();
            // æ³¨æ„: é•¿åº¦ä¸ºcourse[t].size()è€Œä¸æ˜¯n
            for (int i = 0; i < course[t].size(); i ++ ) {
                if (!d[course[t][i]]) continue;
                d[course[t][i]] -- ;
                // å…¥åº¦ä¸º0, åŠ å…¥é˜Ÿåˆ—, åŠ å…¥ç­”æ¡ˆ
                if (!d[course[t][i]]) {
                    q.push(course[t][i]);
                    res.push_back(course[t][i]);
                }
            }
        }
        // ç­”æ¡ˆä¸ªæ•°ä¸æ»¡n, åˆ™æ¸…ç©ºç­”æ¡ˆæ•°ç»„
        if (res.size() != n) res = {};
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n + m), næ˜¯ç‚¹æ•°, mæ˜¯è¾¹æ•°$

**ç©ºé—´å¤æ‚åº¦**

$O(n + m), næ˜¯ç‚¹æ•°, mæ˜¯è¾¹æ•°$

**æ ‡ç­¾**

`æ‹“æ‰‘æ’åº`

**ç¼åˆæ€ª**



### [AcWing 848. æœ‰å‘å›¾çš„æ‹“æ‰‘åºåˆ—](https://www.acwing.com/problem/content/description/850/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ª `n` ä¸ªç‚¹ `m` æ¡è¾¹çš„æœ‰å‘å›¾ï¼Œç‚¹çš„ç¼–å·æ˜¯ `1` åˆ° `n`ï¼Œå›¾ä¸­å¯èƒ½å­˜åœ¨é‡è¾¹å’Œè‡ªç¯ã€‚
>
>   è¯·è¾“å‡ºä»»æ„ä¸€ä¸ªè¯¥æœ‰å‘å›¾çš„æ‹“æ‰‘åºåˆ—ï¼Œå¦‚æœæ‹“æ‰‘åºåˆ—ä¸å­˜åœ¨ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚
>
>   è‹¥ä¸€ä¸ªç”±å›¾ä¸­æ‰€æœ‰ç‚¹æ„æˆçš„åºåˆ— `A` æ»¡è¶³ï¼šå¯¹äºå›¾ä¸­çš„æ¯æ¡è¾¹ `(x,y)`ï¼Œ`x` åœ¨ `A` ä¸­éƒ½å‡ºç°åœ¨ `y` ä¹‹å‰ï¼Œåˆ™ç§° `A` æ˜¯è¯¥å›¾çš„ä¸€ä¸ªæ‹“æ‰‘åºåˆ—ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `x` å’Œ `y`ï¼Œè¡¨ç¤ºå­˜åœ¨ä¸€æ¡ä»ç‚¹ `x` åˆ°ç‚¹ `y` çš„æœ‰å‘è¾¹ `(x,y)`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼Œå¦‚æœå­˜åœ¨æ‹“æ‰‘åºåˆ—ï¼Œåˆ™è¾“å‡ºä»»æ„ä¸€ä¸ªåˆæ³•çš„æ‹“æ‰‘åºåˆ—å³å¯ã€‚
>
>   å¦åˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
3 3
1 2
2 3
1 3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1 2 3
```

**æ‰‹å†™ç¨¿**

>   1.   æ‰¾åˆ°æ‰€æœ‰å…¥åº¦ä¸º `0` çš„ç‚¹, å°†å…¶åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å³å¯
>   2.   å¦‚æ­¤å¾ªç¯å¾€å¤, å³å¾—ç­”æ¡ˆ

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010;
int n, m, idx;
int h[N], e[N], ne[N], q[N], d[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void topsort() {
    int hh = 0, tt = -1;
    // éå†æ‰€æœ‰ç‚¹
    for (int i = 1; i <= n; i ++ )
        // å°†æ‰€æœ‰å…¥åº¦ä¸º0çš„ç‚¹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­
        if (!d[i])
            q[ ++ tt] = i;
    while (hh <= tt) {
        int t = q[hh ++ ];
        // éå†tçš„æ‰€æœ‰é‚»ç‚¹
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // å¦‚æœå…¥åº¦ä¸º0, åˆ™å°†å…¶åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­
            if (-- d[j] == 0) q[ ++ tt] = j;
        }
    }
    // ç‚¹æ•°ä¸è¶³n, è¯´æ˜æ— è§£
    if (tt + 1 < n) puts("-1");
    // è¾“å‡ºç­”æ¡ˆ
    else
        for (int i = 0; i < n; i ++ ) cout << q[i] << " ";
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
        // bçš„å…¥åº¦ ++
        d[b] ++;
    }
    topsort();
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n + m)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ‹“æ‰‘æ’åº`

**ç¼åˆæ€ª**



### [AcWing 1191. å®¶è°±æ ‘](https://www.acwing.com/problem/content/1193/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸ªäººçš„å®¶æ—å¾ˆå¤§ï¼Œè¾ˆåˆ†å…³ç³»å¾ˆæ··ä¹±ï¼Œè¯·ä½ å¸®æ•´ç†ä¸€ä¸‹è¿™ç§å…³ç³»ã€‚
>
>   ç»™å‡ºæ¯ä¸ªäººçš„å­©å­çš„ä¿¡æ¯ã€‚
>
>   è¾“å‡ºä¸€ä¸ªåºåˆ—ï¼Œä½¿å¾—æ¯ä¸ªäººçš„å­©å­éƒ½æ¯”é‚£ä¸ªäººååˆ—å‡ºã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡Œä¸€ä¸ªæ•´æ•° `n`ï¼Œè¡¨ç¤ºå®¶æ—çš„äººæ•°ï¼›
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œç¬¬ `i` è¡Œæè¿°ç¬¬ `i` ä¸ªäººçš„å­©å­ï¼›
>
>   æ¯è¡Œæœ€åæ˜¯ `0` è¡¨ç¤ºæè¿°å®Œæ¯•ã€‚
>
>   æ¯ä¸ªäººçš„ç¼–å·ä» `1` åˆ° `n`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªåºåˆ—ï¼Œä½¿å¾—æ¯ä¸ªäººçš„å­©å­éƒ½æ¯”é‚£ä¸ªäººååˆ—å‡ºï¼›
>
>   æ•°æ®ä¿è¯ä¸€å®šæœ‰è§£ï¼Œå¦‚æœæœ‰å¤šè§£è¾“å‡ºä»»æ„ä¸€è§£ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
5
0
4 5 1 0
1 0
5 3 0
3 0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2 4 5 3 1
```

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ¿é¢˜

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110, M = 10010;
int n, idx;
int h[N], e[M], ne[M], q[N], d[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void topsort() {
    int hh = 0, tt = -1;
    // éå†æ‰€æœ‰ç‚¹
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœå…¥åº¦ä¸º0, åˆ™åŠ å…¥é˜Ÿåˆ—
        if (!d[i])
            q[ ++ tt] = i;
    while (hh <= tt) {
        int t = q[hh ++ ];
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // å¯»æ‰¾å…¥åº¦ä¸º0çš„ç‚¹
            if ( -- d[j] == 0) q[ ++ tt ] = j;
        }
    }
    return;
}
int main() {
    scanf("%d", &n);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) {
        int son;
        while (~scanf("%d", &son), son) {
            // åŠ è¾¹
            add(i, son);
            // sonçš„å…¥åº¦ ++ 
            d[son] ++;
        }
    }
    topsort();
    for (int i = 0; i < n; i ++ ) cout << q[i] << " ";
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n + e)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ‹“æ‰‘æ’åº`

**ç¼åˆæ€ª**



### [AcWing 1192. å¥–é‡‘](https://www.acwing.com/problem/content/1194/)

**é¢˜ç›®æè¿°**

>   ç”±äºæ— æ•Œçš„å‡¡å‡¡åœ¨`2005`å¹´ä¸–ç•Œè‹±ä¿Šå¸…æ°”ç”·æ€»å†³é€‰ä¸­èƒœå‡ºï¼Œ``Yali Company``æ€»ç»ç†`Mr.Z`å¿ƒæƒ…å¥½ï¼Œå†³å®šç»™æ¯ä½å‘˜å·¥å‘å¥–é‡‘ã€‚
>
>   å…¬å¸å†³å®šä»¥æ¯ä¸ªäººæœ¬å¹´åœ¨å…¬å¸çš„è´¡çŒ®ä¸ºæ ‡å‡†æ¥è®¡ç®—ä»–ä»¬å¾—åˆ°å¥–é‡‘çš„å¤šå°‘ã€‚
>
>   äºæ˜¯`Mr.Z`ä¸‹ä»¤å¬å¼€ `m` æ–¹ä¼šè°ˆã€‚
>
>   æ¯ä½å‚åŠ ä¼šè°ˆçš„ä»£è¡¨æå‡ºäº†è‡ªå·±çš„æ„è§ï¼šâ€œæˆ‘è®¤ä¸ºå‘˜å·¥ `a` çš„å¥–é‡‘åº”è¯¥æ¯” `b` é«˜ï¼â€
>
>   `Mr.Z`å†³å®šè¦æ‰¾å‡ºä¸€ç§å¥–é‡‘æ–¹æ¡ˆï¼Œæ»¡è¶³å„ä½ä»£è¡¨çš„æ„è§ï¼Œä¸”åŒæ—¶ä½¿å¾—æ€»å¥–é‡‘æ•°æœ€å°‘ã€‚
>
>   æ¯ä½å‘˜å·¥å¥–é‡‘æœ€å°‘ä¸º`100`å…ƒï¼Œä¸”å¿…é¡»æ˜¯æ•´æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n,m`ï¼Œåˆ†åˆ«è¡¨ç¤ºå…¬å¸å†…å‘˜å·¥æ•°ä»¥åŠå‚ä¼šä»£è¡¨æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡Œ `2` ä¸ªæ•´æ•° `a,b`ï¼Œè¡¨ç¤ºæŸä¸ªä»£è¡¨è®¤ä¸ºç¬¬ `a` å·å‘˜å·¥å¥–é‡‘åº”è¯¥æ¯”ç¬¬ `b` å·å‘˜å·¥é«˜ã€‚

**è¾“å‡ºæ ¼å¼**

>   è‹¥æ— æ³•æ‰¾åˆ°åˆç†æ–¹æ¡ˆï¼Œåˆ™è¾“å‡º`â€œPoor Xedâ€`ï¼›
>
>   å¦åˆ™è¾“å‡ºä¸€ä¸ªæ•°è¡¨ç¤ºæœ€å°‘æ€»å¥–é‡‘ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10000,$
>   +   $1â‰¤mâ‰¤20000$

**è¾“å…¥æ ·ä¾‹**

```c++
2 1
1 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
201
```

**æ‰‹å†™ç¨¿**

![6150845](img/6150845.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 10010, M = 20010;
int n, m, idx;
int h[N], e[M], ne[M], d[N], q[N], dist[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
bool topsort() {
    int hh = 0, tt = -1;
    // éå†æ¯ä¸ªç‚¹
    for (int i = 1; i <= n; i ++ )
        // å¯»æ‰¾å…¥åº¦ä¸º0çš„ç‚¹å¹¶å°†å…¶åŠ å…¥é˜Ÿåˆ—
        if (!d[i])
            q[ ++ tt] = i;
    while (hh <= tt) {
        int t = q[hh ++ ];
        // éå†é‚»è¾¹
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // è‹¥åº¦æ•°ä¸º0, åˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—
            if (-- d[j] == 0)
                q[ ++ tt] = j;
        }
    }
    // æŸ¥çœ‹æ˜¯å¦æœ‰ç¯
    return tt + 1 == n;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        // ä»båˆ°aè¿ä¸€æ¡è¾¹
        add(b, a);
        d[a] ++;
    }
    if (!topsort()) puts("Poor Xed");
    else {
        // æœ€ä½ä¸º100
        for (int i = 1; i <= n; i ++ ) dist[i] = 100;
        for (int i = 0; i < n; i ++ ) {
            int j = q[i];
            for (int k = h[j]; k != -1; k = ne[k])
                dist[e[k]] = max(dist[e[k]], dist[j] + 1);
        }
        int res = 0;
        for (int i = 1; i <= n; i ++ ) res += dist[i];
        cout << res << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n + m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æ‹“æ‰‘æ’åº`

**ç¼åˆæ€ª**



### [AcWing 164. å¯è¾¾æ€§ç»Ÿè®¡](https://www.acwing.com/problem/content/166/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€å¼  `N` ä¸ªç‚¹ `M` æ¡è¾¹çš„æœ‰å‘æ— ç¯å›¾ï¼Œåˆ†åˆ«ç»Ÿè®¡ä»æ¯ä¸ªç‚¹å‡ºå‘èƒ½å¤Ÿåˆ°è¾¾çš„ç‚¹çš„æ•°é‡ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `N,M`ï¼Œæ¥ä¸‹æ¥ `M` è¡Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° `x,y`ï¼Œè¡¨ç¤ºä» `x` åˆ° `y` çš„ä¸€æ¡æœ‰å‘è¾¹ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå…± `N` è¡Œï¼Œè¡¨ç¤ºæ¯ä¸ªç‚¹èƒ½å¤Ÿåˆ°è¾¾çš„ç‚¹çš„æ•°é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤N,Mâ‰¤30000$

**è¾“å…¥æ ·ä¾‹**

```c++
10 10
3 8
2 3
2 5
5 9
5 9
2 3
3 9
4 8
2 10
4 9
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
6
3
3
2
1
1
1
1
1
```

**æ‰‹å†™ç¨¿**

![6151011](img/6151011.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
#include <bitset>
using namespace std;
const int N = 30010;
int n, m, idx;
int h[N], e[N], ne[N], d[N], q[N];
bitset<N> f[N];
void add(int a, int b) {
    e[idx] = b;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void topsort() {
    int hh = 0, tt = -1;
    // éå†æ‰€æœ‰ç‚¹
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœåº¦æ•°ä¸º0, åˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—
        if (!d[i])
            q[ ++ tt] = i;
    while (hh <= tt) {
        int t = q[hh ++ ];
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            // å¦‚æœåº¦æ•°ä¸º0, åˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—
            if (-- d[j] == 0)
                q[ ++ tt] = j;
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        add(a, b);
        d[b] ++;
    }
    topsort();
    // é€†åº
    for (int i = n - 1; i >= 0; i -- ) {
        int j = q[i];
        // j -> jå¯ä»¥ç›¸è¿
        f[j][j] = 1;
        for (int k = h[j]; k != -1; k = ne[k])
            f[j] |= f[e[k]];
    }
    // ç»Ÿè®¡1çš„ä¸ªæ•°
    for (int i = 1; i <= n; i ++ ) cout << f[i].count() << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m * n / 32)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ‹“æ‰‘æ’åº`ã€`åŠ¨æ€è§„åˆ’`

**ç¼åˆæ€ª**



### [AcWing 456. è½¦ç«™åˆ†çº§](https://www.acwing.com/problem/content/458/)

**é¢˜ç›®æè¿°**

>   ä¸€æ¡å•å‘çš„é“è·¯çº¿ä¸Šï¼Œä¾æ¬¡æœ‰ç¼–å·ä¸º `1,â€‚2,â€‚â€¦,â€‚n`â€‚çš„ `n` ä¸ªç«è½¦ç«™ã€‚
>
>   æ¯ä¸ªç«è½¦ç«™éƒ½æœ‰ä¸€ä¸ªçº§åˆ«ï¼Œæœ€ä½ä¸º `1` çº§ã€‚
>
>   ç°æœ‰è‹¥å¹²è¶Ÿè½¦æ¬¡åœ¨è¿™æ¡çº¿è·¯ä¸Šè¡Œé©¶ï¼Œæ¯ä¸€è¶Ÿéƒ½æ»¡è¶³å¦‚ä¸‹è¦æ±‚ï¼šå¦‚æœè¿™è¶Ÿè½¦æ¬¡åœé äº†ç«è½¦ç«™ `x`ï¼Œåˆ™å§‹å‘ç«™ã€ç»ˆç‚¹ç«™ä¹‹é—´æ‰€æœ‰çº§åˆ«å¤§äºç­‰äºç«è½¦ç«™ `x` çš„éƒ½å¿…é¡»åœé ã€‚ï¼ˆæ³¨æ„ï¼šèµ·å§‹ç«™å’Œç»ˆç‚¹ç«™è‡ªç„¶ä¹Ÿç®—ä½œäº‹å…ˆå·²çŸ¥éœ€è¦åœé çš„ç«™ç‚¹ï¼‰â€‚
>
>   ä¾‹å¦‚ï¼Œä¸‹è¡¨æ˜¯ `5` è¶Ÿè½¦æ¬¡çš„è¿è¡Œæƒ…å†µã€‚
>
>   å…¶ä¸­ï¼Œå‰ `4` è¶Ÿè½¦æ¬¡å‡æ»¡è¶³è¦æ±‚ï¼Œè€Œç¬¬ `5` è¶Ÿè½¦æ¬¡ç”±äºåœé äº† `3` å·ç«è½¦ç«™ï¼ˆ`2` çº§ï¼‰å´æœªåœé é€”ç»çš„ `6` å·ç«è½¦ç«™ï¼ˆäº¦ä¸º `2` çº§ï¼‰è€Œä¸æ»¡è¶³è¦æ±‚ã€‚
>
>   ![1163900-20170818013814084-1540659827.jpg](img/19_8d0e0df443-1163900-20170818013814084-1540659827.jpg)
>
>   ç°æœ‰ `m` è¶Ÿè½¦æ¬¡çš„è¿è¡Œæƒ…å†µï¼ˆå…¨éƒ¨æ»¡è¶³è¦æ±‚ï¼‰ï¼Œè¯•æ¨ç®—è¿™ `n` ä¸ªç«è½¦ç«™è‡³å°‘åˆ†ä¸ºå‡ ä¸ªä¸åŒçš„çº§åˆ«ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å« `2` ä¸ªæ­£æ•´æ•° `n,m`ï¼Œç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
>   ç¬¬ `i+1` è¡Œï¼ˆ`1â‰¤iâ‰¤m`ï¼‰ä¸­ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªæ­£æ•´æ•° $s_i$ï¼ˆ$2â‰¤s_iâ‰¤n$ï¼‰ï¼Œè¡¨ç¤ºç¬¬ `i` è¶Ÿè½¦æ¬¡æœ‰ $s_i$ ä¸ªåœé ç«™ï¼›æ¥ä¸‹æ¥æœ‰ $s_i$ ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºæ‰€æœ‰åœé ç«™çš„ç¼–å·ï¼Œä»å°åˆ°å¤§æ’åˆ—ã€‚
>
>   æ¯ä¸¤ä¸ªæ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚è¾“å…¥ä¿è¯æ‰€æœ‰çš„è½¦æ¬¡éƒ½æ»¡è¶³è¦æ±‚ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºåªæœ‰ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå³ `n` ä¸ªç«è½¦ç«™æœ€å°‘åˆ’åˆ†çš„çº§åˆ«æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤n,mâ‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
9 3 
4 1 3 5 6 
3 3 5 6 
3 1 5 9 
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![6151906](img/6151906.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 2010, M = 1000010, K = 1010;
int n, m, idx;
int h[N], e[M], w[M], ne[M], st[K], d[N], q[N], dist[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void topsort() {
    int hh = 0, tt = -1;
    // æ³¨æ„: n + mæ¡è¾¹
    for (int i = 1; i <= n + m; i ++ )
        // å…¥åº¦ä¸º0, åˆ™å…¥é˜Ÿ
        if (!d[i])
            q[++ tt] = i;
    while (hh <= tt) {
        int t = q[hh ++ ];
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (-- d[j] == 0) q[++ tt] = j;
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= m; i ++ ) {
        int cnt;
        memset(st, 0, sizeof st);
        scanf("%d", &cnt);
        // ç»Ÿè®¡èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹
        // åŸå› : èµ·ç‚¹ç«™ä¸ä¸€å®šæ˜¯1å·ç‚¹, ç»ˆç‚¹ç«™ä¹Ÿä¸ä¸€å®šæ˜¯nå·ç‚¹
        int start = n, end = 1;
        while (cnt -- ) {
            int stop;
            scanf("%d", &stop);
            start = min(start, stop);
            end = max(end, stop);
            // æ ‡è®°æ­¤ç«™å·²è¢«åœé 
            st[stop] = true;
        }
        // å»ºç«‹è™šæ‹ŸæºèŠ‚ç‚¹
        int source = n + i;
        // ä»å¼€å¤´åˆ°ç»“æŸ
        for (int j = start; j <= end; j ++ )
            // å¦‚æœæ­¤ç«™æœªè¢«åœé 
            if (!st[j]) {
                // ä»æ­¤ç«™åˆ°è™šæ‹ŸèŠ‚ç‚¹æ·»åŠ ä¸€æ¡æƒå€¼ä¸º0çš„è¾¹
                add(j, source, 0);
                // å…¥åº¦ ++
                d[source] ++;
            }
            else { // æ­¤ç«™è¢«åœé 
                // ä»æ­¤ç«™åˆ°è™šæ‹ŸèŠ‚ç‚¹æ·»åŠ ä¸€æ¡æƒå€¼ä¸º1çš„è¾¹
                add(source, j, 1);
                // å…¥åº¦ ++
                d[j] ++;
            }
    }
    // æ‹“æ‰‘æ’åº
    topsort();
    // åˆå§‹åŒ–[æ‰‹å†™ç¨¿è§£é‡Š]
    for (int i = 1; i <= n; i ++ ) dist[i] = 1;
    // æ³¨æ„: â•ä¸Šè™šæ‹ŸèŠ‚ç‚¹,ä¸€å…±æ˜¯n + mæ¡è¾¹
    for (int i = 0; i < n + m; i ++ ) {
        int j = q[i];
        for (int k = h[j]; k != -1; k = ne[k])
            dist[e[k]] = max(dist[e[k]], dist[j] + w[k]);
    }
    int res = 0;
    // ç»Ÿè®¡æœ€é•¿è·¯
    for (int i = 0; i < n + m; i ++ ) res = max(res, dist[i]);
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$(n + m ^ 2)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æ‹“æ‰‘æ’åº`ã€`å»ºå›¾`

**ç¼åˆæ€ª**



### [AcWing 477. ç¥ç»ç½‘ç»œ](https://www.acwing.com/problem/content/description/479/)

**é¢˜ç›®æè¿°**

>   äººå·¥ç¥ç»ç½‘ç»œ`ï¼ˆArtificialâ€‚Neuralâ€‚Networkï¼‰`æ˜¯ä¸€ç§æ–°å…´çš„å…·æœ‰è‡ªæˆ‘å­¦ä¹ èƒ½åŠ›çš„è®¡ç®—ç³»ç»Ÿï¼Œåœ¨æ¨¡å¼è¯†åˆ«ã€å‡½æ•°é€¼è¿‘åŠè´·æ¬¾é£é™©è¯„ä¼°ç­‰è¯¸å¤šé¢†åŸŸæœ‰å¹¿æ³›çš„åº”ç”¨ã€‚
>
>   å¯¹ç¥ç»ç½‘ç»œçš„ç ”ç©¶ä¸€ç›´æ˜¯å½“ä»Šçš„çƒ­é—¨æ–¹å‘ï¼Œå…°å…°åŒå­¦åœ¨è‡ªå­¦äº†ä¸€æœ¬ç¥ç»ç½‘ç»œçš„å…¥é—¨ä¹¦ç±åï¼Œæå‡ºäº†ä¸€ä¸ªç®€åŒ–æ¨¡å‹ï¼Œä»–å¸Œæœ›ä½ èƒ½å¸®åŠ©ä»–ç”¨ç¨‹åºæ£€éªŒè¿™ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹çš„å®ç”¨æ€§ã€‚
>
>   åœ¨å…°å…°çš„æ¨¡å‹ä¸­ï¼Œç¥ç»ç½‘ç»œå°±æ˜¯ä¸€å¼ æœ‰å‘å›¾ï¼Œå›¾ä¸­çš„èŠ‚ç‚¹ç§°ä¸ºç¥ç»å…ƒï¼Œè€Œä¸”ä¸¤ä¸ªç¥ç»å…ƒä¹‹é—´è‡³å¤šæœ‰ä¸€æ¡è¾¹ç›¸è¿ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªç¥ç»å…ƒçš„ä¾‹å­ï¼š
>
>   ![QQæˆªå›¾20190312065845.png](img/19_5df72e4244-QQ%E6%88%AA%E5%9B%BE20190312065845.png)
>
>   å›¾ä¸­ï¼Œ$X_1â€”X_3$æ˜¯ä¿¡æ¯è¾“å…¥æ¸ é“ï¼Œ$Y_1ï¼Y_2$ æ˜¯ä¿¡æ¯è¾“å‡ºæ¸ é“ï¼Œ$C_1$ è¡¨ç¤ºç¥ç»å…ƒç›®å‰çš„çŠ¶æ€ï¼Œ$U_i$ æ˜¯é˜ˆå€¼ï¼Œå¯è§†ä¸ºç¥ç»å…ƒçš„ä¸€ä¸ªå†…åœ¨å‚æ•°ã€‚â€‚
>
>   ç¥ç»å…ƒæŒ‰ä¸€å®šçš„é¡ºåºæ’åˆ—ï¼Œæ„æˆæ•´ä¸ªç¥ç»ç½‘ç»œã€‚
>
>   åœ¨å…°å…°çš„æ¨¡å‹ä¹‹ä¸­ï¼Œç¥ç»ç½‘ç»œä¸­çš„ç¥ç»å…ƒåˆ†ä¸ºå‡ å±‚ï¼›ç§°ä¸ºè¾“å…¥å±‚ã€è¾“å‡ºå±‚ï¼Œå’Œè‹¥å¹²ä¸ªä¸­é—´å±‚ã€‚
>
>   æ¯å±‚ç¥ç»å…ƒåªå‘ä¸‹ä¸€å±‚çš„ç¥ç»å…ƒè¾“å‡ºä¿¡æ¯ï¼Œåªä»ä¸Šä¸€å±‚ç¥ç»å…ƒæ¥å—ä¿¡æ¯ã€‚
>
>   ä¸‹å›¾æ˜¯ä¸€ä¸ªç®€å•çš„ä¸‰å±‚ç¥ç»ç½‘ç»œçš„ä¾‹å­ã€‚
>
>   ![QQæˆªå›¾20190312065854.png](img/19_63d9ea0244-QQ%E6%88%AA%E5%9B%BE20190312065854.png)
>
>   å…°å…°è§„å®šï¼Œ$C_i$ æœä»å…¬å¼ï¼šï¼ˆå…¶ä¸­ `n` æ˜¯ç½‘ç»œä¸­æ‰€æœ‰ç¥ç»å…ƒçš„æ•°ç›®ï¼‰
>
>   ![15.png.gif](img/19_540dc06844-15.png.gif)
>
>   å…¬å¼ä¸­çš„$W_{ji}$ï¼ˆå¯èƒ½ä¸ºè´Ÿå€¼ï¼‰è¡¨ç¤ºè¿æ¥ $j$ å·ç¥ç»å…ƒå’Œ $i$ å·ç¥ç»å…ƒçš„è¾¹çš„æƒå€¼ã€‚
>
>   å½“ $C_i$ å¤§äº `0` æ—¶ï¼Œè¯¥ç¥ç»å…ƒå¤„äºå…´å¥‹çŠ¶æ€ï¼Œå¦åˆ™å°±å¤„äºå¹³é™çŠ¶æ€ã€‚
>
>   å½“ç¥ç»å…ƒå¤„äºå…´å¥‹çŠ¶æ€æ—¶ï¼Œä¸‹ä¸€ç§’å®ƒä¼šå‘å…¶ä»–ç¥ç»å…ƒä¼ é€ä¿¡å·ï¼Œä¿¡å·çš„å¼ºåº¦ä¸º $C_i$ã€‚
>
>   å¦‚æ­¤ï¼åœ¨è¾“å…¥å±‚ç¥ç»å…ƒè¢«æ¿€å‘ä¹‹åï¼Œæ•´ä¸ªç½‘ç»œç³»ç»Ÿå°±åœ¨ä¿¡æ¯ä¼ è¾“çš„æ¨åŠ¨ä¸‹è¿›è¡Œè¿ä½œã€‚
>
>   ç°åœ¨ï¼Œç»™å®šä¸€ä¸ªç¥ç»ç½‘ç»œï¼ŒåŠå½“å‰è¾“å…¥å±‚ç¥ç»å…ƒçš„çŠ¶æ€ï¼ˆ$C_i$ï¼‰ï¼Œè¦æ±‚ä½ çš„ç¨‹åºè¿ç®—å‡ºæœ€åç½‘ç»œè¾“å‡ºå±‚çš„çŠ¶æ€ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ–‡ä»¶ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•° `n` å’Œ `p`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•°ï¼Œç¬¬ `iï¼‹1` è¡Œæ˜¯ç¥ç»å…ƒiæœ€åˆçŠ¶æ€å’Œå…¶é˜ˆå€¼ï¼ˆ$U_i$ï¼‰ã€‚**æ³¨æ„** è¾“å…¥å±‚ç»™å®šçš„çŠ¶æ€å³ä¸ºæœ€ç»ˆå€¼ï¼Œä¸éœ€è¦å†å‡å» $U_i$ï¼Œéè¾“å…¥å±‚çš„ç¥ç»å…ƒå¼€å§‹æ—¶çŠ¶æ€å¿…ç„¶ä¸º `0`ã€‚
>
>   å†ä¸‹é¢ `P` è¡Œï¼Œæ¯è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° `iï¼Œj` åŠä¸€ä¸ªæ•´æ•° $W_{ij}$ï¼Œè¡¨ç¤ºè¿æ¥ç¥ç»å…ƒ `iã€j` çš„è¾¹æƒå€¼ä¸º $W_{ij}$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºæ–‡ä»¶åŒ…å«è‹¥å¹²è¡Œï¼Œæ¯è¡Œæœ‰ä¸¤ä¸ªæ•´æ•°ï¼Œåˆ†åˆ«å¯¹åº”ä¸€ä¸ªç¥ç»å…ƒçš„ç¼–å·ï¼ŒåŠå…¶æœ€åçš„çŠ¶æ€ï¼Œä¸¤ä¸ªæ•´æ•°é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚
>
>   ä»…è¾“å‡ºæœ€åçŠ¶æ€å¤§äºé›¶çš„è¾“å‡ºå±‚ç¥ç»å…ƒçŠ¶æ€ï¼Œå¹¶ä¸”æŒ‰ç…§ç¼–å·ç”±å°åˆ°å¤§é¡ºåºè¾“å‡ºã€‚
>
>   è‹¥è¾“å‡ºå±‚çš„ç¥ç»å…ƒæœ€åçŠ¶æ€å‡ä¸º `0`ï¼Œåˆ™è¾“å‡º `NULL`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
5 6
1 0
1 0
0 1
0 1
0 1
1 3 1
1 4 1
1 5 1
2 3 1
2 4 1
2 5 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3 1
4 1
5 1
```

**æ‰‹å†™ç¨¿**

![6161208](img/6161208.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 110, M = 10010;
int n, m, idx;
int f[N], u[N], h[N], e[M], w[M], ne[M], din[N], dout[N], q[N];
void add(int a, int b, int c) {
    e[idx] = b;
    w[idx] = c;
    ne[idx] = h[a];
    h[a] = idx ++;
    return;
}
void topsort() {
    int hh = 0, tt = -1;
    for (int i = 1; i <= n; i ++ )
        if (!din[i])
            q[++ tt] = i;
    while (hh <= tt) {
        int t = q[hh ++ ];
        for (int i = h[t]; i != -1; i = ne[i]) {
            int j = e[i];
            if (-- din[j] == 0) q[++ tt] = j;
        }
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    memset(h, -1, sizeof h);
    for (int i = 1; i <= n; i ++ ) scanf("%d%d", &f[i], &u[i]);
    for (int i = 0; i < m; i ++ ) {
        int a, b, c;
        scanf("%d%d%d", &a, &b, &c);
        add(a, b, c);
        // ç»Ÿè®¡å…¥åº¦å’Œå‡ºåº¦
        dout[a] ++, din[b] ++;
    }
    // æ‰€æœ‰éè¾“å…¥å±‚(din[i] > 0)éƒ½å¿…é¡»å‡å»é˜€å€¼
    for (int i = 1; i <= n; i ++ )
        if (din[i]) f[i] -= u[i];
    topsort();
    for (int i = 0; i < n; i ++ ) {
        int j = q[i];
        // å½“f[j] > 0çš„æ—¶å€™, å¤„äºå…´å¥‹çŠ¶æ€, æ‰å¯ä»¥ä¼ é€’ä¿¡æ¯
        if (f[j] <= 0) continue;
        for (int k = h[j]; k != -1; k = ne[k])
            f[e[k]] += f[j] * w[k];
    }
    int flag = false;
    for (int i = 1; i <= n; i ++ ) {
        // å½“èŠ‚ç‚¹iæ˜¯è¾“å‡ºå±‚å¹¶ä¸”çŠ¶æ€ > 0, æ‰è¾“å‡º
        if (!dout[i] && f[i] > 0) {
            printf("%d %d\n", i, f[i]);
            flag = true;
        }
    }
    if (!flag) puts("NULL");
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n + m)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ‹“æ‰‘æ’åº`

**ç¼åˆæ€ª**





# æ•°æ®ç»“æ„



## å¹¶æŸ¥é›†

### åŸç†

![6170917](img/6170917.png)

### [AcWing 836. åˆå¹¶é›†åˆ](https://www.acwing.com/problem/content/838/)

**é¢˜ç›®æè¿°**

>   ä¸€å…±æœ‰ `n` ä¸ªæ•°ï¼Œç¼–å·æ˜¯ `1 âˆ¼ n`ï¼Œæœ€å¼€å§‹æ¯ä¸ªæ•°å„è‡ªåœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚
>
>   ç°åœ¨è¦è¿›è¡Œ `m` ä¸ªæ“ä½œï¼Œæ“ä½œå…±æœ‰ä¸¤ç§ï¼š
>
>   1.  `M a b`ï¼Œå°†ç¼–å·ä¸º `a` å’Œ `b` çš„ä¸¤ä¸ªæ•°æ‰€åœ¨çš„é›†åˆåˆå¹¶ï¼Œå¦‚æœä¸¤ä¸ªæ•°å·²ç»åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼Œåˆ™å¿½ç•¥è¿™ä¸ªæ“ä½œï¼›
>   2.  `Q a b`ï¼Œè¯¢é—®ç¼–å·ä¸º `a` å’Œ `b` çš„ä¸¤ä¸ªæ•°æ˜¯å¦åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼›

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ“ä½œæŒ‡ä»¤ï¼ŒæŒ‡ä»¤ä¸º `M a b` æˆ– `Q a b` ä¸­çš„ä¸€ç§ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ä¸ªè¯¢é—®æŒ‡ä»¤ `Q a b`ï¼Œéƒ½è¦è¾“å‡ºä¸€ä¸ªç»“æœï¼Œå¦‚æœ `a` å’Œ `b` åœ¨åŒä¸€é›†åˆå†…ï¼Œåˆ™è¾“å‡º `Yes`ï¼Œå¦åˆ™è¾“å‡º `No`ã€‚
>
>   æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n, m â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
4 5
M 1 2
M 3 4
Q 1 2
Q 1 3
Q 3 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
Yes
No
Yes
```

**æ‰‹å†™ç¨¿**

>   1.   å¼€å§‹æ—¶æ¯ä¸ªé›†åˆéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é›†åˆ,å¹¶ä¸”éƒ½æ˜¯ç­‰äºè‡ªå·±æœ¬èº«ä¸‹æ ‡çš„æ•°
>   2.   ä¾‹ `1`:
>        `p[5] = 5, p[3] = 3;`
>        å¦‚æœæ˜¯ `M` æ“ä½œçš„è¯é‚£ä¹ˆå°±å°†é›†åˆè¿›è¡Œåˆå¹¶,åˆå¹¶çš„æ“ä½œæ˜¯:
>        `p[3] = p[5] = 5;`
>        æ‰€ä»¥ `3` çš„ç¥–å®—èŠ‚ç‚¹ä¾¿æˆä¸ºäº† `5`
>        æ­¤æ—¶ä»¥ `5` ä¸ºç¥–å®—èŠ‚ç‚¹çš„é›†åˆä¸º `{5ï¼Œ3}`
>        å¦‚æœè¦å°† `p[9] = 9` æ’å…¥åˆ° `p[3]` å½“ä¸­,åº”è¯¥æ‰¾åˆ° `3` çš„ç¥–å®—èŠ‚ç‚¹,
>        ç„¶åå†æŠŠ `p[9] = 9` æ’å…¥å…¶ä¸­,æ‰€ä»¥`p[9] = find(3);`(`find()`å‡½æ•°ç”¨äºæŸ¥æ‰¾ç¥–å®—èŠ‚ç‚¹)
>        ä¹Ÿå¯ä»¥æ˜¯`p[find(9)] = find(3)`,å› ä¸º `9` çš„èŠ‚ç‚¹æœ¬èº«å°±æ˜¯ `9`
>        æ­¤æ—¶ä»¥ `5` ä¸ºç¥–å®—èŠ‚ç‚¹çš„é›†åˆä¸º `{5, 3, 9};`
>        å¦‚æœç¢°åˆ°å¤šä¸ªæ•°çš„é›†åˆæ’å…¥å¦ä¸€ä¸ªé›†åˆå½“ä¸­å…¶åŸç†æ˜¯ç›¸åŒçš„
>   3.   ä¾‹ `2`:
>        ä¸Šè¿°ä¸­ä»¥ `5` ä¸ºç¥–å®—èŠ‚ç‚¹çš„æ˜¯`p[5], p[3], p[9];`(å³`p[5] = 5, p[3] = 5, p[9] = 5`)
>        å†æ„é€ ä¸€ä¸ªä»¥ `6` ä¸ºç¥–å®—èŠ‚ç‚¹çš„é›†åˆä¸º `{6, 4, 7, 10}`
>        å¦‚æœè¦å°†ä»¥ `6` ä¸ºç¥–å®—èŠ‚ç‚¹çš„é›†åˆæ’å…¥åˆ°ä»¥ `5` ä¸ºç¥–å®—èŠ‚ç‚¹çš„é›†åˆ,åˆ™è¯¥æ“ä½œå¯ä»¥æ˜¯
>        `p[6] = find(3)`ï¼ˆæˆ–è€…`find(9), find(5)`ï¼‰
>        æ­¤æ—¶`p[6] = 5`
>        å½“ç„¶å¦‚æœæ˜¯ä»¥ `6` ä¸ºç¥–å®—èŠ‚ç‚¹é›†åˆä¸­çš„`4, 7, 10`åˆ™å¯ä»¥è¿™æ ·
>        `p[find(4)] = find(3)`
>        æˆ–è€…`p[find(7)] = find(3)`å‡å¯ä»¥
>        æ­¤æ—¶ä»¥ `6` ä¸ºç¥–å®—èŠ‚ç‚¹çš„é›†åˆçš„ç¥–å®—èŠ‚ç‚¹éƒ½æˆä¸ºäº† `5`

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int n, m;
int f[N];
int find(int x) {
    // å¦‚æœå·²ç»èµ°åˆ°æœ€é¡¶éƒ¨, åˆ™è¿”å›
    if (f[x] == x) return f[x];
    // è®©xçš„çˆ¶äº²æŒ‡å‘å®¶æ—ä¸­çš„è€ä¸æ­»
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d", &n, &m);
    // å°†æ¯ä¸ªå­©å­çš„çˆ¶äº²éƒ½æ˜¯æœ¬èº«
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        char op[2];
        scanf("%s%d%d", op, &a, &b);
        // æ‰¾açš„çˆ¶äº², æ‰¾bçš„çˆ¶äº²
        int fa = find(a), fb = find(b);
        if (op[0] == 'M') {
            // å¦‚æœéƒ½å±äºåŒä¸€ä¸ªå®¶æ—, åˆ™è·³è¿‡æœ¬æ¬¡å¾ªç¯
            if (fa == fb) continue;
            // è®©faæˆä¸ºfbçš„çˆ¶äº²
            f[fb] = fa;
        }
        else {
            // å¦‚æœåŒå±äºä¸€ä¸ªå®¶æ—, åˆ™è¿”å›Yes
            if (fa == fb) puts("Yes");
            // å¦åˆ™, è¿”å›No
            else puts("No");
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



### [AcWing 837. è¿é€šå—ä¸­ç‚¹çš„æ•°é‡](https://www.acwing.com/problem/content/839/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªåŒ…å« `n` ä¸ªç‚¹ï¼ˆç¼–å·ä¸º `1 âˆ¼ n`ï¼‰çš„æ— å‘å›¾ï¼Œåˆå§‹æ—¶å›¾ä¸­æ²¡æœ‰è¾¹ã€‚
>
>   ç°åœ¨è¦è¿›è¡Œ `m` ä¸ªæ“ä½œï¼Œæ“ä½œå…±æœ‰ä¸‰ç§ï¼š
>
>   1.  `C a b`ï¼Œåœ¨ç‚¹ `a` å’Œç‚¹ `b` ä¹‹é—´è¿ä¸€æ¡è¾¹ï¼Œ`a` å’Œ `b` å¯èƒ½ç›¸ç­‰ï¼›
>   2.  `Q1 a b`ï¼Œè¯¢é—®ç‚¹ `a` å’Œç‚¹ `b` æ˜¯å¦åœ¨åŒä¸€ä¸ªè¿é€šå—ä¸­ï¼Œ`a` å’Œ `b` å¯èƒ½ç›¸ç­‰ï¼›
>   3.  `Q2 a`ï¼Œè¯¢é—®ç‚¹ `a` æ‰€åœ¨è¿é€šå—ä¸­ç‚¹çš„æ•°é‡ï¼›

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œè¾“å…¥æ•´æ•° `n` å’Œ `m`ã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ“ä½œæŒ‡ä»¤ï¼ŒæŒ‡ä»¤ä¸º `C a b`ï¼Œ`Q1 a b` æˆ– `Q2 a` ä¸­çš„ä¸€ç§ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ä¸ªè¯¢é—®æŒ‡ä»¤ `Q1 a b`ï¼Œå¦‚æœ `a` å’Œ `b` åœ¨åŒä¸€ä¸ªè¿é€šå—ä¸­ï¼Œåˆ™è¾“å‡º `Yes`ï¼Œå¦åˆ™è¾“å‡º `No`ã€‚
>
>   å¯¹äºæ¯ä¸ªè¯¢é—®æŒ‡ä»¤ `Q2 a`ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç‚¹ `a` æ‰€åœ¨è¿é€šå—ä¸­ç‚¹çš„æ•°é‡
>
>   æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ n, m â‰¤ 10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
5 5
C 1 2
Q1 1 2
Q2 1
C 2 5
Q2 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
Yes
2
3
```

**æ‰‹å†™ç¨¿**

>   1.   å¹¶æŸ¥é›†æ¨¡æ¿

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010;
int n, m;
int f[N], g[N];
int find(int x) {
    if (f[x] == x) return f[x];
    return f[x] = find(f[x]);
}
int main() {
    scanf("%d%d", &n, &m);
    // åˆå§‹è‡ªå·±ä¸ºè‡ªå·±çš„çˆ¶äº², åˆå§‹é›†åˆå†…æ•°å­—ä¸ªæ•°ä¸º1
    for (int i = 1; i <= n; i ++ ) f[i] = i, g[i] = 1;
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        char op[2];
        scanf("%s", op);
        if (!strcmp(op, "C")) {
            scanf("%d%d", &a, &b);
            // æ‰¾åˆ°å…¶ç¥–å…ˆ
            int fa = find(a), fb = find(b);
            // ç›¸ç­‰, åˆ™è¿”å›
            if (fa == fb) continue;
            // å°†fbçš„çˆ¶äº²æ¢æˆfa
            f[fb] = fa;
            // é›†åˆå†…çš„æ•°å­—ä¸ªæ•°è¿›è¡Œç´¯åŠ 
            g[fa] += g[fb];
        }
        else if (!strcmp(op, "Q1")) {
            scanf("%d%d", &a, &b);
            // æ‰¾åˆ°å…¶ç¥–å…ˆ
            int fa = find(a), fb = find(b);
            // ç›¸ç­‰, è¯´æ˜æ˜¯ä¸€ä¸ªå¤§å®¶æ—, è¿”å›Yes, å¦åˆ™è¿”å›No
            if (fa == fb) puts("Yes");
            else puts("No");
        }
        else {
            scanf("%d", &a);
            // æ‰¾åˆ°å…¶ç¥–å…ˆ, è¿”å›å¤§å®¶æ—å†…çš„äººæ•°
            int fa = find(a);
            cout << g[fa] << endl;
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



### [AcWing 240. é£Ÿç‰©é“¾](https://www.acwing.com/problem/content/242/)

**é¢˜ç›®æè¿°**

>   åŠ¨ç‰©ç‹å›½ä¸­æœ‰ä¸‰ç±»åŠ¨ç‰© `A,B,C`ï¼Œè¿™ä¸‰ç±»åŠ¨ç‰©çš„é£Ÿç‰©é“¾æ„æˆäº†æœ‰è¶£çš„ç¯å½¢ã€‚
>
>   `A` åƒ `B`ï¼Œ`B` åƒ `C`ï¼Œ`C` åƒ `A`ã€‚
>
>   ç°æœ‰ `N` ä¸ªåŠ¨ç‰©ï¼Œä»¥ `1 âˆ¼ N` ç¼–å·ã€‚
>
>   æ¯ä¸ªåŠ¨ç‰©éƒ½æ˜¯ `A,B,C` ä¸­çš„ä¸€ç§ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“å®ƒåˆ°åº•æ˜¯å“ªä¸€ç§ã€‚
>
>   æœ‰äººç”¨ä¸¤ç§è¯´æ³•å¯¹è¿™ `N` ä¸ªåŠ¨ç‰©æ‰€æ„æˆçš„é£Ÿç‰©é“¾å…³ç³»è¿›è¡Œæè¿°ï¼š
>
>   ç¬¬ä¸€ç§è¯´æ³•æ˜¯ `1 X Y`ï¼Œè¡¨ç¤º `X` å’Œ `Y` æ˜¯åŒç±»ã€‚
>
>   ç¬¬äºŒç§è¯´æ³•æ˜¯ `2 X Y`ï¼Œè¡¨ç¤º `X` åƒ `Y`ã€‚
>
>   æ­¤äººå¯¹ `N` ä¸ªåŠ¨ç‰©ï¼Œç”¨ä¸Šè¿°ä¸¤ç§è¯´æ³•ï¼Œä¸€å¥æ¥ä¸€å¥åœ°è¯´å‡º `K` å¥è¯ï¼Œè¿™ `K` å¥è¯æœ‰çš„æ˜¯çœŸçš„ï¼Œæœ‰çš„æ˜¯å‡çš„ã€‚
>
>   å½“ä¸€å¥è¯æ»¡è¶³ä¸‹åˆ—ä¸‰æ¡ä¹‹ä¸€æ—¶ï¼Œè¿™å¥è¯å°±æ˜¯å‡è¯ï¼Œå¦åˆ™å°±æ˜¯çœŸè¯ã€‚
>
>   1.  å½“å‰çš„è¯ä¸å‰é¢çš„æŸäº›çœŸçš„è¯å†²çªï¼Œå°±æ˜¯å‡è¯ï¼›
>   2.  å½“å‰çš„è¯ä¸­ `X` æˆ– `Y` æ¯” `N` å¤§ï¼Œå°±æ˜¯å‡è¯ï¼›
>   3.  å½“å‰çš„è¯è¡¨ç¤º `X` åƒ `X`ï¼Œå°±æ˜¯å‡è¯ã€‚
>
>   ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç»™å®šçš„ `N` å’Œ `K` å¥è¯ï¼Œè¾“å‡ºå‡è¯çš„æ€»æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ•´æ•° `N` å’Œ `K`ï¼Œä»¥ä¸€ä¸ªç©ºæ ¼åˆ†éš”ã€‚
>
>   ä»¥ä¸‹ `K` è¡Œæ¯è¡Œæ˜¯ä¸‰ä¸ªæ­£æ•´æ•° `Dï¼ŒXï¼ŒY`ï¼Œä¸¤æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ï¼Œå…¶ä¸­ `D` è¡¨ç¤ºè¯´æ³•çš„ç§ç±»ã€‚
>
>   è‹¥ `D=1`ï¼Œåˆ™è¡¨ç¤º `X` å’Œ `Y` æ˜¯åŒç±»ã€‚
>
>   è‹¥ `D=2`ï¼Œåˆ™è¡¨ç¤º `X` åƒ `Y`ã€‚

**è¾“å‡ºæ ¼å¼**

>   åªæœ‰ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå‡è¯çš„æ•°ç›®ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ N â‰¤ 50000,$
>   +   $0 â‰¤ K â‰¤ 100000$

**è¾“å…¥æ ·ä¾‹**

```c++
100 7
1 101 1
2 1 2
2 2 3
2 3 3
1 1 3
2 3 1
1 5 5
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![4222147](img/4222147.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 50010;
int n, k;
int f[N], dist[N];
int find(int x) {
    if (f[x] == x) return f[x];
    int p = find(f[x]);
    dist[x] += dist[f[x]];
    return f[x] = p;
}
int main() {
    scanf("%d%d", &n, &k);
    for (int i = 1; i <= n; i ++ ) f[i] = i;
    int res = 0;
    for (int i = 0; i < k; i ++ ) {
        int c, a, b;
        scanf("%d%d%d", &c, &a, &b);
        if (a > n || b > n) {
            res ++ ;
            continue;
        }
        int fa = find(a), fb = find(b);
        if (c == 1) {
            if (fa != fb) { // ä¸åœ¨ä¸€ä¸ªé›†åˆå†…, è¯´æ˜æ— çŸ›ç›¾!!
                f[fb] = fa; // æ›´æ–°çˆ¶èŠ‚ç‚¹
                dist[fb] = dist[a] - dist[b]; // æ›´æ–°è·ç¦»[è·ç¦»å«ä¹‰çœ‹æ‰‹å†™ç¨¿]
            }
            else if (fa == fb && (dist[a] - dist[b]) % 3) res ++;
        }
        else {
            if (fa != fb) { // ä¸åœ¨ä¸€ä¸ªé›†åˆå†…, è¯´æ˜æ— çŸ›ç›¾!!
                f[fb] = fa; // æ›´æ–°çˆ¶èŠ‚ç‚¹
                dist[fb] = dist[a] + 1 - dist[b]; // æ›´æ–°è·ç¦»[è·ç¦»å«ä¹‰çœ‹æ‰‹å†™ç¨¿]
            }
            else if(fa == fb && (dist[a] + 1 - dist[b]) % 3) res ++;
        }
    }
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(k)$

**ç©ºé—´å¤æ‚åº¦**

$(n)$

**æ ‡ç­¾**

`å¸¦æƒå¹¶æŸ¥é›†`ã€`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



### [AcWing 1250. æ ¼å­æ¸¸æˆ](https://www.acwing.com/problem/content/1252/)

**é¢˜ç›®æè¿°**

>   `Alice`å’Œ`Bob`ç©äº†ä¸€ä¸ªå¤è€çš„æ¸¸æˆï¼šé¦–å…ˆç”»ä¸€ä¸ª `nÃ—n` çš„ç‚¹é˜µï¼ˆä¸‹å›¾ `n=3` ï¼‰ã€‚
>
>   æ¥ç€ï¼Œä»–ä»¬ä¸¤ä¸ªè½®æµåœ¨ç›¸é‚»çš„ç‚¹ä¹‹é—´ç”»ä¸Šçº¢è¾¹å’Œè“è¾¹ï¼š
>
>   ![1.png](img/19_9edbcf521b-1.gif)
>
>   ç›´åˆ°å›´æˆä¸€ä¸ªå°é—­çš„åœˆï¼ˆé¢ç§¯ä¸å¿…ä¸º `1`ï¼‰ä¸ºæ­¢ï¼Œâ€œå°åœˆâ€çš„é‚£ä¸ªäººå°±æ˜¯èµ¢å®¶ã€‚å› ä¸ºæ£‹ç›˜å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œä»–ä»¬çš„æ¸¸æˆå®åœ¨æ˜¯å¤ªé•¿äº†ï¼
>
>   ä»–ä»¬ç”šè‡³åœ¨æ¸¸æˆä¸­éƒ½ä¸çŸ¥é“è°èµ¢å¾—äº†æ¸¸æˆã€‚
>
>   äºæ˜¯è¯·ä½ å†™ä¸€ä¸ªç¨‹åºï¼Œå¸®åŠ©ä»–ä»¬è®¡ç®—ä»–ä»¬æ˜¯å¦ç»“æŸäº†æ¸¸æˆï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ•°æ®ç¬¬ä¸€è¡Œä¸ºä¸¤ä¸ªæ•´æ•° `n` å’Œ `m`ã€‚`n`è¡¨ç¤ºç‚¹é˜µçš„å¤§å°ï¼Œ`m` è¡¨ç¤ºä¸€å…±ç”»äº† `m` æ¡çº¿ã€‚
>
>   ä»¥å `m` è¡Œï¼Œæ¯è¡Œé¦–å…ˆæœ‰ä¸¤ä¸ªæ•°å­— `(x,y)`ï¼Œä»£è¡¨äº†ç”»çº¿çš„èµ·ç‚¹åæ ‡ï¼Œæ¥ç€ç”¨ç©ºæ ¼éš”å¼€ä¸€ä¸ªå­—ç¬¦ï¼Œå‡å¦‚å­—ç¬¦æ˜¯ `D`ï¼Œåˆ™æ˜¯å‘ä¸‹è¿ä¸€æ¡è¾¹ï¼Œå¦‚æœæ˜¯ `R` å°±æ˜¯å‘å³è¿ä¸€æ¡è¾¹ã€‚
>
>   è¾“å…¥æ•°æ®ä¸ä¼šæœ‰é‡å¤çš„è¾¹ä¸”ä¿è¯æ­£ç¡®ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€è¡Œï¼šåœ¨ç¬¬å‡ æ­¥çš„æ—¶å€™ç»“æŸã€‚
>
>   å‡å¦‚ `m` æ­¥ä¹‹åä¹Ÿæ²¡æœ‰ç»“æŸï¼Œåˆ™è¾“å‡ºä¸€è¡Œ`â€œdrawâ€`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤200ï¼Œ$
>   +   $1â‰¤mâ‰¤24000$

**è¾“å…¥æ ·ä¾‹**

```c++
3 5
1 1 D
1 1 R
1 2 D
2 1 R
2 2 D
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
```

**æ‰‹å†™ç¨¿**

![6170937](img/6170937.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 40010;
int n, m;
int p[N];
int get(int x, int y) {
    return x * n + y;
}
int find(int x) {
    if (p[x] == x) return p[x];
    return p[x] = find(p[x]);
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 0; i < n * n; i ++ ) p[i] = i;
    int res = -1;
    for (int i = 1; i <= m; i ++ ) {
        int x, y;
        char op[2];
        scanf("%d%d%s", &x, &y, op);
        // åŸå§‹ä¸‹æ ‡ä»1å¼€å§‹, æ•…, éœ€è¦è¿›è¡Œ --
        x --, y --;
        int a = get(x, y), b;
        if (op[0] == 'D') b = get(x + 1, y);
        else b = get(x, y + 1);
        int pa = find(a), pb = find(b);
        // å±äºä¸€ä¸ªé›†åˆ, è¯´æ˜å·²ç»å­˜åœ¨ç¯, è®°å½•ç­”æ¡ˆ, é€€å‡ºå³å¯
        if (pa == pb) {
            res = i;
            break;
        }
        // æ›´æ–°çˆ¶å­å…³ç³»
        p[pb] = pa;
    }
    if (res == -1) cout << "draw" << endl;
    else cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¹¶æŸ¥é›†`

**ç¼åˆæ€ª**



### [AcWing 1252. æ­é…è´­ä¹°](https://www.acwing.com/problem/content/1254/)

**é¢˜ç›®æè¿°**

>   `Joe`è§‰å¾—äº‘æœµå¾ˆç¾ï¼Œå†³å®šå»å±±ä¸Šçš„å•†åº—ä¹°ä¸€äº›äº‘æœµã€‚
>
>   å•†åº—é‡Œæœ‰ `n` æœµäº‘ï¼Œäº‘æœµè¢«ç¼–å·ä¸º `1,2,â€¦,n`ï¼Œå¹¶ä¸”æ¯æœµäº‘éƒ½æœ‰ä¸€ä¸ªä»·å€¼ã€‚
>
>   ä½†æ˜¯å•†åº—è€æ¿è·Ÿä»–è¯´ï¼Œä¸€äº›äº‘æœµè¦æ­é…æ¥ä¹°æ‰å¥½ï¼Œæ‰€ä»¥ä¹°ä¸€æœµäº‘åˆ™ä¸è¿™æœµäº‘æœ‰æ­é…çš„äº‘éƒ½è¦ä¹°ã€‚
>
>   ä½†æ˜¯`Joe`çš„é’±æœ‰é™ï¼Œæ‰€ä»¥ä»–å¸Œæœ›ä¹°çš„ä»·å€¼è¶Šå¤šè¶Šå¥½ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ `1` è¡ŒåŒ…å«ä¸‰ä¸ªæ•´æ•° `nï¼Œmï¼Œw`ï¼Œè¡¨ç¤ºæœ‰ `n` æœµäº‘ï¼Œ`m` ä¸ªæ­é…ï¼Œ`Joe`æœ‰ `w` çš„é’±ã€‚
>
>   ç¬¬ `2âˆ¼n+1`è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° $c_iï¼Œd_i$ è¡¨ç¤º `i` æœµäº‘çš„ä»·é’±å’Œä»·å€¼ã€‚
>
>   ç¬¬ `n+2âˆ¼n+1+m` è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° $u_iï¼Œv_i$ï¼Œè¡¨ç¤ºä¹° $u_i$ å°±å¿…é¡»ä¹° $v_i$ï¼ŒåŒç†ï¼Œå¦‚æœä¹° $v_i$ å°±å¿…é¡»ä¹° $u_i$ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä¸€è¡Œï¼Œè¡¨ç¤ºå¯ä»¥è·å¾—çš„æœ€å¤§ä»·å€¼ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10000,$
>   +   $0â‰¤mâ‰¤5000,$
>   +   $1â‰¤wâ‰¤10000,$
>   +   $1â‰¤c_iâ‰¤5000,$
>   +   $1â‰¤d_iâ‰¤100,$
>   +   $1â‰¤u_i,v_iâ‰¤n$

**è¾“å…¥æ ·ä¾‹**

```c++
5 3 10
3 10
3 10
3 10
5 100
10 1
1 3
3 2
4 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
```

**æ‰‹å†™ç¨¿**

![6171042](img/6171042.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 10010;
int n, m, k;
int w[N], v[N], p[N], f[N];
int find(int x) {
    if (p[x] == x) return p[x];
    return p[x] = find(p[x]);
}
int main() {
    scanf("%d%d%d", &n, &m, &k);
    for (int i = 1; i <= n; i ++ ) p[i] = i;
    for (int i = 1; i <= n; i ++ ) scanf("%d%d", &v[i], &w[i]);
    for (int i = 0; i < m; i ++ ) {
        int a, b;
        scanf("%d%d", &a, &b);
        int pa = find(a);
        int pb = find(b);
        // å¦‚æœä¸åœ¨åŒä¸€ä¸ªé›†åˆ
        if (pa != pb) {
            // æ›´æ–°ä½“ç§¯
            v[pa] += v[pb];
            // æ›´æ–°ä»·å€¼
            w[pa] += w[pb];
            // æ›´æ–°çˆ¶å­å…³ç³»
            p[pb] = pa;
        }
    }
    // 01èƒŒåŒ…
    for (int i = 1; i <= n; i ++ )
        // éå†æ¯ä¸ªç‚¹, æ‰¾åˆ°æ‰€æœ‰çš„è¿é€šå—
        if (p[i] == i)
            // 01èƒŒåŒ…
            for (int j = k; j >= v[i]; j -- )
                f[j] = max(f[j], f[j - v[i]] + w[i]);
    cout << f[k] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¹¶æŸ¥é›†`ã€`01èƒŒåŒ…`

**ç¼åˆæ€ª**



### [AcWing 237. ç¨‹åºè‡ªåŠ¨åˆ†æ](https://www.acwing.com/problem/content/239/)

**é¢˜ç›®æè¿°**

>   åœ¨å®ç°ç¨‹åºè‡ªåŠ¨åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸éœ€è¦åˆ¤å®šä¸€äº›çº¦æŸæ¡ä»¶æ˜¯å¦èƒ½è¢«åŒæ—¶æ»¡è¶³ã€‚
>
>   è€ƒè™‘ä¸€ä¸ªçº¦æŸæ»¡è¶³é—®é¢˜çš„ç®€åŒ–ç‰ˆæœ¬ï¼šå‡è®¾ $x_1,x_2,x_3,â€¦$ ä»£è¡¨ç¨‹åºä¸­å‡ºç°çš„å˜é‡ï¼Œç»™å®š `n` ä¸ªå½¢å¦‚ $x_i=x_j$ æˆ– $x_iâ‰ x_j$ çš„å˜é‡ç›¸ç­‰/ä¸ç­‰çš„çº¦æŸæ¡ä»¶ï¼Œè¯·åˆ¤å®šæ˜¯å¦å¯ä»¥åˆ†åˆ«ä¸ºæ¯ä¸€ä¸ªå˜é‡èµ‹äºˆæ°å½“çš„å€¼ï¼Œä½¿å¾—ä¸Šè¿°æ‰€æœ‰çº¦æŸæ¡ä»¶åŒæ—¶è¢«æ»¡è¶³ã€‚
>
>   ä¾‹å¦‚ï¼Œä¸€ä¸ªé—®é¢˜ä¸­çš„çº¦æŸæ¡ä»¶ä¸ºï¼š$x_1=x_2ï¼Œx_2=x_3ï¼Œx_3=x_4ï¼Œx_1â‰ x_4$ï¼Œè¿™äº›çº¦æŸæ¡ä»¶æ˜¾ç„¶æ˜¯ä¸å¯èƒ½åŒæ—¶è¢«æ»¡è¶³çš„ï¼Œå› æ­¤è¿™ä¸ªé—®é¢˜åº”åˆ¤å®šä¸ºä¸å¯è¢«æ»¡è¶³ã€‚
>
>   ç°åœ¨ç»™å‡ºä¸€äº›çº¦æŸæ»¡è¶³é—®é¢˜ï¼Œè¯·åˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œåˆ¤å®šã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ–‡ä»¶çš„ç¬¬ `1` è¡ŒåŒ…å« `1` ä¸ªæ­£æ•´æ•° `t`ï¼Œè¡¨ç¤ºéœ€è¦åˆ¤å®šçš„é—®é¢˜ä¸ªæ•°ï¼Œæ³¨æ„è¿™äº›é—®é¢˜ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚
>
>   å¯¹äºæ¯ä¸ªé—®é¢˜ï¼ŒåŒ…å«è‹¥å¹²è¡Œï¼š
>
>   ç¬¬ `1` è¡ŒåŒ…å« `1` ä¸ªæ­£æ•´æ•° `n`ï¼Œè¡¨ç¤ºè¯¥é—®é¢˜ä¸­éœ€è¦è¢«æ»¡è¶³çš„çº¦æŸæ¡ä»¶ä¸ªæ•°ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…æ‹¬ `3` ä¸ªæ•´æ•° `i,j,e`ï¼Œæè¿° `1` ä¸ªç›¸ç­‰/ä¸ç­‰çš„çº¦æŸæ¡ä»¶ï¼Œç›¸é‚»æ•´æ•°ä¹‹é—´ç”¨å•ä¸ªç©ºæ ¼éš”å¼€ã€‚è‹¥ `e=1`ï¼Œåˆ™è¯¥çº¦æŸæ¡ä»¶ä¸º $x_i=x_j$ï¼›è‹¥ `e=0`ï¼Œåˆ™è¯¥çº¦æŸæ¡ä»¶ä¸º $x_iâ‰ x_j$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºæ–‡ä»¶åŒ…æ‹¬ `t` è¡Œã€‚
>
>   è¾“å‡ºæ–‡ä»¶çš„ç¬¬ `k` è¡Œè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸² `YES` æˆ–è€… `NO`ï¼Œ`YES` è¡¨ç¤ºè¾“å…¥ä¸­çš„ç¬¬ `k` ä¸ªé—®é¢˜åˆ¤å®šä¸ºå¯ä»¥è¢«æ»¡è¶³ï¼Œ`NO` è¡¨ç¤ºä¸å¯è¢«æ»¡è¶³ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10^5$
>   +   $1â‰¤i,jâ‰¤10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
2
2
1 2 1
1 2 0
2
1 2 1
2 1 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
NO
YES
```

**æ‰‹å†™ç¨¿**

![6181026](img/6181026.png)

**ä»£ç **

```c++
#include <iostream>
#include <unordered_map>
using namespace std;
const int N = 200010, M = 100010;
struct Query {
    int x, y, e;
}query[M];
int n, m, T;
int p[N];
unordered_map<int, int> S;
int get(int x) {
    if (!S.count(x)) S[x] = ++ n;
    return S[x];
}
int find(int x) {
    if (p[x] == x) return p[x];
    return p[x] = find(p[x]);
}
int main() {
    scanf("%d", &T);
    while (T -- ) {
        // åˆå§‹åŒ–
        n = 0;
        // æ¸…ç©ºå“ˆå¸Œè¡¨
        S.clear();
        scanf("%d", &m);
        // éå†æ¯ä¸ªçº¦æŸæ¡ä»¶
        for (int i = 0; i < m; i ++ ) {
            int x, y, e;
            scanf("%d%d%d", &x, &y, &e);
            // æ³¨æ„: xå’Œyæ˜¯ç¦»æ•£åŒ–ä¹‹åçš„æ•°å€¼
            query[i] = {get(x), get(y), e};
        }
        // åˆå§‹åŒ–å¹¶æŸ¥é›†æ•°ç»„
        for (int i = 1; i <= n; i ++ ) p[i] = i;
        for (int i = 0; i < m; i ++ )
            // éå†æ‰€æœ‰ç›¸ç­‰çš„æ¡ä»¶
            if (query[i].e == 1) {
                int a = query[i].x;
                int b = query[i].y;
                int pa = find(a);
                int pb = find(b);
                if (pa != pb) p[pb] = pa;
            }
        bool has_conflict = false;
        for (int i = 0; i < m; i ++ )
            // éå†æ‰€æœ‰ä¸ç­‰çš„æ¡ä»¶
            if (query[i].e == 0) {
                int a = query[i].x;
                int b = query[i].y;
                int pa = find(a);
                int pb = find(b);
                // ä¹‹å‰æ¨å‡ºç›¸ç­‰, ç°åœ¨åˆæ¨å‡ºä¸æƒ³ç­‰, æ•…, äº§ç”ŸçŸ›ç›¾
                if (pa == pb) {
                    has_conflict = true;
                    break;
                }
            }
        if (has_conflict) puts("NO");
        else puts("YES");
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¹¶æŸ¥é›†`ã€`ç¦»æ•£åŒ–`

**ç¼åˆæ€ª**



### [AcWing 239. å¥‡å¶æ¸¸æˆ](https://www.acwing.com/problem/content/241/)

**é¢˜ç›®æè¿°**

>   å° `A` å’Œå° `B` åœ¨ç©ä¸€ä¸ªæ¸¸æˆã€‚
>
>   é¦–å…ˆï¼Œå° `A` å†™äº†ä¸€ä¸ªç”± `0` å’Œ `1` ç»„æˆçš„åºåˆ— `S`ï¼Œé•¿åº¦ä¸º `N`ã€‚
>
>   ç„¶åï¼Œå° `B` å‘å° `A` æå‡ºäº† `M` ä¸ªé—®é¢˜ã€‚
>
>   åœ¨æ¯ä¸ªé—®é¢˜ä¸­ï¼Œå° `B` æŒ‡å®šä¸¤ä¸ªæ•° `l` å’Œ `r`ï¼Œå° `A` å›ç­” `S[lâˆ¼r]` ä¸­æœ‰å¥‡æ•°ä¸ª `1` è¿˜æ˜¯å¶æ•°ä¸ª `1`ã€‚
>
>   æœºæ™ºçš„å° `B` å‘ç°å° `A` æœ‰å¯èƒ½åœ¨æ’’è°ã€‚
>
>   ä¾‹å¦‚ï¼Œå° `A` æ›¾ç»å›ç­”è¿‡ `S[1âˆ¼3]` ä¸­æœ‰å¥‡æ•°ä¸ª `1`ï¼Œ`S[4âˆ¼6]` ä¸­æœ‰å¶æ•°ä¸ª `1`ï¼Œç°åœ¨åˆå›ç­” `S[1âˆ¼6]` ä¸­æœ‰å¶æ•°ä¸ª `1`ï¼Œæ˜¾ç„¶è¿™æ˜¯è‡ªç›¸çŸ›ç›¾çš„ã€‚
>
>   è¯·ä½ å¸®åŠ©å° `B` æ£€æŸ¥è¿™ `M` ä¸ªç­”æ¡ˆï¼Œå¹¶æŒ‡å‡ºåœ¨è‡³å°‘å¤šå°‘ä¸ªå›ç­”ä¹‹åå¯ä»¥ç¡®å®šå° `A` ä¸€å®šåœ¨æ’’è°ã€‚
>
>   å³æ±‚å‡ºä¸€ä¸ªæœ€å°çš„ `k`ï¼Œä½¿å¾— `01` åºåˆ— `S` æ»¡è¶³ç¬¬ `1âˆ¼k` ä¸ªå›ç­”ï¼Œä½†ä¸æ»¡è¶³ç¬¬ `1âˆ¼k+1` ä¸ªå›ç­”ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `N`ï¼Œè¡¨ç¤º `01` åºåˆ—é•¿åº¦ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `M`ï¼Œè¡¨ç¤ºé—®é¢˜æ•°é‡ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ç»„é—®ç­”ï¼šä¸¤ä¸ªæ•´æ•° `l` å’Œ `r`ï¼Œä»¥åŠå›ç­” `even` æˆ– `odd`ï¼Œç”¨ä»¥æè¿° `S[lâˆ¼r]` ä¸­æœ‰å¶æ•°ä¸ª `1` è¿˜æ˜¯å¥‡æ•°ä¸ª `1`ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºä¸€ä¸ªæ•´æ•° `k`ï¼Œè¡¨ç¤º `01` åºåˆ—æ»¡è¶³ç¬¬ `1âˆ¼k` ä¸ªå›ç­”ï¼Œä½†ä¸æ»¡è¶³ç¬¬ `1âˆ¼k+1` ä¸ªå›ç­”ï¼Œå¦‚æœ `01` åºåˆ—æ»¡è¶³æ‰€æœ‰å›ç­”ï¼Œåˆ™è¾“å‡ºé—®é¢˜æ€»æ•°é‡ã€‚

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤10^9,Mâ‰¤5000$

**è¾“å…¥æ ·ä¾‹**

```c++
10
5
1 2 even
3 4 odd
5 6 even
1 6 even
7 10 odd
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![6191221](img/6191221.png)

**ä»£ç ä¸€: å¸¦æƒå¹¶æŸ¥é›†**

```c++
#include <iostream>
#include <cstring>
#include <unordered_map>
using namespace std;
const int N = 10010;
int n, m;
int p[N], d[N];
unordered_map<int, int> S;
// ç¦»æ•£åŒ–
int get(int x) {
    if (S.count(x) == 0) S[x] = ++ n;
    return S[x];
}
int find(int x) {
    if (p[x] == x) return p[x];
    int root = find(p[x]);
    // d[x] += d[p[x]]; ä¸æ˜¯d[root]
    d[x] += d[p[x]];
    return p[x] = root;
}
int main() {
    scanf("%d%d", &n, &m);
    n = 0;
    for (int i = 1; i < N; i ++ ) p[i] = i;
    // å…¨éƒ¨æ­£ç¡®, åˆ™ç­”æ¡ˆæ˜¯m
    int res = m;
    for (int i = 1; i <= m; i ++ ) {
        int l, r;
        char type[5];
        scanf("%d%d%s", &l, &r, type);
        // sum[l, r] = sum[r] - sum[l - 1];
        int a = get(l - 1), b = get(r);
        int pa = find(a);
        int pb = find(b);
        if (!strcmp(type, "odd")) { // å¥‡æ•°
            // å¦‚æœaå’Œbå¤„äºåŒä¸ªé›†åˆå¹¶ä¸”ä¸æ˜¯åŒä¸€ç±»
            if (pa == pb && (d[a] + d[b]) % 2 == 0) {
                res = i - 1;
                break;
            }
            // ä¸åœ¨åŒä¸€ä¸ªé›†åˆ
            else if (pa != pb) {
                // æ›´æ–°
                d[pa] = 1 - d[a] - d[b];
                p[pa] = pb;
            }
        }
        else { // å¶æ•°
            // å¦‚æœaå’Œbå¤„äºåŒä¸ªé›†åˆå¹¶ä¸”ä¸æ˜¯åŒä¸€ç±»
            if (pa == pb && (d[a] + d[b]) % 2) {
                res = i - 1;
                break;
            }
            // ä¸åœ¨åŒä¸€ä¸ªé›†åˆ
            else if (pa != pb) {
                // æ›´æ–°
                d[pa] = -d[a] - d[b];
                p[pa] = pb;
            }
        }
    }
    cout << res << endl;
    return 0;
}
```

**ä»£ç äºŒ: æ‰©å±•åŸŸ**

```c++
#include <iostream>
#include <cstring>
#include <unordered_map>
using namespace std;
const int N = 20010, base = N / 2;
int n, m;
int p[N], d[N];
unordered_map<int, int> S;
int get(int x) {
    if (S.count(x) == 0) S[x] = ++ n;
    return S[x];
}
int find(int x) {
    if (p[x] == x) return p[x];
    int root = find(p[x]);
    d[x] += d[p[x]];
    return p[x] = root;
}
int main() {
    scanf("%d%d", &n, &m);
    n = 0;
    for (int i = 1; i < N; i ++ ) p[i] = i;
    int res = m;
    for (int i = 1; i <= m; i ++ ) {
        int l, r;
        char type[5];
        scanf("%d%d%s", &l, &r, type);
        int a = get(l - 1), b = get(r);
        if (strcmp("odd", type) == 0) { // å¥‡æ•°
            // ä¸ç¬¦åˆæ¡ä»¶
            if (find(a) == find(b) || find(a + base) == find(b + base)) {
                res = i - 1;
                break;
            }
            else {
                p[find(a)] = find(b + base);
                p[find(a + base)] = find(b);
            }
        }
        else { // å¶æ•°
            // ä¸ç¬¦åˆæ¡ä»¶
            if (find(a) == find(b + base) || find(a + base) == find(b)) {
                res = i - 1;
                break;
            }
            else {
                p[find(a)] = find(b);
                p[find(a + base)] = find(b + base);
            }
        }
    }
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(mlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¸¦æƒå¹¶æŸ¥é›†`ã€`æ‰©å±•åŸŸ`

**ç¼åˆæ€ª**



### [AcWing 238. é“¶æ²³è‹±é›„ä¼ è¯´](https://www.acwing.com/problem/content/240/)

**é¢˜ç›®æè¿°**

>   æœ‰ä¸€ä¸ªåˆ’åˆ†ä¸º `N` åˆ—çš„æ˜Ÿé™…æˆ˜åœºï¼Œå„åˆ—ä¾æ¬¡ç¼–å·ä¸º `1,2,â€¦,N`ã€‚
>
>   æœ‰ `N` è‰˜æˆ˜èˆ°ï¼Œä¹Ÿä¾æ¬¡ç¼–å·ä¸º `1,2,â€¦,N`ï¼Œå…¶ä¸­ç¬¬ `i` å·æˆ˜èˆ°å¤„äºç¬¬ `i` åˆ—ã€‚
>
>   æœ‰ `T` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤æ ¼å¼ä¸ºä»¥ä¸‹ä¸¤ç§ä¹‹ä¸€ï¼š
>
>   1.  `M i j`ï¼Œè¡¨ç¤ºè®©ç¬¬ `i` å·æˆ˜èˆ°æ‰€åœ¨åˆ—çš„å…¨éƒ¨æˆ˜èˆ°ä¿æŒåŸæœ‰é¡ºåºï¼Œæ¥åœ¨ç¬¬ `j` å·æˆ˜èˆ°æ‰€åœ¨åˆ—çš„å°¾éƒ¨ã€‚
>   2.  `C i j`ï¼Œè¡¨ç¤ºè¯¢é—®ç¬¬ `i` å·æˆ˜èˆ°ä¸ç¬¬ `j` å·æˆ˜èˆ°å½“å‰æ˜¯å¦å¤„äºåŒä¸€åˆ—ä¸­ï¼Œå¦‚æœåœ¨åŒä¸€åˆ—ä¸­ï¼Œå®ƒä»¬ä¹‹é—´é—´éš”äº†å¤šå°‘è‰˜æˆ˜èˆ°ã€‚
>
>   ç°åœ¨éœ€è¦ä½ ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œå¤„ç†ä¸€ç³»åˆ—çš„æŒ‡ä»¤ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `T`ï¼Œè¡¨ç¤ºå…±æœ‰ `T` æ¡æŒ‡ä»¤ã€‚
>
>   æ¥ä¸‹æ¥ `T` è¡Œï¼Œæ¯è¡Œä¸€ä¸ªæŒ‡ä»¤ï¼ŒæŒ‡ä»¤æœ‰ä¸¤ç§å½¢å¼ï¼š`M i j` æˆ– `C i j`ã€‚
>
>   å…¶ä¸­ `M` å’Œ `C` ä¸ºå¤§å†™å­—æ¯è¡¨ç¤ºæŒ‡ä»¤ç±»å‹ï¼Œ`i` å’Œ `j` ä¸ºæ•´æ•°ï¼Œè¡¨ç¤ºæŒ‡ä»¤æ¶‰åŠçš„æˆ˜èˆ°ç¼–å·ã€‚

**è¾“å‡ºæ ¼å¼**

>   ä½ çš„ç¨‹åºåº”å½“ä¾æ¬¡å¯¹è¾“å…¥çš„æ¯ä¸€æ¡æŒ‡ä»¤è¿›è¡Œåˆ†æå’Œå¤„ç†ï¼š
>
>   å¦‚æœæ˜¯ `M i j` å½¢å¼ï¼Œåˆ™è¡¨ç¤ºèˆ°é˜Ÿæ’åˆ—å‘ç”Ÿäº†å˜åŒ–ï¼Œä½ çš„ç¨‹åºè¦æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯ä¸è¦è¾“å‡ºä»»ä½•ä¿¡æ¯ï¼›
>
>   å¦‚æœæ˜¯ `C i j` å½¢å¼ï¼Œä½ çš„ç¨‹åºè¦è¾“å‡ºä¸€è¡Œï¼Œä»…åŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåœ¨åŒä¸€åˆ—ä¸Šï¼Œç¬¬ `i` å·æˆ˜èˆ°ä¸ç¬¬ `j` å·æˆ˜èˆ°ä¹‹é—´å¸ƒç½®çš„æˆ˜èˆ°æ•°ç›®ï¼Œå¦‚æœç¬¬ `i` å·æˆ˜èˆ°ä¸ç¬¬ `j` å·æˆ˜èˆ°å½“å‰ä¸åœ¨åŒä¸€åˆ—ä¸Šï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $Nâ‰¤30000,Tâ‰¤500000$

**è¾“å…¥æ ·ä¾‹**

```c++
4
M 2 3
C 1 2
M 2 4
C 4 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
-1
1
```

**æ‰‹å†™ç¨¿**

![6181258](img/6181258.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 30010;
int n;
int p[N], sum[N], d[N];
int find(int x) {
    if (p[x] == x) return p[x];
    // æ‰¾åˆ°p[x]çš„ç¥–å…ˆ
    int root = find(p[x]);
    // æ³¨æ„: è¿™é‡Œæ·»åŠ çš„æ˜¯xçš„ç¥–å…ˆp[x]çš„è·ç¦»è€Œä¸æ˜¯p[x]çš„ç¥–å…ˆrootçš„è·ç¦»!!!!
    // [æ‰‹å†™ç¨¿è¿›ä¸€æ­¥è¯´æ˜]
    d[x] += d[p[x]];
    return p[x] = root;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i < N; i ++ ) {
        // æ¯ä¸ªæ•°çš„ç¥–å…ˆå‡æ˜¯è‡ªå·±
        p[i] = i;
        // ä¸€å¼€å§‹é›†åˆå†…åªæœ‰ä¸€ä¸ªæ•°å­—
        sum[i] = 1;
    }
    for (int i = 0; i < n; i ++ ) {
        char op[2];
        int a, b;
        scanf("%s%d%d", op, &a, &b);
        int pa = find(a);
        int pb = find(b);
        if (op[0] == 'M') {
            // å¦‚æœaå’Œbä¸åœ¨ä¸€ä¸ªé›†åˆå†…éƒ¨
            if (pa != pb) {
                // å…ˆæ›´æ–°d[pa]çš„å€¼
                d[pa] = sum[pb];
                // å†æ›´æ–°bæ‰€åœ¨é›†åˆå†…çš„å…ƒç´ æ•°ç›®
                sum[pb] += sum[pa];
                // æ³¨æ„: é¢˜ç›®è¦æ±‚æ˜¯aæ¥åˆ°båé¢!!!
                p[pa] = pb;
            }
        }
        else {
            if (pa != pb) puts("-1");
            // è®¡ç®—éš”é—´æ•°é‡åº”ä¸º d[a] - d[b] - 1 !!æ³¨æ„: é—´éš”!!
            // 1 2 3, åˆ™1å’Œ3é—´éš”çš„æ•°é‡ä¸º1, å³ä¸º2
            // å¦‚æœä¸¤ä¸ªæˆ˜èˆ°ç´§æŒ¨ç€, åˆ™é—´éš”æˆ˜èˆ°æ•°é‡ä¸º0, æ•…, éœ€è¦å’Œ0å–ä¸ªmaxå³å¯
            else cout << max(0, abs(d[a] - d[b]) - 1) << endl;
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(Tlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¸¦æƒå¹¶æŸ¥é›†`

**ç¼åˆæ€ª**





## æ ‘çŠ¶æ•°ç»„

### åŸç†

**æ‰‹å†™ç¨¿**

![1262039](img/1262039.png)

### æ³¨æ„äº‹é¡¹

> 1. <font style="color: red">**å…ˆææ˜ç™½æ ‘çŠ¶æ•°ç»„å­˜çš„å€¼çš„æ„ä¹‰ï¼Œæ­¤ç‚¹è‡³å…³é‡è¦ï¼ï¼ï¼**</font>

### [P3374 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ 1](https://www.luogu.com.cn/problem/P3374)

**é¢˜ç›®æè¿°**

> å¦‚é¢˜ï¼Œå·²çŸ¥ä¸€ä¸ªæ•°åˆ—ï¼Œä½ éœ€è¦è¿›è¡Œä¸‹é¢ä¸¤ç§æ“ä½œï¼š
>
> - å°†æŸä¸€ä¸ªæ•°åŠ ä¸Š `x`
> - æ±‚å‡ºæŸåŒºé—´æ¯ä¸€ä¸ªæ•°çš„å’Œ

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ­£æ•´æ•° `n,m`ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥æ•°åˆ—æ•°å­—çš„ä¸ªæ•°å’Œæ“ä½œçš„æ€»ä¸ªæ•°ã€‚
>
> ç¬¬äºŒè¡ŒåŒ…å« `n` ä¸ªç”¨ç©ºæ ¼åˆ†éš”çš„æ•´æ•°ï¼Œå…¶ä¸­ç¬¬ `i` ä¸ªæ•°å­—è¡¨ç¤ºæ•°åˆ—ç¬¬ `i` é¡¹çš„åˆå§‹å€¼ã€‚
>
> æ¥ä¸‹æ¥ `m` è¡Œæ¯è¡ŒåŒ…å« `3` ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œï¼Œå…·ä½“å¦‚ä¸‹ï¼š
>
> - `1 x k` å«ä¹‰ï¼šå°†ç¬¬ `x` ä¸ªæ•°åŠ ä¸Š `k`
> - `2 x y` å«ä¹‰ï¼šè¾“å‡ºåŒºé—´ `[x,y]` å†…æ¯ä¸ªæ•°çš„å’Œ

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºåŒ…å«è‹¥å¹²è¡Œæ•´æ•°ï¼Œå³ä¸ºæ‰€æœ‰æ“ä½œ `2` çš„ç»“æœã€‚

**è¾“å…¥ #1**

```c++
5 5
1 5 4 2 3
1 1 3
2 2 5
1 3 -1
1 4 2
2 1 4
```

**è¾“å‡º #1**

```c++
14
16
```

**æ•°æ®èŒƒå›´**

> å¯¹äº `30%` çš„æ•°æ®ï¼Œ$1â‰¤nâ‰¤8$ï¼Œ$1â‰¤mâ‰¤10$ï¼›
> å¯¹äº `70%` çš„æ•°æ®ï¼Œ$1â‰¤n,mâ‰¤10^4$ï¼›
> å¯¹äº `100%` çš„æ•°æ®ï¼Œ$1â‰¤n,mâ‰¤5Ã—10^5$ã€‚

**æ ·ä¾‹è¯´æ˜**

![img](img/2256.png)

æ•…è¾“å‡ºç»“æœ`14ã€16`

**ä»£ç **

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 500010;
int n, m;
LL tr[N];
int lowbit(int x) {
    return x & -x;
}
void add(int x, int c) {
    for (int i = x; i <= n; i += lowbit(i)) tr[i] += c;
    return;
}
int sum(int x) {
    LL res = 0;
    for (int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1, t; i <= n; i ++ ) {
        scanf("%d", &t);
        // ä¸€å¼€å§‹åœ¨æ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡ä¸ºiçš„ä½ç½®ä¸Šæ·»åŠ t
        add(i, t);
        // æ³¨æ„å¿…é¡»ä½¿ç”¨addå‡½æ•°ï¼Œå› ä¸ºaddå‡½æ•°å½“ä¸­åŒ…å«å¯¹å…¶ä»–ä¸‹æ ‡çš„å€¼çš„æ›´æ–°
    }
    while (m -- ) {
        int op, x, y;
        scanf("%d%d%d", &op, &x, &y);
        if (op == 1) add(x, y);
        else cout << sum(y) - sum(x - 1) << endl;
    }
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘çŠ¶æ•°ç»„`

### [P1908 é€†åºå¯¹](https://www.luogu.com.cn/problem/P1908)

**é¢˜ç›®æè¿°**

>   çŒ«çŒ« `TOM` å’Œå°è€é¼  `JERRY` æœ€è¿‘åˆè¾ƒé‡ä¸Šäº†ï¼Œä½†æ˜¯æ¯•ç«Ÿéƒ½æ˜¯æˆå¹´äººï¼Œä»–ä»¬å·²ç»ä¸å–œæ¬¢å†ç©é‚£ç§ä½ è¿½æˆ‘èµ¶çš„æ¸¸æˆï¼Œç°åœ¨ä»–ä»¬å–œæ¬¢ç©ç»Ÿè®¡ã€‚
>
>   æœ€è¿‘ï¼Œ`TOM` è€çŒ«æŸ¥é˜…åˆ°ä¸€ä¸ªäººç±»ç§°ä¹‹ä¸ºâ€œé€†åºå¯¹â€çš„ä¸œè¥¿ï¼Œè¿™ä¸œè¥¿æ˜¯è¿™æ ·å®šä¹‰çš„ï¼šå¯¹äºç»™å®šçš„ä¸€æ®µæ­£æ•´æ•°åºåˆ—ï¼Œé€†åºå¯¹å°±æ˜¯åºåˆ—ä¸­ $a_i>a_j$ ä¸” $i<j$ çš„æœ‰åºå¯¹ã€‚çŸ¥é“è¿™æ¦‚å¿µåï¼Œä»–ä»¬å°±æ¯”èµ›è°å…ˆç®—å‡ºç»™å®šçš„ä¸€æ®µæ­£æ•´æ•°åºåˆ—ä¸­é€†åºå¯¹çš„æ•°ç›®ã€‚æ³¨æ„åºåˆ—ä¸­å¯èƒ½æœ‰é‡å¤æ•°å­—ã€‚
>
>   **Update:æ•°æ®å·²åŠ å¼ºã€‚**

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œï¼Œä¸€ä¸ªæ•° `n`ï¼Œè¡¨ç¤ºåºåˆ—ä¸­æœ‰ `n` ä¸ªæ•°ã€‚
>
>   ç¬¬äºŒè¡Œ `n` ä¸ªæ•°ï¼Œè¡¨ç¤ºç»™å®šçš„åºåˆ—ã€‚åºåˆ—ä¸­æ¯ä¸ªæ•°å­—ä¸è¶…è¿‡ $10^9$ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºåºåˆ—ä¸­é€†åºå¯¹çš„æ•°ç›®ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
6
5 4 2 6 3 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
11
```

**è¯´æ˜/æç¤º**

>   å¯¹äº $25\%$ çš„æ•°æ®ï¼Œ$n \leq 2500$
>
>   å¯¹äº $50\%$ çš„æ•°æ®ï¼Œ$n \leq 4 \times 10^4$ã€‚
>
>   å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$n \leq 5 \times 10^5$
>
>   è¯·ä½¿ç”¨è¾ƒå¿«çš„è¾“å…¥è¾“å‡º
>
>   åº”è¯¥ä¸ä¼š $O(n^2)$ è¿‡ $50$ ä¸‡å§ $by chen_zhe$

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



### [AcWing 241. æ¥¼å…°å›¾è…¾](https://www.acwing.com/problem/content/243/)

**é¢˜ç›®æè¿°**

> åœ¨å®Œæˆäº†åˆ†é…ä»»åŠ¡ä¹‹åï¼Œè¥¿éƒ¨ `314` æ¥åˆ°äº†æ¥¼å…°å¤åŸçš„è¥¿éƒ¨ã€‚
>
> ç›¸ä¼ å¾ˆä¹…ä»¥å‰è¿™ç‰‡åœŸåœ°ä¸Š(æ¯”æ¥¼å…°å¤åŸè¿˜æ—©)ç”Ÿæ´»ç€ä¸¤ä¸ªéƒ¨è½ï¼Œä¸€ä¸ªéƒ¨è½å´‡æ‹œå°–åˆ€(`V`)ï¼Œä¸€ä¸ªéƒ¨è½å´‡æ‹œé“é”¹(`âˆ§`)ï¼Œä»–ä»¬åˆ†åˆ«ç”¨ `V` å’Œ `âˆ§` çš„å½¢çŠ¶æ¥ä»£è¡¨å„è‡ªéƒ¨è½çš„å›¾è…¾ã€‚
>
> è¥¿éƒ¨ `314` åœ¨æ¥¼å…°å¤åŸçš„ä¸‹é¢å‘ç°äº†ä¸€å¹…å·¨å¤§çš„å£ç”»ï¼Œå£ç”»ä¸Šè¢«æ ‡è®°å‡ºäº† `n` ä¸ªç‚¹ï¼Œç»æµ‹é‡å‘ç°è¿™ `n` ä¸ªç‚¹çš„æ°´å¹³ä½ç½®å’Œç«–ç›´ä½ç½®æ˜¯ä¸¤ä¸¤ä¸åŒçš„ã€‚
>
> è¥¿éƒ¨ `314` è®¤ä¸ºè¿™å¹…å£ç”»æ‰€åŒ…å«çš„ä¿¡æ¯ä¸è¿™ `n` ä¸ªç‚¹çš„ç›¸å¯¹ä½ç½®æœ‰å…³ï¼Œå› æ­¤ä¸å¦¨è®¾åæ ‡åˆ†åˆ«ä¸º $(1,y_1),(2,y_2),â€¦,(n,y_n)ï¼Œ$å…¶ä¸­ $y_1âˆ¼y_n$ æ˜¯ `1` åˆ° `n` çš„ä¸€ä¸ªæ’åˆ—ã€‚
>
> è¥¿éƒ¨ `314` æ‰“ç®—ç ”ç©¶è¿™å¹…å£ç”»ä¸­åŒ…å«ç€å¤šå°‘ä¸ªå›¾è…¾ã€‚
>
> å¦‚æœä¸‰ä¸ªç‚¹ $(i,y_i),(j,y_j),(k,y_k)$ æ»¡è¶³ `1â‰¤i<j<kâ‰¤n` ä¸” $y_i>y_j,y_j<y_k$ï¼Œåˆ™ç§°è¿™ä¸‰ä¸ªç‚¹æ„æˆ `V` å›¾è…¾;
>
> å¦‚æœä¸‰ä¸ªç‚¹ $(i,y_i),(j,y_j),(k,y_k)$ æ»¡è¶³ `1â‰¤i<j<kâ‰¤n` ä¸” $y_i<y_j,y_j>y_k$ï¼Œåˆ™ç§°è¿™ä¸‰ä¸ªç‚¹æ„æˆ `âˆ§` å›¾è…¾;
>
> è¥¿éƒ¨ `314` æƒ³çŸ¥é“ï¼Œè¿™ `n` ä¸ªç‚¹ä¸­ä¸¤ä¸ªéƒ¨è½å›¾è…¾çš„æ•°ç›®ã€‚
>
> å› æ­¤ï¼Œä½ éœ€è¦ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥æ±‚å‡º `V` çš„ä¸ªæ•°å’Œ `âˆ§` çš„ä¸ªæ•°ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸€ä¸ªæ•° `n`ã€‚
>
> ç¬¬äºŒè¡Œæ˜¯ `n` ä¸ªæ•°ï¼Œåˆ†åˆ«ä»£è¡¨ `y1ï¼Œy2,â€¦,yn`ã€‚

**è¾“å‡ºæ ¼å¼**

> ä¸¤ä¸ªæ•°ï¼Œä¸­é—´ç”¨ç©ºæ ¼éš”å¼€ï¼Œä¾æ¬¡ä¸º `V` çš„ä¸ªæ•°å’Œ `âˆ§` çš„ä¸ªæ•°ã€‚

**æ•°æ®èŒƒå›´**

> å¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ`nâ‰¤200000`ï¼Œä¸”è¾“å‡ºç­”æ¡ˆä¸ä¼šè¶…è¿‡ `int64`ã€‚
> $y_1âˆ¼y_n$ æ˜¯ `1` åˆ° `n` çš„ä¸€ä¸ªæ’åˆ—ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
5
1 5 3 2 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3 4
```

**æ‰‹å†™ç¨¿**

> 1. ä½¿ç”¨ `g[i]` è¡¨ç¤ºåŸæ•°ç»„ï¼›`tr[i]` è¡¨ç¤ºåœ¨æ ‘çŠ¶æ•°ç»„ä¸­<font style="color: red">ä¸‹æ ‡ä¸º `i` </font>çš„ä½ç½®ä¸Šæœ‰ä¸€ä¸ªæ•°å­—ï¼Œä½¿ç”¨ `1` åšæ ‡è®°ï¼›å¦‚æœä¸‹æ ‡ä¸º `i` çš„ä½ç½®ä¸Šæ²¡æœ‰æ•°å­—ï¼Œä½¿ç”¨ `0` åšæ ‡è®°ï¼Œç”±äºæ•°ç»„åˆå§‹åŒ–ä¸º `0`ï¼Œå› æ­¤ï¼Œä¸éœ€è¦å†é¢å¤–åšæ ‡è®° ï¼›`great[i]` è¡¨ç¤º `g` æ•°ç»„ä¸­æ¯” `g[i]` å¤§çš„æ•°å­—çš„ä¸ªæ•°ï¼›`lesser[i]` è¡¨ç¤º `g` æ•°ç»„ä¸­æ¯” `g[i]` å°çš„æ•°å­—çš„ä¸ªæ•°
> 2. ä»¥ `g` æ•°ç»„çš„æ¯ä¸€ä¸ªä¸‹æ ‡ `i` ä¸ºç´¢å¼•ï¼Œå¯»æ‰¾ `i` å·¦è¾¹æ¯” `g[i]` å¤§çš„æ•°å­—çš„ä¸ªæ•°å’Œ `i` å³è¾¹æ¯” `g[i]` å¤§çš„æ•°å­—çš„ä¸ªæ•°ï¼Œæ ¹æ®ä¹˜æ³•åŸç†ï¼Œä¸¤è€…å³å¯æ±‚å¾— $\vee$ çš„ä¸ªæ•°ï¼›åŒç†ï¼Œæ±‚å¾— $\wedge$ çš„ä¸ªæ•°
> 3. ä¸¤æ¬¡éå†ã€<font style="color: red">ææ˜“æ··æ·†éœ€é‡ç‚¹é˜…è¯»</font>ã€‘
>     + ç¬¬ä¸€æ¬¡éå†ã€<font style="color: red">ä»å‰å¾€å</font>ã€‘
>         + åœ¨å½“å‰æƒ…å†µï¼ˆä»å‰å¾€åï¼‰ä¸‹ï¼Œ`great[i]` è¡¨ç¤º `g` æ•°ç»„ä¸­æ‰€æœ‰ä¸‹æ ‡åœ¨ `i` <font style="color: red">ä¹‹å‰</font>çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯” `g[i]` <font style="color: red">å¤§</font> çš„æ•°å­—çš„ä¸ªæ•°ï¼›`less[i]` è¡¨ç¤º `g` æ•°ç»„ä¸­æ‰€æœ‰ä¸‹æ ‡åœ¨ `i` <font style="color: red">ä¹‹å‰</font>çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯” `g[i]` <font style="color: red">å°Â </font>çš„æ•°å­—çš„ä¸ªæ•°
>     + ç¬¬äºŒæ¬¡éå†ã€<font style="color: red">ä»åå¾€å‰</font>ã€‘
>         + åœ¨å½“å‰æƒ…å†µï¼ˆä»åå¾€å‰ï¼‰ä¸‹ï¼Œ`great[i]` è¡¨ç¤º `g` æ•°ç»„ä¸­æ‰€æœ‰ä¸‹æ ‡åœ¨ `i` <font style="color: red">ä¹‹å</font>çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯” `g[i]` <font style="color: red">å¤§</font> çš„æ•°å­—çš„ä¸ªæ•°ï¼›`less[i]` è¡¨ç¤º `g` æ•°ç»„ä¸­æ‰€æœ‰ä¸‹æ ‡åœ¨ `i` <font style="color: red">ä¹‹å</font>çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯” `g[i]` <font style="color: red">å°</font> çš„æ•°å­—çš„ä¸ªæ•°

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
typedef long long LL;
const int N = 200010;
int n;
int g[N], tr[N], great[N], lesser[N];
int lowbit(int x) {
    return x & -x;
}
void add(int x, int c) {
    for (int i = x; i <= n; i += lowbit(i) ) tr[i] += c;
    return;
}
int sum(int x) {
    int res = 0; 
    for (int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &g[i]);
    // ã€ä»å‰å¾€åã€‘éå†æ•°ç»„
    for (int i = 1; i <= n; i ++ ) {
        int y = g[i];
        // great[i]è¡¨ç¤ºåœ¨ã€ä¸‹æ ‡ã€‘iã€ä¹‹å‰ã€‘çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯”yã€å¤§ã€‘çš„æ•°å­—çš„ä¸ªæ•°
        great[i] = sum(n) - sum(y);
        // lesser[i]è¡¨ç¤ºåœ¨ã€ä¸‹æ ‡ã€‘iã€ä¹‹å‰ã€‘çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯”yã€å°ã€‘çš„æ•°å­—çš„ä¸ªæ•°
        lesser[i] = sum(y - 1);
        // åœ¨ä¸‹æ ‡ä¸ºyçš„ä½ç½®ä¸Šæ·»åŠ 1ï¼Œè¡¨ç¤ºåœ¨ä¸‹æ ‡ä¸ºyçš„ä½ç½®ä¸Šæœ‰ä¸€ä¸ªæ•°å­—
        add(y, 1);
    }
    // åˆå§‹åŒ–æ•°ç»„
    memset(tr, 0, sizeof tr);
    LL res1 = 0, res2 = 0;
    // ã€ä»åå¾€å‰ã€‘éå†æ•°ç»„
    for (int i = n; i; i -- ) {
        int y = g[i];
        // sum(n) - sum(y) è¡¨ç¤ºåœ¨ã€ä¸‹æ ‡ã€‘ä¸ºiã€ä¹‹åã€‘çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯”yã€å¤§ã€‘çš„æ•°å­—çš„ä¸ªæ•°
        res1 += great[i] * (LL)(sum(n) - sum(y));
        // sum(y - 1) è¡¨ç¤ºåœ¨ã€ä¸‹æ ‡ã€‘ä¸ºiã€ä¹‹åã€‘çš„æ‰€æœ‰æ•°å­—å½“ä¸­æ¯”yã€å°ã€‘çš„æ•°å­—çš„ä¸ªæ•°
        res2 += lesser[i] * (LL)sum(y - 1);
        // åœ¨ä¸‹æ ‡ä¸ºyçš„ä½ç½®ä¸Šæ·»åŠ 1ï¼Œè¡¨ç¤ºåœ¨ä¸‹æ ‡ä¸ºyçš„ä½ç½®ä¸Šæœ‰ä¸€ä¸ªæ•°å­—
        add(y, 1);
    }
    printf("%lld %lld\n", res1, res2);
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘çŠ¶æ•°ç»„`

### [AcWing 242. ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜](https://www.acwing.com/problem/content/description/248/)

**é¢˜ç›®æè¿°**

> ç»™å®šé•¿åº¦ä¸º `N` çš„æ•°åˆ— `A`ï¼Œç„¶åè¾“å…¥ `M` è¡Œæ“ä½œæŒ‡ä»¤ã€‚
>
> ç¬¬ä¸€ç±»æŒ‡ä»¤å½¢å¦‚ `C l r d`ï¼Œè¡¨ç¤ºæŠŠæ•°åˆ—ä¸­ç¬¬ `lâˆ¼r` ä¸ªæ•°éƒ½åŠ  `d`ã€‚
>
> ç¬¬äºŒç±»æŒ‡ä»¤å½¢å¦‚ `Q x`ï¼Œè¡¨ç¤ºè¯¢é—®æ•°åˆ—ä¸­ç¬¬ `x` ä¸ªæ•°çš„å€¼ã€‚
>
> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `N` å’Œ `M`ã€‚
>
> ç¬¬äºŒè¡ŒåŒ…å« `N` ä¸ªæ•´æ•° `A[i]`ã€‚
>
> æ¥ä¸‹æ¥ `M` è¡Œè¡¨ç¤º `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤çš„æ ¼å¼å¦‚é¢˜ç›®æè¿°æ‰€ç¤ºã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚
>
> æ¯ä¸ªç­”æ¡ˆå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤N,Mâ‰¤10^5$,
> + $|d|â‰¤10000$,
> + $|A[i]|â‰¤10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
10 5
1 2 3 4 5 6 7 8 9 10
Q 4
Q 1
Q 2
C 1 6 3
Q 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
1
2
5
```

**æ­¥éª¤**

> 1. æ ‘çŠ¶æ•°ç»„å¯ä»¥è§£å†³çš„é—®é¢˜ï¼š
>     + åŒºé—´æ±‚å’Œ
>     + å•ç‚¹æ›´æ–°
>
> 2. æœ¬é¢˜çš„è¦æ±‚æœ‰ä¸¤ä¸ªæ“ä½œ
>
>     + å°†åŸæ•°ç»„å˜æˆæ ‘çŠ¶æ•°ç»„ï¼ˆå·®åˆ†æ•°ç»„ï¼‰
>
>     + å°†é¢˜ç›®ä¸­çš„ä¸¤ä¸ªæ“ä½œå˜æˆæ ‘çŠ¶æ•°ç»„çš„ç»å…¸æ“ä½œ
>
>         + ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯æ•°åˆ—ä¸­çš„ç¬¬ `l ï½ r` ä¸ªæ•°å­—éƒ½åŠ ä¸Š `d`ï¼Œåˆ†è‹¥å¹²ä¸ªæ­¥éª¤å°†å…¶è½¬åŒ–ä¸ºæ ‘çŠ¶æ•°ç»„çš„ç»å…¸æ“ä½œä¹‹ä¸€å³å•ç‚¹æ›´æ–°
>             + ç¬¬ `l ï½ r` ä¸ªæ•°å­—æ·»åŠ  `d`ï¼Œç”±å·®åˆ†æ•°ç»„ `tr` å¯çŸ¥ï¼Œ`tr[l] += dï¼Œtr[r + 1] -= d` å³å¯å®Œæˆæ“ä½œï¼Œå¯¹åº”æ ‘çŠ¶æ•°ç»„ç»å…¸æ“ä½œçš„å•ç‚¹æ›´æ–°
>
>         + ç¬¬äºŒä¸ªæ“ä½œæ˜¯æŸ¥è¯¢æ•°åˆ—ä¸­çš„ç¬¬ `x` ä¸ªæ•°å­—ï¼Œåˆ†è‹¥å¹²ä¸ªæ­¥éª¤å°†å…¶è½¬åŒ–ä¸ºæ ‘çŠ¶æ•°ç»„çš„ç»å…¸æ“ä½œä¹‹ä¸€å³åŒºé—´æ±‚å’Œ
>             + ä¿®æ”¹ç¬¬ `x` ä¸ªæ•°å­—ï¼Œç”±å·®åˆ†æ•°ç»„ `tr` å¯çŸ¥ï¼Œ`sum[1 ~ x]` å³ä¸ºç¬¬ `x` ä¸ªæ•°å­—çš„å€¼ï¼Œå¯¹åº”æ ‘çŠ¶æ•°ç»„çš„åŒºé—´æ±‚å’Œæ“ä½œ

**ä»£ç **

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 100010;
int n, m;
int g[N], tr[N];
int lowbit(int x) {
    return x & -x;
}
void add(int x, int c) {
    for (int i = x; i <= n; i += lowbit(i)) tr[i] += c;
    return;
}
int sum(int x) {
    int res = 0;
    for (int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
}
int main() {
    scanf("%d%d",&n, &m);
    for (int i = 1; i <= n; i ++ ) {
        scanf("%d", &g[i]);
        // æ„å»ºå·®åˆ†æ ‘çŠ¶æ•°ç»„
        add(i, g[i] - g[i - 1]);
    }
    char op[2];
    while (m -- ) {
        scanf("%s", op);
        if (op[0] == 'C') {
            int l, r, d;
            scanf("%d%d%d", &l, &r, &d);
            // tr[l] += d;
            add(l, d);
            // tr[r + 1] -= d;
            add(r + 1, -d);
        }
        else {
            int x;
            scanf("%d", &x);
            // æ±‚å’Œ
            cout << sum(x) << endl;
        }
    }
    return 0;
}
```

### [AcWing 243. ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜2](https://www.acwing.com/problem/content/244/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º `N` çš„æ•°åˆ— `A`ï¼Œä»¥åŠ `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤å¯èƒ½æ˜¯ä»¥ä¸‹ä¸¤ç§ä¹‹ä¸€ï¼š
>
> 1. `C l r d`ï¼Œè¡¨ç¤ºæŠŠ `A[l],A[l+1],â€¦,A[r]` éƒ½åŠ ä¸Š `d`ã€‚
> 2. `Q l r`ï¼Œè¡¨ç¤ºè¯¢é—®æ•°åˆ—ä¸­ç¬¬ `lâˆ¼r` ä¸ªæ•°çš„å’Œã€‚
>
> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `N,M`ã€‚
>
> ç¬¬äºŒè¡Œ `N` ä¸ªæ•´æ•° `A[i]`ã€‚
>
> æ¥ä¸‹æ¥ `M` è¡Œè¡¨ç¤º `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤çš„æ ¼å¼å¦‚é¢˜ç›®æè¿°æ‰€ç¤ºã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚
>
> æ¯ä¸ªç­”æ¡ˆå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤N,Mâ‰¤10^5,$
> + $|d|â‰¤10000,$
> + $|A[i]|â‰¤10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
10 5
1 2 3 4 5 6 7 8 9 10
Q 4 4
Q 1 10
Q 2 4
C 3 6 3
Q 2 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
55
9
15
```

**æ‰‹å†™ç¨¿**

![1292230](img/1292230.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 100010;
int n, m;
int g[N];
LL tr1[N], tr2[N];
int lowbit(int x) {
    return x & -x;
}
void add(LL tr[], int x, LL c) {
    for (int i = x; i <= n; i += lowbit(i)) tr[i] += c;
    return;
}
LL sum(LL tr[], LL x) {
    LL res = 0;
    for (int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
}
LL prefix_sum(int x) {
    return sum(tr1, x) * (x + 1) - sum(tr2, x);
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &g[i]);
    for (int i = 1; i <= n; i ++ ) {
        int b = g[i] - g[i - 1];
        // ç¬¬ä¸€ä¸ªæ•°ç»„tr1å­˜çš„æ˜¯çº¢+ç´«
        add(tr1, i, b);
        // ç¬¬äºŒä¸ªæ•°ç»„tr2å­˜çš„æ˜¯ç´«
        add(tr2, i, (LL)i * b);
    }
    while (m -- ) {
        char op[2];
        scanf("%s", op);
        if (op[0] == 'C') {
            int l, r, d;
            scanf("%d%d%d", &l, &r, &d);
            add(tr1, l, d), add(tr2, l, l * d);
            add(tr1, r + 1, -d), add(tr2, r + 1, (r + 1) * -d);
        }
        else {
            int l, r;
            scanf("%d%d", &l, &r);
            cout << prefix_sum(r) - prefix_sum(l - 1) << endl;
        }
    }
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘çŠ¶æ•°ç»„`

### [AcWing 244. è°œä¸€æ ·çš„ç‰›](https://www.acwing.com/problem/content/245/)

**é¢˜ç›®æè¿°**

> æœ‰ `n` å¤´å¥¶ç‰›ï¼Œå·²çŸ¥å®ƒä»¬çš„èº«é«˜ä¸º `1âˆ¼n` ä¸”å„ä¸ç›¸åŒï¼Œä½†ä¸çŸ¥é“æ¯å¤´å¥¶ç‰›çš„å…·ä½“èº«é«˜ã€‚
>
> ç°åœ¨è¿™ `n` å¤´å¥¶ç‰›ç«™æˆä¸€åˆ—ï¼Œå·²çŸ¥ç¬¬ `i` å¤´ç‰›å‰é¢æœ‰ $A_i$ å¤´ç‰›æ¯”å®ƒä½ï¼Œæ±‚æ¯å¤´å¥¶ç‰›çš„èº«é«˜ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ `1` è¡Œï¼šè¾“å…¥æ•´æ•° `n`ã€‚
>
> ç¬¬ `2..n` è¡Œï¼šæ¯è¡Œè¾“å…¥ä¸€ä¸ªæ•´æ•° $A_i$ï¼Œç¬¬ `i` è¡Œè¡¨ç¤ºç¬¬ `i` å¤´ç‰›å‰é¢æœ‰ $A_i$ å¤´ç‰›æ¯”å®ƒä½ã€‚
> ï¼ˆæ³¨æ„ï¼šå› ä¸ºç¬¬ `1` å¤´ç‰›å‰é¢æ²¡æœ‰ç‰›ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å°†å®ƒåˆ—å‡ºï¼‰

**è¾“å‡ºæ ¼å¼**

> è¾“å‡ºåŒ…å« `n` è¡Œï¼Œæ¯è¡Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç‰›çš„èº«é«˜ã€‚
>
> ç¬¬ `i` è¡Œè¾“å‡ºç¬¬ `i` å¤´ç‰›çš„èº«é«˜ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤nâ‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
5
1
2
1
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
4
5
3
1
```

**æ‰‹å†™ç¨¿**

![1301406](img/1301406.png)

**æ­¥éª¤**

> 1. `h[i]` ä»£è¡¨åœ¨ç¬¬ `i` å¤´ç‰›ä¹‹å‰æœ‰ `h[i]` å¤´ç‰›æ¯”å½“å‰ç¬¬ `i` å¤´ç‰›çŸ®
> 2. ä»åå¾€å‰éå†ï¼Œåœ¨å‰©ä¸‹çš„æ•°å­—ï¼ˆåŒ…æ‹¬å½“å‰æ•°å­—ï¼‰å½“ä¸­å¯»æ‰¾ç¬¬ `h[i] + 1` å°çš„æ•°å­—å³å¯
> 3. æ ·ä¾‹æ¨¡æ‹Ÿï¼ˆä»åå¾€å‰ï¼‰
>     + åˆå§‹åŒ–ï¼šç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´ `1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5`ï¼ˆä¸ä¸€å®šæœ‰åºï¼‰
>     + ç¬¬ä¸€æ­¥ï¼šå€’æ•°ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯ `0`ï¼Œä»£è¡¨åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[1, 2, 3, 4, 5]`å†…æœ‰ `0` å¤´ç‰›æ¯”è‡ªå·±çŸ®ï¼Œå³åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[1, 2, 3, 4, 5]`å†…å¯»æ‰¾ç¬¬ `1(h[i] + 1)` å°çš„é«˜åº¦çš„ç‰›ï¼Œå³ä¸º `1`ï¼Œæ­¤æ—¶ï¼Œå‰©ä¸‹çš„ç‰›çš„é«˜åº¦é€‰æ‹©å¯ä¸º `2ï¼Œ3ï¼Œ4ï¼Œ5`
>     + ç¬¬äºŒæ­¥ï¼šå€’æ•°ç¬¬äºŒä¸ªæ•°å­—æ˜¯ `1`ï¼Œä»£è¡¨åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[2, 3, 4, 5]`å†…æœ‰ `1` å¤´ç‰›æ¯”è‡ªå·±çŸ®ï¼Œå³åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[2, 3, 4, 5]`å†…å¯»æ‰¾ç¬¬ `2(h[i] + 1)` å°çš„é«˜åº¦çš„ç‰›ï¼Œå³ä¸º `3`ï¼Œæ­¤æ—¶ï¼Œå‰©ä¸‹çš„ç‰›çš„é«˜åº¦é€‰æ‹©å¯ä¸º `2ï¼Œ4ï¼Œ5`
>     + ç¬¬ä¸‰æ­¥ï¼šå€’æ•°ç¬¬ä¸‰ä¸ªæ•°å­—æ˜¯ `2`ï¼Œä»£è¡¨åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[2, 4, 5]`å†…æœ‰ `2` å¤´ç‰›æ¯”è‡ªå·±çŸ®ï¼Œå³åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[2, 4, 5]`å†…å¯»æ‰¾ç¬¬ `3(h[i] + 1)` å°çš„é«˜åº¦çš„ç‰›ï¼Œå³ä¸º `5`ï¼Œæ­¤æ—¶ï¼Œå‰©ä¸‹çš„ç‰›çš„é«˜åº¦é€‰æ‹©å¯ä¸º `2ï¼Œ4`
>     + ç¬¬å››æ­¥ï¼šå€’æ•°ç¬¬å››ä¸ªæ•°å­—æ˜¯ `1`ï¼Œä»£è¡¨åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[2, 4]`å†…æœ‰ `1` å¤´ç‰›æ¯”è‡ªå·±çŸ®ï¼Œå³åœ¨ç‰›çš„é«˜åº¦å¯é€‰æ‹©èŒƒå›´`[2, 4]`å†…å¯»æ‰¾ç¬¬ `2(h[i] + 1)` å°çš„é«˜åº¦çš„ç‰›ï¼Œå³ä¸º `4`ï¼Œæ­¤æ—¶ï¼Œå‰©ä¸‹çš„ç‰›çš„é«˜åº¦å¯é€‰æ‹©ä¸º `2`
>     + ç¬¬äº”æ­¥ï¼šå‰©ä¸‹çš„ç‰›çš„é«˜åº¦ä¸º `2`ï¼Œæ•…ç­”æ¡ˆä¸º `[2, 4, 5, 3, 1]`
> 4. å®ç°æ–¹å¼ï¼šæ ‘çŠ¶æ•°ç»„ + äºŒåˆ†
>     + æ ‘çŠ¶æ•°ç»„ `tr[i]` è¡¨ç¤ºé«˜åº¦ä¸º `i` æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œ`1` ä»£è¡¨å¯ä½¿ç”¨ï¼Œå¦åˆ™ï¼Œä¸å¯ä½¿ç”¨
>         + æ ‘çŠ¶æ•°ç»„åˆå§‹åŒ–ä¸º `1`ï¼Œè¡¨æ˜ä¸€å¼€å§‹ï¼Œæ¯ä¸ªæ•°å­—éƒ½å¯ä»¥ä½¿ç”¨
>     + æ ‘çŠ¶æ•°ç»„ `sum[i]` å‰ç¼€å’Œæ˜¯å•è°ƒçš„ï¼Œæ•…å¯ä»¥ä½¿ç”¨äºŒåˆ†
> 5. æ³¨æ„äº‹é¡¹
>     + äºŒåˆ†çš„æ˜¯ã€<font style = "color: red">**ç‰›çš„é«˜åº¦**</font>ã€‘
>     + æ ‘çŠ¶æ•°ç»„ `tr[i]` è¡¨ç¤ºé«˜åº¦ä¸º `i` çš„ç‰›æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œ`1` ä»£è¡¨å¯ä»¥ä½¿ç”¨ï¼Œå¦åˆ™ï¼Œä¸å¯ä½¿ç”¨

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int n;
int h[N], tr[N], ans[N];
int lowbit(int x) {
    return x & -x;
}
void add(int x, int c) {
    for (int i = x; i <= n; i += lowbit(i)) tr[i] += c;
    return;
}
int sum(int x) {
    int res = 0;
    for (int i = x; i; i -= lowbit(i)) res += tr[i];
    return res;
}
int main() {
    scanf("%d", &n);
    // ä¸‹æ ‡ä»2å¼€å§‹ï¼Œå› ä¸ºç¬¬ä¸€å¤´ç‰›å‰é¢æ²¡æœ‰æ¯”å®ƒçŸ®çš„ï¼Œé»˜è®¤ä¸º0ï¼Œé¢˜ç›®ä¸­å·²ç»æ ‡æ³¨
    for (int i = 2; i <= n; i ++ ) scanf("%d", &h[i]);
    // æ¯å¤´ç‰›åˆå§‹åŒ–ä¸º1ï¼Œè¡¨æ˜å½“å‰è¿™å¤´ç‰›çš„é«˜åº¦iå¯ä»¥è¢«ä½¿ç”¨ã€æœªè¢«å‰”é™¤ã€‘
    for (int i = 1; i <= n; i ++ ) add(i, 1);
    for (int i = n; i; i --) {
        // å¯»æ‰¾iå‰é¢çš„ç¬¬h[i]å°çš„æ•°ï¼Œç®—ä¸Šå½“å‰å€¼ï¼Œæ•…å¯»æ‰¾ç¬¬h[i] + 1ä¸ªæ•°å­—
        int k = h[i] + 1;
        // äºŒåˆ†çš„æ˜¯ç‰›çš„é«˜åº¦ï¼Œå³æŸ¥çœ‹å½“å‰ç‰›çš„é«˜åº¦æ˜¯å¦æ»¡è¶³ç­”æ¡ˆ
        int l = 1, r = n;
        while (l < r) {
            int mid = l + r >> 1;
            // midä»£è¡¨ç‰›çš„é«˜åº¦
            if (sum(mid) >= k) r = mid;
            else l = mid + 1;
        }
        // å°†ç»“æœåŠ å…¥ç­”æ¡ˆ
        ans[i] = r;
        // å°†å·²ç»åŠ å…¥ç­”æ¡ˆçš„æ•°å­—è¿›è¡Œæ’é™¤
        add(r, -1);
    }
    for (int i = 1; i <= n; i ++ ) cout << ans[i] << endl;
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘çŠ¶æ•°ç»„`

### [LeetCode 307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode-cn.com/problems/range-sum-query-mutable/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•°ç»„ `nums` ï¼Œè¯·ä½ å®Œæˆä¸¤ç±»æŸ¥è¯¢ã€‚
>
> å…¶ä¸­ä¸€ç±»æŸ¥è¯¢è¦æ±‚ æ›´æ–° æ•°ç»„ `nums` ä¸‹æ ‡å¯¹åº”çš„å€¼
> å¦ä¸€ç±»æŸ¥è¯¢è¦æ±‚è¿”å›æ•°ç»„ `nums` ä¸­ç´¢å¼• `left` å’Œç´¢å¼• `right` ä¹‹é—´ï¼ˆ åŒ…å« ï¼‰çš„ `nums` å…ƒç´ çš„ å’Œ ï¼Œå…¶ä¸­ `left <= right`
> å®ç° `NumArray` ç±»ï¼š
>
> + `NumArray(int[] nums)` ç”¨æ•´æ•°æ•°ç»„ `nums` åˆå§‹åŒ–å¯¹è±¡
> + `void update(int index, int val)` å°† `nums[index]` çš„å€¼ æ›´æ–° ä¸º `val`
> + `int sumRange(int left, int right)` è¿”å›æ•°ç»„ `nums` ä¸­ç´¢å¼• `left` å’Œç´¢å¼• `right` ä¹‹é—´ï¼ˆ åŒ…å« ï¼‰çš„ `nums` å…ƒç´ çš„ å’Œ `ï¼ˆå³ï¼Œnums[left] + nums[left + 1], ..., nums[right]ï¼‰`

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š
> `["NumArray", "sumRange", "update", "sumRange"]
> [[[1, 3, 5]], [0, 2], [1, 2], [0, 2]]`
> è¾“å‡ºï¼š
> `[null, 9, null, 8]`
>
> è§£é‡Šï¼š
> `NumArray numArray = new NumArray([1, 3, 5]);
> numArray.sumRange(0, 2); // è¿”å› 1 + 3 + 5 = 9
> numArray.update(1, 2);   // nums = [1,2,5]
> numArray.sumRange(0, 2); // è¿”å› 1 + 2 + 5 = 8`

**æç¤º**

> + $1 <= nums.length <= 3 * 10^4$
> + $-100 <= nums[i] <= 100$
> + $0 <= index < nums.length$
> + $-100 <= val <= 100$
> + $0 <= left <= right < nums.length$
> + $è°ƒç”¨ pdate å’Œ sumRange æ–¹æ³•æ¬¡æ•°ä¸å¤§äº 3 * 10^4 $

**è§£é¢˜æ­¥éª¤**

> 1. æ ‘çŠ¶æ•°ç»„è§£å†³çš„åŸºæœ¬é—®é¢˜
>
>     + å•ç‚¹æ›´æ–°
>     + åŒºé—´æ±‚å’Œ
>
> 2. æœ¬é¢˜å•ç‚¹æ›´æ–°ç•¥æœ‰ç‰¹æ®Šï¼Œæœ¬é¢˜çš„å•ç‚¹æ›´æ–°ä¸æ˜¯å°†æŸä¸ªå€¼ `tr[i] += val` ï¼Œè€Œæ˜¯ `tr[i] = val` ï¼Œå› æ­¤ï¼Œæœ¬é¢˜çš„ `val` åº”è¯¥ä¸º `val = val - nums[i]` ï¼Œè¿™æ ·ï¼Œ`tr[i] += val` å˜æˆ `tr[i] = tr[i] + val - nums[i] = val` ï¼ŒåŒæ—¶ï¼Œå°† `nums[i] = val` æ‰ç¬¦åˆé¢˜æ„
>
> 3. å¿…é¡»æ›´æ–°çš„åŸå› 
>
>     + æ¨¡æ‹Ÿæ ·ä¾‹
>
>         + è¾“å…¥
>
>             > `["NumArray","update","sumRange","update","sumRange"]`
>             > `[[[7]],[0,2],[0,0],[0,9],[0,0]]`
>
>         + è¾“å‡º
>
>             > `[null,null,2,null,9]`

**ä»£ç **

```c++
class NumArray {
public:
    int n;
    vector<int> tr, nums;
    int lowbit(int x) {
        return x & -x;
    }
    void add(int x, int c) {
        for (int i = x; i <= n; i += lowbit(i)) tr[i] += c;
        return;
    }
    int sum(int x) {
        int res = 0;
        for (int i = x; i; i -= lowbit(i)) res += tr[i];
        return res;
    }
    NumArray(vector<int>& _nums) {
        nums = _nums;
        n = nums.size();
        nums.resize(n + 1);
        tr = vector<int>(n + 5);
        // æ„å»ºæ ‘çŠ¶æ•°ç»„
        for (int i = 0; i < n; i ++ ) add(i + 1, nums[i]);
    }
    
    void update(int index, int val) {
        // æ ‘çŠ¶æ•°ç»„ä¸‹æ ‡ä»1å¼€å§‹
        add(index + 1, val - nums[index]);
        // æ›´æ–°åŸæ•°ç»„
        // æ›´æ–°ç¼˜ç”±åœ¨è§£é¢˜æ­¥éª¤ä¸­
        nums[index] = val;
        return;
    }
    
    int sumRange(int left, int right) {
        left ++, right ++;
        return sum(right) - sum(left - 1);
    }
};

/**
 * Your NumArray object will be instantiated and called as such:
 * NumArray* obj = new NumArray(nums);
 * obj->update(index,val);
 * int param_2 = obj->sumRange(left,right);
 */
```

**æ ‡ç­¾**

`æ ‘çŠ¶æ•°ç»„`



## çº¿æ®µæ ‘

### åŸç†

![1310947](img/1310947.png)

### [AcWing 1275. æœ€å¤§æ•°](https://www.acwing.com/problem/content/1277/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªæ­£æ•´æ•°æ•°åˆ— $a_1,a_2,â€¦,a_n$ï¼Œæ¯ä¸€ä¸ªæ•°éƒ½åœ¨ $0âˆ¼pâˆ’1$ ä¹‹é—´ã€‚
>
> å¯ä»¥å¯¹è¿™åˆ—æ•°è¿›è¡Œä¸¤ç§æ“ä½œï¼š
>
> 1. æ·»åŠ æ“ä½œï¼šå‘åºåˆ—åæ·»åŠ ä¸€ä¸ªæ•°ï¼Œåºåˆ—é•¿åº¦å˜æˆ `n+1`ï¼›
> 2. è¯¢é—®æ“ä½œï¼šè¯¢é—®è¿™ä¸ªåºåˆ—ä¸­æœ€å `L` ä¸ªæ•°ä¸­æœ€å¤§çš„æ•°æ˜¯å¤šå°‘ã€‚
>
> ç¨‹åºè¿è¡Œçš„æœ€å¼€å§‹ï¼Œæ•´æ•°åºåˆ—ä¸ºç©ºã€‚
>
> ä¸€å…±è¦å¯¹æ•´æ•°åºåˆ—è¿›è¡Œ `m` æ¬¡æ“ä½œã€‚
>
> å†™ä¸€ä¸ªç¨‹åºï¼Œè¯»å…¥æ“ä½œçš„åºåˆ—ï¼Œå¹¶è¾“å‡ºè¯¢é—®æ“ä½œçš„ç­”æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ­£æ•´æ•° `m,p`ï¼Œæ„ä¹‰å¦‚é¢˜ç›®æè¿°ï¼›
>
> æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œã€‚
>
> å¦‚æœè¯¥è¡Œçš„å†…å®¹æ˜¯ `Q L`ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªæ“ä½œæ˜¯è¯¢é—®åºåˆ—ä¸­æœ€å `L` ä¸ªæ•°çš„æœ€å¤§æ•°æ˜¯å¤šå°‘ï¼›
>
> å¦‚æœæ˜¯ `A t`ï¼Œåˆ™è¡¨ç¤ºå‘åºåˆ—åé¢åŠ ä¸€ä¸ªæ•°ï¼ŒåŠ å…¥çš„æ•°æ˜¯ `(t+a) mod p`ã€‚å…¶ä¸­ï¼Œ`t` æ˜¯è¾“å…¥çš„å‚æ•°ï¼Œ`a` æ˜¯åœ¨è¿™ä¸ªæ·»åŠ æ“ä½œä¹‹å‰æœ€åä¸€ä¸ªè¯¢é—®æ“ä½œçš„ç­”æ¡ˆï¼ˆå¦‚æœä¹‹å‰æ²¡æœ‰è¯¢é—®æ“ä½œï¼Œåˆ™ `a=0`ï¼‰ã€‚
>
> ç¬¬ä¸€ä¸ªæ“ä½œä¸€å®šæ˜¯æ·»åŠ æ“ä½œã€‚å¯¹äºè¯¢é—®æ“ä½œï¼Œ`L>0` ä¸”ä¸è¶…è¿‡å½“å‰åºåˆ—çš„é•¿åº¦ã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹äºæ¯ä¸€ä¸ªè¯¢é—®æ“ä½œï¼Œè¾“å‡ºä¸€è¡Œã€‚è¯¥è¡Œåªæœ‰ä¸€ä¸ªæ•°ï¼Œå³åºåˆ—ä¸­æœ€å `L` ä¸ªæ•°çš„æœ€å¤§æ•°ã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤mâ‰¤2Ã—10^5$,
> + $1â‰¤pâ‰¤2Ã—10^9$,
> + $0â‰¤t<p$

**è¾“å…¥æ ·ä¾‹**

```c++
10 100
A 97
Q 1
Q 1
A 17
Q 2
A 63
Q 1
Q 1
Q 3
A 99
```

**è¾“å‡ºæ ·ä¾‹**

```c++
97
97
97
60
60
97
```

**æ ·ä¾‹è§£é‡Š**

> æœ€åçš„åºåˆ—æ˜¯ `97,14,60,96`ã€‚

**å¤‡æ³¨**

![2111618](img/2111618.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 200010;
int n, m, p;
struct Node {
    int l, r, Max; // Maxæ˜¯åŒºé—´[l, r]çš„æœ€å¤§å€¼
}tr[N * 4];
void build(int u, int l, int r) { // uå½“å‰èŠ‚ç‚¹çš„ä¸‹æ ‡ï¼Œ[l, r]æ˜¯åŒºé—´å·¦å³ç«¯ç‚¹
    tr[u] = {l, r};
    // åŒºé—´åªæœ‰ä¸€ä¸ªæ•°å­—
    if (l == r) return;
    int mid = l + r >> 1;
    // å·¦å­æ ‘
    build(u << 1, l, mid);
    // å³å­æ ‘
    build(u << 1 | 1, mid + 1, r);
    return;
}
int query(int u, int l, int r) {
    // å¦‚æœçº¿æ®µæ ‘çš„åŒºé—´å®Œå…¨åŒ…å«åœ¨æ‰€æŸ¥è¯¢åŒºé—´çš„å†…éƒ¨ï¼Œåˆ™ç›´æ¥è¿”å›æœ€å¤§å€¼å³å¯
    if (tr[u].l >= l && tr[u].r <= r) return tr[u].Max;
    int mid = tr[u].l + tr[u].r >> 1;
    int Max = 0;
    /**
    	é—®é¢˜ï¼šä¸ºå•¥ä¸åˆ¤æ–­ä¸¤ä¸ªåŒºé—´ä¸ç›¸äº¤çš„æƒ…å†µï¼Ÿ
    	å›ç­”ï¼šæŸ¥çœ‹å¤‡æ³¨
    */
    // å¦‚æœå·¦è¾¹åŒºé—´æœ‰é‡åˆï¼Œåˆ™æŸ¥è¯¢å·¦è¾¹
    // è‡³äºä¸ºå•¥ä¸èƒ½å†™æˆquery(u << 1, l, mid)ï¼ŒæŸ¥çœ‹åŸç†çš„æ ·ä¾‹æ¨¡æ‹Ÿå³å¯çŸ¥æ™“
    if (l <= mid) Max = query(u << 1, l, r);
    // å¦‚æœå³è¾¹åŒºé—´æœ‰é‡åˆï¼Œåˆ™æŸ¥è¯¢å³è¾¹
    // è‡³äºä¸ºå•¥ä¸èƒ½å†™æˆquery(u << 1, l, mid)ï¼ŒæŸ¥çœ‹åŸç†çš„æ ·ä¾‹æ¨¡æ‹Ÿå³å¯çŸ¥æ™“
    if (r > mid) Max = max(Max, query(u << 1 | 1, l, r));
    return Max;
}
// ç”±å­èŠ‚ç‚¹æ›´æ–°çˆ¶èŠ‚ç‚¹
void pushup(int u) {
    tr[u].Max = max(tr[u << 1].Max, tr[u << 1 | 1].Max);
    return;
}
void modify(int u, int x, int c) {
    // å¦‚æœåˆ°è¾¾å¶å­ç»“ç‚¹å³åŒºé—´å·¦å³ç«¯ç‚¹éƒ½æ˜¯xï¼Œåˆ™ä¿®æ”¹å€¼å³å¯
    // ç”±äºåªæœ‰ä¸€ä¸ªå€¼ï¼Œå› æ­¤ï¼ŒåŒºé—´æœ€å¤§å€¼å³ä¸ºå½“å‰å€¼æœ¬èº«
    if (tr[u].l == x && tr[u].r == x) tr[u].Max = c;
    else {
        int mid = tr[u].l + tr[u].r >> 1;
        // å’Œå·¦è¾¹æœ‰äº¤é›†
        if (x <= mid) modify(u << 1, x, c);
        // å’Œå³è¾¹æœ‰äº¤é›†
        if (x > mid) modify(u << 1 | 1, x, c);
        // ç”±å­èŠ‚ç‚¹æ›´æ–°çˆ¶èŠ‚ç‚¹
        pushup(u);
    }
    return;
}
int main() {
    scanf("%d%d", &m, &p);
    // æœ€å¤šæœ‰mä¸ªæ“ä½œï¼Œå› æ­¤ï¼ŒåŒºé—´å³ç«¯ç‚¹ä¸ºm
    build(1, 1, m);
    int x, last = 0;
    char op[2];
    while (m -- ) {
        scanf("%s%d", op, &x);
        if (op[0] == 'Q') {
            // æŸ¥è¯¢æœ€åxä¸ªæ•°å­—çš„æœ€å¤§å€¼ï¼Œå…¶åŒºé—´ä¸º[n - x + 1, n]
            last = query(1, n - x + 1, n);
            cout << last << endl;
        }
        else {
            // ä¿®æ”¹ç¬¬n + 1ä¸ªå€¼
            modify(1, n + 1, (x + 0LL + last) % p);
            n ++;
        }
    }
    return 0;
}
```

**æ ‡ç­¾**

`çº¿æ®µæ ‘`

### [AcWing 245. ä½ èƒ½å›ç­”è¿™äº›é—®é¢˜å—](https://www.acwing.com/problem/content/246/)

**é¢˜ç›®æè¿°**

> ç»™å®šé•¿åº¦ä¸º `N` çš„æ•°åˆ— `A`ï¼Œä»¥åŠ `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤å¯èƒ½æ˜¯ä»¥ä¸‹ä¸¤ç§ä¹‹ä¸€ï¼š
>
> 1. `1 x y`ï¼ŒæŸ¥è¯¢åŒºé—´ `[x,y]` ä¸­çš„æœ€å¤§è¿ç»­å­æ®µå’Œï¼Œå³ $max_{xâ‰¤lâ‰¤râ‰¤y}\{âˆ‘\limits_{i=l}^rA[i]\}$ã€‚
> 2. `2 x y`ï¼ŒæŠŠ `A[x]` æ”¹æˆ `y`ã€‚
>
> å¯¹äºæ¯ä¸ªæŸ¥è¯¢æŒ‡ä»¤ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `N,M`ã€‚
>
> ç¬¬äºŒè¡Œ `N` ä¸ªæ•´æ•° `A[i]`ã€‚
>
> æ¥ä¸‹æ¥ `M` è¡Œæ¯è¡Œ `3` ä¸ªæ•´æ•° `k,x,y`ï¼Œ`k=1` è¡¨ç¤ºæŸ¥è¯¢ï¼ˆæ­¤æ—¶å¦‚æœ `x>y`ï¼Œè¯·äº¤æ¢ `x,y`ï¼‰ï¼Œ`k=2` è¡¨ç¤ºä¿®æ”¹ã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹äºæ¯ä¸ªæŸ¥è¯¢æŒ‡ä»¤è¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚
>
> æ¯ä¸ªç­”æ¡ˆå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

> + $Nâ‰¤500000,Mâ‰¤100000$,
> + $âˆ’1000â‰¤A[i]â‰¤1000$

**è¾“å…¥æ ·ä¾‹**

```c++
5 3
1 2 -3 4 5
1 2 3
2 2 -1
1 3 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
-1
```

**æ‰‹å†™ç¨¿**

![2111320](img/2111320.jpg)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 500010;
struct Node {
    int l, r; // åŒºé—´å·¦å³ç«¯ç‚¹
    int maxSum; // æœ€å¤§è¿ç»­å­åŒºé—´å’Œ
    int lMaxSum, rMaxSum; // æœ€å¤§å‰ç¼€å’Œå’Œæœ€å¤§åç¼€å’Œ
    int sum; // åŒºé—´å’Œ
}tr[N * 4];
int n, m;
int g[N];
void pushup(Node& u, Node& l, Node& r) {
    u.maxSum = max(max(l.maxSum, r.maxSum), l.rMaxSum + r.lMaxSum);
    u.lMaxSum = max(l.lMaxSum, l.sum + r.lMaxSum);
    u.rMaxSum = max(r.rMaxSum, r.sum + l.rMaxSum);
    u.sum = l.sum + r.sum;
    return;
}
// ç”±çˆ¶èŠ‚ç‚¹æ›´æ–°å­èŠ‚ç‚¹
void pushup(int u) {
    pushup(tr[u], tr[u << 1], tr[u << 1 | 1]);
    return;
}
void build(int u, int l, int r) {
    // åˆ°è¾¾å¶å­èŠ‚ç‚¹[l, r]æ˜¯ä¸‹æ ‡ï¼Œè®°å½•æ‰€æœ‰å±æ€§å€¼
    if (l == r) tr[u] = {l, r, g[l], g[l], g[l], g[l]};
    else {
        // å¦‚æœæ²¡æœ‰åˆ°è¾¾å¶å­ç»“ç‚¹ï¼Œåˆ™åªè®°å½•åŒºé—´ç«¯ç‚¹å³å¯ï¼Œåˆ«çš„å€¼æš‚æ—¶æ— æ³•å¾—å‡º
        tr[u] = {l, r};
        int mid = l + r >> 1;
        build(u << 1, l, mid);
        build(u << 1 | 1, mid + 1, r);
        // æ›´æ–°ã€çˆ¶èŠ‚ç‚¹ã€‘ä¸­é™¤äº†åŒºé—´ç«¯ç‚¹ä¹‹å¤–çš„å…¶ä½™å±æ€§å€¼å³å¯
        pushup(u);
    }
    return;
}
// ç”±äºæ ‘çŠ¶æ•°ç»„çš„èŠ‚ç‚¹æ˜¯ç»“æ„ä½“ï¼Œå› æ­¤ï¼Œè¿”å›å€¼æ˜¯èŠ‚ç‚¹ã€ç»“æ„ä½“ã€‘
Node query(int u, int l, int r) {
    if (tr[u].l >= l && tr[u].r <= r) return tr[u];
    else {
        int mid = tr[u].l + tr[u].r >> 1;
        // åŒºé—´æŸ¥è¯¢åŒºé—´å¯èƒ½ä¸å­˜åœ¨
        // å¦‚æœæŸ¥è¯¢çš„åŒºé—´åœ¨çº¿æ®µæ ‘åŒºé—´çš„å·¦è¾¹
        if (r <= mid) return query(u << 1, l, r);
        // å¦‚æœæŸ¥è¯¢çš„åŒºé—´åœ¨çº¿æ®µæ ‘åŒºé—´çš„å³è¾¹
        else if (l > mid) return query(u << 1 | 1, l, r);
        else {
            // å¦‚æœæŸ¥è¯¢çš„åŒºé—´å’Œå·¦å³ç«¯ç‚¹æœ‰äº¤é›†
            auto left = query(u << 1, l, r);
            auto right = query(u << 1 | 1, l, r);
            // ä½¿ç”¨ç»“æ„ä½“èŠ‚ç‚¹
            Node res;
            pushup(res, left, right);
            return res;
        }
    }
}
void modify(int u, int x, int c) {
    // æ‰¾åˆ°å¶å­èŠ‚ç‚¹
    if (tr[u].l == x && tr[u].r == x) tr[u] = {x, x, c, c, c, c};
    else {
        // æ ¹æ®é¢˜ç›®æè¿°ä¿®æ”¹çš„åŒºé—´ä¸€å®šæ˜¯åˆæ³•åŒºé—´ï¼Œä¸€å®šä¼šæœ‰ç›¸äº¤
        int mid = tr[u].l + tr[u].r >> 1;
        // å¦‚æœå’Œå·¦åŒºé—´æœ‰äº¤é›†
        if (x <= mid) modify(u << 1, x, c);
        // å¦‚æœå’Œå³åŒºé—´æœ‰äº¤é›†
        else modify(u << 1 | 1, x, c);
        // ä¿®æ”¹å®Œè®°å¾—æ›´æ–°çˆ¶èŠ‚ç‚¹
        pushup(u);
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &g[i]);
    build(1, 1, n);
    int k, x, y;
    while (m -- ) {
        scanf("%d%d%d", &k, &x, &y);
        if (k == 1) {
            // å¦‚æœå·¦ç«¯ç‚¹å¤§äºå³ç«¯ç‚¹ï¼Œåˆ™äº¤æ¢ç«¯ç‚¹å³å¯
            if (x > y) swap(x, y);
            cout << query(1, x, y).maxSum << endl;
        }
        else modify(1, x, y);
    }
    return 0;
}
```

**æ ‡ç­¾**

`çº¿æ®µæ ‘`

### [AcWing 246. åŒºé—´æœ€å¤§å…¬çº¦æ•°](https://www.acwing.com/problem/content/247/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º `N` çš„æ•°åˆ— `A`ï¼Œä»¥åŠ `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤å¯èƒ½æ˜¯ä»¥ä¸‹ä¸¤ç§ä¹‹ä¸€ï¼š
>
> 1. `C l r d`ï¼Œè¡¨ç¤ºæŠŠ `A[l],A[l+1],â€¦,A[r]` éƒ½åŠ ä¸Š `d`ã€‚
> 2. `Q l r`ï¼Œè¡¨ç¤ºè¯¢é—® `A[l],A[l+1],â€¦,A[r]` çš„æœ€å¤§å…¬çº¦æ•°(`GCD`)ã€‚
>
> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `N,M`ã€‚
>
> ç¬¬äºŒè¡Œ `N` ä¸ªæ•´æ•° `A[i]`ã€‚
>
> æ¥ä¸‹æ¥ `M` è¡Œè¡¨ç¤º `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤çš„æ ¼å¼å¦‚é¢˜ç›®æè¿°æ‰€ç¤ºã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚
>
> æ¯ä¸ªç­”æ¡ˆå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

> + $Nâ‰¤500000,Mâ‰¤100000$,
> + $1â‰¤A[i]â‰¤10^{18}$,
> + $|d|â‰¤10^{18}$

**è¾“å…¥æ ·ä¾‹**

```c++
5 5
1 3 5 7 9
Q 1 5
C 1 5 1
Q 1 5
C 3 3 6
Q 2 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
2
4
```

**æ‰‹å†™ç¨¿**

![2012309](img/2012309.jpg)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 500010;
struct Node {
    int l, r; // åŒºé—´å·¦å³ç«¯ç‚¹
    LL sum, d; // åŒºé—´å’Œå’ŒåŒºé—´çš„æœ€å¤§å…¬çº¦æ•°
}tr[N * 4];
int n, m;
LL g[N];
// æ³¨æ„ç±»å‹LL
LL gcd(LL a, LL b) {
    if (!b) return a;
    return gcd(b, a % b);
}
void pushup(Node& u, Node& l, Node& r) {
    u.sum = l.sum + r.sum;
    u.d = gcd(l.d, r.d);
    return;
}
void pushup(int u) {
    pushup(tr[u], tr[u << 1], tr[u << 1 | 1]);
    return;
}
void build(int u, int l, int r) {
    if (l == r) {
        // æ³¨æ„ç±»å‹LL
        LL a = g[r] - g[r - 1];
        tr[u] = {l, r, a, a};
    }
    else {
        tr[u] = {l, r};
        int mid = l + r >> 1;
        build(u << 1, l, mid);
        build(u << 1 | 1, mid + 1, r);
        // æ³¨æ„æ›´æ–°ä¸‹çˆ¶èŠ‚ç‚¹u
        pushup(u);
    }
    return;
}
Node query(int u, int l, int r) {
    // å¦‚æœçº¿æ®µæ ‘ä¸­çš„åŒºé—´åŒ…å«åœ¨æ‰€æŸ¥è¯¢åŒºé—´çš„å†…éƒ¨ï¼Œåˆ™ç›´æ¥è¿”å›
    if (tr[u].l >= l && tr[u].r <= r) return tr[u];
    else {
        int mid = tr[u].l + tr[u].r >> 1;
        // å¦‚æœæŸ¥è¯¢åŒºé—´å‡ºç°åœ¨çº¿æ®µæ ‘åŒºé—´çš„å·¦è¾¹
        if (r <= mid) return query(u << 1, l, r);
        // å¦‚æœæŸ¥è¯¢åŒºé—´å‡ºç°åœ¨çº¿æ®µæ ‘åŒºé—´çš„å³è¾¹
        else if (l > mid) return query(u << 1 | 1, l, r);
        else {
            // å¦‚æœæŸ¥è¯¢åŒºé—´å¤„äºçº¿æ®µæ ‘åŒºé—´çš„ä¸¤è¾¹
            auto left = query(u << 1, l, r);
            auto right = query(u << 1 | 1, l, r);
            Node res;
            pushup(res, left, right);
            return res;
        }
    }
}
void modify(int u, int x, LL c) {
    if (tr[u].l == x && tr[u].r == x) {
        // æ³¨æ„ç±»å‹LL
        LL a = tr[u].sum + c;
        tr[u] = {x, x, a, a};
    }
    else {
        int mid = tr[u].l + tr[u].r >> 1;
        // å¦‚æœæ•°xä½äºå·¦åŒºé—´
        if (x <= mid) modify(u << 1, x, c);
        // å¦‚æœæ•°xä½äºå³åŒºé—´
        else modify(u << 1 | 1, x, c);
        // æ›´æ–°çˆ¶èŠ‚ç‚¹u
        pushup(u);
    }
    return;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%lld", &g[i]);
    build(1, 1, n);
    char op[2];
    int l, r;
    LL d;
    while (m -- ) {
        scanf("%s", op);
        if (op[0] == 'Q') {
            scanf("%d%d", &l, &r);
            // æ³¨æ„æœ€å¤§å…¬çº¦æ•°å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œè®°å¾—å–ç»å¯¹å€¼
            cout << abs(gcd(query(1, 1, l).sum, query(1, l + 1, r).d)) << endl; 
        }
        else {
            scanf("%d%d%lld", &l, &r, &d);
            modify(1, l, d);
            // è®°å¾—åˆ¤æ–­æ˜¯å¦è¶Šç•Œ
            if (r + 1 <= n) modify(1, r + 1, -d);
        }
    }
    return 0;
}
```

**æ ‡ç­¾**

`å·®åˆ†`ã€`æ ‘çŠ¶æ•°ç»„`

### [AcWing 243. ä¸€ä¸ªç®€å•çš„æ•´æ•°é—®é¢˜2](https://www.acwing.com/problem/content/244/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º `N` çš„æ•°åˆ— `A`ï¼Œä»¥åŠ `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤å¯èƒ½æ˜¯ä»¥ä¸‹ä¸¤ç§ä¹‹ä¸€ï¼š
>
> 1. `C l r d`ï¼Œè¡¨ç¤ºæŠŠ `A[l],A[l+1],â€¦,A[r]` éƒ½åŠ ä¸Š `d`ã€‚
> 2. `Q l r`ï¼Œè¡¨ç¤ºè¯¢é—®æ•°åˆ—ä¸­ç¬¬ `lâˆ¼r` ä¸ªæ•°çš„å’Œã€‚
>
> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `N,M`ã€‚
>
> ç¬¬äºŒè¡Œ `N` ä¸ªæ•´æ•° `A[i]`ã€‚
>
> æ¥ä¸‹æ¥ `M` è¡Œè¡¨ç¤º `M` æ¡æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤çš„æ ¼å¼å¦‚é¢˜ç›®æè¿°æ‰€ç¤ºã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹äºæ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºä¸€ä¸ªæ•´æ•°è¡¨ç¤ºç­”æ¡ˆã€‚
>
> æ¯ä¸ªç­”æ¡ˆå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤N,Mâ‰¤10^5$,
> + $|d|â‰¤10000$,
> + $|A[i]|â‰¤10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
10 5
1 2 3 4 5 6 7 8 9 10
Q 4 4
Q 1 10
Q 2 4
C 3 6 3
Q 2 4
```

**è¾“å‡ºæ ·ä¾‹**

```c++
4
55
9
15
```

**æ­¥éª¤**

> 1. `pushdown` æ“ä½œï¼ˆæ‡’æ ‡è®°ï¼‰
>     + ç”¨é€”
>         + å°†å½“å‰åŒºé—´ä¸­çš„æ¯ä¸€ä¸ªæ•°å­—éƒ½æ·»åŠ ä¸Š `d`
>     + æ­¥éª¤
>         + ç¬¬ä¸€æ­¥ï¼šæŸ¥çœ‹å½“å‰æ ¹èŠ‚ç‚¹ `u` æ‰€åœ¨åŒºé—´æ˜¯å¦å±äºæŸ¥è¯¢çš„åŒºé—´
>         + ç¬¬äºŒæ­¥ï¼šæ›´æ–°ç›¸å¯¹åº”çš„ä¿¡æ¯
>         + ç¬¬ä¸‰æ­¥ï¼šå°†æ‡’æ ‡è®° `add` è®¾ç½®ä¸º `0`ï¼Œè¡¨ç¤ºå·²ç»ä¸‹æ”¾å®Œæ¯•
> 2. æ³¨æ„ `pushdown` å’Œ `pushup` çš„ä½ç½®

**ä»£ç **

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 100010;
struct Node {
    int l, r;
    LL sum; // åŒºé—´å’Œ
    int add; // æ‡’æ ‡è®°
}tr[N * 4];
int n, m;
int g[N];
void pushup(int u) {
    // æ‡’æ ‡è®°ã€ä¸åŒ…å«ã€‘å½“å‰èŠ‚ç‚¹
    tr[u].sum = tr[u << 1].sum + tr[u << 1 | 1].sum;
    return;
}
void pushdown(int u) {
    auto &root = tr[u], &left = tr[u << 1], &right = tr[u << 1 | 1];
    // å¦‚æœæœ‰æ‡’æ ‡è®°ï¼Œåˆ™å°†æ‡’æ ‡è®°è¿›è¡Œä¸‹æ”¾
    if (root.add) {
        // å·¦å­©å­çš„æ‡’æ ‡è®°è¿›è¡Œç´¯åŠ ï¼ŒåŒæ—¶ï¼ŒåŒºé—´å’Œä¹Ÿéœ€è¦ç´¯åŠ 
        left.add += root.add, left.sum += (LL)(left.r - left.l + 1) * root.add;
        // å³å­©å­çš„æ‡’æ ‡è®°è¿›è¡Œç´¯åŠ ï¼ŒåŒæ—¶ï¼ŒåŒºé—´å’Œä¹Ÿéœ€è¦ç´¯åŠ 
        right.add += root.add, right.sum += (LL)(right.r - right.l + 1) * root.add;
        // æ‡’æ ‡è®°ç½®ä¸º0
        root.add = 0;
    }
    return;
}
void build(int u, int l, int r) {
    // å¦‚æœåˆ°è¾¾å¶å­ç»“ç‚¹ï¼Œåˆ™æ›´æ–°ç›¸å¯¹åº”çš„ä¿¡æ¯
    if (l == r) tr[u] = {l, r, g[l], 0};
    else {
        // æ›´æ–°åŒºé—´çš„å·¦å³ç«¯ç‚¹ä¿¡æ¯
        tr[u] = {l, r};
        int mid = tr[u].l + tr[u].r >> 1;
        // å¦‚æœå’Œå·¦åŒºé—´æœ‰äº¤é›†ï¼Œå»ºç«‹æ ‘çŠ¶æ•°ç»„
        build(u << 1, l, mid);
        // å¦‚æœå’Œå³åŒºé—´æœ‰äº¤é›†ï¼Œå»ºç«‹æ ‘çŠ¶æ•°ç»„
        build(u << 1 |1, mid + 1, r);
        // ç”±å­èŠ‚ç‚¹æ›´æ–°çˆ¶èŠ‚ç‚¹
        pushup(u);
    }
    return;
}
void modify(int u, int l, int r, int d) {
    // å¦‚æœæ ‘çŠ¶æ•°ç»„åŒºé—´çš„å·¦å³ç«¯ç‚¹åŒ…å«åœ¨è¦æŸ¥è¯¢çš„åŒºé—´å†…éƒ¨ï¼Œåˆ™ç›´æ¥æ›´æ–°ç›¸å¯¹åº”çš„ä¿¡æ¯
    if (tr[u].l >= l && tr[u].r <= r) {
        tr[u].sum += (LL)(tr[u].r - tr[u].l + 1) * d;
        tr[u].add += d;
    }
    else { // å¿…é¡»è¦è¿›è¡Œåˆ†è£‚
        // åˆ†è£‚ä¹‹å‰å¿…é¡»è¦è¿›è¡Œpushdownæ“ä½œï¼Œå³ä¸‹æ”¾æ‡’æ ‡è®°æ“ä½œ
        pushdown(u);
        int mid = tr[u].l + tr[u].r >> 1;
        // å¦‚æœå’Œå·¦åŒºé—´æœ‰äº¤é›†
        if (l <= mid) modify(u << 1, l, r, d);
        // å¦‚æœå’Œå³åŒºé—´æœ‰äº¤é›†
        if (r > mid) modify(u << 1 | 1, l, r, d);
        // ç”±å­èŠ‚ç‚¹ä¿¡æ¯æ›´æ–°çˆ¶èŠ‚ç‚¹ä¿¡æ¯
        pushup(u);
    }
    return;
}
LL query(int u, int l, int r) {
    // å¦‚æœæ ‘çŠ¶æ•°ç»„åŒºé—´çš„å·¦å³ç«¯ç‚¹åŒ…å«åœ¨è¦æŸ¥è¯¢çš„åŒºé—´å†…éƒ¨ï¼Œåˆ™ç›´æ¥æ›´æ–°ç›¸å¯¹åº”çš„ä¿¡æ¯
    if (tr[u].l >= l && tr[u].r <= r) return tr[u].sum;
    // è¦è¿›è¡Œåˆ†è£‚
    pushdown(u);
    int mid = tr[u].l + tr[u].r >> 1;
    LL sum = 0;
    // å¦‚æœå’Œå·¦è¾¹åŒºé—´æœ‰äº¤é›†
    if (l <= mid) sum += query(u << 1, l, r);
    // å¦‚æœå’Œå³è¾¹åŒºé—´æœ‰äº¤é›†
    if (r > mid) sum += query(u << 1 | 1, l, r);
    return sum;
}
int main() {
    scanf("%d%d", &n, &m);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &g[i]);
    build(1, 1, n);
    while (m -- ) {
        char op[2];
        int l, r, d;
        scanf("%s", op);
        if (op[0] == 'C') {
            scanf("%d%d%d", &l, &r, &d);
            modify(1, l, r, d);
        }
        else {
            scanf("%d%d", &l, &r);
            cout << query(1, l, r) << endl;
        }
    }
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘çŠ¶æ•°ç»„`ã€`æ‡’æ ‡è®°`

### [AcWing 247. äºšç‰¹å…°è’‚æ–¯](https://www.acwing.com/problem/content/249/)

**é¢˜ç›®æè¿°**

> æœ‰å‡ ä¸ªå¤å¸Œè…Šä¹¦ç±ä¸­åŒ…å«äº†å¯¹ä¼ è¯´ä¸­çš„äºšç‰¹å…°è’‚æ–¯å²›çš„æè¿°ã€‚
>
> å…¶ä¸­ä¸€äº›ç”šè‡³åŒ…æ‹¬å²›å±¿éƒ¨åˆ†åœ°å›¾ã€‚
>
> ä½†ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›åœ°å›¾æè¿°äº†äºšç‰¹å…°è’‚æ–¯çš„ä¸åŒåŒºåŸŸã€‚
>
> æ‚¨çš„æœ‹å‹ `Bill` å¿…é¡»çŸ¥é“åœ°å›¾çš„æ€»é¢ç§¯ã€‚
>
> ä½ è‡ªå‘Šå¥‹å‹‡å†™äº†ä¸€ä¸ªè®¡ç®—è¿™ä¸ªæ€»é¢ç§¯çš„ç¨‹åºã€‚

**è¾“å…¥æ ¼å¼**

> è¾“å…¥åŒ…å«å¤šç»„æµ‹è¯•ç”¨ä¾‹ã€‚
>
> å¯¹äºæ¯ç»„æµ‹è¯•ç”¨ä¾‹ï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ï¼Œè¡¨ç¤ºæ€»çš„åœ°å›¾æ•°é‡ã€‚
>
> æ¥ä¸‹æ¥ `n` è¡Œï¼Œæç»˜äº†æ¯å¼ åœ°å›¾ï¼Œæ¯è¡ŒåŒ…å«å››ä¸ªæ•°å­— $x_1,y_1,x_2,y_2$ï¼ˆä¸ä¸€å®šæ˜¯æ•´æ•°ï¼‰ï¼Œ$(x_1,y_1)$ å’Œ $(x_2,y_2)$ åˆ†åˆ«æ˜¯åœ°å›¾çš„å·¦ä¸Šè§’ä½ç½®å’Œå³ä¸‹è§’ä½ç½®ã€‚
>
> æ³¨æ„ï¼Œåæ ‡è½´ `x` è½´ä»ä¸Šå‘ä¸‹å»¶ä¼¸ï¼Œ`y` è½´ä»å·¦å‘å³å»¶ä¼¸ã€‚
>
> å½“è¾“å…¥ç”¨ä¾‹ `n=0` æ—¶ï¼Œè¡¨ç¤ºè¾“å…¥ç»ˆæ­¢ï¼Œè¯¥ç”¨ä¾‹æ— éœ€å¤„ç†ã€‚

**è¾“å‡ºæ ¼å¼**

> æ¯ç»„æµ‹è¯•ç”¨ä¾‹è¾“å‡ºä¸¤è¡Œã€‚
>
> ç¬¬ä¸€è¡Œè¾“å‡º `Test case #k`ï¼Œå…¶ä¸­ `k` æ˜¯æµ‹è¯•ç”¨ä¾‹çš„ç¼–å·ï¼Œä» `1` å¼€å§‹ã€‚
>
> ç¬¬äºŒè¡Œè¾“å‡º `Total explored area: a`ï¼Œå…¶ä¸­ `a` æ˜¯æ€»åœ°å›¾é¢ç§¯ï¼ˆå³æ­¤æµ‹è¯•ç”¨ä¾‹ä¸­æ‰€æœ‰çŸ©å½¢çš„é¢ç§¯å¹¶ï¼Œæ³¨æ„å¦‚æœä¸€ç‰‡åŒºåŸŸè¢«å¤šä¸ªåœ°å›¾åŒ…å«ï¼Œåˆ™åœ¨è®¡ç®—æ€»é¢ç§¯æ—¶åªè®¡ç®—ä¸€æ¬¡ï¼‰ï¼Œç²¾ç¡®åˆ°å°æ•°ç‚¹åä¸¤ä½æ•°ã€‚
>
> åœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åè¾“å‡ºä¸€ä¸ªç©ºè¡Œã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤nâ‰¤10000$,
> + $0â‰¤x1<x2â‰¤100000$,
> + $0â‰¤y1<y2â‰¤100000$
> + æ³¨æ„ï¼Œæœ¬é¢˜ $n$ çš„èŒƒå›´ä¸Šé™åŠ å¼ºè‡³ $10000$ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
2
10 10 20 20
15 15 25 25.5
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
Test ccase #1
Total explored area: 180.00 
```

**æ ·ä¾‹è§£é‡Š**

> æ ·ä¾‹æ‰€ç¤ºåœ°å›¾è¦†ç›–åŒºåŸŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸¤ä¸ªçŸ©å½¢åŒºåŸŸæ‰€è¦†ç›–çš„æ€»é¢ç§¯ï¼Œå³ä¸ºæ ·ä¾‹çš„è§£ã€‚

![2051745.png](img/19_4acba44c27-%E6%97%A0%E6%A0%87%E9%A2%98-20220205174554149.png)

**æ‰‹å†™ç¨¿**

![2071347](img/2071347.png)

**ç–‘ç‚¹è¯¦è§£**

> 1. çº¿æ®µæ ‘ä¸­å­˜å‚¨çš„èŠ‚ç‚¹æ˜¯çº¿æ®µä¸æ˜¯ç‚¹ï¼Œæ³¨æ„ä¸¤è€…ä¹‹é—´çš„å¯¹åº”å…³ç³»
>
>     ![2071518](img/2071518.png)
>
> 1. ç¦»æ•£åŒ–çš„åŸå› 
>
>     + æ³¨æ„æ ‘çŠ¶æ•°ç»„ä¸­çš„å€¼å°±æ˜¯ä¸‹æ ‡ï¼Œå¹¶ä¸”`y` è½´ä¸Šçš„ç«¯ç‚¹ä¸ä¸€å®šæ˜¯æ•´æ•°ï¼Œæœ‰å¯èƒ½æ˜¯å°æ•°ï¼Œå› æ­¤ï¼Œä¸ºäº†é˜²æ­¢å‡ºç°å°æ•°çš„æƒ…å†µï¼Œæ•…ä½¿ç”¨ç¦»æ•£åŒ–å¤„ç†
>
>     + ä¸¾ä¾‹è¯´æ˜ `g = [1, 1.5, 2, 5]`
>         + å¦‚æœä¸ä½¿ç”¨ç¦»æ•£åŒ–ï¼Œåˆ™ä¸èƒ½è®¡ç®— `g[1 ~ 1.5]` çš„å’Œ
>         + å¦‚æœä½¿ç”¨ç¦»æ•£åŒ–ï¼Œåˆ™ `1ï¼Œ1.5ï¼Œ2ï¼Œ2.5` æ‰€å¯¹åº”çš„ä¸‹æ ‡ä¸º `0ï¼Œ1ï¼Œ2ï¼Œ3` éƒ½æ˜¯æ•´æ•°ï¼Œåˆ™å¯ä»¥è®¡ç®—
>
> 1. æ ‘çŠ¶æ•°ç»„ä¸­çš„èŠ‚ç‚¹çš„å±æ€§å€¼ cnt åˆ†ç±»è®¨è®ºçš„åŸå› 
>
>     ![2071546](img/2071546.png)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
#include <algorithm>
using namespace std;
const int N = 10010;
struct Segment {
    double x, y1, y2;
    // è¡¨æ˜å½“å‰çº¿æ®µæ˜¯å·¦è¾¹ç•Œè¿˜æ˜¯å³è¾¹ç•Œï¼Œå·¦è¾¹ç•Œçš„æƒå€¼ä¸º1ï¼Œå³è¾¹ç•Œçš„æƒå€¼ä¸º-1
    int k;
    bool operator < (Segment &T) { // æŒ‰ç…§æ¨ªåæ ‡xè¿›è¡Œæ’åº
        return x < T.x;
    }
}segs[N * 2]; // 1ä¸ªçŸ©å½¢å¯¹åº”2ä¸ªæ¨ªåæ ‡ï¼Œå› æ­¤ï¼ŒNä¸ªçŸ©å½¢å¯¹åº”2 * Nä¸ªæ¨ªåæ ‡
struct Node {
    int l, r;
    int cnt; // å½“å‰åŒºé—´è¢«è¦†ç›–çš„å±‚æ•°
    double len; // å½“å‰yè½´ä¸Šå¤§äº1çš„åŒºé—´é•¿åº¦ï¼Œæ³¨æ„å˜é‡çš„ç±»å‹
}tr[N * 8]; // å·¦è¾¹ç•Œæ¨ªåæ ‡å¯¹åº”4Nç©ºé—´ï¼Œå³è¾¹ç•Œæ¨ªåæ ‡å¯¹åº”4Nç©ºé—´ï¼Œå…±8Nç©ºé—´
int n;
vector<double> ys; // å­˜å‚¨yè½´ä¸Šæ‰€æœ‰çš„æ— é‡å¤çš„ç‚¹ï¼Œç”¨æ¥åšç¦»æ•£åŒ–ï¼Œæ³¨æ„å˜é‡ç±»å‹
// æŸ¥æ‰¾å¤§äºç­‰äºyçš„æ•°æ®çš„ä¸‹æ ‡æ‰€åœ¨ä½ç½®
int find(double y) {
    return lower_bound(ys.begin(), ys.end(), y) - ys.begin();
}
void pushup(int u) {
    // å¦‚æœå½“å‰çº¿æ®µæ ‘åŒºé—´è¢«è¦†ç›–ï¼Œåˆ™å½“å‰åŒºé—´çš„é•¿åº¦å³ä¸ºçº¿æ®µæ ‘çš„é•¿åº¦len
    if (tr[u].cnt) tr[u].len = ys[tr[u].r + 1] - ys[tr[u].l];
    else if (tr[u].l != tr[u].r) // å¦‚æœä¸æ˜¯å¶èŠ‚ç‚¹
        tr[u].len = tr[u << 1].len + tr[u << 1 | 1].len;
    else tr[u].len = 0; // å¦‚æœæ˜¯å¶èŠ‚ç‚¹è®°å¾—åˆå§‹åŒ–é•¿åº¦ä¸º0
    return;
}
void build(int u, int l, int r) {
    // åˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„ï¼Œä¸ç”¨ç®¡trçš„åŒºé—´é—®é¢˜ï¼Œå³ä½¿l != rä¹Ÿè¦è¿›è¡Œåˆå§‹åŒ–
    tr[u] = {l, r, 0, 0};
    if (l != r) {
        int mid = l + r >> 1;
        build(u << 1, l, mid);
        build(u << 1 | 1, mid + 1, r);
    }
    return;
}
void modify(int u, int l, int r, int k) {
    if (tr[u].l >= l && tr[u].r <= r) {
        tr[u].cnt += k;
        // è®¡ç®—é•¿åº¦ï¼Œå› ä¸ºkä¸ä¸€å®šä¸ºæ­£æ•°ï¼Œå¦‚æœcnt == 0ï¼Œåˆ™éœ€è¦é€šè¿‡å½“å‰æ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹è¿›è¡Œè®¡ç®—
        pushup(u);
    }
    else {
        int mid = tr[u].l + tr[u].r >> 1;
        if (l <= mid) modify(u << 1, l, r, k);
        if (r > mid) modify(u << 1 | 1, l, r, k);
        // è®¡ç®—é•¿åº¦ï¼Œå› ä¸ºkä¸ä¸€å®šä¸ºæ­£æ•°ï¼Œå¦‚æœcnt == 0ï¼Œåˆ™éœ€è¦é€šè¿‡å½“å‰æ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹è¿›è¡Œè®¡ç®—
        pushup(u);
    }
    return;
}
int main() {
    int T = 0;
    while (scanf("%d", &n), n) {
        ys.clear(); // å¤šç»„è¾“å…¥ï¼Œæ³¨æ„æ¯æ¬¡æ¸…ç©ºysé‡Œé¢çš„æ•°æ®
        for (int i = 0, j = 0; i < n; i ++ ) {
            double x1, y1, x2, y2;
            scanf("%lf%lf%lf%lf", &x1, &y1, &x2, &y2);
            segs[j ++ ] = {x1, y1, y2, 1};
            segs[j ++ ] = {x2, y1, y2, -1};
            ys.push_back(y1);
            ys.push_back(y2);
        }
        // å¯¹äºyè½´ä¸Šçš„ç‚¹è¿›è¡Œæ’åºï¼Œæ–¹ä¾¿å»é‡å¤„ç†
        sort(ys.begin(), ys.end());
        // å»é‡çš„å‰ææ˜¯æœ‰åºåºåˆ—ï¼Œå› æ­¤ï¼Œäº‹å…ˆè¦æ’åºï¼ŒåŸå› åœ¨äºæ­¤
        ys.erase(unique(ys.begin(), ys.end()), ys.end());
        // å»ºç«‹çº¿æ®µæ ‘ï¼ŒåŒºé—´çš„ä¸ªæ•°ç­‰äºç‚¹çš„ä¸ªæ•°å‡ä¸€ï¼Œç‚¹çš„èŒƒå›´[0, n - 1],æ¢ç®—åŒºé—´çš„è¯ï¼Œå†å‡ä¸€ï¼ŒåŒºé—´çš„èŒƒå›´ä¸º[0, n - 2]
        build(1, 0, ys.size() - 2);
        // å¯¹äºsegsè¿›è¡Œæ’åº
        sort(segs, segs + n * 2);
        // è®¡ç®—æ€»é¢ç§¯
        double res = 0;
        for (int i = 0; i < n * 2; i ++ ) {
            if (i > 0) res += tr[1].len * (segs[i].x - segs[i - 1].x);
            modify(1, find(segs[i].y1), find(segs[i].y2) - 1, segs[i].k);
        }
        printf("Test case #%d\nTotal explored area: %.2lf\n\n", ++T, res);
    }
    return 0;
}
```

**æ ‡ç­¾**

`æ ‘çŠ¶æ•°ç»„`ã€`æ‰«æçº¿`

### [AcWing 1277. ç»´æŠ¤åºåˆ—](https://www.acwing.com/problem/content/1279/)

**é¢˜ç›®æè¿°**

> è€å¸ˆäº¤ç»™å°å¯å¯ä¸€ä¸ªç»´æŠ¤æ•°åˆ—çš„ä»»åŠ¡ï¼Œç°åœ¨å°å¯å¯å¸Œæœ›ä½ æ¥å¸®ä»–å®Œæˆã€‚
>
> æœ‰é•¿ä¸º `N` çš„æ•°åˆ—ï¼Œä¸å¦¨è®¾ä¸º $a_1,a_2,â€¦,a_N$ã€‚
>
> æœ‰å¦‚ä¸‹ä¸‰ç§æ“ä½œå½¢å¼ï¼š
>
> 1. æŠŠæ•°åˆ—ä¸­çš„ä¸€æ®µæ•°å…¨éƒ¨ä¹˜ä¸€ä¸ªå€¼ï¼›
> 2. æŠŠæ•°åˆ—ä¸­çš„ä¸€æ®µæ•°å…¨éƒ¨åŠ ä¸€ä¸ªå€¼ï¼›
> 3. è¯¢é—®æ•°åˆ—ä¸­çš„ä¸€æ®µæ•°çš„å’Œï¼Œç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œä½ åªéœ€è¾“å‡ºè¿™ä¸ªæ•°æ¨¡ `P` çš„å€¼ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸¤ä¸ªæ•´æ•° `N` å’Œ `P`ï¼›
>
> ç¬¬äºŒè¡Œå«æœ‰ `N` ä¸ªéè´Ÿæ•´æ•°ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ä¸º $a_1,a_2,â€¦,a_N$ï¼›
>
> ç¬¬ä¸‰è¡Œæœ‰ä¸€ä¸ªæ•´æ•° `M`ï¼Œè¡¨ç¤ºæ“ä½œæ€»æ•°ï¼›
>
> ä»ç¬¬å››è¡Œå¼€å§‹æ¯è¡Œæè¿°ä¸€ä¸ªæ“ä½œï¼Œè¾“å…¥çš„æ“ä½œæœ‰ä»¥ä¸‹ä¸‰ç§å½¢å¼ï¼š
>
> - æ“ä½œ `1`ï¼š`1 t g c`ï¼Œè¡¨ç¤ºæŠŠæ‰€æœ‰æ»¡è¶³ $tâ‰¤iâ‰¤g$ çš„ $a_i$ æ”¹ä¸º $a_iÃ—c$ï¼›
> - æ“ä½œ `2`ï¼š`2 t g c`ï¼Œè¡¨ç¤ºæŠŠæ‰€æœ‰æ»¡è¶³ $tâ‰¤iâ‰¤g$ çš„ $a_i$ æ”¹ä¸º $a_i+c$ï¼›
> - æ“ä½œ `3`ï¼š`3 t g`ï¼Œè¯¢é—®æ‰€æœ‰æ»¡è¶³ $tâ‰¤iâ‰¤g$ çš„ $a_i$ çš„å’Œæ¨¡ `P` çš„å€¼ã€‚
>
> åŒä¸€è¡Œç›¸é‚»ä¸¤æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ï¼Œæ¯è¡Œå¼€å¤´å’Œæœ«å°¾æ²¡æœ‰å¤šä½™ç©ºæ ¼ã€‚

**è¾“å‡ºæ ¼å¼**

å¯¹æ¯ä¸ªæ“ä½œ `3`ï¼ŒæŒ‰ç…§å®ƒåœ¨è¾“å…¥ä¸­å‡ºç°çš„é¡ºåºï¼Œä¾æ¬¡è¾“å‡ºä¸€è¡Œä¸€ä¸ªæ•´æ•°è¡¨ç¤ºè¯¢é—®ç»“æœã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤N,Mâ‰¤10^5$,
> + $1â‰¤tâ‰¤gâ‰¤N$,
> + $0â‰¤c,a_iâ‰¤10^9$,
> + $1â‰¤Pâ‰¤10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
7 43
1 2 3 4 5 6 7
5
1 2 5 5
3 2 4
2 3 7 9
3 1 3
3 4 7
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2
35
8
```

**æ ·ä¾‹è§£é‡Š**

> åˆå§‹æ—¶æ•°åˆ—ä¸º `{1,2,3,4,5,6,7}`ï¼›
>
> ç»è¿‡ç¬¬ `1` æ¬¡æ“ä½œåï¼Œæ•°åˆ—ä¸º `{1,10,15,20,25,6,7}`ï¼›
>
> å¯¹ç¬¬ `2` æ¬¡æ“ä½œï¼Œå’Œä¸º `10+15+20=45`ï¼Œæ¨¡ `43` çš„ç»“æœæ˜¯ `2`ï¼›
>
> ç»è¿‡ç¬¬ `3` æ¬¡æ“ä½œåï¼Œæ•°åˆ—ä¸º `{1,10,24,29,34,15,16}`ï¼›
>
> å¯¹ç¬¬ `4` æ¬¡æ“ä½œï¼Œå’Œä¸º `1+10+24=35`ï¼Œæ¨¡ `43` çš„ç»“æœæ˜¯ `35`ï¼›
>
> å¯¹ç¬¬ `5` æ¬¡æ“ä½œï¼Œå’Œä¸º `29+34+15+16=94`ï¼Œæ¨¡ `43` çš„ç»“æœæ˜¯ `8`ã€‚

**è§£é¢˜æ­¥éª¤**

> 1. çº¿æ®µæ ‘ä¸­ç»´æŠ¤äº”ä¸ªä¿¡æ¯
>
>     + åŒºé—´å·¦å³ç«¯ç‚¹ `[l, r]`
>     + åŒºé—´å’Œ `sum`
>     + æ‡’æ ‡è®° `add` å’Œ `mul`ï¼Œè¡¨ç¤ºåŒºé—´å†…çš„æ¯ä¸ªæ•°å­—æ·»åŠ  `add` å’Œ ä¹˜ä»¥ `mul`
>
> 2. å½“çº¿æ®µæ ‘ä¸­çš„èŠ‚ç‚¹åŒæ—¶å«æœ‰æ‡’æ ‡è®° `add` å’Œ `mul` çš„æ—¶å€™ï¼Œå¦‚ä½•ç¡®å®šé¡ºåºï¼Œä»¥æ–¹ä¾¿å¥½ç»´æŠ¤ä¿¡æ¯ï¼Ÿ
>
>     + åˆ†ä¸¤ç§æƒ…å†µï¼šå…ˆ `add` åœ¨ `mul` å’Œå…ˆ `mul` å† `add`
>
>         + ç¬¬ä¸€ç§æƒ…å†µï¼šå…ˆ `add` å† `mul`
>
>             ![2081729](img/2081729.png)
>
>         + ç¬¬äºŒç§æƒ…å†µï¼šå…ˆ `mul` å† `add`
>
>             ![2081730](img/2081730.png)
>
>         + ç»¼ä¸Šæ‰€è¿°ï¼Œé¡ºåºåº”è¯¥ä¸ºå…ˆ `mul` å† `add` å³å¯
>
>     + ç¡®å®šå®Œé¡ºåºä¹‹åï¼ŒæŒ‰ç…§é¡ºåºå…ˆ `mul` å† `add` çš„æ“ä½œï¼Œè¿›è¡Œåˆ†æï¼ŒæŸ¥çœ‹å€¼çš„å˜åŒ–
>
>         ![2082022](img/2082022.png)
>
>         + å¤‡æ³¨
>             + `x âœ–ï¸ mul + add` æ˜¯åŸæ¥çš„æ•°ï¼Œä¹Ÿå°±æ˜¯åŒºé—´å’Œ `sum`
>             + æŒ‰ç…§é¡ºåºå…ˆ `mul` å† `add`ï¼Œä»¥æ–¹ä¾¿åŒºåˆ†å˜é‡ï¼Œæ•…ä½¿ç”¨ `mul'` å’Œ `add'` æ¥è¡¨ç¤ºå³å¯
>
> 3. ä½¿ç”¨å…ˆ `mul` å† `add` çš„é¡ºåºç®€åŒ–åŒºé—´åŠ å’ŒåŒºé—´ä¹˜æ“ä½œ
>
>     + åŒºé—´åŠ 
>         + ä»¤ `mul = 1ï¼Œadd = d` å³å¯
>     + åŒºé—´ä¹˜
>         + ä»¤ `mul = dï¼Œadd = 0` å³å¯

**ä»£ç **

```c++
#include <iostream>
using namespace std;
typedef long long LL;
const int N = 100010;
struct Node {
    int l, r; // å·¦å³åŒºé—´
    LL sum; // åŒºé—´å’Œ
    int mul, add; // åŒºé—´ä¹˜æ‡’æ ‡è®°mulå’ŒåŒºé—´åŠ æ‡’æ ‡è®°add
}tr[N * 4];
int n, m, p;
int g[N];
void eval(Node& root, int mul, int add) {
    // åŸç†æŸ¥çœ‹è§£æ
    root.sum = (root.sum * mul + (LL)(root.r - root.l + 1) * add) % p;
    root.mul = (LL)root.mul * mul % p;
    root.add = ((LL)root.add * mul + add) % p;
    return;
}
void pushup(int u) {
    // è®°å¾—å–æ¨¡
    tr[u].sum = (tr[u << 1].sum + tr[u << 1 | 1].sum) % p;
    return;
}
void pushdown(int u) {
    eval(tr[u << 1], tr[u].mul, tr[u].add);
    eval(tr[u << 1 | 1], tr[u].mul, tr[u].add);
    // è®°å¾—å°†æ‡’æ ‡è®°æ¸…ç©º
    tr[u].mul = 1, tr[u].add = 0;
    return;
}
void build(int u, int l, int r) {
    if (l == r) tr[u] = {l, r, g[l], 1, 0};
    else {
        // sumå…ˆéšä¾¿è®¾ç½®ä¸€ä¸ªå€¼
        tr[u] = {l, r, 0, 1, 0};
        int mid = tr[u].l + tr[u].r >> 1;
        build(u << 1, l, mid);
        build(u << 1 | 1, mid + 1, r);
        pushup(u);
    }
    return;
}
void modify(int u, int l, int r, int mul, int add) {
    if (tr[u].l >= l && tr[u].r <= r) eval(tr[u], mul, add);
    else { // åŒºé—´è¦è¿›è¡Œåˆ†è£‚
        // æ‡’æ ‡è®°ä¸‹ä¼ 
        pushdown(u);
        int mid = tr[u].l + tr[u].r >> 1;
        // å·¦è¾¹æœ‰äº¤é›†
        if (l <= mid) modify(u << 1, l, r, mul, add);
        // å³è¾¹æœ‰äº¤é›†
        if (r > mid) modify(u << 1 | 1, l, r, mul, add);
        // ç”±å­èŠ‚ç‚¹æ›´æ–°çˆ¶èŠ‚ç‚¹
        pushup(u);
    }
    return;
}
int query(int u, int l, int r) {
    if (tr[u].l >= l && tr[u].r <= r) return tr[u].sum;
    // æŸ¥è¯¢çš„æ—¶å€™éœ€è¦å°†æ‡’æ ‡è®°ä¸‹ä¼ 
    pushdown(u);
    int sum = 0;
    int mid = tr[u].l + tr[u].r >> 1;
    // å·¦è¾¹æœ‰äº¤é›†
    if (l <= mid) sum += query(u << 1, l, r);
    // å³è¾¹æœ‰äº¤é›†ï¼Œè®°å¾—å–æ¨¡
    if (r > mid) sum = (sum + query(u << 1 | 1, l, r)) % p;
    return sum;
}
int main() {
    scanf("%d%d", &n, &p);
    for (int i = 1; i <= n; i ++ ) scanf("%d", &g[i]);
    // å»ºç«‹çº¿æ®µæ ‘
    build(1, 1, n);
    scanf("%d", &m);
    while (m -- ) {
        int num, l, r, k;
        scanf("%d", &num);
        // åŒºé—´ä¹˜
        if (num == 1) {
            scanf("%d%d%d", &l, &r, &k);
            modify(1, l, r, k, 0);
        }
        // åŒºé—´åŠ 
        else if (num == 2) {
            scanf("%d%d%d", &l, &r, &k);
            modify(1, l, r, 1, k);
        }
        // åŒºé—´æŸ¥è¯¢
        else {
            scanf("%d%d", &l, &r);
            cout << query(1, l, r) << endl;
        }
    }
    return 0;
}
```

**æ ‡ç­¾**

`çº¿æ®µæ ‘`





## `Trie`æ ‘

### [LeetCode 212. å•è¯æœç´¢ II](https://leetcode-cn.com/problems/word-search-ii/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ª `m x n` äºŒç»´å­—ç¬¦ç½‘æ ¼ `board` å’Œä¸€ä¸ªå•è¯ï¼ˆå­—ç¬¦ä¸²ï¼‰åˆ—è¡¨ `words`ï¼Œæ‰¾å‡ºæ‰€æœ‰åŒæ—¶åœ¨äºŒç»´ç½‘æ ¼å’Œå­—å…¸ä¸­å‡ºç°çš„å•è¯ã€‚
>
> å•è¯å¿…é¡»æŒ‰ç…§å­—æ¯é¡ºåºï¼Œé€šè¿‡ ç›¸é‚»çš„å•å…ƒæ ¼ å†…çš„å­—æ¯æ„æˆï¼Œå…¶ä¸­â€œç›¸é‚»â€å•å…ƒæ ¼æ˜¯é‚£äº›æ°´å¹³ç›¸é‚»æˆ–å‚ç›´ç›¸é‚»çš„å•å…ƒæ ¼ã€‚åŒä¸€ä¸ªå•å…ƒæ ¼å†…çš„å­—æ¯åœ¨ä¸€ä¸ªå•è¯ä¸­ä¸å…è®¸è¢«é‡å¤ä½¿ç”¨ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`board = [["o","a","a","n"],["e","t","a","e"],["i","h","k","r"],["i","f","l","v"]], words = ["oath","pea","eat","rain"]`
> è¾“å‡ºï¼š`["eat","oath"]`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`board = [["a","b"],["c","d"]], words = ["abcb"]`
> è¾“å‡ºï¼š`[]`

**æç¤º**

> + $m == board.length$
> + $n == board[i].length$
> + $1 <= m, n <= 12$
> + $board[i][j] æ˜¯ä¸€ä¸ªå°å†™è‹±æ–‡å­—æ¯$
> + $1 <= words.length <= 3 * 10^4$
> + $1 <= words[i].length <= 10$
> + `words[i]` ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ
> + `words` ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²äº’ä¸ç›¸åŒ

**é¢˜è§£**

> 1. ä½¿ç”¨å­—å…¸æ ‘å­˜å‚¨æ¯ä¸ªå•è¯
> 2. ä»æ¯ä¸€ä¸ªèµ·ç‚¹ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢æ¯ä¸ªå•è¯å³å¯

**ä»£ç **

```c++
class Solution {
public:
    // å®šä¹‰å­—å…¸æ ‘ç»“æ„ä½“
    struct Node {
        int id;
        Node* son[26];
        Node() {
            id = -1;
            for (int i = 0; i < 26; i ++ ) son[i] = NULL;
        }
    }*root;
    int n, m;
    int dx[4] = {1, -1, 0, 0};
    int dy[4] = {0, 0, -1, 1};
    unordered_set<int> ids;
    void insert(string word, int id) {
        auto p = root;
        for (int i = 0; i < word.size(); i ++ ) {
            int u = word[i] - 'a';
            if (!p -> son[u]) p -> son[u] = new Node();
            p = p -> son[u];
        }
        p -> id = id;
        return;
    }
    void dfs(vector<vector<char>>& g, int x, int y, Node* p) {
        if (p -> id != -1) ids.insert(p -> id);
        char t = g[x][y];
        g[x][y] = '.';
        for (int i = 0; i < 4; i ++ ) {
            int tx = x + dx[i];
            int ty = y + dy[i];
            if (tx < 0 || tx >= n || ty < 0 || ty >= m || g[tx][ty] == '.') continue;
            int u = g[tx][ty] - 'a';
            if (p -> son[u]) dfs(g, tx, ty, p -> son[u]);
        }
        g[x][y] = t;
        return;
    }
    vector<string> findWords(vector<vector<char>>& g, vector<string>& words) {
        n = g.size(), m = g[0].size();
        root = new Node();
        for (int i = 0; i < words.size(); i ++ ) insert(words[i], i);
        vector<string> res;
        for (int i = 0; i < n; i ++ )
            for (int j = 0; j < m; j ++ ) {
                int u = g[i][j] - 'a';
                if (root -> son[u]) dfs(g, i, j, root -> son[u]);
            }
        for (auto& id : ids) res.push_back(words[id]);
        return res;
    }
};
```

**æ ‡ç­¾**

`dfs`ã€`å­—å…¸æ ‘`

# å¤šå‰æ ‘ä¸“é¢˜

## äºŒå‰æ ‘

### äºŒå‰æ ‘

#### [LeetCode 297. äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–](https://leetcode-cn.com/problems/serialize-and-deserialize-binary-tree/)

**é¢˜ç›®æè¿°**

> åºåˆ—åŒ–æ˜¯å°†ä¸€ä¸ªæ•°æ®ç»“æ„æˆ–è€…å¯¹è±¡è½¬æ¢ä¸ºè¿ç»­çš„æ¯”ç‰¹ä½çš„æ“ä½œï¼Œè¿›è€Œå¯ä»¥å°†è½¬æ¢åçš„æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å†…å­˜ä¸­ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ä¸ªè®¡ç®—æœºç¯å¢ƒï¼Œé‡‡å–ç›¸åæ–¹å¼é‡æ„å¾—åˆ°åŸæ•°æ®ã€‚
>
> è¯·è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥å®ç°äºŒå‰æ ‘çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚è¿™é‡Œä¸é™å®šä½ çš„åºåˆ— / ååºåˆ—åŒ–ç®—æ³•æ‰§è¡Œé€»è¾‘ï¼Œä½ åªéœ€è¦ä¿è¯ä¸€ä¸ªäºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶ä¸”å°†è¿™ä¸ªå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºåŸå§‹çš„æ ‘ç»“æ„ã€‚
>
> æç¤º: è¾“å…¥è¾“å‡ºæ ¼å¼ä¸ `LeetCode` ç›®å‰ä½¿ç”¨çš„æ–¹å¼ä¸€è‡´ï¼Œè¯¦æƒ…è¯·å‚é˜… `LeetCode` åºåˆ—åŒ–äºŒå‰æ ‘çš„æ ¼å¼ã€‚ä½ å¹¶éå¿…é¡»é‡‡å–è¿™ç§æ–¹å¼ï¼Œä½ ä¹Ÿå¯ä»¥é‡‡ç”¨å…¶ä»–çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**ç¤ºä¾‹ 1**

![img](img/serdeser.jpg)

> è¾“å…¥ï¼š`root = [1,2,3,null,null,4,5]`
> è¾“å‡ºï¼š`[1,2,3,null,null,4,5]`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`root = []`
> è¾“å‡ºï¼š`[]`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`root = [1]`
> è¾“å‡ºï¼š`[1]`

**ç¤ºä¾‹ 4**

> è¾“å…¥ï¼š`root = [1,2]`
> è¾“å‡ºï¼š`[1,2]`

**æç¤º**

> + $æ ‘ä¸­ç»“ç‚¹æ•°åœ¨èŒƒå›´ [0, 10^4] å†…$
> + $-1000 <= Node.val <= 1000$

**æ‰‹å†™ç¨¿**

![WX20220121-142021@2x](img/WX20220121-142021@2x.png)

**ä»£ç **

```c++
/**
 * Definition for a binary tree node.
 * struct TreeNode {
 *     int val;
 *     TreeNode *left;
 *     TreeNode *right;
 *     TreeNode(int x) : val(x), left(NULL), right(NULL) {}
 * };
 */
class Codec {
public:
    string str;
    void dfs_s(TreeNode* root) {
        if (!root) {
            str += "#,";
            return;
        }
        str += to_string(root -> val) + ",";
        dfs_s(root -> left);
        dfs_s(root -> right);
        return;
    }
    // Encodes a tree to a single string.
    string serialize(TreeNode* root) {
        // æ·±æœ
        dfs_s(root);
        return str;
    }
    TreeNode* dfs_d(string& data, int &u) {
        if (data[u] == '#') {
            // è·³è¿‡#å’Œåé¢çš„,
            u += 2;
            return NULL;
        }
        int k = u;
        while (data[u] != ',') u ++;
        auto root = new TreeNode(stoi(data.substr(k, u - k)));
        // è·³è¿‡,
        u ++;
        root -> left = dfs_d(data, u);
        root -> right = dfs_d(data, u);
        return root;
    }
    // Decodes your encoded data to tree.
    TreeNode* deserialize(string data) {
        int u = 0;
        return dfs_d(data, u);
    }
};

// Your Codec object will be instantiated and called as such:
// Codec ser, deser;
// TreeNode* ans = deser.deserialize(ser.serialize(root));
```

**æ ‡ç­¾**

`dfs`ã€`æ•°æ®ç»“æ„`

#### [LeetCode 331. éªŒè¯äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ–](https://leetcode-cn.com/problems/verify-preorder-serialization-of-a-binary-tree/)

**é¢˜ç›®æè¿°**

>   åºåˆ—åŒ–äºŒå‰æ ‘çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å‰åºéå†ã€‚å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªéç©ºèŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸‹è¿™ä¸ªèŠ‚ç‚¹çš„å€¼ã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ ‡è®°å€¼è®°å½•ï¼Œä¾‹å¦‚ `#`ã€‚
>
>   ```c++
>   	_9_
>    /   \
>   3     2
>   / \   / \
>   4   1  #  6
>   / \ / \   / \
>   # # # #   # #
>   ```
>
>   ä¾‹å¦‚ï¼Œä¸Šé¢çš„äºŒå‰æ ‘å¯ä»¥è¢«åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸² `"9,3,4,#,#,1,#,#,2,#,6,#,#"`ï¼Œå…¶ä¸­ `#` ä»£è¡¨ä¸€ä¸ªç©ºèŠ‚ç‚¹ã€‚
>
>   ç»™å®šä¸€ä¸²ä»¥é€—å·åˆ†éš”çš„åºåˆ—ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ˜¯æ­£ç¡®çš„äºŒå‰æ ‘çš„å‰åºåºåˆ—åŒ–ã€‚ç¼–å†™ä¸€ä¸ªåœ¨ä¸é‡æ„æ ‘çš„æ¡ä»¶ä¸‹çš„å¯è¡Œç®—æ³•ã€‚
>
>   æ¯ä¸ªä»¥é€—å·åˆ†éš”çš„å­—ç¬¦æˆ–ä¸ºä¸€ä¸ªæ•´æ•°æˆ–ä¸ºä¸€ä¸ªè¡¨ç¤º `null` æŒ‡é’ˆçš„ `'#'` ã€‚
>
>   ä½ å¯ä»¥è®¤ä¸ºè¾“å…¥æ ¼å¼æ€»æ˜¯æœ‰æ•ˆçš„ï¼Œä¾‹å¦‚å®ƒæ°¸è¿œä¸ä¼šåŒ…å«ä¸¤ä¸ªè¿ç»­çš„é€—å·ï¼Œæ¯”å¦‚ `"1,,3"` ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `"9,3,4,#,#,1,#,#,2,#,6,#,#"`
>   è¾“å‡º: `true`

**ç¤ºä¾‹ 2**

>   è¾“å…¥: `"1,#"`
>   è¾“å‡º: `false`

**ç¤ºä¾‹ 3**

>   è¾“å…¥: `"9,#,#,1"`
>   è¾“å‡º: `false`

**æ‰‹å†™ç¨¿**

>   ![321113](img/321113-20220302123253489.png)
>
>   è‹¥ä»£ç ä¸ç†è§£ï¼Œå»ºè®®æ¨¡æ‹Ÿæ ·ä¾‹

**ä»£ç **

```c++
class Solution {
public:
    int k = 0;
    bool isValidSerialization(string s) {
        // ä»¥é€—å·,ç»“å°¾
        s += ',';
        if (!dfs(s)) return false;
        // å¦‚æœè¿˜æ²¡æœ‰è®¡ç®—åˆ°ç»“å°¾ï¼Œè¯´æ˜ä¸ç¬¦åˆæ¡ä»¶ï¼Œæ ·ä¾‹ï¼š3,#,#,1
        return k == s.size();
    }
    bool dfs(string& s) {
        // å¦‚æœå·²ç»åˆ°è¾¾å…ƒç´ ç»“å°¾ï¼Œè¿”å›false
        if (k == s.size()) return false;
        // è·³è¿‡#å’Œ,
        if (s[k] == '#') return k += 2, true;
        // è·³è¿‡æ•°å­—
        while (isdigit(s[k])) k ++ ;
        // è·³è¿‡é€—å·
        k ++ ;
        // éå†å·¦å­æ ‘å’Œå³å­æ ‘
        return dfs(s) && dfs(s);
    }
};
```

**æ ‡ç­¾**

`äºŒå‰æ ‘`ã€`dfs`

### äºŒå‰æœç´¢æ ‘

#### [LeetCode 501. äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°](https://leetcode.cn/problems/find-mode-in-binary-search-tree/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªå«é‡å¤å€¼çš„äºŒå‰æœç´¢æ ‘`ï¼ˆBSTï¼‰`çš„æ ¹èŠ‚ç‚¹ `root` ï¼Œæ‰¾å‡ºå¹¶è¿”å› `BST` ä¸­çš„æ‰€æœ‰ **ä¼—æ•°**ï¼ˆå³ï¼Œå‡ºç°é¢‘ç‡æœ€é«˜çš„å…ƒç´ ï¼‰ã€‚
>
>   å¦‚æœæ ‘ä¸­æœ‰ä¸æ­¢ä¸€ä¸ªä¼—æ•°ï¼Œå¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ã€‚
>
>   å‡å®š `BST` æ»¡è¶³å¦‚ä¸‹å®šä¹‰ï¼š
>
>   ç»“ç‚¹å·¦å­æ ‘ä¸­æ‰€å«èŠ‚ç‚¹çš„å€¼ **å°äºç­‰äº** å½“å‰èŠ‚ç‚¹çš„å€¼
>   ç»“ç‚¹å³å­æ ‘ä¸­æ‰€å«èŠ‚ç‚¹çš„å€¼ **å¤§äºç­‰äº** å½“å‰èŠ‚ç‚¹çš„å€¼
>   å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æœç´¢æ ‘

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`root = [1,null,2,2]`
>   è¾“å‡ºï¼š`[2]`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`root = [0]`
>   è¾“å‡ºï¼š`[0]`

**æç¤º**

>   +   $æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [1, 10^4] å†…$
>   +   $-10^5 <= Node.val <= 10^5$

**è¿›é˜¶**

>   ä½ å¯ä»¥ä¸ä½¿ç”¨é¢å¤–çš„ç©ºé—´å—ï¼Ÿï¼ˆå‡è®¾ç”±é€’å½’äº§ç”Ÿçš„éšå¼è°ƒç”¨æ ˆçš„å¼€é”€ä¸è¢«è®¡ç®—åœ¨å†…ï¼‰

**æ‰‹å†™ç¨¿**

![641950](img/641950.png)

**ä»£ç **

```c++
/**
 * Definition for a binary tree node.
 * struct TreeNode {
 *     int val;
 *     TreeNode *left;
 *     TreeNode *right;
 *     TreeNode() : val(0), left(nullptr), right(nullptr) {}
 *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}
 *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}
 * };
 */
class Solution {
public:
    vector<int> ans;
    int Mxcnt = 0, cnt = 0, last;
    void dfs(TreeNode* root) {
        // ç©ºå­æ ‘ç›´æ¥è¿”å›
        if (!root) return;
        // éå†å·¦å­æ ‘
        dfs(root -> left);
        // å¦‚æœå’Œä¸Šä¸€ä¸ªæ•°ç›¸ç­‰, åˆ™ cnt ++
        if (root -> val == last) cnt ++;
        else {
            // æ›´æ–°ä¸Šä¸€ä¸ªæ•°
            last = root -> val;
            // æ›´æ–°ä¸ªæ•°
            cnt = 1;
        }
        // å¦‚æœå½“å‰æ•°çš„ä¸ªæ•°å¤§äºå…¨å±€æœ€å¤§æ•°, åˆ™æ›´æ–°
        if (cnt > Mxcnt) {
            // æ›´æ–°æœ€å¤§æ•°
            Mxcnt = cnt;
            // æ›´æ–°ç­”æ¡ˆæ•°ç»„
            ans = {last};
        }
        // ç­”æ¡ˆå¤šä¸€ä¸ªæ•°
        else if (cnt == Mxcnt) ans.push_back(last);
        // éå†å³å­æ ‘
        dfs(root -> right);
        return;
    }
    vector<int> findMode(TreeNode* root) {
        dfs(root);
        return ans;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`äºŒå‰æœç´¢æ ‘`

**ç¼åˆæ€ª**



#### [LeetCode 530. äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®](https://leetcode.cn/problems/minimum-absolute-difference-in-bst/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ `root` ï¼Œè¿”å› æ ‘ä¸­ä»»æ„ä¸¤ä¸åŒèŠ‚ç‚¹å€¼ä¹‹é—´çš„æœ€å°å·®å€¼ ã€‚
>
>   å·®å€¼æ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œå…¶æ•°å€¼ç­‰äºä¸¤å€¼ä¹‹å·®çš„ç»å¯¹å€¼ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`root = [4,2,6,1,3]`
>   è¾“å‡ºï¼š`1`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`root = [1,0,48,null,null,12,49]`
>   è¾“å‡ºï¼š`1`

**æç¤º**

>   +   $æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [2, 10^4]$
>   +   $0 <= Node.val <= 10^5$

æ³¨æ„

>   æœ¬é¢˜ä¸ [LeetCode 783.](https://leetcode-cn.com/problems/minimum-distance-between-bst-nodes/) ç›¸åŒ

**æ‰‹å†™ç¨¿**

![642104](img/642104.png)

**ä»£ç **

```c++
/**
 * Definition for a binary tree node.
 * struct TreeNode {
 *     int val;
 *     TreeNode *left;
 *     TreeNode *right;
 *     TreeNode() : val(0), left(nullptr), right(nullptr) {}
 *     TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}
 *     TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}
 * };
 */
class Solution {
public:
    int ans = 1e9, last, is_first = true;
    void dfs(TreeNode* root) {
        // ç©ºæ ‘è¿”å›
        if (!root) return;
        // éå†å·¦å­æ ‘
        dfs(root -> left);
        // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ•°, åˆ™æ ‡è®°
        if (is_first) is_first = false;
        // å¦‚æœä¸æ˜¯ç¬¬ä¸€ä¸ªæ•°, åˆ™æ›´æ–°æœ€å°å·®å€¼
        else ans = min(ans, abs(root -> val - last));
        // æ›´æ–°ä¸Šä¸€ä¸ªæ•°
        last = root -> val;
        // éå†å³å­æ ‘
        dfs(root -> right);
        return;
    }
    int getMinimumDifference(TreeNode* root) {
        dfs(root);
        return ans;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`äºŒå‰æœç´¢æ ‘`

**ç¼åˆæ€ª**



# å­—ç¬¦ä¸²ä¸“é¢˜

## KMP

### [Leetode 214. æœ€çŸ­å›æ–‡ä¸²](https://leetcode-cn.com/problems/shortest-palindrome/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œä½ å¯ä»¥é€šè¿‡åœ¨å­—ç¬¦ä¸²å‰é¢æ·»åŠ å­—ç¬¦å°†å…¶è½¬æ¢ä¸ºå›æ–‡ä¸²ã€‚æ‰¾åˆ°å¹¶è¿”å›å¯ä»¥ç”¨è¿™ç§æ–¹å¼è½¬æ¢çš„æœ€çŸ­å›æ–‡ä¸²ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`s = "aacecaaa"`
> è¾“å‡ºï¼š`"aaacecaaa"`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`s = "abcd"`
> è¾“å‡ºï¼š`"dcbabcd"`

**æç¤º**

> + $0 <= s.length <= 5 * 10^4$
> + $s$ ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ

**æ‰‹å†™ç¨¿**

![WechatIMG95](img/WechatIMG95.jpeg)

**æ€è·¯**

> 1. è¦æƒ³è®© `c + a + b` æœ€çŸ­ï¼Œåˆ™åªè¦ `c` å’Œ `b` æœ€çŸ­å³å¯ï¼Œæ¢å¥è¯è¯´ï¼Œè®© `a` æœ€é•¿å³å¯
>
> 2. é€šè¿‡ä¸Šè¿°åˆ†æï¼Œé—®é¢˜è½¬åŒ–ä¸ºåœ¨åŸä¸²`ï¼ˆa + bï¼‰`ä¸­å¯»æ‰¾æœ€é•¿å›æ–‡å­ä¸²å³å¯è§£å†³é—®é¢˜
>
> 3. é€šè¿‡ä»¥ä¸‹æ­¥éª¤ï¼Œå¯»æ‰¾æœ€é•¿å›æ–‡å­ä¸²å³å¯
>
>     + å°†åŸä¸²é€†åºå¤åˆ¶ä¸€éï¼Œç”¨ `#` è¿æ¥ï¼Œæ”¾åœ¨åŸä¸²çš„åé¢
>
>         ![image-20220118072649711](img/image-20220118072649711.png)
>
>     + å¯»æ‰¾æ–°ä¸² `a + b + b + a` çš„æœ€é•¿å›æ–‡å‰ç¼€å³å¯ï¼Œå³ `KMP` çš„ `next` æ•°ç»„çš„å«ä¹‰
>
> 4. æ‰¾å‡º `a` ä¹‹åï¼Œå°† `a` ä¹‹åçš„éƒ¨åˆ†ï¼Œå³ `b` æˆªå–å‡ºæ¥ï¼Œé€†åºæ”¾åˆ°æœ€å‰æ–¹

**ä»£ç **

```c++
class Solution {
public:
    string shortestPalindrome(string s) {
        string t = s;
        t = ' ' + t + '#' + string(t.rbegin(), t.rend());
        int n = t.size();
        vector<int> ne(n + 5);
        for (int i = 2, j = 0; i < n; i ++ ) {
            while (j && t[i] != t[j + 1]) j = ne[j];
            if (t[i] == t[j + 1]) j ++;
            ne[i] = j;
        }
        t = s.substr(ne[n - 1]);
        return string(t.rbegin(), t.rend()) + s;
    }
};
```

**æ ‡ç­¾**

`å­—ç¬¦ä¸²`ã€`å›æ–‡ä¸²`ã€`KMP`

# æ¨¡æ‹Ÿé¢˜ä¸“é¢˜

## æ¨¡æ‹Ÿ

### [LeetCode 299. çŒœæ•°å­—æ¸¸æˆ](https://leetcode-cn.com/problems/bulls-and-cows/)

**é¢˜ç›®æè¿°**

> ä½ åœ¨å’Œæœ‹å‹ä¸€èµ·ç© çŒœæ•°å­—`ï¼ˆBulls and Cowsï¼‰`æ¸¸æˆï¼Œè¯¥æ¸¸æˆè§„åˆ™å¦‚ä¸‹ï¼š
>
> å†™å‡ºä¸€ä¸ªç§˜å¯†æ•°å­—ï¼Œå¹¶è¯·æœ‹å‹çŒœè¿™ä¸ªæ•°å­—æ˜¯å¤šå°‘ã€‚æœ‹å‹æ¯çŒœæµ‹ä¸€æ¬¡ï¼Œä½ å°±ä¼šç»™ä»–ä¸€ä¸ªåŒ…å«ä¸‹è¿°ä¿¡æ¯çš„æç¤ºï¼š
>
> çŒœæµ‹æ•°å­—ä¸­æœ‰å¤šå°‘ä½å±äºæ•°å­—å’Œç¡®åˆ‡ä½ç½®éƒ½çŒœå¯¹äº†ï¼ˆç§°ä¸º "`Bulls`"ï¼Œå…¬ç‰›ï¼‰ï¼Œ
> æœ‰å¤šå°‘ä½å±äºæ•°å­—çŒœå¯¹äº†ä½†æ˜¯ä½ç½®ä¸å¯¹ï¼ˆç§°ä¸º "`Cows`"ï¼Œå¥¶ç‰›ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¬¡çŒœæµ‹ä¸­æœ‰å¤šå°‘ä½éå…¬ç‰›æ•°å­—å¯ä»¥é€šè¿‡é‡æ–°æ’åˆ—è½¬æ¢æˆå…¬ç‰›æ•°å­—ã€‚
> ç»™ä½ ä¸€ä¸ªç§˜å¯†æ•°å­— `secret` å’Œæœ‹å‹çŒœæµ‹çš„æ•°å­— `guess` ï¼Œè¯·ä½ è¿”å›å¯¹æœ‹å‹è¿™æ¬¡çŒœæµ‹çš„æç¤ºã€‚
>
> æç¤ºçš„æ ¼å¼ä¸º "`xAyB`" ï¼Œ`x` æ˜¯å…¬ç‰›ä¸ªæ•°ï¼Œ `y` æ˜¯å¥¶ç‰›ä¸ªæ•°ï¼Œ`A` è¡¨ç¤ºå…¬ç‰›ï¼Œ`B` è¡¨ç¤ºå¥¶ç‰›ã€‚
>
> è¯·æ³¨æ„ç§˜å¯†æ•°å­—å’Œæœ‹å‹çŒœæµ‹çš„æ•°å­—éƒ½å¯èƒ½å«æœ‰é‡å¤æ•°å­—ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`secret = "1807", guess = "7810"`
> è¾“å‡ºï¼š`"1A3B"`
> è§£é‡Šï¼šæ•°å­—å’Œä½ç½®éƒ½å¯¹ï¼ˆå…¬ç‰›ï¼‰ç”¨ `'|'` è¿æ¥ï¼Œæ•°å­—çŒœå¯¹ä½ç½®ä¸å¯¹ï¼ˆå¥¶ç‰›ï¼‰çš„é‡‡ç”¨æ–œä½“åŠ ç²—æ ‡è¯†ã€‚
> `"1807"
> |
> "7810"`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`secret = "1123", guess = "0111"`
> è¾“å‡ºï¼š`"1A1B"`
> è§£é‡Šï¼šæ•°å­—å’Œä½ç½®éƒ½å¯¹ï¼ˆå…¬ç‰›ï¼‰ç”¨ `'|'` è¿æ¥ï¼Œæ•°å­—çŒœå¯¹ä½ç½®ä¸å¯¹ï¼ˆå¥¶ç‰›ï¼‰çš„é‡‡ç”¨æ–œä½“åŠ ç²—æ ‡è¯†ã€‚
> `"1123"        "1123"
> |      or     |
> "0111"        "0111"`
> æ³¨æ„ï¼Œä¸¤ä¸ªä¸åŒ¹é…çš„ `1` ä¸­ï¼Œåªæœ‰ä¸€ä¸ªä¼šç®—ä½œå¥¶ç‰›ï¼ˆæ•°å­—çŒœå¯¹ä½ç½®ä¸å¯¹ï¼‰ã€‚é€šè¿‡é‡æ–°æ’åˆ—éå…¬ç‰›æ•°å­—ï¼Œå…¶ä¸­ä»…æœ‰ä¸€ä¸ª `1` å¯ä»¥æˆä¸ºå…¬ç‰›æ•°å­—ã€‚

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`secret = "1", guess = "0"`
> è¾“å‡ºï¼š`"0A0B"`

**ç¤ºä¾‹ 4**

> è¾“å…¥ï¼š`secret = "1", guess = "1"`
> è¾“å‡ºï¼š`"1A0B"`

**æç¤º**

> + $1 <= secret.length, guess.length <= 1000$
> + $secret.length == guess.length$
> + `secret` å’Œ `guess` ä»…ç”±æ•°å­—ç»„æˆ

**é¢˜è§£**

> 1. ä¸¤æ¬¡éå†ï¼›
> 2. ç¬¬ä¸€æ¬¡éå†æ•°ç»„å¹¶ä¸”ç»Ÿè®¡å…¬ç‰›çš„æ¬¡æ•°ï¼ŒåŒæ—¶å°†ä¸æ»¡è¶³å…¬ç‰›çš„å­—ç¬¦ä½¿ç”¨å¤šé‡é›†åˆè®°å½•ä¸‹æ¥
> 3. ç¬¬äºŒæ¬¡éå†æ•°ç»„å¹¶ä¸”åˆ©ç”¨å¤šé‡é›†åˆç»Ÿè®¡å¥¶ç‰›çš„æ¬¡æ•°ï¼Œæ³¨æ„ä¸€ä¸ªæ•°å­—åªèƒ½å¯¹åº”ä¸€ä¸ªæ•°å­—ï¼Œå› æ­¤ï¼Œå¦‚æœæ¯”å¯¹æˆåŠŸéœ€è¦å°†æˆåŠŸçš„å­—ç¬¦ä»å¤šé‡é›†åˆé‡Œé¢åˆ é™¤

**ä»£ç **

```c++
class Solution {
public:
    string getHint(string s, string t) {
        int a = 0, b = 0;
        multiset<char> hash;
        for (int i = 0; i < s.size(); i ++ ) {
            if (s[i] == t[i]) a ++;
            else hash.insert(s[i]);
        }
        for (int i = 0; i < s.size(); i ++ ) {
            if (s[i] == t[i]) continue;
            if (hash.count(t[i])) {
                b ++;
                hash.erase(hash.find(t[i]));
            }
        }
        return to_string(a) + "A" + to_string(b) + "B";
    }
};
```

**æ ‡ç­¾**

`æ¨¡æ‹Ÿ`

### [LeetCode 273. æ•´æ•°è½¬æ¢è‹±æ–‡è¡¨ç¤º](https://leetcode-cn.com/problems/integer-to-english-words/)

**é¢˜ç›®æè¿°**

> å°†éè´Ÿæ•´æ•° num è½¬æ¢ä¸ºå…¶å¯¹åº”çš„è‹±æ–‡è¡¨ç¤ºã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`num = 123`
> è¾“å‡ºï¼š`"One Hundred Twenty Three"`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`num = 12345`
> è¾“å‡ºï¼š`"Twelve Thousand Three Hundred Forty Five"`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`num = 1234567`
> è¾“å‡ºï¼š`"One Million Two Hundred Thirty Four Thousand Five Hundred Sixty Seven"`

**ç¤ºä¾‹ 4**

> è¾“å…¥ï¼š`num = 1234567891`
> è¾“å‡ºï¼š`"One Billion Two Hundred Thirty Four Million Five Hundred Sixty Seven Thousand Eight Hundred Ninety One"`

**æç¤º**

> + $0 <= num <= 2^{31} - 1$

**æ‰‹å†™ç¨¿**

![1](img/1.png)

**ä»£ç **

```c++
class Solution {
public:
    // é¢„å¤„ç†æ•°æ®
    string nums0_19[20] = {
        "Zero", "One", "Two", "Three", "Four", 
        "Five", "Six", "Seven", "Eight", "Nine",
        "Ten", "Eleven", "Twelve", "Thirteen",
        "Fourteen", "Fifteen", "Sixteen", "Seventeen",
        "Eighteen", "Nineteen"
    };
    string nums20_90[8] = {
        "Twenty", "Thirty", "Forty", "Fifty",
        "Sixty", "Seventy", "Eighty", "Ninety"
    };
    string nums1000_1e9[4] = {
        "Billion ", "Million ", "Thousand ", ""
    };
    string get(int x) {
        if (x == 0) return "Zero";
        string res;
        if (x >= 100) {
            res += nums0_19[x / 100] + " Hundred ";
            x %= 100;
        }
        if (x >= 20) {
            res += nums20_90[x / 10 - 2] + " ";
            x %= 10;
        }
        if (x) res += nums0_19[x] + " ";
        return res;
    }
    string numberToWords(int num) {
        if (num == 0) return "Zero";
        string res;
        for (int i = 1e9, j = 0; i >= 1; i /= 1000, j ++ )
            if (num >= i) {
                res += get(num / i) + nums1000_1e9[j];
                num %= i;
            }
        // æ³¨æ„ç©ºæ ¼é—®é¢˜
        res.pop_back();
        return res;
    }
};
```

**æ ‡ç­¾**

`æ¨¡æ‹Ÿ`ã€`æ•°å­—è½¬æ¢`ã€`ä¸­è‹±æ–‡`

### [AcWing 1473. A + B æ ¼å¼](https://www.acwing.com/problem/content/1475/)

**é¢˜ç›®æè¿°**

>   è®¡ç®— `a + b` å¹¶ä»¥æ ‡å‡†æ ¼å¼è¾“å‡ºæ€»å’Œ----ä¹Ÿå°±æ˜¯è¯´ï¼Œä»æœ€ä½ä½å¼€å§‹æ¯éš”ä¸‰ä½æ•°åŠ è¿›ä¸€ä¸ªé€—å·ï¼ˆåƒä½åˆ†éš”ç¬¦ï¼‰ï¼Œå¦‚æœç»“æœå°‘äºå››ä½åˆ™ä¸éœ€æ·»åŠ ã€‚

**è¾“å…¥æ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `a` å’Œ `b`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼Œä»¥æ ‡å‡†æ ¼å¼è¾“å‡º `a + b` çš„å’Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $âˆ’10^6â‰¤a,bâ‰¤10^6$

**è¾“å…¥æ ·ä¾‹**

```c++
-1000000 9
```

**è¾“å‡ºæ ·ä¾‹**

```c++
-999,991
```

**æ‰‹å†™ç¨¿**

>   1.   å¯¹ `a + b` å½¢æˆçš„å­—ç¬¦ä¸² `s`ï¼Œè¿›è¡Œéå†ï¼Œä½¿ç”¨ `t` ä½œä¸ºç­”æ¡ˆï¼Œåˆ†ä»¥ä¸‹æƒ…å†µï¼š
>        +   å¦‚æœå½“å‰éå†çš„å­—ç¬¦æ•°é‡ `k` å·²ç»è¾¾åˆ° `3` ä¸ªï¼Œåˆ™åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå­—ç¬¦å¹¶ä¸”ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯å¦æ˜¯ `'-'`
>            +   å¦‚æœæ¡ä»¶æˆç«‹ï¼Œ`t += ,` å¹¶ä¸”ï¼Œå°† `k` ç½® `0`
>            +   å¦‚æœæ¡ä»¶ä¸æˆç«‹ï¼Œé€€å‡ºå¾ªç¯
>        +   åè½¬ `t`ï¼Œå¦‚æœå­—ç¬¦ä¸² `s` çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ `'-'`ï¼Œå°†å…¶åŠ å…¥åˆ°ç­”æ¡ˆå³å¯

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
int a, b;
int main() {
    cin >> a >> b;
    string s = to_string(a + b);
    string t;
    for (int i = s.size() - 1, k = 0; i >= 0 && s[i] != '-'; i -- ) {
        t += s[i];
        k ++;
        // å¦‚æœæ•°é‡å·²ç»è¾¾åˆ°3ä¸ªï¼Œå¹¶ä¸”ï¼Œè¿˜æœ‰ä¸‹ä¸€ä¸ªå­—ç¬¦æˆ–è€…ä¸‹ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯'-'
        // å°†å…¶åŠ å…¥åˆ°ç­”æ¡ˆï¼Œå°†kç½®0
        if (k == 3 && i - 1 >= 0 && s[i - 1] != '-') t += ',', k = 0; 
    }
    // åè½¬t
    reverse(t.begin(), t.end());
    // å¦‚æœsçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯'-'ï¼Œå°†å…¶åŠ å…¥åˆ°ç­”æ¡ˆ
    if (s[0] == '-') t = '-' + t;
    cout << t << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`æ¨¡æ‹Ÿ`

**ç¼åˆæ€ª**

### [L1-049 å¤©æ¢¯èµ›åº§ä½åˆ†é…](https://pintia.cn/problem-sets/994805046380707840/problems/994805081289900032)

**é¢˜ç›®æè¿°**

> å¤©æ¢¯èµ›æ¯å¹´æœ‰å¤§é‡å‚èµ›é˜Ÿå‘˜ï¼Œè¦ä¿è¯åŒä¸€æ‰€å­¦æ ¡çš„æ‰€æœ‰é˜Ÿå‘˜éƒ½ä¸èƒ½ç›¸é‚»ï¼Œåˆ†é…åº§ä½å°±æˆä¸ºä¸€ä»¶æ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ã€‚ä¸ºæ­¤æˆ‘ä»¬åˆ¶å®šå¦‚ä¸‹ç­–ç•¥ï¼šå‡è®¾æŸèµ›åœºæœ‰ `N` æ‰€å­¦æ ¡å‚èµ›ï¼Œç¬¬ `i` æ‰€å­¦æ ¡æœ‰ `M[i]` æ”¯é˜Ÿä¼ï¼Œæ¯é˜Ÿ `10` ä½å‚èµ›é€‰æ‰‹ã€‚ä»¤æ¯æ ¡é€‰æ‰‹æ’æˆä¸€åˆ—çºµé˜Ÿï¼Œç¬¬ `i + 1` é˜Ÿçš„é€‰æ‰‹æ’åœ¨ç¬¬ `i` é˜Ÿé€‰æ‰‹ä¹‹åã€‚ä»ç¬¬ `1` æ‰€å­¦æ ¡å¼€å§‹ï¼Œå„æ ¡çš„ç¬¬ `1` ä½é˜Ÿå‘˜é¡ºæ¬¡å…¥åº§ï¼Œç„¶åæ˜¯å„æ ¡çš„ç¬¬ `2` ä½é˜Ÿå‘˜â€¦â€¦ ä»¥æ­¤ç±»æ¨ã€‚å¦‚æœæœ€ååªå‰©ä¸‹ `1` æ‰€å­¦æ ¡çš„é˜Ÿä¼è¿˜æ²¡æœ‰åˆ†é…åº§ä½ï¼Œåˆ™éœ€è¦å®‰æ’ä»–ä»¬çš„é˜Ÿå‘˜éš”ä½å°±åã€‚æœ¬é¢˜å°±è¦æ±‚ä½ ç¼–å†™ç¨‹åºï¼Œè‡ªåŠ¨ä¸ºå„æ ¡ç”Ÿæˆé˜Ÿå‘˜çš„åº§ä½å·ï¼Œä» `1` å¼€å§‹ç¼–å·ã€‚

**è¾“å…¥æ ¼å¼**

> è¾“å…¥åœ¨ä¸€è¡Œä¸­ç»™å‡ºå‚èµ›çš„é«˜æ ¡æ•° `N` ï¼ˆä¸è¶…è¿‡`100`çš„æ­£æ•´æ•°ï¼‰ï¼›ç¬¬äºŒè¡Œç»™å‡º `N` ä¸ªä¸è¶…è¿‡``10``çš„æ­£æ•´æ•°ï¼Œå…¶ä¸­ç¬¬ `i` ä¸ªæ•°å¯¹åº”ç¬¬ `i` æ‰€é«˜æ ¡çš„å‚èµ›é˜Ÿä¼æ•°ï¼Œæ•°å­—é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚

**è¾“å‡ºæ ¼å¼**

> ä»ç¬¬ `1` æ‰€é«˜æ ¡çš„ç¬¬ `1` æ”¯é˜Ÿä¼å¼€å§‹ï¼Œé¡ºæ¬¡è¾“å‡ºé˜Ÿå‘˜çš„åº§ä½å·ã€‚æ¯é˜Ÿå ä¸€è¡Œï¼Œåº§ä½å·é—´ä»¥ `1` ä¸ªç©ºæ ¼åˆ†éš”ï¼Œè¡Œé¦–å°¾ä¸å¾—æœ‰å¤šä½™ç©ºæ ¼ã€‚å¦å¤–ï¼Œæ¯æ‰€é«˜æ ¡çš„ç¬¬ä¸€è¡ŒæŒ‰â€œ`#X`â€è¾“å‡ºè¯¥æ ¡çš„ç¼–å·`X`ï¼Œä» `1` å¼€å§‹ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
3
3 4 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
#1
1 4 7 10 13 16 19 22 25 28
31 34 37 40 43 46 49 52 55 58
61 63 65 67 69 71 73 75 77 79
#2
2 5 8 11 14 17 20 23 26 29
32 35 38 41 44 47 50 53 56 59
62 64 66 68 70 72 74 76 78 80
82 84 86 88 90 92 94 96 98 100
#3
3 6 9 12 15 18 21 24 27 30
33 36 39 42 45 48 51 54 57 60
```

**æ‰‹å†™ç¨¿**

![462037](img/462037.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 110;
int n, m;
int q[N];
int g[N][N];
int main() {
    scanf("%d", &m);
    for (int i = 0; i < m; i ++ ) {
        scanf("%d", &q[i]);
        n = max(n, q[i] * 10);
    }
    int num = 0;
    int which = -1; // è®°å½•ä¸Šä¸€ä¸ªè½®çš„æœ€åä¸€ä¸ªæŠ¥æ•°çš„é˜Ÿä¼çš„ID
    for (int i = 0; i < n; i ++ )
        for (int j = 0; j < m; j ++ ) {
            if (i >= q[j] * 10) continue;
            // å¦‚æœä¸Šä¸€è½®æœ€åä¸€ä¸ªæŠ¥æ•°çš„é˜Ÿä¼çš„IDå’Œå½“å‰çš„é˜Ÿä¼æ˜¯åŒä¸€ä¸ªé˜Ÿä¼
            // è¯´æ˜åªå‰©ä¸‹ä¸€ä¸ªé˜Ÿä¼, éœ€è¦éš”ä½å°±åš, ++ num
            if (j == which) ++ num;
            g[i][j] = ++ num;
            which = j;
        }
    for (int i = 0; i < m; i ++ ) {
        printf("#%d\n", i + 1);
        for (int j = 0; j < q[i]; j ++ ) {
            for (int k = 0; k < 10; k ++ ) {
                cout << g[j * 10 + k][i];
                if (k + 1 < 10) cout << ' ';
            }
            cout << endl;
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`æ¨¡æ‹Ÿé¢˜`

**ç¼åˆæ€ª**



### [LeetCode 38. å¤–è§‚æ•°åˆ—](https://leetcode-cn.com/problems/count-and-say/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªæ­£æ•´æ•° `n` ï¼Œè¾“å‡ºå¤–è§‚æ•°åˆ—çš„ç¬¬ `n` é¡¹ã€‚
>
> ã€Œå¤–è§‚æ•°åˆ—ã€æ˜¯ä¸€ä¸ªæ•´æ•°åºåˆ—ï¼Œä»æ•°å­— `1` å¼€å§‹ï¼Œåºåˆ—ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯å¯¹å‰ä¸€é¡¹çš„æè¿°ã€‚
>
> ä½ å¯ä»¥å°†å…¶è§†ä½œæ˜¯ç”±é€’å½’å…¬å¼å®šä¹‰çš„æ•°å­—å­—ç¬¦ä¸²åºåˆ—ï¼š
>
> + `countAndSay(1) = "1"`
> + `countAndSay(n)` æ˜¯å¯¹ `countAndSay(n - 1)` çš„æè¿°ï¼Œç„¶åè½¬æ¢æˆå¦ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²ã€‚
>
> å‰äº”é¡¹å¦‚ä¸‹:
>
> > 1.     `1`
> > 2.     `11`
> > 3.     `21`
> > 4.     ``1211``
> > 5.     `111221`
> >
> > ç¬¬ä¸€é¡¹æ˜¯æ•°å­— `1` 
> > æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ `1` å³ â€œ ä¸€ ä¸ª `1` â€ï¼Œè®°ä½œ "`11`"
> > æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ `11` å³ â€œ äºŒ ä¸ª `1` â€ ï¼Œè®°ä½œ "`21`"
> > æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ `21` å³ â€œ ä¸€ ä¸ª `2` + ä¸€ ä¸ª `1` â€ ï¼Œè®°ä½œ "`1211`"
> > æè¿°å‰ä¸€é¡¹ï¼Œè¿™ä¸ªæ•°æ˜¯ `1211` å³ â€œ ä¸€ ä¸ª ``1`` + ä¸€ ä¸ª `2` + äºŒ ä¸ª `1` â€ ï¼Œè®°ä½œ "`111221`"
>
>
> è¦ æè¿° ä¸€ä¸ªæ•°å­—å­—ç¬¦ä¸²ï¼Œé¦–å…ˆè¦å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸º æœ€å° æ•°é‡çš„ç»„ï¼Œæ¯ä¸ªç»„éƒ½ç”±è¿ç»­çš„æœ€å¤š ç›¸åŒå­—ç¬¦ ç»„æˆã€‚ç„¶åå¯¹äºæ¯ä¸ªç»„ï¼Œå…ˆæè¿°å­—ç¬¦çš„æ•°é‡ï¼Œç„¶åæè¿°å­—ç¬¦ï¼Œå½¢æˆä¸€ä¸ªæè¿°ç»„ã€‚è¦å°†æè¿°è½¬æ¢ä¸ºæ•°å­—å­—ç¬¦ä¸²ï¼Œå…ˆå°†æ¯ç»„ä¸­çš„å­—ç¬¦æ•°é‡ç”¨æ•°å­—æ›¿æ¢ï¼Œå†å°†æ‰€æœ‰æè¿°ç»„è¿æ¥èµ·æ¥ã€‚
>
> ä¾‹å¦‚ï¼Œæ•°å­—å­—ç¬¦ä¸² "`3322251`" çš„æè¿°å¦‚ä¸‹å›¾ï¼š
>
> ![img](img/1629874763-TGmKUh-image.png)

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 1`
> è¾“å‡ºï¼š`"1"`
> è§£é‡Šï¼šè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬æ ·ä¾‹ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 4`
> è¾“å‡ºï¼š`"1211"`
> è§£é‡Šï¼š
> `countAndSay(1) = "1"`
> `countAndSay(2) = è¯» "1" = ä¸€ ä¸ª 1 = "11"`
> `countAndSay(3) = è¯» "11" = äºŒ ä¸ª 1 = "21"`
> `countAndSay(4) = è¯» "21" = ä¸€ ä¸ª 2 + ä¸€ ä¸ª 1 = "12" + "11" = "1211"`

**æç¤º**

> + $1 <= n <= 30$

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ‹Ÿå³å¯
>   2.   æ³¨æ„äº‹é¡¹: çœ‹ä»£ç 

**ä»£ç **

```c++
class Solution {
public:
    string countAndSay(int n) {
        string str = "1";
        for (int i = 2; i <= n; i ++ ) {
            string tmp;
            for (int j = 0; j < str.size(); j ++ ) {
                int k = j;
                // åˆ¤æ–­å­—ç¬¦str[j]çš„ä¸ªæ•°
                while (k < str.size() && str[k] == str[j]) k ++;
                // (k - j)ä¸ªå­—ç¬¦str[j]
                tmp += to_string(k - j) + str[j];
                j = k - 1;
            }
            str = tmp;
        }
        return str;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(nm), næ˜¯ç»™å®šçš„æ­£æ•´æ•°, mæ˜¯ç”Ÿæˆå­—ç¬¦ä¸²çš„é•¿åº¦$

**ç©ºé—´å¤æ‚åº¦**

$O(m), mæ˜¯ç”Ÿæˆå­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦$

**æ ‡ç­¾**

`æ¨¡æ‹Ÿ`

**ç¼åˆæ€ª**



### [LeetCode 68. æ–‡æœ¬å·¦å³å¯¹é½](https://leetcode-cn.com/problems/text-justification/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªå•è¯æ•°ç»„ `words` å’Œä¸€ä¸ªé•¿åº¦ `maxWidth` ï¼Œé‡æ–°æ’ç‰ˆå•è¯ï¼Œä½¿å…¶æˆä¸ºæ¯è¡Œæ°å¥½æœ‰ `maxWidth` ä¸ªå­—ç¬¦ï¼Œä¸”å·¦å³ä¸¤ç«¯å¯¹é½çš„æ–‡æœ¬ã€‚
>
>   ä½ åº”è¯¥ä½¿ç”¨ â€œè´ªå¿ƒç®—æ³•â€ æ¥æ”¾ç½®ç»™å®šçš„å•è¯ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½å¯èƒ½å¤šåœ°å¾€æ¯è¡Œä¸­æ”¾ç½®å•è¯ã€‚å¿…è¦æ—¶å¯ç”¨ç©ºæ ¼ ' ' å¡«å……ï¼Œä½¿å¾—æ¯è¡Œæ°å¥½æœ‰ `maxWidth` ä¸ªå­—ç¬¦ã€‚
>
>   è¦æ±‚å°½å¯èƒ½å‡åŒ€åˆ†é…å•è¯é—´çš„ç©ºæ ¼æ•°é‡ã€‚å¦‚æœæŸä¸€è¡Œå•è¯é—´çš„ç©ºæ ¼ä¸èƒ½å‡åŒ€åˆ†é…ï¼Œåˆ™å·¦ä¾§æ”¾ç½®çš„ç©ºæ ¼æ•°è¦å¤šäºå³ä¾§çš„ç©ºæ ¼æ•°ã€‚
>
>   æ–‡æœ¬çš„æœ€åä¸€è¡Œåº”ä¸ºå·¦å¯¹é½ï¼Œä¸”å•è¯ä¹‹é—´ä¸æ’å…¥é¢å¤–çš„ç©ºæ ¼ã€‚
>
>   æ³¨æ„:
>
>   å•è¯æ˜¯æŒ‡ç”±éç©ºæ ¼å­—ç¬¦ç»„æˆçš„å­—ç¬¦åºåˆ—ã€‚
>   æ¯ä¸ªå•è¯çš„é•¿åº¦å¤§äº `0`ï¼Œå°äºç­‰äº `maxWidth`ã€‚
>   è¾“å…¥å•è¯æ•°ç»„ `words` è‡³å°‘åŒ…å«ä¸€ä¸ªå•è¯ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `words = ["This", "is", "an", "example", "of", "text", "justification."], maxWidth = 16`
>   è¾“å‡º:
>   `[
>     "This    is    an",
>     "example  of text",
>     "justification.  "
>   ]`

**ç¤ºä¾‹ 2**

>   è¾“å…¥:`words = ["What","must","be","acknowledgment","shall","be"], maxWidth = 16`
>   è¾“å‡º:
>   `[
>    "What   must   be",
>    "acknowledgment  ",
>    "shall be        "
>   ]`
>   è§£é‡Š: æ³¨æ„æœ€åä¸€è¡Œçš„æ ¼å¼åº”ä¸º `"shall be    "` è€Œä¸æ˜¯ `"shall     be"`,
>       å› ä¸ºæœ€åä¸€è¡Œåº”ä¸ºå·¦å¯¹é½ï¼Œè€Œä¸æ˜¯å·¦å³ä¸¤ç«¯å¯¹é½ã€‚       
>       ç¬¬äºŒè¡ŒåŒæ ·ä¸ºå·¦å¯¹é½ï¼Œè¿™æ˜¯å› ä¸ºè¿™è¡ŒåªåŒ…å«ä¸€ä¸ªå•è¯ã€‚

**ç¤ºä¾‹ 3**

>   è¾“å…¥:`words = ["Science","is","what","we","understand","well","enough","to","explain","to","a","computer.","Art","is","everything","else","we","do"]ï¼ŒmaxWidth = 20`
>   è¾“å‡º:
>   `[
>    "Science  is  what we",
>    "understand      well",
>    "enough to explain to",
>    "a  computer.  Art is",
>    "everything  else  we",
>    "do                  "
>   ]`

**æç¤º**

>   +   $1 <= words.length <= 300$
>   +   $1 <= words[i].length <= 20$
>   +   $words[i] ç”±å°å†™è‹±æ–‡å­—æ¯å’Œç¬¦å·ç»„æˆ$
>   +   $1 <= maxWidth <= 100$
>   +   $words[i].length <= maxWidth$

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ‹Ÿ, åˆ†ä¸¤æ­¥è¿›è¡Œ
>        +   å·¦å¯¹é½
>        +   ä¸¤ç«¯å¯¹é½
>   2.   `++ usednum <= leftnum` è§£é‡Š
>        +   `usednum` è¡¨ç¤ºçš„å«ä¹‰æ˜¯åœ¨å¤šå‡ºæ¥çš„ç©ºæ ¼ä¸­å·²ç»ä½¿ç”¨çš„ä¸ªæ•°
>        +   `leftnum` è¡¨ç¤ºå¤šå‡ºæ¥ç©ºæ ¼çš„æ€»ä¸ªæ•°
>        +   å‡è®¾ `leftnum = 0`
>        +   `usednum` åˆå§‹å€¼ä¸º `0`, è¡¨ç¤ºä¸€ä¸ªæ•°å­—éƒ½æ²¡æœ‰è¢«ä½¿ç”¨è¿‡
>        +   ä¸Šå¼å«ä¹‰æ˜¯ç”¨è¿‡ä¸€ä¸ªæ•°å­—ä¹‹åå¦‚æœå°äºç­‰äºæ€»ä¸ªæ•°, è¯´æ˜åˆæ³•, è¿”å› `true(1)`, å¦åˆ™, è¿”å› `false(0)`

**ä»£ç **

```c++
class Solution {
public:
    vector<string> fullJustify(vector<string>& g, int Max) {
        int n = g.size();
        vector<string> res;
        for (int i = 0; i < n; i ++ ) {
            // speå«ä¹‰ä¸ºç©ºæ ¼çš„æ•°é‡
            int j = i, len = 0, spe = 0;
            string line;
            while (j < n && len + spe + g[j].size() <= Max) {
                len = len + spe + g[j].size();
                spe = 1, j ++ ;
            }
            int wdnum = j - i; // å•è¯çš„æ•°é‡
            if (j == n || wdnum == 1) { // åˆ°è¾¾æœ€åä¸€è¡Œæ´»ç€æœ¬è¡Œåªæœ‰ä¸€ä¸ªå•è¯, å·¦å¯¹é½
                // å…ˆè¾“å…¥ä¸€ä¸ªå•è¯
                line = g[i];
                for (int k = i + 1; k < j; k ++ ) line += ' ' + g[k];
                // å°†å‰©ä½™çš„ç©ºæ ¼è¡¥é½
                line += string(Max - line.size(), ' ');
            }
            else { // ä¸¤ç«¯å¯¹é½
                // ç©ºæ ¼çš„å¹³å‡æ•°é‡
                int spenum = (Max - len + wdnum - 1) / (wdnum - 1);
               	// å‰©ä½™ç©ºæ ¼çš„æ•°é‡
                int leftnum = (Max - len + wdnum - 1) % (wdnum - 1);
                int usednum = 0; // å·²ç»ç”¨è¿‡çš„ç©ºæ ¼çš„æ•°é‡
                line = g[i ++]; // å…ˆè¾“å…¥ä¸€ä¸ªå•è¯
                // ä¸¥æ ¼å°äº
                // ++ usednum <= leftnum[æ‰‹å†™ç¨¿è§£é‡ŠåŸå› ]
                while (line.size() < Max)
                    line += string(spenum + (++ usednum <= leftnum), ' ') + g[i ++ ];
            }
            i = j - 1;
            res.push_back(line);
        }
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n), nè¡¨ç¤ºå•è¯çš„æ•°é‡$

**ç©ºé—´å¤æ‚åº¦**

$O(n), nè¡¨ç¤ºå•è¯çš„æ€»é•¿åº¦$

**æ ‡ç­¾**

`æ¨¡æ‹Ÿ`ã€`å­—ç¬¦ä¸²`

**ç¼åˆæ€ª**



## é˜…è¯»ç†è§£é¢˜

### [LeetCode 275. H æŒ‡æ•° II](https://leetcode-cn.com/problems/h-index-ii/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `citations` ï¼Œå…¶ä¸­ `citations[i]` è¡¨ç¤ºç ”ç©¶è€…çš„ç¬¬ `i` ç¯‡è®ºæ–‡è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œ`citations` å·²ç»æŒ‰ç…§ å‡åºæ’åˆ— ã€‚è®¡ç®—å¹¶è¿”å›è¯¥ç ”ç©¶è€…çš„ `h` æŒ‡æ•°ã€‚
>
> `h` æŒ‡æ•°çš„å®šä¹‰ï¼š`h` ä»£è¡¨â€œé«˜å¼•ç”¨æ¬¡æ•°â€ï¼ˆ`high citations`ï¼‰ï¼Œä¸€åç§‘ç ”äººå‘˜çš„ `h` æŒ‡æ•°æ˜¯æŒ‡ä»–ï¼ˆå¥¹ï¼‰çš„ ï¼ˆ`n` ç¯‡è®ºæ–‡ä¸­ï¼‰æ€»å…±æœ‰ `h` ç¯‡è®ºæ–‡åˆ†åˆ«è¢«å¼•ç”¨äº†è‡³å°‘ `h` æ¬¡ã€‚ä¸”å…¶ä½™çš„ `n - h` ç¯‡è®ºæ–‡æ¯ç¯‡è¢«å¼•ç”¨æ¬¡æ•° ä¸è¶…è¿‡ `h` æ¬¡ã€‚
>
> æç¤ºï¼šå¦‚æœ `h` æœ‰å¤šç§å¯èƒ½çš„å€¼ï¼Œh æŒ‡æ•° æ˜¯å…¶ä¸­æœ€å¤§çš„é‚£ä¸ªã€‚
>
> è¯·ä½ è®¾è®¡å¹¶å®ç°å¯¹æ•°æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`citations = [0,1,3,5,6]`
> è¾“å‡ºï¼š`3`
> è§£é‡Šï¼šç»™å®šæ•°ç»„è¡¨ç¤ºç ”ç©¶è€…æ€»å…±æœ‰ `5` ç¯‡è®ºæ–‡ï¼Œæ¯ç¯‡è®ºæ–‡ç›¸åº”çš„è¢«å¼•ç”¨äº† `0, 1, 3, 5, 6` æ¬¡ã€‚
> ç”±äºç ”ç©¶è€…æœ‰ `3` ç¯‡è®ºæ–‡æ¯ç¯‡ è‡³å°‘ è¢«å¼•ç”¨äº† `3` æ¬¡ï¼Œå…¶ä½™ä¸¤ç¯‡è®ºæ–‡æ¯ç¯‡è¢«å¼•ç”¨ ä¸å¤šäº `3` æ¬¡ï¼Œæ‰€ä»¥å¥¹çš„ `h` æŒ‡æ•°æ˜¯ `3` ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`citations = [1,2,100]`
> è¾“å‡ºï¼š`2`

**æç¤º**

> + $n == citations.length$
> + $1 <= n <= 10^5$
> + $0 <= citations[i] <= 1000$
> + $citations æŒ‰ å‡åºæ’åˆ—$

**åˆ†æ**

> 1. å°†æ•°ç»„ä»å¤§åˆ°å°æ’åºï¼Œç„¶åä»å‰å¾€åä¸€æ¬¡æšä¸¾æ¯ä¸€ä¸ªæ•°å­—ï¼Œå¦‚æœå½“å‰æ•°å­— `g[i] >= n - i`ï¼Œåˆ™æ‰¾åˆ°ç­”æ¡ˆ
> 2. æœ¬é¢˜ä¸­ç”±äºæŒ‰ç…§ä»å°åˆ°å¤§æ’åºçš„ï¼Œæ‰€ä»¥åšçš„æ—¶å€™éœ€è¦è¿›è¡Œåæ ‡å˜æ¢ `g[n - mid]` è¡¨ç¤ºçš„æ˜¯ä»å¤§åˆ°å°çš„ç¬¬ `mid` ä¸ªæ•°å­—
> 3. æœ¬é¢˜ä¸­äºŒåˆ†çš„æ˜¯ç­”æ¡ˆä¹Ÿå°±æ˜¯ `H` çš„å€¼ï¼Œæœ€å°æ˜¯ `0`ï¼Œæœ€å¤§æ˜¯ `n`

**ä»£ç **

```c++
class Solution {
public:
    int hIndex(vector<int>& g) {
        int n = g.size(), l = 0, r = n;
        while (l < r) {
            int mid = l + r + 1 >> 1;
            if (g[n - mid] >= mid) l = mid;
            else r = mid - 1;
        }
        return l;
    }
};
```

**æ ‡ç­¾**

`é˜…è¯»ç†è§£`

### [LeetCode 393. UTF-8 ç¼–ç éªŒè¯](https://leetcode-cn.com/problems/utf-8-validation/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªè¡¨ç¤ºæ•°æ®çš„æ•´æ•°æ•°ç»„ `data` ï¼Œè¿”å›å®ƒæ˜¯å¦ä¸ºæœ‰æ•ˆçš„ `UTF-8` ç¼–ç ã€‚
>
>   `UTF-8` ä¸­çš„ä¸€ä¸ªå­—ç¬¦å¯èƒ½çš„é•¿åº¦ä¸º `1` åˆ° `4` å­—èŠ‚ï¼Œéµå¾ªä»¥ä¸‹çš„è§„åˆ™ï¼š
>
>   +   å¯¹äº `1` å­—èŠ‚ çš„å­—ç¬¦ï¼Œå­—èŠ‚çš„ç¬¬ä¸€ä½è®¾ä¸º `0` ï¼Œåé¢ `7` ä½ä¸ºè¿™ä¸ªç¬¦å·çš„ `unicode` ç ã€‚
>   +   å¯¹äº `n` å­—èŠ‚ çš„å­—ç¬¦ (`n > 1`)ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰ `n` ä½éƒ½è®¾ä¸º`1`ï¼Œç¬¬ `n + 1` ä½è®¾ä¸º `0` ï¼Œåé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º `10` ã€‚å‰©ä¸‹çš„æ²¡æœ‰æåŠçš„äºŒè¿›åˆ¶ä½ï¼Œå…¨éƒ¨ä¸ºè¿™ä¸ªç¬¦å·çš„ `unicode` ç ã€‚
>
>   è¿™æ˜¯ `UTF-8` ç¼–ç çš„å·¥ä½œæ–¹å¼ï¼š
>
>   ```c++
>      Char. number range  |        UTF-8 octet sequence
>         (hexadecimal)    |              (binary)
>      --------------------+---------------------------------------------
>      0000 0000-0000 007F | 0xxxxxxx
>      0000 0080-0000 07FF | 110xxxxx 10xxxxxx
>      0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx
>      0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
>   ```
>
>
>   æ³¨æ„ï¼šè¾“å…¥æ˜¯æ•´æ•°æ•°ç»„ã€‚åªæœ‰æ¯ä¸ªæ•´æ•°çš„ æœ€ä½ `8` ä¸ªæœ‰æ•ˆä½ ç”¨æ¥å­˜å‚¨æ•°æ®ã€‚è¿™æ„å‘³ç€æ¯ä¸ªæ•´æ•°åªè¡¨ç¤º `1` å­—èŠ‚çš„æ•°æ®ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`data = [197,130,1]`
>   è¾“å‡ºï¼š`true`
>   è§£é‡Šï¼šæ•°æ®è¡¨ç¤ºå­—èŠ‚åºåˆ—:`11000101 10000010 00000001`ã€‚
>   è¿™æ˜¯æœ‰æ•ˆçš„ `utf-8` ç¼–ç ï¼Œä¸ºä¸€ä¸ª `2` å­—èŠ‚å­—ç¬¦ï¼Œè·Ÿç€ä¸€ä¸ª `1` å­—èŠ‚å­—ç¬¦ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`data = [235,140,4]`
>   è¾“å‡ºï¼š`false`
>   è§£é‡Šï¼šæ•°æ®è¡¨ç¤º `8` ä½çš„åºåˆ—: `11101011 10001100 00000100`.
>   å‰ `3` ä½éƒ½æ˜¯ `1` ï¼Œç¬¬ `4` ä½ä¸º `0` è¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª `3` å­—èŠ‚å­—ç¬¦ã€‚
>   ä¸‹ä¸€ä¸ªå­—èŠ‚æ˜¯å¼€å¤´ä¸º `10` çš„å»¶ç»­å­—èŠ‚ï¼Œè¿™æ˜¯æ­£ç¡®çš„ã€‚
>   ä½†ç¬¬äºŒä¸ªå»¶ç»­å­—èŠ‚ä¸ä»¥ `10` å¼€å¤´ï¼Œæ‰€ä»¥æ˜¯ä¸ç¬¦åˆè§„åˆ™çš„ã€‚

**æç¤º**

>   +   $1 <= data.length <= 2 * 10^4$
>   +   $0 <= data[i] <= 255$

**æ‰‹å†™ç¨¿**

![4241610](img/4241610.png)

**ä»£ç **

```c++
class Solution {
public:
    int get(int x, int k) {
        return x >> k & 1;
    }
    bool validUtf8(vector<int>& data) {
        for (int i = 0; i < data.size(); i ++ ) {
            // å¦‚æœæ˜¯ä¸€ä¸ªå­—èŠ‚, åˆ™è·³è¿‡
            if (!get(data[i], 7)) continue;
            int k = 0;
            // æŸ¥çœ‹å½“å‰å­—ç¬¦å æ®çš„å­—èŠ‚æ•°
            while (k <= 4 && get(data[i], 7 - k)) k ++ ;
            if (k < 2 || k > 4) return false;
           	// æŸ¥çœ‹ä¹‹åçš„kä¸ªå­—èŠ‚[åŒ…æ‹¬å½“å‰ä½ç½®]
            for (int j = 1; j < k; j ++ )
                // ä¸èƒ½è¶Šç•Œ
                if (i + j < data.size() && get(data[i + j], 7) && !get(data[i + j], 6))
                    continue;
                else return false;
            i += k - 1;
        }
        return true;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`é˜…è¯»ç†è§£é¢˜`

**ç¼åˆæ€ª**



## è¡¨è¾¾å¼æ±‚å€¼

### [LeetCode 224. åŸºæœ¬è®¡ç®—å™¨](https://leetcode-cn.com/problems/basic-calculator/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ s ï¼Œè¯·ä½ å®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`s = "1 + 1"`
> è¾“å‡ºï¼š`2`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`s = " 2-1 + 2 "`
> è¾“å‡ºï¼š`3`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`s = "(1+(4+5+2)-3)+(6+8)"`
> è¾“å‡ºï¼š`23`

**æç¤º**

> + $1 <= s.length <= 3 * 10^5$
> + `s` ç”±æ•°å­—`ã€'+'ã€'-'ã€'('ã€')'ã€`å’Œ `' '` ç»„æˆ
> + `s` è¡¨ç¤ºä¸€ä¸ªæœ‰æ•ˆçš„è¡¨è¾¾å¼

**é¢˜è§£**

> 1. ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªæ˜¯æ•°å­—æ ˆ `num` ï¼Œå¦ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²æ ˆ `oper`
> 2. éå†æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œåˆ†ä»¥ä¸‹äº”ç§æƒ…å†µï¼š
>     + å¦‚æœé‡åˆ°ç©ºæ ¼ï¼Œç›´æ¥ `continue`
>     + å¦‚æœé‡åˆ°`(`ï¼Œç›´æ¥å…¥æ ˆ `oper`
>     + å¦‚æœé‡åˆ° `)` ï¼Œè®¡ç®—ç­”æ¡ˆï¼Œç›´åˆ° `oper` æ ˆé¡¶ä¸º `(` çš„æ—¶å€™åœæ­¢
>     + å¦‚æœé‡åˆ°æ•°å­—ï¼Œåˆ™è®¡ç®—æ•°å­—çš„å¤§å°ï¼Œå…¥æ ˆ `num`<font style="color:red">**ï¼ˆæ³¨æ„æ•°å­—ä¸ä¸€å®šæ˜¯ä¸€ä½æ•°ï¼‰**</font>
>     + å¦‚æœé‡åˆ° `+`ï¼Œ`-`ï¼Œåˆ™ç»§ç»­è¿›è¡Œå¦‚ä¸‹åˆ¤æ–­ï¼š
>         + å¦‚æœå½“å‰å€¼æ˜¯ç¬¬ä¸€ä½ï¼Œä¾‹å¦‚ `+2`ï¼Œåˆ™ä¸ºäº†æ–¹ä¾¿è®¡ç®—ï¼Œåœ¨å‰é¢è¡¥ä¸€ä¸ª `0` å³å¯
>         + å¦‚æœå½“å‰ä½ä¸æ˜¯ç¬¬ä¸€ä½å¹¶ä¸”å‰ä¸€ä½æ˜¯æ‹¬å·ï¼Œä¾‹å¦‚ `(+2)`ï¼Œåˆ™ä¸ºäº†æ–¹ä¾¿ï¼Œè¡¥ä¸€ä¸ª `0` å³å¯
>         + é™¤ä¸Šè¿°æƒ…å†µå¤–ï¼Œæ­£å¸¸è®¡ç®—ï¼Œç›´åˆ°æ ˆä¸ºç©ºæˆ–è€…é‡åˆ° `(` çš„æ—¶å€™åœæ­¢
> 3. å¦‚æœæ ˆä¸­è¿˜æœ‰è¿ç®—ç¬¦ï¼Œåˆ™ç»§ç»­è®¡ç®—ï¼Œç›´åˆ°æ ˆä¸ºç©ºï¼Œç­”æ¡ˆå°±æ˜¯æ ˆé¡¶å…ƒç´ 

**ä»£ç **

```c++
class Solution {
public:
    stack<int> num;
    stack<char> oper;
    void eval() {
        int b = num.top(); num.pop();
        int a = num.top(); num.pop();
        char op = oper.top(); oper.pop();
        if (op == '+') num.push(a + b);
        else num.push(a - b);
        return;
    }
    int calculate(string s) {
        for (int i = 0; i < s.size(); i ++ ) {
            if (s[i] == ' ') continue;
            else if (s[i] == '(') oper.push(s[i]);
            else if (s[i] == ')') {
                while (oper.top() != '(') eval();
                // å¼¹å‡ºå·¦æ‹¬å·
                oper.pop();
            }
            else if (isdigit(s[i])) {
                int sum = 0;
                while (i < s.size() && isdigit(s[i]))
                    sum = sum * 10 + (s[i ++ ] - '0');
                num.push(sum);
                i --;
            }
            else {
                // å¤„ç†ç‰¹æ®Šæƒ…å†µï¼Œå¦‚ +2 + a æˆ–è€… (-2 + a) ç­‰ç±»ä¼¼æƒ…å†µ
                if (!i || s[i - 1] == '(') num.push(0);
                while (oper.size() && oper.top() != '(') eval();
                // å°†å½“å‰æ‹¬å·å…¥æ ˆ
                oper.push(s[i]);
            }
        }
        while (oper.size()) eval();
        return num.top();
    }
};
```

**æ ‡ç­¾**

`æ ˆ`ã€`è¡¨è¾¾å¼æ±‚å€¼`

### [LeetCode 282. ç»™è¡¨è¾¾å¼æ·»åŠ è¿ç®—ç¬¦](https://leetcode-cn.com/problems/expression-add-operators/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªä»…åŒ…å«æ•°å­— `0-9` çš„å­—ç¬¦ä¸² `num` å’Œä¸€ä¸ªç›®æ ‡å€¼æ•´æ•° `target` ï¼Œåœ¨ `num` çš„æ•°å­—ä¹‹é—´æ·»åŠ  äºŒå…ƒ è¿ç®—ç¬¦ï¼ˆä¸æ˜¯ä¸€å…ƒï¼‰`+`ã€`-` æˆ– `*` ï¼Œè¿”å›æ‰€æœ‰èƒ½å¤Ÿå¾—åˆ°ç›®æ ‡å€¼çš„è¡¨è¾¾å¼ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥: `num = "123", target = 6`
> è¾“å‡º: `["1+2+3", "1*2*3"] `

**ç¤ºä¾‹ 2**

> è¾“å…¥: `num = "232", target = 8`
> è¾“å‡º: `["2*3+2", "2+3*2"]`

**ç¤ºä¾‹ 3**

> è¾“å…¥: `num = "105", target = 5`
> è¾“å‡º: `["1*0+5","10-5"]`

**ç¤ºä¾‹ 4**

> è¾“å…¥: `num = "00", target = 0`
> è¾“å‡º: `["0+0", "0-0", "0*0"]`

**ç¤ºä¾‹ 5**

> è¾“å…¥: `num = "3456237490", target = 9191`
> è¾“å‡º: `[]`

**æç¤º**

> + $1 <= num.length <= 10$
> + $num ä»…å«æ•°å­—$
> + $-2^{31} <= target <= 2^{31} - 1$

**æ‰‹å†™ç¨¿**

![w](img/w.png)

**ä»£ç **

```c++
class Solution {
public:
    typedef long long LL;
    string path;
    vector<string> res;
    // ä¿è¯ç­”æ¡ˆä¸è¶Šç•Œï¼Œä½†æ˜¯ä¸ä¿è¯ä¸­é—´è¿‡ç¨‹ä¸è¶Šç•Œ
    void dfs(string& num, int u, int len, LL a, LL b, LL target) {
        if (u == num.size())
            if (a == target) {
                res.push_back(path.substr(0, len - 1));
                return;
            }
        LL c = 0;
        for (int i = u; i < num.size(); i ++ ) {
            c = c * 10 + (num[i] - '0');
            path[len ++ ] = num[i];
            // æšä¸¾ç¬¬lenä½å¡«å†™çš„è¿ç®—ç¬¦
            // +
            path[len] = '+';
            dfs(num, i + 1, len + 1, a + b * c, 1, target);
            if (i + 1 < num.size()) {
                // -
                path[len] = '-';
                dfs(num, i + 1, len + 1, a + b * c, -1, target);
                // *
                path[len] = '*';
                dfs(num, i + 1, len + 1, a, b * c, target);
            }
            // ä¸èƒ½æœ‰å‰å¯¼0
            if (num[u] == '0') return;
        }
        return;
    }
    vector<string> addOperators(string num, int target) {
        // æ‰©å®¹
        path.resize(100);
        /*
        	å‚æ•°1: numå­—ç¬¦ä¸²
        	å‚æ•°2: å½“å‰æšä¸¾çš„æ˜¯numä¸­çš„å“ªä½å­—ç¬¦
        	å‚æ•°3: ç­”æ¡ˆå­—ç¬¦ä¸²çš„é•¿åº¦
        	å‚æ•°4: açš„å€¼
        	å‚æ•°5: bçš„å€¼
        	å‚æ•°6: ç›®æ ‡å€¼
        */
        dfs(num, 0, 0, 0, 1, target);
        return res;
    }
};
```

**æ ‡ç­¾**

`dfs`ã€`è¡¨è¾¾å¼æ±‚å€¼`

## é«˜ç²¾åº¦

### æ³¨æ„äº‹é¡¹ã€å¿…çœ‹ã€‘

>   1.   åˆ†æå¦‚ä¸‹ä»£ç ã€ä»¥é«˜ç²¾åº¦åŠ æ³•ä¸ºä¾‹ã€‘
>
>        ```c++
>        vector<int> add(vector<int>& A, vector<int>& B) {
>            vector<int> C;
>            // è¿›ä½
>            int t = 0;
>            for (int i = 0, j = 0; i < A.size() || j < B.size(); i ++, j ++ ) {
>                if (i < A.size()) t += A[i];
>                if (j < B.size()) t += B[i];
>                C.push_back(t % 10);
>                t /= 10;
>            }
>            // å¦‚æœäº§ç”Ÿä½æ•°çš„å˜åŒ–ï¼Œå³ç±»ä¼¼äº99 + 1ï¼Œæ•…è¿˜éœ€å¤„ç†è¿›ä½
>            while (t) {
>                C.push_back(t % 10);
>                t /= 10;
>            }
>            // é€†åºè¿”å›
>            return vector<int>(C.rbegin(), C.rend());
>        }
>        ```
>
>        +   é—®é¢˜å¦‚ä¸‹
>
>            +   äº§ç”Ÿè¿›ä½çš„æ—¶å€™ï¼Œä¸ºå•¥è¦ä½¿ç”¨ `while(t)` è€Œä¸æ˜¯ `if(t)` ?
>
>                >   1.   æ˜ç¡®ç›®æ ‡ï¼š`C` ä¸­çš„<font style = "color: red">**æ¯ä¸€ä¸ªå…ƒç´ **</font>åªèƒ½æ˜¯<font style = "color: red">**ä¸€ä½æ•°**</font>
>                >
>                >        +   ä¸ºå•¥ `C` ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å¿…é¡»åªèƒ½æ˜¯ä¸€ä½æ•°ï¼Ÿ
>                >
>                >            >   å‡è®¾`A` å’Œ `B` ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ æœ‰å¯èƒ½ä¸æ˜¯ä¸€ä½æ•°ï¼Œä¾‹å¦‚ï¼Œ`A = {2e9}, B = {2e9}`ï¼Œè°ƒç”¨ `add(A, B)`ï¼Œæ­¤æ—¶ï¼Œç­”æ¡ˆåº”ä¸º ` 4e9`ï¼Œç”±äºï¼Œ`C` ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ `int` ç±»å‹ï¼Œæ­¤æ—¶å°±è¶Šç•Œäº†ï¼Œæ— æ³•è®¡ç®—å‡ºæ­£ç¡®ç­”æ¡ˆï¼Œå› æ­¤ï¼Œ`C` ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ å¿…é¡»åªèƒ½æ˜¯ä¸€ä½æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šäº§ç”Ÿè¶Šç•Œçš„é—®é¢˜ï¼Œ`long long` å’Œ `double` ç­‰å…¶ä»–ç±»å‹ï¼Œéƒ½æ˜¯ä¼šäº§ç”Ÿç›¸ä¼¼çš„é—®é¢˜

### [AcWing 791. é«˜ç²¾åº¦åŠ æ³•](https://www.acwing.com/problem/content/793/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªæ­£æ•´æ•°ï¼ˆä¸å«å‰å¯¼ `0`ï¼‰ï¼Œè®¡ç®—å®ƒä»¬çš„å’Œã€‚

**è¾“å…¥æ ¼å¼**

>   å…±ä¸¤è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«æ‰€æ±‚çš„å’Œã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤æ•´æ•°é•¿åº¦â‰¤100000$

**è¾“å…¥æ ·ä¾‹**

```c++
12
23
```

**è¾“å‡ºæ ·ä¾‹**

```c++
35
```

**æ‰‹å†™ç¨¿**

>   1.   æ¨¡æ‹Ÿæ‰‹ç®—å³å¯
>
>   2.   æ³¨æ„äº‹é¡¹ï¼š
>
>        +   æ•°å­—éœ€è¦<font style = "color: red">**å€’ç€å­˜å‚¨**</font>ï¼ŒåŸå› å¦‚ä¸‹
>
>            ![392036](img/392036.png)

**ä»£ç ä¸€ï¼š`vector` å­˜å‚¨**

```c++
#include <iostream>
#include <vector>
using namespace std;
string a, b;
vector<int> A, B;
vector<int> add(vector<int>& A, vector<int>& B) {
    vector<int> C;
    // è¿›ä½
    int t = 0;
    for (int i = 0, j = 0; i < A.size() || j < B.size(); i ++, j ++ ) {
        if (i < A.size()) t += A[i];
        if (j < B.size()) t += B[i];
        C.push_back(t % 10);
        t /= 10;
    }
    // å¦‚æœäº§ç”Ÿä½æ•°çš„å˜åŒ–ï¼Œå³ç±»ä¼¼äº99 + 1ï¼Œæ•…è¿˜éœ€å¤„ç†è¿›ä½
    while (t) {
        C.push_back(t % 10);
        t /= 10;
    }
    // é€†åºè¿”å›
    return vector<int>(C.rbegin(), C.rend());
}
int main() {
    cin >> a >> b;
    for (int i = a.size() - 1; i >= 0; i -- ) A.push_back(a[i] - '0');
    for (int i = b.size() - 1; i >= 0; i -- ) B.push_back(b[i] - '0');
    vector<int> C = add(A, B);
    for (int i = 0; i < C.size(); i ++ ) cout << C[i];
    return 0;
}
```

**ä»£ç äºŒï¼šæ•°ç»„å­˜å‚¨**

```c++
#include <iostream>
using namespace std;
const int N = 100005;
string a, b;
// è®°å½•Aæ•°ç»„é•¿åº¦ï¼ŒBæ•°ç»„é•¿åº¦å’ŒCæ•°ç»„é•¿åº¦
int n, m, idx;
int A[N], B[N], C[N];
void add(int A[], int B[]) {
    // è¿›ä½
    int t = 0;
    for (int i = 0, j = 0; i < n || j < m; i ++, j ++ ) {
        if (i < n) t += A[i];
        if (j < m) t += B[i];
        C[idx ++ ] = t % 10; 
        t /= 10;
    }
    // å¦‚æœäº§ç”Ÿä½æ•°çš„å˜åŒ–ï¼Œå³ç±»ä¼¼äº99 + 1ï¼Œæ•…è¿˜éœ€å¤„ç†è¿›ä½
    while (t) {
        C[idx ++ ] = t % 10;
        t /= 10;
    }
    // é€†åº
    for (int i = 0; i < idx / 2; i ++ ) swap(C[i], C[idx - 1 - i]);
    return;
}
int main() {
    cin >> a >> b;
    n = a.size(), m = b.size();
    for (int i = n - 1; i >= 0; i -- ) A[n - 1 - i] = a[i] - '0';
    for (int i = m - 1; i >= 0; i -- ) B[m - 1 - i] = b[i] - '0';
    add(A, B);
    for (int i = 0; i < idx; i ++ ) cout << C[i];
    return 0;
}
```

**æ ‡ç­¾**

`é«˜ç²¾åº¦`ã€`é«˜ç²¾åº¦åŠ æ³•`

### [AcWing 792. é«˜ç²¾åº¦å‡æ³•](https://www.acwing.com/problem/content/794/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªæ­£æ•´æ•°ï¼ˆä¸å«å‰å¯¼ `0`ï¼‰ï¼Œè®¡ç®—å®ƒä»¬çš„å·®ï¼Œè®¡ç®—ç»“æœå¯èƒ½ä¸ºè´Ÿæ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   å…±ä¸¤è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«æ‰€æ±‚çš„å·®ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤æ•´æ•°é•¿åº¦â‰¤10^5$

**è¾“å…¥æ ·ä¾‹**

```c++
32
11
```

**è¾“å‡ºæ ·ä¾‹**

```c++
21
```

**æ‰‹å†™ç¨¿**

>   <font style = "color: red">**æ³¨æ„äº‹é¡¹ï¼š**</font>
>
>   +   ä¸ºäº†ä½¿å¾—é«˜ç²¾åº¦æ¨¡æ¿ç»Ÿä¸€ï¼Œæ•…<font style="color: red">**å€’ç€å­˜å‚¨**</font>
>   +   è®¡ç®— `A - B` çš„æ—¶å€™ï¼Œä¸ºäº†å†™ä»£ç æ–¹ä¾¿ï¼Œè§„å®š `A >= B`ï¼ˆæ‰‹å†™å†™ä¸ªåˆ¤æ–­å‡½æ•° `cmp` ï¼‰
>   +   å…¶ä½™ç»†èŠ‚éƒ¨åˆ†ä½“ç°åœ¨ä»£ç ä¸­

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
string a, b;
vector<int> A, B;
bool cmp(string &a, string &b) {
    if (a.size() != b.size()) return a.size() >= b.size();
    return a >= b;
}
vector<int> sub(vector<int>& A, vector<int>& B) {
    vector<int> C;
    int t = 0;
    // å› ä¸ºA >= Bï¼Œå› æ­¤ï¼ŒAçš„é•¿åº¦ä¸€å®šå¤§äºç­‰äºBçš„é•¿åº¦
    for (int i = 0; i < A.size(); i ++ ) {
        t = A[i] - t;
        // å¦‚æœå½“å‰æ²¡æœ‰åˆ°è¾¾Bçš„ç»“å°¾
        if (i < B.size()) t -= B[i];
        C.push_back((t + 10) % 10);
        if (t >= 0) t = 0;
        else t = 1;
    }
    while (t) C.push_back(t % 10), t /= 10;
    // å»æ‰å‰å¯¼0
    while (C.size() > 1 && C.back() == 0) C.pop_back();
    return vector<int>(C.rbegin(), C.rend());
}
int main() {
    cin >> a >> b;
    for (int i = a.size() - 1; i >= 0; i -- ) A.push_back(a[i] - '0');
    for (int i = b.size() - 1; i >= 0; i -- ) B.push_back(b[i] - '0');
    vector<int> C;
    if (cmp(a, b)) // å¦‚æœ A >= B
        C = sub(A, B);
    else { // å¦‚æœ A < B
        cout << "-";
        C = sub(B, A);
    }
    for (int i = 0; i < C.size(); i ++ ) cout << C[i];
    return 0;
}
```

**æ ‡ç­¾**

`é«˜ç²¾åº¦`ã€`é«˜ç²¾åº¦å‡æ³•`

### [AcWing 793. é«˜ç²¾åº¦ä¹˜æ³•](https://www.acwing.com/problem/content/795/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªéè´Ÿæ•´æ•°ï¼ˆä¸å«å‰å¯¼ `0`ï¼‰ `A` å’Œ `B`ï¼Œè¯·ä½ è®¡ç®— `AÃ—B` çš„å€¼ã€‚

**è¾“å…¥æ ¼å¼**

>   å…±ä¸¤è¡Œï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `A`ï¼Œç¬¬äºŒè¡ŒåŒ…å«æ•´æ•° `B`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å« `AÃ—B` çš„å€¼ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Açš„é•¿åº¦â‰¤100000,$
>   +   $0â‰¤Bâ‰¤10000$

**è¾“å…¥æ ·ä¾‹**

```c++
2
3
```

**è¾“å‡ºæ ·ä¾‹**

```c++
6
```

**æ‰‹å†™ç¨¿**

>   1.   ä¸ºäº†å†™ä»£ç æ–¹ä¾¿ä»¥åŠæ ¼å¼ç»Ÿä¸€<font style = "color: red">**å€’ç€å­˜å‚¨**</font>

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
string a;
int b;
vector<int> A;
vector<int> mul(vector<int>& A, int b) {
    vector<int> C;
    int t = 0;
    for (int i = 0; i < A.size(); i ++ ) {
        t += A[i] * b;
        C.push_back(t % 10);
        t /= 10;
    }
    while (t) C.push_back(t % 10),t /= 10;
    // å¤„ç†ç±»ä¼¼ 1000 * 0 çš„æƒ…å†µ
    // å¦‚æœç­”æ¡ˆæ˜¯0ï¼Œåˆ™åªä¿ç•™ä¸€ä¸ª
    while (C.size() > 1 && C.back() == 0) C.pop_back();
    return vector<int>(C.rbegin(), C.rend());
}
int main() {
    cin >> a >> b;
    for (int i = a.size() - 1;i >= 0; i -- ) A.push_back(a[i] - '0');
    vector<int> C = mul(A, b);
    for (int i = 0; i < C.size(); i ++ ) cout << C[i];
    return 0;
}
```

**æ ‡ç­¾**

`é«˜ç²¾åº¦`ã€`é«˜ç²¾åº¦ä¹˜æ³•`

### [AcWing 794. é«˜ç²¾åº¦é™¤æ³•](https://www.acwing.com/problem/content/796/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªéè´Ÿæ•´æ•°ï¼ˆä¸å«å‰å¯¼ `0`ï¼‰ `Aï¼ŒB`ï¼Œè¯·ä½ è®¡ç®— `A/B` çš„å•†å’Œä½™æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   å…±ä¸¤è¡Œï¼Œç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `A`ï¼Œç¬¬äºŒè¡ŒåŒ…å«æ•´æ•° `B`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œè¾“å‡ºæ‰€æ±‚çš„å•†ï¼Œç¬¬äºŒè¡Œè¾“å‡ºæ‰€æ±‚ä½™æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤Açš„é•¿åº¦â‰¤100000,$
>   +   $1â‰¤Bâ‰¤10000,$
>   +   $B ä¸€å®šä¸ä¸º 0$

**è¾“å…¥æ ·ä¾‹**

```c++
7
2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
1
```

**æ‰‹å†™ç¨¿**

>   1.   <font style = "color: red">**æ³¨æ„äº‹é¡¹ï¼š**</font>
>        +   é™¤æ³•æ˜¯<font style = "color: red">æ­£ç€å­˜å‚¨</font>ï¼Œå› ä¸ºé™¤æ³•æ˜¯ä»<font style = "color: red">æœ€é«˜ä½</font>å¼€å§‹è®¡ç®—ï¼Œè€ŒåŠ å‡ä¹˜éƒ½æ˜¯ä»<font style = "color: red">æœ€ä½ä½</font>å¼€å§‹è®¡ç®—
>        +   å…¶ä½™ç»†èŠ‚åœ¨ä»£ç ä¸­

**ä»£ç **

```c++
#include <iostream>
#include <vector>
using namespace std;
string a;
int b, re;
vector<int> A;
vector<int> divide(vector<int>& A, int b) {
    vector<int> C;
    int t = 0;
    for (int i = 0; i < A.size(); i ++ ) {
        t = t * 10 + A[i];
        // /bå’Œ%bä¸æ˜¯/10å’Œ%10
        C.push_back(t / b);
        t %= b;
    }
    re = t;
    // åè½¬æ–¹ä¾¿é™¤å»åƒå²›0
    C = vector<int>(C.rbegin(), C.rend());
    while (C.size() > 1 && C.back() == 0) C.pop_back();
    // å†æ¬¡åè½¬
    return vector<int>(C.rbegin(), C.rend());
}
int main() {
    cin >> a >> b;
    // æ­£ç€å­˜å‚¨
    for (int i = 0; i < a.size(); i ++ ) A.push_back(a[i] - '0');
    vector<int> C = divide(A, b);
    for (int i = 0; i < C.size(); i ++ ) cout << C[i];
    cout << endl << re << endl;
    return 0;
}
```

**æ ‡ç­¾**

`é«˜ç²¾åº¦`ã€`é«˜ç²¾åº¦é™¤æ³•`

# æ•°å­¦

##  æ™®é€šæ•°å­¦

### [LeetCode 223. çŸ©å½¢é¢ç§¯](https://leetcode-cn.com/problems/rectangle-area/)

**é¢˜ç›®æè¿°**

> ç»™ä½  **äºŒç»´** å¹³é¢ä¸Šä¸¤ä¸ª **ç”±ç›´çº¿æ„æˆä¸”è¾¹ä¸åæ ‡è½´å¹³è¡Œ/å‚ç›´** çš„çŸ©å½¢ï¼Œè¯·ä½ è®¡ç®—å¹¶è¿”å›ä¸¤ä¸ªçŸ©å½¢è¦†ç›–çš„æ€»é¢ç§¯ã€‚
>
> æ¯ä¸ªçŸ©å½¢ç”±å…¶ **å·¦ä¸‹** é¡¶ç‚¹å’Œ **å³ä¸Š** é¡¶ç‚¹åæ ‡è¡¨ç¤ºï¼š
>
> ç¬¬ä¸€ä¸ªçŸ©å½¢ç”±å…¶å·¦ä¸‹é¡¶ç‚¹ `(ax1, ay1)` å’Œå³ä¸Šé¡¶ç‚¹ `(ax2, ay2)` å®šä¹‰ã€‚
> ç¬¬äºŒä¸ªçŸ©å½¢ç”±å…¶å·¦ä¸‹é¡¶ç‚¹ `(bx1, by1)` å’Œå³ä¸Šé¡¶ç‚¹ `(bx2, by2)` å®šä¹‰ã€‚

**ç¤ºä¾‹ 1**

![çŸ©å½¢é¢ç§¯ å›¾1](img/%E7%9F%A9%E5%BD%A2%E9%9D%A2%E7%A7%AF%20%E5%9B%BE1.png)

> è¾“å…¥ï¼š`ax1 = -3, ay1 = 0, ax2 = 3, ay2 = 4, bx1 = 0, by1 = -1, bx2 = 9, by2 = 2`
> è¾“å‡ºï¼š`45`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`ax1 = -2, ay1 = -2, ax2 = 2, ay2 = 2, bx1 = -2, by1 = -2, bx2 = 2, by2 = 2`
> è¾“å‡ºï¼š`16`

**æç¤º**

> $-10^4\;<=\;ax1,\;ay1,\;ax2,\;ay2,\;bx1,\;by1,\;bx2,\;by2\;<=\;10^4$

**æ‰‹å†™ç¨¿**

![çŸ©å½¢é¢ç§¯](img/%E7%9F%A9%E5%BD%A2%E9%9D%A2%E7%A7%AF.png)

**ä»£ç **

```c++
class Solution {
public:
    int computeArea(int ax1, int ay1, int ax2, int ay2, int bx1, int by1, int bx2, int by2) {
        int X = max(0, min(ax2, bx2) - max(ax1, bx1));
        int Y = max(0, min(ay2, by2) - max(ay1, by1));
        return (ax2 - ax1) * (ay2 - ay1) + (bx2 - bx1) * (by2 - by1) - X * Y;
    }
};
```

**æ ‡ç­¾**

`å‡ ä½•`ã€`æ•°å­¦`

### [LeetCode 264. ä¸‘æ•° II](https://leetcode-cn.com/problems/ugly-number-ii/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•´æ•° `n` ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›ç¬¬ `n` ä¸ªä¸‘æ•° ã€‚
>
> ä¸‘æ•° å°±æ˜¯åªåŒ…å«è´¨å› æ•° `2ã€3` å’Œ/æˆ– `5` çš„æ­£æ•´æ•°ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 10`
> è¾“å‡ºï¼š`12`
> è§£é‡Šï¼š`[1, 2, 3, 4, 5, 6, 8, 9, 10, 12]` æ˜¯ç”±å‰ `10` ä¸ªä¸‘æ•°ç»„æˆçš„åºåˆ—ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 1`
> è¾“å‡ºï¼š`1`
> è§£é‡Šï¼š`1` é€šå¸¸è¢«è§†ä¸ºä¸‘æ•°ã€‚

**æç¤º**

> $1\;\leq\;n\;\leq\;1690$

**é¢˜è§£**

> 1. è‹¥ `a` æ˜¯<font style ="color: red">**ä¸‘æ•°**</font>ï¼Œåˆ™ `a * 2` ä¹Ÿæ˜¯ä¸‘æ•°
>
>     + $$
>         è‹¥aæ˜¯ä¸‘æ•°ï¼Œåˆ™aå¯ä»¥è¡¨ç¤ºæˆ \\
>         a = p_1^{n}\;*\;p_2^{m}\;*\;p_3^{k}ï¼Œ\;å…¶ä¸­p_1ä¸º2ï¼Œp_2ä¸º3ï¼Œp_3ä¸º5 \\
>         ç°åœ¨æ¥çœ‹\;a\;*\;p = p_1^{n}\;*\;p_2^{m}\;*\;p_3^{k}\;*\;pï¼Œå…¶ä¸­pä¸º2ï¼Œ3ï¼Œæˆ–5 \\
>         è¯æ¯•
>         $$
>
> 2. ä¸‰æŒ‡é’ˆåšæ³•

**æ‰‹å†™ç¨¿**

![2172025](img/2172025.png)

**è§£é¢˜æ­¥éª¤**

> 1. åˆå§‹ä¸‘æ ‘æ•°ç»„ç­‰äº `q = [1]`ï¼Œå®šä¹‰ä¸‰ä¸ªæŒ‡é’ˆï¼Œ`iï¼Œjï¼Œk` åˆ†åˆ«å¯¹åº”è´¨å› æ•° `2` çš„é›†åˆï¼Œ`3` çš„é›†åˆï¼Œ`5` çš„é›†åˆï¼Œåˆå§‹å€¼ä¸º `i = j = k = 0`
>     + ç¬¬ä¸€æ­¥
>         + `t = min(q[i] * 2, q[j] * 3, q[k] * 5) = min(1 * 2, 1 * 3, 1 * 5) = min(2,  3, 5) = 2`
>         + `t` å–å€¼ä¸º `2`ï¼Œå¯¹åº”çš„æ˜¯ `i` æŒ‡é’ˆï¼Œå› æ­¤ï¼Œ`i ++`
>         + æ­¤æ—¶ï¼Œ`q = [1, 2], i = 1, j = k = 0`
>     + ç¬¬äºŒæ­¥
>         + `t = min(q[i] * 2, q[j] * 3, q[k] * 5) = min(4, 3, 5) = 3`
>         + `t` å–å€¼ä¸º `3`ï¼Œå¯¹åº”çš„æ˜¯ `j` æŒ‡é’ˆï¼Œå› æ­¤ï¼Œ`j ++`
>         + æ­¤æ—¶ï¼Œ`q = [1, 2, 3], i = 1, j = 1, k = 0`
>     + ç¬¬ä¸‰æ­¥
>         + `t = min(q[i] * 2, q[j] * 3, q[k] * 5) = min(4, 6, 5) = 4`
>         + `t` å–å€¼ä¸º `4`ï¼Œå¯¹åº”çš„æ˜¯ `i` æŒ‡é’ˆï¼Œå› æ­¤ï¼Œ`i ++`
>         + æ­¤æ—¶ï¼Œ`q = [1, 2, 3, 4], i = 2, j = 1, k = 0`
>     + ç¬¬å››æ­¥
>         + `t = min(q[i] * 2, q[j] * 3, q[k] * 5) = min(6, 6, 5) = 5`
>         + `t` å–å€¼ä¸º `5`ï¼Œå¯¹åº”çš„æ˜¯ `k` æŒ‡é’ˆï¼Œå› æ­¤ï¼Œ`k ++`
>         + æ­¤æ—¶ï¼Œ`q = [1, 2, 3, 4, 5], i = 2, j = 1, k = 1`
>     + ç¬¬äº”æ­¥
>         + `t = min(q[i] * 2, q[j] * 3, q[k] * 5) = min(6, 6, 10) = 6`
>         + `t` å–å€¼ä¸º `6`ï¼Œå¯¹åº”çš„æ˜¯ `i` å’Œ `j` æŒ‡é’ˆï¼Œå› æ­¤ï¼Œ`i ++, j ++`
>             + æ³¨æ„ï¼šå¦‚æœæœ‰ç›¸ç­‰çš„ï¼ŒæŒ‡é’ˆéƒ½éœ€è¦è¿›è¡Œç§»åŠ¨ï¼Œè€Œä¸èƒ½åªç§»åŠ¨ä¸€ä¸ªæŒ‡é’ˆ
>         + æ­¤æ—¶ï¼Œ`q = [1, 2, 3, 4, 5, 6], i = 3, j = 2, k = 1`
>     + ä¾æ¬¡ç±»æ¨

**ä»£ç **

```c++
class Solution {
public:
    int nthUglyNumber(int n) {
        vector<int> q(1, 1);
        for (int i = 0, j = 0, k = 0; q.size() < n; ) {
            int t = min(q[i] * 2, min(q[j] * 3, q[k] * 5));
            q.push_back(t);
            // ä¸èƒ½ä½¿ç”¨ if else å› ä¸ºä¼šæœ‰ç›¸åŒå€¼
            if (q[i] * 2 == t) i ++;
            if (q[j] * 3 == t) j ++;
            if (q[k] * 5 == t) k ++;
        }
        return q.back();
    }
};
```

**æ ‡ç­¾**

`ä¸‰è·¯å½’å¹¶`ã€`å½’å¹¶æ’åº`

### [AcWing 313. è¶…çº§ä¸‘æ•°](https://leetcode-cn.com/problems/super-ugly-number/)

**é¢˜ç›®æè¿°**

> è¶…çº§ä¸‘æ•° æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå¹¶æ»¡è¶³å…¶æ‰€æœ‰è´¨å› æ•°éƒ½å‡ºç°åœ¨è´¨æ•°æ•°ç»„ `primes` ä¸­ã€‚
>
> ç»™ä½ ä¸€ä¸ªæ•´æ•° `n` å’Œä¸€ä¸ªæ•´æ•°æ•°ç»„ `primes` ï¼Œè¿”å›ç¬¬ `n` ä¸ª è¶…çº§ä¸‘æ•° ã€‚
>
> é¢˜ç›®æ•°æ®ä¿è¯ç¬¬ `n` ä¸ª è¶…çº§ä¸‘æ•° åœ¨ `32-bit` å¸¦ç¬¦å·æ•´æ•°èŒƒå›´å†…ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 12, primes = [2,7,13,19]`
> è¾“å‡ºï¼š`32`
> è§£é‡Šï¼šç»™å®šé•¿åº¦ä¸º `4` çš„è´¨æ•°æ•°ç»„ `primes = [2,7,13,19]`ï¼Œå‰ `12` ä¸ªè¶…çº§ä¸‘æ•°åºåˆ—ä¸ºï¼š`[1,2,4,7,8,13,14,16,19,26,28,32]` ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 1, primes = [2,3,5]`
> è¾“å‡ºï¼š`1`
> è§£é‡Šï¼š`1` ä¸å«è´¨å› æ•°ï¼Œå› æ­¤å®ƒçš„æ‰€æœ‰è´¨å› æ•°éƒ½åœ¨è´¨æ•°æ•°ç»„ `primes = [2,3,5]` ä¸­ã€‚

**æç¤º**

> + $1 <= n <= 10^6$
> + $1 <= primes.length <= 100$
> + $2 <= primes[i] <= 1000$
> + $é¢˜ç›®æ•°æ® ä¿è¯ primes[i] æ˜¯ä¸€ä¸ªè´¨æ•°$
> + $primes ä¸­çš„æ‰€æœ‰å€¼éƒ½ äº’ä¸ç›¸åŒ ï¼Œä¸”æŒ‰ é€’å¢é¡ºåº æ’åˆ—$

**è§£é¢˜æ­¥éª¤**

> 1. åŒ `LeetCode 264 ä¸‘æ ‘ II`
>
> 2. å”¯ä¸€ä¸åŒçš„æ˜¯ç”± `3` æŒ‡é’ˆå˜æˆ `k` æŒ‡é’ˆ
>
> 3. å…·ä½“å®ç°çš„ç»†èŠ‚
>
>     ![2180807](img/2180807.png)
>
>     > 1. ä¸‰æŒ‡é’ˆæœ‰ä¸€ä¸ªå¯»æ‰¾æœ€å°å€¼çš„æ“ä½œ `min(q[i] * 2, min(q[j] * 3, q[k] * 5))`ï¼Œåœ¨æœ¬é¢˜ä¸­ï¼Œå°†å¯»æ‰¾ `k` ä¸ªæŒ‡é’ˆçš„æœ€å°å€¼æ“ä½œï¼Œæ¢æˆå †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—æ¥å®ç°ï¼‰
>     > 2. ä¼˜å…ˆé˜Ÿåˆ—ä¸­ç»´æŠ¤ä¸¤ä¸ªå˜é‡ï¼Œåˆ†åˆ«ä¸º `k` ä¸ªæŒ‡é’ˆå¯¹åº”çš„å€¼ä»¥åŠä¸‹æ ‡
>     > 3. è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ç¡®å®šæŸä¸ªæ•° `x` æ˜¯ç”±å“ªä¸ªè´¨æ•°è¿­ä»£è€Œæ¥çš„
>     >     + å¯¹äºä¸‘æ ‘ $S_p$ æ¥è¯´ï¼Œå…¶ä¸‹ä¸€ä¸ªæ•°ä¸º $k = S_p * p$ ï¼Œå› æ­¤ï¼Œå½“å‰è´¨æ•° $p = k / S_p$
>     > 4. å¦‚æœè¿˜æ˜¯æœ‰äº›è®¸æ¨¡ç³Šï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿæ ·ä¾‹å³å¯

**ä»£ç **

```c++
class Solution {
public:
    typedef long long LL;
    typedef pair<LL, LL> PLL;
    int nthSuperUglyNumber(int n, vector<int>& primes) {
        // å®šä¹‰å°æ ¹å †
        priority_queue<PLL, vector<PLL>, greater<PLL>> heap;
        // å«ä¹‰åœ¨å›¾ç¤ºæ‰‹å†™ç¨¿
        for (auto& x : primes) heap.push({x, 1});
        vector<int> q(n + 5);
        q[1] = 1;
        for (int i = 2; i <= n;) {
            auto tp = heap.top(); heap.pop();
            if (tp.first != q[i - 1]) q[i ++ ] = tp.first;
            int idx = tp.second, p = tp.first / q[idx];
            heap.push({(LL)p * q[idx + 1], idx + 1});
        }
        return q[n];
    }
};
```

**æ ‡ç­¾**

`ä¼˜å…ˆé˜Ÿåˆ—`ã€`Kè·¯å½’å¹¶`

### [LeetCode 279. å®Œå…¨å¹³æ–¹æ•°](https://leetcode-cn.com/problems/perfect-squares/)

**é¢˜ç›®æè¿°**

> ç»™å®šæ­£æ•´æ•° nï¼Œæ‰¾åˆ°è‹¥å¹²ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼ˆæ¯”å¦‚ 1, 4, 9, 16, ...ï¼‰ä½¿å¾—å®ƒä»¬çš„å’Œç­‰äº nã€‚ä½ éœ€è¦è®©ç»„æˆå’Œçš„å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°æœ€å°‘ã€‚
>
> ç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œè¿”å›å’Œä¸º n çš„å®Œå…¨å¹³æ–¹æ•°çš„ æœ€å°‘æ•°é‡ ã€‚
>
> å®Œå…¨å¹³æ–¹æ•° æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå…¶å€¼ç­‰äºå¦ä¸€ä¸ªæ•´æ•°çš„å¹³æ–¹ï¼›æ¢å¥è¯è¯´ï¼Œå…¶å€¼ç­‰äºä¸€ä¸ªæ•´æ•°è‡ªä¹˜çš„ç§¯ã€‚ä¾‹å¦‚ï¼Œ1ã€4ã€9 å’Œ 16 éƒ½æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Œè€Œ 3 å’Œ 11 ä¸æ˜¯ã€‚

 **ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 12`
> è¾“å‡ºï¼š`3` 
> è§£é‡Šï¼š`12 = 4 + 4 + 4`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 13`
> è¾“å‡ºï¼š`2`
> è§£é‡Šï¼š`13 = 4 + 9`

**æç¤º**

> $1 <= n <= 10^4$

**æ³•ä¸€:åŠ¨æ€è§„åˆ’**

**æ‰‹å†™ç¨¿**

![å®Œå…¨å¹³æ–¹æ•°](img/%E5%AE%8C%E5%85%A8%E5%B9%B3%E6%96%B9%E6%95%B0.png)

**ä»£ç **

```c++
class Solution {
public:
    int numSquares(int n) {
        vector<int> f(n + 5, 1e9);
        f[0] = 0;
        for (int i = 1; i <= n; i ++ )
            for (int j = 1; j <= i / j; j ++ )
                f[i] = min(f[i], f[i - j * j] + 1);
        return f[n];
    }
};
```

**æ–¹æ³•äºŒ:æ•°å­¦**

**æ­¥éª¤**

> 1. [å››å¹³æ–¹å’Œå®šç†](https://baike.baidu.com/item/%E5%9B%9B%E5%B9%B3%E6%96%B9%E5%92%8C%E5%AE%9A%E7%90%86):æ¯ä¸ªæ­£æ•´æ•°å‡å¯è¡¨ç¤ºä¸º4ä¸ªæ•´æ•°çš„å¹³æ–¹å’Œ,å®šä¹‰æ­¤é¢˜çš„ä¸Šé™,ç­”æ¡ˆåªèƒ½ä¸º `1, 2, 3, 4`
> 2. [å‹’è®©å¾·ä¸‰å¹³æ–¹å’Œå®šç†](https://en.wikipedia.org/wiki/Legendre%27s_three-square_theorem):å½“ $n=4^a(8b+7)$æ—¶ï¼Œ`n` ä¸èƒ½å†™æˆ `3` ä¸ªæ•°çš„å¹³æ–¹å’Œ
> 3. æšä¸¾ç­”æ¡ˆæ˜¯å¦ä¸º `2`

**ä»£ç **

```c++
class Solution {
public:
    bool check(int n) {
        int r = sqrt(n);
        return r * r == n;
    }
    int numSquares(int n) {
        // åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°å­—
        if (check(n)) return 1;
        // åˆ¤æ–­æ˜¯å¦æ˜¯ä¸¤ä¸ªæ•°å­—
        for (int i = 1; i <= n / i; i ++ )
            if (check(n - i * i)) return 2;
        // åˆ¤æ–­æ˜¯å¦æ˜¯å››ä¸ªæ•°å­—
        while (n % 4 == 0) n /= 4;
        if (n % 8 == 7) return 4;
        return 3;
    }
};
```

**æ ‡ç­¾**

`åŠ¨æ€è§„åˆ’`ã€`æ•°å­¦`

### [LeetCode 233. æ•°å­— 1 çš„ä¸ªæ•°](https://leetcode-cn.com/problems/number-of-digit-one/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªæ•´æ•° `n`ï¼Œè®¡ç®—æ‰€æœ‰å°äºç­‰äº `n` çš„éè´Ÿæ•´æ•°ä¸­æ•°å­— `1` å‡ºç°çš„ä¸ªæ•°ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 13`
> è¾“å‡ºï¼š`6`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 0`
> è¾“å‡ºï¼š`0`

**æç¤º**

> + $0 <= n <= 10^9$

**é¢˜è§£**

> 1. å°†æ•°å­—åˆ†è§£æˆæ¯ä¸ªæ•°å­—ï¼Œå­˜æ”¾åˆ° vector é‡Œé¢ï¼Œæ³¨æ„é¡ºåºé—®é¢˜
> 2. ä»å‰å¾€åä¾æ¬¡éå†æ¯ä¸ªæ•°å­—ï¼Œåˆ¤æ–­å½“å‰ä½ç½®ä¸Š 1 çš„ä¸ªæ•°ç´¯åŠ å³å¯

**æ‰‹å†™ç¨¿**

![WX20220119-100611@2x (1)](img/WX20220119-100611@2x%20(1).png)

**ä»£ç **

```c++
class Solution {
public:
    int countDigitOne(int n) {
        vector<int> num;
        while (n) {
            num.push_back(n % 10);
            n /= 10;
        }
        // æ³¨æ„é¡ºåºé—®é¢˜
        reverse(num.begin(), num.end());
        int res = 0;
        for (int i = 0; i < num.size(); i ++ ) {
            int left = 0, right = 0, p = 1;
            for (int j = 0; j < i; j ++ ) left = left * 10 + num[j];
            for (int j = i + 1; j < num.size(); j ++ )
                right = right * 10 + num[j], p *= 10;
            if (num[i] == 0) res += left * p;
            else if (num[i] == 1) res += left * p + right + 1;
            else res += (left + 1) * p;
        }
        return res;
    }
};
```

**æ ‡ç­¾**

`æ•°å­¦`

### [LeetCode 231. 2 çš„å¹‚](https://leetcode-cn.com/problems/power-of-two/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•´æ•° `n`ï¼Œè¯·ä½ åˆ¤æ–­è¯¥æ•´æ•°æ˜¯å¦æ˜¯ `2` çš„å¹‚æ¬¡æ–¹ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
>
> å¦‚æœå­˜åœ¨ä¸€ä¸ªæ•´æ•° `x`  ä½¿å¾— `n == 2x` ï¼Œåˆ™è®¤ä¸º `n` æ˜¯ `2` çš„å¹‚æ¬¡æ–¹ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 1`
> è¾“å‡ºï¼š`true`
> è§£é‡Šï¼š$2^0 = 1$

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 16`
> è¾“å‡ºï¼š`true`
> è§£é‡Šï¼š$2^4 = 16$

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`n = 3`
> è¾“å‡ºï¼š`false`

**ç¤ºä¾‹ 4**

> è¾“å…¥ï¼š`n = 4`
> è¾“å‡ºï¼š`true`

**ç¤ºä¾‹ 5**

> è¾“å…¥ï¼š`n = 5`
> è¾“å‡ºï¼š`false`

**æç¤º**

> + $-2^{31} <= n <= 2^{31} - 1$

**è¿›é˜¶**

> ä½ èƒ½å¤Ÿä¸ä½¿ç”¨å¾ªç¯/é€’å½’è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ

**æ–¹æ³•ä¸€ï¼šå¯¹æ•°**

**ä»£ç **

```c++
class Solution {
public:
    bool isPowerOfTwo(int n) {
        if (n <= 0) return false;
        return (log2(n) - int(log2(n))) == 0;
    }
};
```

**æ–¹æ³•äºŒï¼šä½è¿ç®—**

**è§£æ**

> 1. ä¸€ä¸ªæ•°å­— `x` å¦‚æœæ˜¯ `2` çš„å¹‚ï¼Œåˆ™è¯´æ˜ `x` çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º `000001000000`
> 2. `lowbit` è®¡ç®—æœ€åä¸€ä½ `1` çš„å¤§å°ï¼Œåˆ¤æ–­æ˜¯å¦å’Œ `x` ç›¸ç­‰å³å¯

**ä»£ç **

```c++
class Solution {
public:
    bool isPowerOfTwo(int n) {
        if (n <= 0) return false;
        return (n & -n) == n;
    }
};
```

**æ–¹æ³•ä¸‰ï¼šå–å·§çš„ä½è¿ç®—**

**è§£æ**

> 1. ç”±<a href="https://baike.baidu.com/item/%E7%AE%97%E6%9C%AF%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86/10920095">ç®—æœ¯åŸºæœ¬å®šç†</a>å¯çŸ¥ï¼Œä»»æ„è‡ªç„¶æ•°éƒ½å¯ä»¥å”¯ä¸€åˆ†è§£ä¸ºè‹¥å¹²ä¸ªè´¨æ•°çš„ä¹˜ç§¯ï¼Œæ•° `x` è‹¥æ˜¯ `2` çš„å¹‚ï¼Œåˆ™ `x` çš„è´¨å› æ•°åªæœ‰ `2`ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œä¸å­˜åœ¨å…¶ä»–çš„è´¨å› æ•°
>     + åè¯æ³•
>         + å¦‚æœ `x` çš„è´¨å› æ•°é™¤äº† `2` ä¹‹å¤–ï¼Œè¿˜æœ‰è´¨å› æ•° `p`ï¼Œåˆ™ `p` ä¸€å®šä¸èƒ½è¢«åˆ†è§£ï¼Œå› ä¸º `p` ä¹Ÿæ˜¯è´¨æ•°
> 2. æ‰¾å‡ºæœ€å¤§çš„åªå«æœ‰ `2` çš„è´¨å› å­çš„æ•° `x`ï¼Œä¸éš¾å‘ç°ï¼Œæ‰€æœ‰æ»¡è¶³è´¨å› å­åªæœ‰ `2` çš„æ•°å‡æ˜¯ `x` çš„å› å­

**ä»£ç **

```c++
class Solution {
public:
    bool isPowerOfTwo(int n) {
        if (n <= 0) return false;
        return (1 << 30) % n == 0;
    }
};
```

**æ ‡ç­¾**

`å¯¹æ•°`ã€`ä½è¿ç®—`

### [LeetCode 326. 3 çš„å¹‚](https://leetcode-cn.com/problems/power-of-three/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ `3` çš„å¹‚æ¬¡æ–¹ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
>
> æ•´æ•° `n` æ˜¯ `3` çš„å¹‚æ¬¡æ–¹éœ€æ»¡è¶³ï¼šå­˜åœ¨æ•´æ•° `x` ä½¿å¾— `n == 3x`

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 27`
> è¾“å‡ºï¼š`true`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 0`
> è¾“å‡ºï¼š`false`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`n = 9`
> è¾“å‡ºï¼š`true`

**ç¤ºä¾‹ 4**

> è¾“å…¥ï¼š`n = 45`
> è¾“å‡ºï¼š`false`

**æç¤º**

> + $-2^{31} <= n <= 2^{31} - 1$

**æ–¹æ³•ä¸€ï¼šå¯¹æ•°å‡½æ•°**

**å…¬å¼æ¨å¯¼**

> ç”±äº c++ æ²¡æœ‰ä»¥ä»»æ„è‡ªç„¶æ•°ä¸ºåº•çš„å¯¹æ•°å‡½æ•°ï¼Œå› æ­¤ï¼Œéœ€è¦ä½¿ç”¨æ¢åº•å…¬å¼è¿›è¡Œæ¨å¯¼è®¡ç®—ï¼Œè¯æ˜å¦‚ä¸‹ï¼š
> $$
> æ¢åº•å…¬å¼ï¼šlog_ab = \frac{log_cb}{log_ca}ï¼Œå…¶ä¸­cä¸ºä»»æ„è‡ªç„¶æ•° \\
> å½“c=10æ—¶ï¼Œæœ‰log_ab = \frac{loga}{logb}
> $$

**ä»£ç **

```c++
class Solution {
public:
    bool isPowerOfThree(int n) {
        // ä¸èƒ½æ˜¯è´Ÿæ•°
        if (n <= 0) return false;
        double x = log10(n) / log10(3);
        return x == int(x);
    }
};
```

**æ–¹æ³•äºŒï¼šæ‰“è¡¨**

**æ­¥éª¤**

> 1. å¯¹äºä»»æ„ä¸€ä¸ªæ•° `x` æ¥è¯´ï¼Œ$3^x$ å¯èƒ½çš„å–å€¼ä¸º $3^0, 3^1, 3^2, 3^3,..., 3^n,..., 3^{+\infty}$
> 2. å–æœ€å¤§å€¼ $3^n = 3 * 3 ^ {n - 1}$ ï¼Œå¯ä»¥çœ‹å‡ºæ‰€æœ‰æ¯”æœ€å¤§å€¼å°çš„æ•°åŒæ—¶åˆæ˜¯ `3` çš„å¹‚çš„æ•°éƒ½æ˜¯æœ€å¤§å€¼çš„å› å­ï¼Œå› æ­¤ï¼Œå¯ä»¥æ‰¾å‡ºæœ€å¤§å€¼ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯æœ€å¤§å€¼çš„å› å­å³å¯
> 3. <font style="color: red">**æ³¨æ„ï¼šxå¿…é¡»å¾—æ˜¯è´¨æ•°ï¼ŒåŸå› ï¼š<a href="https://baike.baidu.com/item/%E7%AE%97%E6%9C%AF%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86/10920095">ç®—æœ¯åŸºæœ¬å®šç†</a>**</font>ï¼Œè¯¦ç»†è§£é‡Šå¦‚ä¸‹
>     + ç”±ç®—æœ¯åŸºæœ¬å®šç†å¯çŸ¥ï¼Œä»»æ„<font style="color: red">**è‡ªç„¶æ•°**</font>éƒ½å¯ä»¥<font style="color: red">**å”¯ä¸€**</font>åˆ†è§£ä¸ºè‹¥å¹²ä¸ª<font style="color: red">**è´¨æ•°**</font>ç›¸ä¹˜
>     + åè¯æ³•
>         + å¦‚æœæ•° `x` åˆ†è§£ä¹‹åçš„è´¨æ•°é™¤äº† `3` ä¹‹å¤–ï¼Œè¿˜æœ‰åˆ«çš„è´¨æ•° `p`ï¼Œåˆ™ `x` ä¸€å®šä¸æ˜¯ `3` çš„å¹‚ï¼Œå› ä¸º `p` ä¹Ÿæ˜¯è´¨æ•°ï¼Œä¸”ä¸èƒ½å†æ¬¡åˆ†è§£
>         + å› æ­¤ï¼Œå¦‚æœæ•° `x` æ˜¯ `3` çš„å¹‚ï¼Œåˆ™å…¶è´¨å› å­æœ‰ä¸”åªæœ‰ `3` æ‰å¯
> 4. æ‰¾å‡ºæœ€å¤§çš„æ»¡è¶³è´¨å› å­åªæœ‰ `3` çš„æ•° `x`ï¼Œä¸éš¾å‘ç°ï¼Œæ‰€æœ‰æ»¡è¶³è´¨å› å­åªæœ‰ `3` çš„æ•°å‡æ˜¯ `x` çš„å› å­

**ä»£ç **

```c++
class Solution {
public:
    bool isPowerOfThree(int n) {
        if (n <= 0) return false;
        return 1162261467 % n == 0;
    }
};
```

**æ ‡ç­¾**

`å¯¹æ•°`ã€`ç®—æœ¯åŸºæœ¬å®šç†`ã€`æ•°è®º`

### [LeetCode 342. 4çš„å¹‚](https://leetcode-cn.com/problems/power-of-four/)

**é¢˜ç›®æè¿°**

> ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œå†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­å®ƒæ˜¯å¦æ˜¯ `4` çš„å¹‚æ¬¡æ–¹ã€‚å¦‚æœæ˜¯ï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
>
> æ•´æ•° `n` æ˜¯ `4` çš„å¹‚æ¬¡æ–¹éœ€æ»¡è¶³ï¼šå­˜åœ¨æ•´æ•° `x` ä½¿å¾— `n == 4x`

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`n = 16`
> è¾“å‡ºï¼š`true`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 5`
> è¾“å‡ºï¼š`false`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`n = 1`
> è¾“å‡ºï¼š`true`

**æç¤º**

> + $-2^{31} <= n <= 2{31} - 1$

**è¿›é˜¶**

> ä½ èƒ½ä¸ä½¿ç”¨å¾ªç¯æˆ–è€…é€’å½’æ¥å®Œæˆæœ¬é¢˜å—ï¼Ÿ

**æ–¹æ³•ä¸€ï¼šå¯¹æ•°**

**ä»£ç **

```c++
class Solution {
public:
    bool isPowerOfFour(int n) {
        if (n <= 0) return false;
        double x = log10(n) / log10(4);
        return x == int(x);
    }
};
```

**æ–¹æ³•äºŒï¼šä½è¿ç®—**

**è§£æ**

> 1. å¦‚æœæ•° `x` æ˜¯ `4` çš„å¹‚ï¼Œåˆ™ `x` ä¹Ÿä¸€å®šæ˜¯ `2` çš„å¹‚ï¼Œå³æœ‰ $4 ^ x = (2 ^ 2)^x = (2 ^ x) ^ 2$
>     + å…ˆå¯¹ `x` è¿›è¡Œå¼€æ–¹å¾—åˆ° `r`ï¼Œåˆ¤æ–­ $r^2$ æ˜¯å¦ç­‰äº `x`
>         + ä¸ç­‰äºï¼Œè¿”å›âŒ
>         + ç­‰äºï¼Œåˆ¤æ–­ `r` æ˜¯å¦æ˜¯ `2` çš„å¹‚å³å¯

**ä»£ç **

```c++
class Solution {
public:
    bool isPowerOfFour(int n) {
        if (n <= 0) return false;
        int r = sqrt(n);
        if (r * r != n) return false;
        return (1 << 30) % n == 0;
    }
};
```

**æ ‡ç­¾**

`å¯¹æ•°`ã€`ä½è¿ç®—`

### [LeetCode 343. æ•´æ•°æ‹†åˆ†](https://leetcode-cn.com/problems/integer-break/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªæ­£æ•´æ•° `n` ï¼Œå°†å…¶æ‹†åˆ†ä¸º `k` ä¸ª æ­£æ•´æ•° çš„å’Œï¼ˆ `k >= 2` ï¼‰ï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚
>
>   è¿”å› ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯ ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `n = 2`
>   è¾“å‡º: `1`
>   è§£é‡Š: `2 = 1 + 1, 1 Ã— 1 = 1`ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥: `n = 10`
>   è¾“å‡º: `36`
>   è§£é‡Š: `10 = 3 + 3 + 4, 3 Ã— 3 Ã— 4 = 36`ã€‚

**æç¤º**

>   +   $2 <= n <= 58$

**æ‰‹å†™ç¨¿**

![332159](img/332159.png)

**ä»£ç **

```c++
class Solution {
public:
    int integerBreak(int n) {
        if (n <= 3) return 1 * (n - 1);
        int res = 1;
        while (n >= 5) n -= 3, res *= 3;
        return res * n;
    }
};
```

**æ ‡ç­¾**

`æ•°å­¦`

### [LeetCode 357. è®¡ç®—å„ä¸ªä½æ•°ä¸åŒçš„æ•°å­—ä¸ªæ•°](https://leetcode-cn.com/problems/count-numbers-with-unique-digits/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° `n`ï¼Œè®¡ç®—å„ä½æ•°å­—éƒ½ä¸åŒçš„æ•°å­— `x` çš„ä¸ªæ•°ï¼Œå…¶ä¸­ $0 â‰¤ x < 10^n$ ã€‚

**ç¤ºä¾‹**

>   è¾“å…¥: `2`
>   è¾“å‡º: `91`
>   è§£é‡Š: ç­”æ¡ˆåº”ä¸ºé™¤å» `11,22,33,44,55,66,77,88,99` å¤–ï¼Œåœ¨ `[0,100)` åŒºé—´å†…çš„æ‰€æœ‰æ•°å­—ã€‚

**æ‰‹å†™ç¨¿**

![350904](img/350904.png)

**ä»£ç **

```c++
class Solution {
public:
    int countNumbersWithUniqueDigits(int n) {
        // 0 ï½ 9 å…±10ä¸ªæ•°å­—ï¼Œn > 10 æ— æ„ä¹‰
        n = min(n, 10);
        vector<int> f(n + 1);
        // 0 ç‰¹åˆ¤
        if (n == 0) return 1;
        f[1] = 9;
        for (int i = 2; i <= n; i ++ ) f[i] = f[i - 1] * (11 - i);
        int res = 0;
        for (int i = 1; i <= n; i ++ ) res += f[i];
        // åŠ ä¸Š 0 è¿™ä¸ªæ•°å­—
        return res + 1;
    }
};
```

**æ ‡ç­¾**

`æ’åˆ—ç»„åˆ`ã€`æ•°å­¦`ã€`åŠ¨æ€è§„åˆ’`

## æ•°è®ºç›¸å…³

### [AcWing 319. ç¯æ³¡å¼€å…³](https://leetcode-cn.com/problems/bulb-switcher/)

**é¢˜ç›®æè¿°**

> åˆå§‹æ—¶æœ‰ `n` ä¸ªç¯æ³¡å¤„äºå…³é—­çŠ¶æ€ã€‚ç¬¬ä¸€è½®ï¼Œä½ å°†ä¼šæ‰“å¼€æ‰€æœ‰ç¯æ³¡ã€‚æ¥ä¸‹æ¥çš„ç¬¬äºŒè½®ï¼Œä½ å°†ä¼šæ¯ä¸¤ä¸ªç¯æ³¡å…³é—­ç¬¬äºŒä¸ªã€‚
>
> ç¬¬ä¸‰è½®ï¼Œä½ æ¯ä¸‰ä¸ªç¯æ³¡å°±åˆ‡æ¢ç¬¬ä¸‰ä¸ªç¯æ³¡çš„å¼€å…³ï¼ˆå³ï¼Œæ‰“å¼€å˜å…³é—­ï¼Œå…³é—­å˜æ‰“å¼€ï¼‰ã€‚ç¬¬ `i` è½®ï¼Œä½ æ¯ `i` ä¸ªç¯æ³¡å°±åˆ‡æ¢ç¬¬ `i` ä¸ªç¯æ³¡çš„å¼€å…³ã€‚ç›´åˆ°ç¬¬ `n` è½®ï¼Œä½ åªéœ€è¦åˆ‡æ¢æœ€åä¸€ä¸ªç¯æ³¡çš„å¼€å…³ã€‚
>
> æ‰¾å‡ºå¹¶è¿”å› `n` è½®åæœ‰å¤šå°‘ä¸ªäº®ç€çš„ç¯æ³¡ã€‚ 

**ç¤ºä¾‹ 1**

![img](img/bulb.jpg)

> è¾“å…¥ï¼š`n = 3`
> è¾“å‡ºï¼š`1 `
> è§£é‡Šï¼š
> åˆå§‹æ—¶, ç¯æ³¡çŠ¶æ€ [å…³é—­, å…³é—­, å…³é—­].
> ç¬¬ä¸€è½®å, ç¯æ³¡çŠ¶æ€ [å¼€å¯, å¼€å¯, å¼€å¯].
> ç¬¬äºŒè½®å, ç¯æ³¡çŠ¶æ€ [å¼€å¯, å…³é—­, å¼€å¯].
> ç¬¬ä¸‰è½®å, ç¯æ³¡çŠ¶æ€ [å¼€å¯, å…³é—­, å…³é—­]. 
>
> ä½ åº”è¯¥è¿”å› `1`ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªç¯æ³¡è¿˜äº®ç€ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`n = 0`
> è¾“å‡ºï¼š`0`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`n = 1`
> è¾“å‡ºï¼š`1`

**æç¤º**

> + $0 <= n <= 10^9$

**æ‰‹å†™ç¨¿**

![2181929](img/2181929.png)

**ä»£ç **

```c++
class Solution {
public:
    int bulbSwitch(int n) {
        // å¯»æ‰¾1ï½nä¸­å®Œå…¨å¹³æ–¹æ•°çš„ä¸ªæ•°
        return sqrt(n);
    }
};
```

**æ ‡ç­¾**

`å®Œå…¨å¹³æ–¹æ•°`ã€`è„‘ç­‹æ€¥è½¬å¼¯`ã€`æ•°è®º`

### [LeetCode 365. æ°´å£¶é—®é¢˜](https://leetcode-cn.com/problems/water-and-jug-problem/)

>   æœ‰ä¸¤ä¸ªæ°´å£¶ï¼Œå®¹é‡åˆ†åˆ«ä¸º `jug1Capacity` å’Œ `jug2Capacity` å‡ã€‚æ°´çš„ä¾›åº”æ˜¯æ— é™çš„ã€‚ç¡®å®šæ˜¯å¦æœ‰å¯èƒ½ä½¿ç”¨è¿™ä¸¤ä¸ªå£¶å‡†ç¡®å¾—åˆ° `targetCapacity` å‡ã€‚
>
>   å¦‚æœå¯ä»¥å¾—åˆ° `targetCapacity` å‡æ°´ï¼Œæœ€åè¯·ç”¨ä»¥ä¸Šæ°´å£¶ä¸­çš„ä¸€æˆ–ä¸¤ä¸ªæ¥ç››æ”¾å–å¾—çš„ `targetCapacity` å‡æ°´ã€‚
>
>   ä½ å¯ä»¥ï¼š
>
>   è£…æ»¡ä»»æ„ä¸€ä¸ªæ°´å£¶
>   æ¸…ç©ºä»»æ„ä¸€ä¸ªæ°´å£¶
>   ä»ä¸€ä¸ªæ°´å£¶å‘å¦å¤–ä¸€ä¸ªæ°´å£¶å€’æ°´ï¼Œç›´åˆ°è£…æ»¡æˆ–è€…å€’ç©º

**ç¤ºä¾‹ 1**

>   è¾“å…¥: `jug1Capacity = 3, jug2Capacity = 5, targetCapacity = 4`
>   è¾“å‡º: `true`
>   è§£é‡Šï¼šæ¥è‡ªè‘—åçš„ ["Die Hard"](https://www.youtube.com/watch?v=BVtQNK_ZUJg)

**ç¤ºä¾‹ 2**

>   è¾“å…¥: `jug1Capacity = 2, jug2Capacity = 6, targetCapacity = 5`
>   è¾“å‡º: `false`

**ç¤ºä¾‹ 3**

>   è¾“å…¥: `jug1Capacity = 1, jug2Capacity = 2, targetCapacity = 3`
>   è¾“å‡º: `true`

**æç¤º**

>   +   $1 <= jug1Capacity, jug2Capacity, targetCapacity <= 10^6$

**æ‰‹å†™ç¨¿**

![351607](img/351607.png)

**ä»£ç **

```c++
class Solution {
public:
    int gcd(int a, int b) {
        if (!b) return a;
        return gcd(b, a % b);
    }
    bool canMeasureWater(int a, int b, int c) {
        if (a + b < c) return false;
        return c % gcd(a, b) == 0; 
    }
};
```

**æ ‡ç­¾**

`è´ç¥–å®šç†`ã€`æ•°è®º`ã€`æ¬§å‡ é‡Œå¾—ç®—æ³•`

### [AcWing 4199. å…¬çº¦æ•°](https://www.acwing.com/problem/content/4202/)

**é¢˜ç›®æè¿°**

>   ç»™å®šä¸¤ä¸ªæ­£æ•´æ•° `a` å’Œ `b`ã€‚
>
>   ä½ éœ€è¦å›ç­” `q` ä¸ªè¯¢é—®ã€‚
>
>   æ¯ä¸ªè¯¢é—®ç»™å®šä¸¤ä¸ªæ•´æ•° `l,r`ï¼Œä½ éœ€è¦æ‰¾åˆ°**æœ€å¤§**çš„æ•´æ•° `x`ï¼Œæ»¡è¶³ï¼š
>
>   1.  `x` æ˜¯ `a` å’Œ `b` çš„å…¬çº¦æ•°ã€‚
>   2.  `l â‰¤ x â‰¤ r`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `a,b`ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å«ä¸€ä¸ªæ•´æ•° `q`ã€‚
>
>   æ¥ä¸‹æ¥ `q` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `l,r`ã€‚

**è¾“å‡ºæ ¼å¼**

>   æ¯ä¸ªè¯¢é—®è¾“å‡ºä¸€è¡Œç­”æ¡ˆï¼Œå³æ»¡è¶³æ¡ä»¶çš„æœ€å¤§çš„ `x`ï¼Œå¦‚æœè¯¢é—®æ— è§£ï¼Œåˆ™è¾“å‡º `âˆ’1`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $å‰å…­ä¸ªæµ‹è¯•ç‚¹æ»¡è¶³ 1 â‰¤ a, b â‰¤ 100ï¼Œ1 â‰¤ q â‰¤ 20ã€‚$
>   +   $æ‰€æœ‰æµ‹è¯•ç‚¹æ»¡è¶³ 1 â‰¤ a, b â‰¤ 10^9ï¼Œ1 â‰¤ q â‰¤ 10^4ï¼Œ1 â‰¤ l â‰¤ r â‰¤ 10^9ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
9 27
3
1 5
10 11
9 11
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
-1
9
```

**æ‰‹å†™ç¨¿**

![422107](img/422107.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
const int N = 10010;
int n, m, q, idx;
int p[N];
// æœ€å¤§å…¬çº¦æ•°æ¨¡æ¿
int gcd(int a, int b) {
    if (!b) return a;
    return gcd(b, a % b);
}
void get_primes(int d) {
    for (int i = 1; i <= d / i; i ++ )
        if (d % i == 0) {
            p[idx ++ ] = i;
            // é˜²æ­¢å‡ºç°é‡å¤å…ƒç´ 
            if (i != d / i) p[idx ++ ] = d / i;
        }
    return;
}
bool check(int mid, int l, int r) {
    // æ‰‹å†™ç¨¿å…·ä½“è§£é‡Š
    if (p[mid] <= l) return true;
    else if (p[mid] <= r) return true;
    return false;
}
int main() {
    scanf("%d%d%d", &n, &m, &q);
    int d = gcd(n, m);
    get_primes(d);
    // äºŒåˆ†çš„å‰æï¼šæ•°ç»„æœ‰åºï¼Œæ•…åº”è¯¥å…ˆæ’åº
    sort(p, p + idx);
    while (q -- ) {
        int L, R;
        scanf("%d%d", &L, &R);
        int l = 0, r = idx - 1;
        while (l < r) {
            int mid = l + r + 1 >> 1;
            // checkå‡½æ•°æ‰‹å†™ç¨¿å…·ä½“è§£é‡Š
            if (check(mid, L, R)) l = mid;
            else r = mid - 1;
        }
        // äºŒåˆ†ä¸€å®šæ˜¯æœ‰ç­”æ¡ˆçš„
        // åˆ¤æ–­å¦‚æœç­”æ¡ˆä½äºLå’ŒRä¹‹é—´ï¼Œè¯´æ˜ç­”æ¡ˆåˆæ³•ï¼Œå¦åˆ™ï¼Œä¸åˆæ³•
        if (p[l] >= L && p[l] <= R) cout << p[l] << endl;
        else cout << -1 << endl;
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(qlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)ï¼ŒnæŒ‡çš„æ˜¯çº¦æ•°çš„ä¸ªæ•°$

**æ ‡ç­¾**

`æ¬§å‡ é‡Œå¾—ç®—æ³•`ã€`è¯•é™¤æ³•æ±‚çº¦æ•°ä¸ªæ•°`

**ç¼åˆæ€ª**



## é«˜æ–¯æ¶ˆå…ƒ

### [AcWing 883. é«˜æ–¯æ¶ˆå…ƒè§£çº¿æ€§æ–¹ç¨‹ç»„](https://www.acwing.com/problem/content/885/)

**é¢˜ç›®æè¿°**

>   è¾“å…¥ä¸€ä¸ªåŒ…å« `n` ä¸ªæ–¹ç¨‹ `n` ä¸ªæœªçŸ¥æ•°çš„çº¿æ€§æ–¹ç¨‹ç»„ã€‚
>
>   æ–¹ç¨‹ç»„ä¸­çš„ç³»æ•°ä¸ºå®æ•°ã€‚
>
>   æ±‚è§£è¿™ä¸ªæ–¹ç¨‹ç»„ã€‚
>
>   ä¸‹å›¾ä¸ºä¸€ä¸ªåŒ…å« `m` ä¸ªæ–¹ç¨‹ `n` ä¸ªæœªçŸ¥æ•°çš„çº¿æ€§æ–¹ç¨‹ç»„ç¤ºä¾‹ï¼š
>
>   ![9a504fc2d5628535be9dcb5f90ef76c6a7ef634a.gif](img/19_b30080c698-9a504fc2d5628535be9dcb5f90ef76c6a7ef634a.gif)

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å« `n + 1` ä¸ªå®æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªæ–¹ç¨‹çš„ `n` ä¸ªç³»æ•°ä»¥åŠç­‰å·å³ä¾§çš„å¸¸æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¦‚æœç»™å®šçº¿æ€§æ–¹ç¨‹ç»„å­˜åœ¨å”¯ä¸€è§£ï¼Œåˆ™è¾“å‡ºå…± `n` è¡Œï¼Œå…¶ä¸­ç¬¬ `i` è¡Œè¾“å‡ºç¬¬ `i` ä¸ªæœªçŸ¥æ•°çš„è§£ï¼Œç»“æœä¿ç•™ä¸¤ä½å°æ•°ã€‚
>
>   å¦‚æœç»™å®šçº¿æ€§æ–¹ç¨‹ç»„å­˜åœ¨æ— æ•°è§£ï¼Œåˆ™è¾“å‡º `Infinite group solutions`ã€‚
>
>   å¦‚æœç»™å®šçº¿æ€§æ–¹ç¨‹ç»„æ— è§£ï¼Œåˆ™è¾“å‡º `No solution`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100,$
>   +   $æ‰€æœ‰è¾“å…¥ç³»æ•°ä»¥åŠå¸¸æ•°å‡ä¿ç•™ä¸¤ä½å°æ•°ï¼Œç»å¯¹å€¼å‡ä¸è¶…è¿‡ 100ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
3
1.00 2.00 -1.00 -6.00
2.00 1.00 -3.00 -9.00
-1.00 -1.00 2.00 7.00
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1.00
-2.00
3.00
```

**æ‰‹å†™ç¨¿**

![3201224](img/3201224.jpg)

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
using namespace std;
const int N = 110;
const double eps = 1e-6;
int n;
double a[N][N];
int guass() {
    // åŒ–æˆä¸Šä¸‰è§’çŸ©é˜µ
    int r, c;
    // æšä¸¾æ¯ä¸€åˆ—
    for (r = 1, c = 1; c <= n; c ++ ) {
        // 1. æ‰¾ä¸»å…ƒ
        int t = r;
        for (int i = r; i <= n; i ++ )
            if (fabs(a[i][c]) > fabs(a[t][c])) t = i;
        // å¦‚æœå½“å‰åˆ—çš„æœ€å¤§å€¼å·²ç»æ˜¯0ï¼Œåˆ™ä¸éœ€è¦å†è¿›è¡Œ2ï¼Œ3ï¼Œ4æ­¥éª¤
        if (fabs(a[t][c]) < eps) continue;
        // 2. äº¤æ¢ä¸¤è¡Œ
        if (t != r) // å¦‚æœå½“å‰åˆ—çš„æœ€å¤§å€¼æ‰€åœ¨çš„è¡Œä¸æ˜¯æœ¬è¡Œï¼Œåˆ™äº¤æ¢ä¸¤è¡Œ
            for (int i = c; i <= n + 1; i ++ ) swap(a[r][i], a[t][i]);
        // 3. å½’ä¸€åŒ–
        // å€’åºæšä¸¾
        for (int i = n + 1; i >= c; i -- ) a[r][i] /= a[r][c];
        // 4. å°†å½“å‰åˆ—çš„å…¶ä»–å€¼æ¶ˆæˆ0
        for (int i = r + 1; i <= n; i ++ )
            for (int j = n + 1; j >= c; j -- ) {
                // å¦‚æœå·²ç»æ˜¯0ï¼Œåˆ™ä¸éœ€è¦å†è¿›è¡Œ
                if (fabs(a[i][c]) < eps) continue;
                a[i][j] -= a[r][j] * a[i][c];
            }
        r ++;
    }
    if (r <= n)
        for (int i = r; i <= n; i ++ ) {
            if (fabs(a[i][n + 1])) return -1;
        return 0;
    }
    // åŒ–æˆå¯¹è§’çŸ©é˜µ
    for (int i = n - 1; i >= 1; i -- )
        for (int j = i + 1; j <= n; j ++ )
            a[i][n + 1] -= a[i][j] * a[j][n + 1];
    return 1;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= n + 1; j ++ )
            scanf("%lf", &a[i][j]);
    int t = guass();
    if (t == -1) printf("No solution");
    else if (t == 0) printf("Infinite group solutions");
    else
        for (int i = 1; i <= n; i ++ ) {
            if (fabs(a[i][n + 1]) < eps) cout << "0.00" << endl;
            else printf("%.2lf\n", a[i][n + 1]);
        }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`é«˜æ–¯æ¶ˆå…ƒ`

**ç¼åˆæ€ª**

### [AcWing 884. é«˜æ–¯æ¶ˆå…ƒè§£å¼‚æˆ–çº¿æ€§æ–¹ç¨‹ç»„](https://www.acwing.com/problem/content/886/)

**é¢˜ç›®æè¿°**

>   è¾“å…¥ä¸€ä¸ªåŒ…å« `n` ä¸ªæ–¹ç¨‹ `n` ä¸ªæœªçŸ¥æ•°çš„å¼‚æˆ–çº¿æ€§æ–¹ç¨‹ç»„ã€‚
>
>   æ–¹ç¨‹ç»„ä¸­çš„ç³»æ•°å’Œå¸¸æ•°ä¸º `0` æˆ– `1`ï¼Œæ¯ä¸ªæœªçŸ¥æ•°çš„å–å€¼ä¹Ÿä¸º `0` æˆ– `1`ã€‚
>
>   æ±‚è§£è¿™ä¸ªæ–¹ç¨‹ç»„ã€‚
>
>   å¼‚æˆ–çº¿æ€§æ–¹ç¨‹ç»„ç¤ºä¾‹å¦‚ä¸‹ï¼š
>
>   ```c++
>   M[1][1]x[1] ^ M[1][2]x[2] ^ â€¦ ^ M[1][n]x[n] = B[1]
>   M[2][1]x[1] ^ M[2][2]x[2] ^ â€¦ ^ M[2][n]x[n] = B[2]
>   â€¦
>   M[n][1]x[1] ^ M[n][2]x[2] ^ â€¦ ^ M[n][n]x[n] = B[n]
>   ```
>
>   å…¶ä¸­ `^` è¡¨ç¤ºå¼‚æˆ–`(XOR)`ï¼Œ`M[i][j]` è¡¨ç¤ºç¬¬ `i` ä¸ªå¼å­ä¸­ `x[j]` çš„ç³»æ•°ï¼Œ`B[i]` æ˜¯ç¬¬ `i` ä¸ªæ–¹ç¨‹å³ç«¯çš„å¸¸æ•°ï¼Œå–å€¼å‡ä¸º `0` æˆ– `1`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å« `n + 1` ä¸ªæ•´æ•° `0` æˆ– `1`ï¼Œè¡¨ç¤ºä¸€ä¸ªæ–¹ç¨‹çš„ `n` ä¸ªç³»æ•°ä»¥åŠç­‰å·å³ä¾§çš„å¸¸æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   å¦‚æœç»™å®šçº¿æ€§æ–¹ç¨‹ç»„å­˜åœ¨å”¯ä¸€è§£ï¼Œåˆ™è¾“å‡ºå…± `n` è¡Œï¼Œå…¶ä¸­ç¬¬ `i` è¡Œè¾“å‡ºç¬¬ `i` ä¸ªæœªçŸ¥æ•°çš„è§£ã€‚
>
>   å¦‚æœç»™å®šçº¿æ€§æ–¹ç¨‹ç»„å­˜åœ¨å¤šç»„è§£ï¼Œåˆ™è¾“å‡º `Multiple sets of solutions`ã€‚
>
>   å¦‚æœç»™å®šçº¿æ€§æ–¹ç¨‹ç»„æ— è§£ï¼Œåˆ™è¾“å‡º `No solution`ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
3
1 1 0 1
0 1 1 0
1 0 0 1
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1
0
0
```

**æ‰‹å†™ç¨¿**

>   1.   åŒ `AcWing 883. é«˜æ–¯æ¶ˆå…ƒè§£çº¿æ€§æ–¹ç¨‹ç»„`

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 110;
int n;
int a[N][N];
int guass() {
    int r, c;
    // è½¬åŒ–æˆä¸Šä¸‰è§’çŸ©é˜µ
    for (r = 1, c = 1; c <= n; c ++ ) {
        // æ‰¾åˆ°å½“å‰åˆ—ç»å¯¹å€¼æœ€å¤§çš„è¡Œ
        int t = r;
        for (int i = r; i <= n; i ++ )
            if (a[i][c]) {
                t = i;
                break;
            }
        // å¦‚æœå½“å‰æœ€å¤§å€¼æ˜¯0ï¼Œåˆ™æ­¤è¡Œä¸éœ€è¦å†è¿›è¡Œé¢å¤–çš„å¤„ç†
        if (!a[t][c]) continue;
        // å¦‚æœå½“å‰è¡Œä¸æ˜¯æœ€å¤§å€¼æ‰€åœ¨çš„è¡Œï¼Œåˆ™äº¤æ¢ä¸¤è¡Œ
        if (t != r) 
            for (int i = c; i <= n + 1; i ++ ) swap(a[t][i], a[r][i]);
        // ä½¿ç”¨å½“å‰è¡Œå»æ¶ˆå…¶å®ƒè¡Œ
        for (int i = r + 1; i <= n; i ++ )
            for (int j = n + 1; j >= c; j -- ) {
                if (a[i][c] == 0) break;
                a[i][j] ^= a[r][j] & a[i][c];
            }
        r ++;
    }
    if (r <= n) {
        for (int i = r; i <= n; i ++ )
            if (a[i][n + 1]) return -1;
        return 0;
    }
    for (int i = n - 1; i >= 1; i -- )
        for (int j = i + 1; j <= n; j ++ ) 
            a[i][n + 1] ^= a[i][j] & a[j][n + 1];
    return 1;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ )
        for (int j = 1; j <= n + 1; j ++ )
            scanf("%d", &a[i][j]);
    int t = guass();
    if (t == -1) puts("No solution");
    else if (t == 0) puts("Multiple sets of solutions");
    else 
        for (int i = 1; i <= n; i ++ ) cout << a[i][n + 1] << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`é«˜æ–¯æ¶ˆå…ƒ`

**ç¼åˆæ€ª**

### [AcWing 207. çƒå½¢ç©ºé—´äº§ç”Ÿå™¨](https://www.acwing.com/problem/content/209/)

**é—®é¢˜æè¿°**

>   æœ‰ä¸€ä¸ªçƒå½¢ç©ºé—´äº§ç”Ÿå™¨èƒ½å¤Ÿåœ¨ `n` ç»´ç©ºé—´ä¸­äº§ç”Ÿä¸€ä¸ªåšç¡¬çš„çƒä½“ã€‚
>
>   ç°åœ¨ï¼Œä½ è¢«å›°åœ¨äº†è¿™ä¸ª `n` ç»´çƒä½“ä¸­ï¼Œä½ åªçŸ¥é“çƒé¢ä¸Š `n + 1` ä¸ªç‚¹çš„åæ ‡ï¼Œä½ éœ€è¦ä»¥æœ€å¿«çš„é€Ÿåº¦ç¡®å®šè¿™ä¸ª `n` ç»´çƒä½“çš„çƒå¿ƒåæ ‡ï¼Œä»¥ä¾¿äºæ‘§æ¯è¿™ä¸ªçƒå½¢ç©ºé—´äº§ç”Ÿå™¨ã€‚
>
>   **æ³¨æ„ï¼š** æ•°æ®ä¿è¯æœ‰å”¯ä¸€è§£ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥çš„ `n + 1` è¡Œï¼Œæ¯è¡Œæœ‰ `n` ä¸ªå®æ•°ï¼Œè¡¨ç¤ºçƒé¢ä¸Šä¸€ç‚¹çš„ `n` ç»´åæ ‡ã€‚
>
>   æ¯ä¸€ä¸ªå®æ•°ç²¾ç¡®åˆ°å°æ•°ç‚¹å `6` ä½ï¼Œä¸”å…¶ç»å¯¹å€¼éƒ½ä¸è¶…è¿‡ `20000`ã€‚

**è¾“å‡ºæ ¼å¼**

>   æœ‰ä¸”åªæœ‰ä¸€è¡Œï¼Œä¾æ¬¡ç»™å‡ºçƒå¿ƒçš„ `n` ç»´åæ ‡ï¼ˆ`n` ä¸ªå®æ•°ï¼‰ï¼Œä¸¤ä¸ªå®æ•°ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
>   æ¯ä¸ªå®æ•°ç²¾ç¡®åˆ°å°æ•°ç‚¹å `3` ä½ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10$

**è¾“å…¥æ ·ä¾‹**

```c++
2
0.0 0.0
-1.0 1.0
1.0 0.0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
0.500 1.500
```

**æ‰‹å†™ç¨¿**

![3201626](img/3201626.png)

**ä»£ç **

```c++
#include <iostream>
#include <cmath>
using namespace std;
const int N = 15;
const double eps = 1e-6;
int n;
double a[N][N], b[N][N];
// é«˜æ–¯æ¶ˆå…ƒæ¨¡æ¿
void guass() {
    int r, c;
    for (r = 1, c = 1; c <= n; c ++ ) {
        int t = r;
        for (int i = r; i <= n; i ++ )
            if (fabs(b[i][c]) > fabs(b[t][c])) t = i;
        if (fabs(b[t][c]) < eps) continue;
        if (t != r)
            for (int i = c; i <= n + 1; i ++ ) swap(b[t][i], b[r][i]);
        for (int i = n + 1; i >= c; i -- )
            b[r][i] /= b[r][c];
        for (int i = r + 1; i <= n; i ++ )
            for (int j = n + 1; j >= c; j -- ) {
                if (fabs(b[i][c]) < eps) break;
                b[i][j] -= b[r][j] * b[i][c];
            }
        r ++;
    }
    for (int i = n - 1; i >= 1; i -- )
        for (int j = i + 1; j <= n; j ++ )
            b[i][n + 1] -= b[i][j] * b[j][n + 1];
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n + 1; i ++ )
        for (int j = 1; j <= n; j ++ )
            scanf("%lf", &a[i][j]);
    // æ„é€ bæ•°ç»„
    for (int i = 2; i <= n + 1; i ++ )
        for (int j = 1; j <= n; j ++ ) {
            b[i - 1][j] = 2 * (a[1][j] - a[i][j]);
            b[i - 1][n + 1] += (a[1][j] * a[1][j]) - a[i][j] * a[i][j];
        }
    guass();
    for (int i = 1; i <= n; i ++ )
        printf("%.3lf ", b[i][n + 1]);
    return 0;

```

**æ—¶é—´å¤æ‚åº¦**

$O(n^3)$

**ç©ºé—´å¤æ‚åº¦**

$O(n^2)$

**æ ‡ç­¾**

`è§£æ–¹ç¨‹`ã€`é«˜æ–¯æ¶ˆå…ƒ`

**ç¼åˆæ€ª**

[AcWing 883. é«˜æ–¯æ¶ˆå…ƒè§£çº¿æ€§æ–¹ç¨‹ç»„](#AcWing 883. é«˜æ–¯æ¶ˆå…ƒè§£çº¿æ€§æ–¹ç¨‹ç»„)

## çº¦ç‘Ÿå¤«ç¯

### åŸç†ä»‹ç»

![3221150](img/3221150.png)

### [PTA 7-28 çŒ´å­é€‰å¤§ç‹](https://pintia.cn/problem-sets/14/problems/808)

**é¢˜ç›®æè¿°**

>   ä¸€ç¾¤çŒ´å­è¦é€‰æ–°çŒ´ç‹ã€‚æ–°çŒ´ç‹çš„é€‰æ‹©æ–¹æ³•æ˜¯ï¼šè®© `N `åªå€™é€‰çŒ´å­å›´æˆä¸€åœˆï¼Œä»æŸä½ç½®èµ·é¡ºåºç¼–å·ä¸º `1~N` å·ã€‚ä»ç¬¬ `1` å·å¼€å§‹æŠ¥æ•°ï¼Œæ¯è½®ä» `1` æŠ¥åˆ° `3`ï¼Œå‡¡æŠ¥åˆ° `3` çš„çŒ´å­å³é€€å‡ºåœˆå­ï¼Œæ¥ç€åˆä»ç´§é‚»çš„ä¸‹ä¸€åªçŒ´å­å¼€å§‹åŒæ ·çš„æŠ¥æ•°ã€‚å¦‚æ­¤ä¸æ–­å¾ªç¯ï¼Œæœ€åå‰©ä¸‹çš„ä¸€åªçŒ´å­å°±é€‰ä¸ºçŒ´ç‹ã€‚è¯·é—®æ˜¯åŸæ¥ç¬¬å‡ å·çŒ´å­å½“é€‰çŒ´ç‹ï¼Ÿ

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åœ¨ä¸€è¡Œä¸­ç»™ä¸€ä¸ªæ­£æ•´æ•°`Nï¼ˆâ‰¤1000ï¼‰`ã€‚

**è¾“å‡ºæ ¼å¼**

>   åœ¨ä¸€è¡Œä¸­è¾“å‡ºå½“é€‰çŒ´ç‹çš„ç¼–å·ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
11
```

**è¾“å‡ºæ ·ä¾‹**

```c++
7
```

**æ‰‹å†™ç¨¿**

>   åŸç†å·²ç»è¯´æ˜

**ä»£ç **

```c++
#include <iostream>
using namespace std;
const int N = 1010;
int n, k = 3;
int f[N][5];
int main() {
    scanf("%d", &n);
    f[1][k] = 0;
    for (int i = 2; i <= n; i ++ )
        f[i][k] = (f[i - 1][k] + k) % i;
    // è®¡ç®—çš„æ˜¯ä¸‹æ ‡ï¼Œæ•…ç­”æ¡ˆã€ç¼–å·ã€‘éœ€è¦å†+1
    cout << f[n][k] + 1 << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`çº¦ç‘Ÿå¤«ç¯`

**ç¼åˆæ€ª**



### [LeetCode 390. æ¶ˆé™¤æ¸¸æˆ](https://leetcode-cn.com/problems/elimination-game/)

**é¢˜ç›®æè¿°**

>   åˆ—è¡¨ `arr` ç”±åœ¨èŒƒå›´ `[1, n]` ä¸­çš„æ‰€æœ‰æ•´æ•°ç»„æˆï¼Œå¹¶æŒ‰ä¸¥æ ¼é€’å¢æ’åºã€‚è¯·ä½ å¯¹ `arr` åº”ç”¨ä¸‹è¿°ç®—æ³•ï¼š
>
>   ä»å·¦åˆ°å³ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªæ•°å­—ï¼Œç„¶åæ¯éš”ä¸€ä¸ªæ•°å­—åˆ é™¤ä¸€ä¸ªï¼Œç›´åˆ°åˆ°è¾¾åˆ—è¡¨æœ«å°¾ã€‚
>   é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œä½†è¿™æ¬¡æ˜¯ä»å³åˆ°å·¦ã€‚ä¹Ÿå°±æ˜¯ï¼Œåˆ é™¤æœ€å³ä¾§çš„æ•°å­—ï¼Œç„¶åå‰©ä¸‹çš„æ•°å­—æ¯éš”ä¸€ä¸ªåˆ é™¤ä¸€ä¸ªã€‚
>   ä¸æ–­é‡å¤è¿™ä¸¤æ­¥ï¼Œä»å·¦åˆ°å³å’Œä»å³åˆ°å·¦äº¤æ›¿è¿›è¡Œï¼Œç›´åˆ°åªå‰©ä¸‹ä¸€ä¸ªæ•°å­—ã€‚
>   ç»™ä½ æ•´æ•° `n` ï¼Œè¿”å› `arr` æœ€åå‰©ä¸‹çš„æ•°å­—ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`n = 9`
>   è¾“å‡ºï¼š`6`
>   è§£é‡Šï¼š
>   `arr = [1, 2, 3, 4, 5, 6, 7, 8, 9]`
>   `arr = [2, 4, 6, 8]`
>   `arr = [2, 6]`
>   `arr = [6]`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`n = 1`
>   è¾“å‡ºï¼š`1`

**æç¤º**

>   +   $1 <= n <= 10^9$

**æ‰‹å†™ç¨¿**

![3252237](img/3252237.png)

**ä»£ç **

```c++
class Solution {
public:
    int lastRemaining(int n) {
        if (n == 1) return 1;
        return 2 * (n / 2 + 1 - lastRemaining(n / 2));
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(log_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`çº¦ç‘Ÿå¤«ç¯`

**ç¼åˆæ€ª**



## è®¡ç®—å‡ ä½•

### åŸºç¡€çŸ¥è¯†

#### å‰ç½®çŸ¥è¯†

##### ä¸‰è§’å‡½æ•°

>   1. $\pi = acos(-1);$
>
>       ![3161550](img/3161550.png)
>
>   2. ä½™å¼¦å®šç† $c^2 = a^2 + b^2 - 2abcos(t)$
>
>       ![image-20220316155853980](img/image-20220316155853980.png)

##### æµ®ç‚¹æ•°

>   1.   æµ®ç‚¹æ•°çš„æ¯”è¾ƒ
>
>        ```c++
>        // æå°æ•°
>        const double eps = 1e-8;
>        int sign(double x) { // ç¬¦å·å‡½æ•°
>            // å–ç»å¯¹å€¼
>            if (fabs(x) < eps) return 0;
>            if (x < 0) return -1;
>            return 1;
>        }
>        ```
>
>        ![image-20220316161149165](img/image-20220316161149165.png)
>
>   2.   æµ®ç‚¹æ•°çš„æ¯”è¾ƒ
>
>        ```c++
>        // æå°æ•°
>        const double eps = 1e-8;
>        int cmp(double x, double y) { // æ¯”è¾ƒå‡½æ•°
>            // å–ç»å¯¹å€¼
>            if (fabs(x - y) < eps) return 0;
>            if (x < y) return -1;
>            return 1;
>        }
>        ```
>
>        ![image-20220316162034261](img/image-20220316162034261.png)

##### å‘é‡

###### å†…ç§¯ï¼ˆç‚¹ç§¯ï¼‰

>   1.   å®šä¹‰ï¼š`AÂ·B = |A||B|cos(C)`
>
>   2.   å‡ ä½•æ„ä¹‰
>
>        ![image-20220316164311609](img/image-20220316164311609.png)
>
>   3.   ä»£ç å®ç°
>
>        ```c++
>        double dot(Point a, Point b) {
>        	return a.x * b.x + a.y * b.y;
>        }
>        ```

###### å¤–ç§¯ï¼ˆå‰ç§¯ï¼‰

>   1.   å®šä¹‰ï¼š`AxB = |A||B|sin(C)`
>
>   2.   å‡ ä½•æ„ä¹‰
>
>   
>
>   3.   ä»£ç å®ç°

```markdown
        
    3.3 å¤–ç§¯ï¼ˆå‰ç§¯ï¼‰ 
        (1) å‡ ä½•æ„ä¹‰ï¼šå‘é‡Aä¸Bå¼ æˆçš„å¹³è¡Œå››è¾¹å½¢çš„æœ‰å‘é¢ç§¯ã€‚Båœ¨Açš„é€†æ—¶é’ˆæ–¹å‘ä¸ºæ­£ã€‚
        (2) ä»£ç å®ç°
        double cross(Point a, Point b)
        {
            return a.x * b.y - b.x * a.y;
        }
    3.4 å¸¸ç”¨å‡½æ•°
        3.4.1 å–æ¨¡
        double get_length(Point a)
        {
            return sqrt(dot(a, a));
        }
        3.4.2 è®¡ç®—å‘é‡å¤¹è§’
        double get_angle(Point a, Point b)
        {
            return acos(dot(a, b) / get_length(a) / get_length(b));
        }
        3.4.3 è®¡ç®—ä¸¤ä¸ªå‘é‡æ„æˆçš„å¹³è¡Œå››è¾¹å½¢æœ‰å‘é¢ç§¯
        double area(Point a, Point b, Point c)
        {
            return cross(b - a, c - a);
        }
        3.4.5 å‘é‡Aé¡ºæ—¶é’ˆæ—‹è½¬Cçš„è§’åº¦ï¼š
        Point rotate(Point a, double angle)
        {
            return Point(a.x * cos(angle) + a.y * sin(angle), -a.x * sin(angle) + a.y * cos(angle));
        }
4. ç‚¹ä¸çº¿
    4.1 ç›´çº¿å®šç†
        (1) ä¸€èˆ¬å¼ ax + by + c = 0
        (2) ç‚¹å‘å¼ p0 + vt
        (3) æ–œæˆªå¼ y = kx + b
    4.2 å¸¸ç”¨æ“ä½œ
        (1) åˆ¤æ–­ç‚¹åœ¨ç›´çº¿ä¸Š A x B = 0
        (2) ä¸¤ç›´çº¿ç›¸äº¤
        // cross(v, w) == 0åˆ™ä¸¤ç›´çº¿å¹³è¡Œæˆ–è€…é‡åˆ
        Point get_line_intersection(Point p, Vector v, Point q, vector w)
        {
            vector u = p - q;
            double t = cross(w, u) / cross(v, w);
            return p + v * t;
        }
        (3) ç‚¹åˆ°ç›´çº¿çš„è·ç¦»
        double distance_to_line(Point p, Point a, Point b)
        {
            vector v1 = b - a, v2 = p - a;
            return fabs(cross(v1, v2) / get_length(v1));
        }
        (4) ç‚¹åˆ°çº¿æ®µçš„è·ç¦»
        double distance_to_segment(Point p, Point a, Point b)
        {
            if (a == b) return get_length(p - a);
            Vector v1 = b - a, v2 = p - a, v3 = p - b;
            if (sign(dot(v1, v2)) < 0) return get_length(v2);
            if (sign(dot(v1, v3)) > 0) return get_length(v3);
            return distance_to_line(p, a, b);
        }
        (5) ç‚¹åœ¨ç›´çº¿ä¸Šçš„æŠ•å½±
        double get_line_projection(Point p, Point a, Point b)
        {
            Vector v = b - a;
            return a + v * (dot(v, p - a) / dot(v, v));
        }
        (6) ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Š
        bool on_segment(Point p, Point a, Point b)
        {
            return sign(cross(p - a, p - b)) == 0 && sign(dot(p - a, p - b)) <= 0;
        }
        (7) åˆ¤æ–­ä¸¤çº¿æ®µæ˜¯å¦ç›¸äº¤
        bool segment_intersection(Point a1, Point a2, Point b1, Point b2)
        {
            double c1 = cross(a2 - a1, b1 - a1), c2 = cross(a2 - a1, b2 - a1);
            double c3 = cross(b2 - b1, a2 - b1), c4 = cross(b2 - b1, a1 - b1);
            return sign(c1) * sign(c2) <= 0 && sign(c3) * sign(c4) <= 0;
        }
5. å¤šè¾¹å½¢
    5.1 ä¸‰è§’å½¢
    5.1.1 é¢ç§¯
        (1) å‰ç§¯
        (2) æµ·ä¼¦å…¬å¼
            p = (a + b + c) / 2;
            S = sqrt(p(p - a) * (p - b) * (p - c));
    5.1.2 ä¸‰è§’å½¢å››å¿ƒ
        (1) å¤–å¿ƒï¼Œå¤–æ¥åœ†åœ†å¿ƒ
            ä¸‰è¾¹ä¸­å‚çº¿äº¤ç‚¹ã€‚åˆ°ä¸‰è§’å½¢ä¸‰ä¸ªé¡¶ç‚¹çš„è·ç¦»ç›¸ç­‰
        (2) å†…å¿ƒï¼Œå†…åˆ‡åœ†åœ†å¿ƒ
            è§’å¹³åˆ†çº¿äº¤ç‚¹ï¼Œåˆ°ä¸‰è¾¹è·ç¦»ç›¸ç­‰
        (3) å‚å¿ƒ
            ä¸‰æ¡å‚çº¿äº¤ç‚¹
        (4) é‡å¿ƒ
            ä¸‰æ¡ä¸­çº¿äº¤ç‚¹ï¼ˆåˆ°ä¸‰è§’å½¢ä¸‰é¡¶ç‚¹è·ç¦»çš„å¹³æ–¹å’Œæœ€å°çš„ç‚¹ï¼Œä¸‰è§’å½¢å†…åˆ°ä¸‰è¾¹è·ç¦»ä¹‹ç§¯æœ€å¤§çš„ç‚¹ï¼‰
    5.2 æ™®é€šå¤šè¾¹å½¢
        é€šå¸¸æŒ‰é€†æ—¶é’ˆå­˜å‚¨æ‰€æœ‰ç‚¹
        5.2.1 å®šä¹‰
        (1) å¤šè¾¹å½¢
            ç”±åœ¨åŒä¸€å¹³é¢ä¸”ä¸å†åŒä¸€ç›´çº¿ä¸Šçš„å¤šæ¡çº¿æ®µé¦–å°¾é¡ºæ¬¡è¿æ¥ä¸”ä¸ç›¸äº¤æ‰€ç»„æˆçš„å›¾å½¢å«å¤šè¾¹å½¢
        (2) ç®€å•å¤šè¾¹å½¢
            ç®€å•å¤šè¾¹å½¢æ˜¯é™¤ç›¸é‚»è¾¹å¤–å…¶å®ƒè¾¹ä¸ç›¸äº¤çš„å¤šè¾¹å½¢
        (3) å‡¸å¤šè¾¹å½¢
            è¿‡å¤šè¾¹å½¢çš„ä»»æ„ä¸€è¾¹åšä¸€æ¡ç›´çº¿ï¼Œå¦‚æœå…¶ä»–å„ä¸ªé¡¶ç‚¹éƒ½åœ¨è¿™æ¡ç›´çº¿çš„åŒä¾§ï¼Œåˆ™æŠŠè¿™ä¸ªå¤šè¾¹å½¢å«åšå‡¸å¤šè¾¹å½¢
            ä»»æ„å‡¸å¤šè¾¹å½¢å¤–è§’å’Œå‡ä¸º360Â°
            ä»»æ„å‡¸å¤šè¾¹å½¢å†…è§’å’Œä¸º(nâˆ’2)180Â°
        5.2.2 å¸¸ç”¨å‡½æ•°
        (1) æ±‚å¤šè¾¹å½¢é¢ç§¯ï¼ˆä¸ä¸€å®šæ˜¯å‡¸å¤šè¾¹å½¢ï¼‰
        æˆ‘ä»¬å¯ä»¥ä»ç¬¬ä¸€ä¸ªé¡¶ç‚¹é™¤æ³•æŠŠå‡¸å¤šè¾¹å½¢åˆ†æˆn âˆ’ 2ä¸ªä¸‰è§’å½¢ï¼Œç„¶åæŠŠé¢ç§¯åŠ èµ·æ¥ã€‚
        double polygon_area(Point p[], int n)
        {
            double s = 0;
            for (int i = 1; i + 1 < n; i ++ )
                s += cross(p[i] - p[0], p[i + 1] - p[i]);
            return s / 2;
        }
        (2) åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…ï¼ˆä¸ä¸€å®šæ˜¯å‡¸å¤šè¾¹å½¢ï¼‰
        a. å°„çº¿æ³•ï¼Œä»è¯¥ç‚¹ä»»æ„åšä¸€æ¡å’Œæ‰€æœ‰è¾¹éƒ½ä¸å¹³è¡Œçš„å°„çº¿ã€‚äº¤ç‚¹ä¸ªæ•°ä¸ºå¶æ•°ï¼Œåˆ™åœ¨å¤šè¾¹å½¢å¤–ï¼Œä¸ºå¥‡æ•°ï¼Œåˆ™åœ¨å¤šè¾¹å½¢å†…ã€‚
        b. è½¬è§’æ³•
        (3) åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å‡¸å¤šè¾¹å½¢å†…
        åªéœ€åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨æ‰€æœ‰è¾¹çš„å·¦è¾¹ï¼ˆé€†æ—¶é’ˆå­˜å‚¨å¤šè¾¹å½¢ï¼‰ã€‚
    5.3 çš®å…‹å®šç†
        çš®å…‹å®šç†æ˜¯æŒ‡ä¸€ä¸ªè®¡ç®—ç‚¹é˜µä¸­é¡¶ç‚¹åœ¨æ ¼ç‚¹ä¸Šçš„å¤šè¾¹å½¢é¢ç§¯å…¬å¼è¯¥å…¬å¼å¯ä»¥è¡¨ç¤ºä¸º:
            S = a + b/2 - 1
        å…¶ä¸­aè¡¨ç¤ºå¤šè¾¹å½¢å†…éƒ¨çš„ç‚¹æ•°ï¼Œbè¡¨ç¤ºå¤šè¾¹å½¢è¾¹ç•Œä¸Šçš„ç‚¹æ•°ï¼ŒSè¡¨ç¤ºå¤šè¾¹å½¢çš„é¢ç§¯ã€‚
6. åœ†
    (1) åœ†ä¸ç›´çº¿äº¤ç‚¹
    (2) ä¸¤åœ†äº¤ç‚¹
    (3) ç‚¹åˆ°åœ†çš„åˆ‡çº¿
    (4) ä¸¤åœ†å…¬åˆ‡çº¿
    (5) ä¸¤åœ†ç›¸äº¤é¢ç§¯
```

#### [AcWing 2983. ç©å…·](https://www.acwing.com/problem/content/2986/)

**é¢˜ç›®æè¿°**

>   è®¡ç®—ç©å…·æ”¶çº³ç›’ä¸­ï¼Œæ¯ä¸ªåˆ†åŒºå†…çš„ç©å…·æ•°é‡ã€‚
>
>   çº¦ç¿°çš„çˆ¶æ¯æœ‰ä¸€ä¸ªçƒ¦æ¼----çº¦ç¿°æ¯æ¬¡ç©å®Œç©å…·ä»¥åæ€»ä¼šå°†ç©å…·ä¹±æ‰”ã€‚
>
>   ä»–ä»¬ä¸ºçº¦ç¿°å‡†å¤‡äº†ä¸€ä¸ªé•¿æ–¹å½¢çš„ç©å…·æ”¶çº³ç›’ï¼Œç”¨æ¥æ”¾ä»–çš„ç©å…·ã€‚
>
>   ä½†æ˜¯çº¦ç¿°éå¸¸è°ƒçš®ï¼Œæ¯æ¬¡éƒ½éå¸¸éšæ„çš„å°†ç©å…·æ‰”è¿›ç›’å­ä¸­ï¼Œä½¿å¾—æ‰€æœ‰ç©å…·éƒ½éšæ„æ··åœ¨ä¸€èµ·ï¼Œè¿™è®©çº¦ç¿°éš¾ä»¥æ‰¾åˆ°ä»–å–œæ¬¢çš„ç©å…·ã€‚
>
>   å¯¹æ­¤ï¼Œçº¦ç¿°çš„çˆ¶æ¯æƒ³å‡ºäº†ä¸€ä¸ªå¯¹ç­–ï¼Œç”¨è‹¥å¹²ä¸ªçº¸æ¿å°†æ”¶çº³ç›’åˆ†éš”æˆè‹¥å¹²ä¸ªåˆ†åŒºï¼Œè¿™æ ·è‡³å°‘æ‰”åˆ°ä¸åŒåˆ†åŒºçš„ç©å…·ä¹‹é—´è¿˜æ˜¯èƒ½åˆ†å¼€çš„ã€‚
>
>   ä¸‹é¢æ˜¯ä¸€ä¸ªæ”¶çº³ç›’çš„ä¿¯è§†å›¾ç¤ºä¾‹ã€‚
>
>   ![1.jpg](img/19_6d93a6ca3b-1.jpg)
>
>   ä½ çš„ä»»åŠ¡æ˜¯ï¼Œæ¯å½“çº¦ç¿°å°†ç©å…·æ‰”è¿›æ”¶çº³ç›’ä¸­æ—¶ï¼Œç¡®å®šæ¯ä¸ªåˆ†åŒºä¸­æœ‰å¤šå°‘ä¸ªç©å…·ã€‚

**è¾“å…¥æ ¼å¼**

>   æœ¬é¢˜åŒ…å«å¤šç»„æµ‹è¯•æ•°æ®ã€‚
>
>   å¯¹äºæ¯ç»„æ•°æ®ï¼Œç¬¬ä¸€è¡ŒåŒ…å« `6` ä¸ªæ•´æ•° $n,m,x_1,y_1,x_2,y_2$ï¼Œè¡¨ç¤ºå…±æœ‰ `n` ä¸ªçº¸æ¿ï¼Œ`m` ä¸ªç©å…·ï¼Œæ”¶çº³ç›’çš„å·¦ä¸Šè§’åæ ‡ä¸º `(x1,y1)`ï¼Œå³ä¸‹è§’åæ ‡ä¸º `(x2,y2)`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $U_i,L_i$ï¼Œè¡¨ç¤ºç¬¬ `i` ä¸ªçº¸æ¿çš„ä¸¤ç«¯ç‚¹åæ ‡åˆ†åˆ«ä¸º $(U_i,y_1)$ å’Œ $(L_i,y_2)$ã€‚æ•°æ®ä¿è¯çº¸æ¿ä¹‹é—´ä¸ç›¸äº¤ï¼Œä¸”æŒ‰ç…§ä»å·¦è‡³å³é¡ºåºä¾æ¬¡ç»™å‡ºã€‚
>
>   æ¥ä¸‹æ¥ `m` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° $X_j,Y_j$ï¼Œè¡¨ç¤ºç¬¬ `j` ä¸ªç©å…·çš„ä½ç½®åæ ‡ã€‚ç©å…·çš„ç»™å‡ºé¡ºåºæ˜¯éšæœºçš„ã€‚æ•°æ®ä¿è¯ç©å…·ä¸ä¼šæ°å¥½è½åœ¨çº¸æ¿ä¸Šï¼Œä¹Ÿä¸ä¼šè½åœ¨ç›’å­å¤–ã€‚
>
>   è¾“å…¥ç”±åŒ…å«å•ä¸ª `0` çš„ä¸€è¡Œç»“æŸã€‚

**è¾“å‡ºæ ¼å¼**

>   å¯¹äºæ¯ç»„æ•°æ®ï¼Œè¾“å‡º `n+1` è¡Œã€‚
>
>   `n` ä¸ªçº¸æ¿å°†æ”¶çº³ç›’åˆ’åˆ†ä¸ºäº† `n+1` ä¸ªåˆ†åŒºï¼Œä»å·¦åˆ°å³ç¼–å·ä¸º `0âˆ¼n`ã€‚
>
>   æŒ‰ç…§åˆ†åŒºç¼–å·ä»å°åˆ°å¤§çš„é¡ºåºï¼Œæ¯è¡Œè¾“å‡ºä¸€è¡Œä¿¡æ¯ `i: j`ï¼Œå…¶ä¸­ `i` è¡¨ç¤ºåˆ†åŒºç¼–å·ï¼Œ`j` è¡¨ç¤ºåˆ†åŒºå†…ç©å…·æ•°é‡ã€‚
>
>   æ¯ç»„æ•°æ®ä¹‹é—´ï¼Œ**ç”¨ç©ºè¡Œéš”å¼€**ã€‚

**æ•°æ®èŒƒå›´**

>   +   $æ¯ä¸ªæµ‹è¯•ç‚¹æœ€å¤šåŒ…å« 10 ç»„æ•°æ®ã€‚$
>   +   $1â‰¤n,mâ‰¤5000,$
>   +   $æ‰€æœ‰åæ ‡å–å€¼èŒƒå›´ [âˆ’10^5,10^5]ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
5 6 0 10 60 0
3 1
4 3
6 8
10 10
15 30
1 5
2 1
2 8
5 5
40 10
7 9
4 10 0 10 100 0
20 20
40 40
60 60
80 80
 5 10
15 10
25 10
35 10
45 10
55 10
65 10
75 10
85 10
95 10
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
0: 2
1: 1
2: 1
3: 1
4: 0
5: 1

0: 2
1: 2
2: 2
3: 2
4: 2
```

**æ³¨æ„**

>   å¦‚ç¤ºä¾‹æ‰€ç¤ºï¼Œè½åœ¨ç›’å­è¾¹ç¼˜çš„ç©å…·ä¹Ÿç®—åœ¨ç›’å­å†…ã€‚

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



### æ‰«æçº¿é—®é¢˜

#### [AcWing 3068. æ‰«æçº¿](https://www.acwing.com/problem/content/3071/)

**é¢˜ç›®æè¿°**

>   åœ¨äºŒç»´å¹³é¢ä¸­ç»™å®š `n` ä¸ª**ä¸¤æ¡è¾¹åˆ†åˆ«ä¸ x è½´å’Œ y è½´å¹³è¡Œ**çš„çŸ©å½¢ï¼Œè¯·ä½ æ±‚å‡ºå®ƒä»¬çš„é¢ç§¯å¹¶ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«å››ä¸ªæ•´æ•° `x1,y1,x2,y2`ï¼Œè¡¨ç¤ºå…¶ä¸­ä¸€ä¸ªçŸ©å½¢çš„å·¦ä¸‹è§’åæ ‡ `(x1,y1)` å’Œå³ä¸Šè§’åæ ‡ `(x2,y2)`ã€‚
>
>   æ³¨æ„ï¼Œåæ ‡è½´ `x` è½´ä»å·¦å‘å³å»¶ä¼¸ï¼Œ`y` è½´ä»ä¸‹å‘ä¸Šå»¶ä¼¸ã€‚
>
>   ![1.png](img/19_d636a12245-1.png)

**è¾“å‡ºæ ¼å¼**

>   ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºçŸ©å½¢çš„é¢ç§¯å¹¶ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤1000,$
>   +   $âˆ’10^9â‰¤x1<x2â‰¤10^9,$
>   +   $âˆ’10^9â‰¤y1<y2â‰¤10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
2
10 10 20 20
15 15 25 25
```

**è¾“å‡ºæ ·ä¾‹**

```c++
175
```

**æ‰‹å†™ç¨¿**

![3161121](img/3161121.png)

**ä»£ç **

```c++
#include <iostream>
#include <vector>
#include <algorithm>
#define x first
#define y second
using namespace std;
typedef long long LL;
typedef pair<int, int> PII;
const int N = 1010, INF = 0x3f3f3f3f;
int n;
PII l[N], r[N];
vector<int> points;
LL merge_segs(int a, int b) {
    vector<PII> segs;
    // éå†æ¯ä¸ªçŸ©å½¢
    for (int i = 1; i <= n; i ++ )
        // å¦‚æœå½“å‰çŸ©å½¢å°†åˆ†å‰²æˆçš„é•¿æ¡å®Œå…¨åŒ…è£¹åœ¨å†…
        if (l[i].x <= a && r[i].x >= b)
            // è®°å½•æ­¤åŒºé—´ã€yè½´æ–¹å‘ã€‘
            segs.push_back({l[i].y, r[i].y});
    // åŒºé—´åˆå¹¶æ¨¡æ¿
    // æ’åº
    sort(segs.begin(), segs.end());
    LL height = 0;
    int L = -INF, R = -INF;
    for (auto& [l, r] : segs)
        if (R < l) {
            height += ((LL)R - L);
            L = l, R = r;
        }
        else R = max(R, r);
    // è®°å¾—å°†æœ€åä¸€æ®µçš„é•¿åº¦æ·»åŠ ä¸Š
    height += (R - L);
    // è®¡ç®—ç­”æ¡ˆå³å¯
    return height * (b - a);
}
int main() {
    scanf("%d", &n);
    for (int i = 1; i <= n; i ++ ) {
        // è®°å½•çŸ©å½¢å·¦è¾¹çš„xåæ ‡å’Œyåæ ‡
        // è®°å½•çŸ©å½¢å³è¾¹çš„xåæ ‡å’Œyåæ ‡
        scanf("%d%d%d%d", &l[i].x, &l[i].y, &r[i].x, &r[i].y);
        // ç»Ÿè®¡æ‰€æœ‰çš„æ¨ªåæ ‡
        points.push_back(l[i].x);
        points.push_back(r[i].x);
    }
    // æ’åº
    sort(points.begin(), points.end());
    // å»é‡
    points.erase(unique(points.begin(), points.end()), points.end());
    // å¯èƒ½ä¼šè¶Šç•Œï¼Œä½¿ç”¨LL
    LL res = 0;
    // éå†æ¯ä¸ªåŒºé—´
    for (int i = 1; i < points.size(); i ++ )
        // ç»Ÿè®¡æ€»å’Œ
        res += merge_segs(points[i - 1], points[i]);
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ‰«æçº¿`

**ç¼åˆæ€ª**

[AcWing 803. åŒºé—´åˆå¹¶](#AcWing 803. åŒºé—´åˆå¹¶)

#### [AcWing 2801. ä¸‰è§’å½¢é¢ç§¯å¹¶](https://www.acwing.com/problem/content/2803/)

>   ç»™å‡º `n` ä¸ªä¸‰è§’å½¢ï¼Œæ±‚å®ƒä»¬å¹¶çš„é¢ç§¯ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡Œä¸º `n`ï¼Œå³ä¸‰è§’å½¢çš„ä¸ªæ•°ã€‚
>
>   ä»¥ä¸‹ `n` è¡Œï¼Œæ¯è¡Œ `6` ä¸ªå®æ•° $x_1,y_1,x_2,y_2,x_3,y_3$ï¼Œä»£è¡¨ä¸‰è§’å½¢çš„é¡¶ç‚¹åæ ‡ã€‚
>
>   åæ ‡å‡ä¸ºä¸è¶…è¿‡ $10^6$ çš„å®æ•°ï¼Œè¾“å…¥æ•°æ®ä¿ç•™ `1` ä½å°æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºå¹¶çš„é¢ç§¯ `u`ï¼Œä¿ç•™ä¸¤ä½å°æ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100$

**è¾“å…¥æ ·ä¾‹**

```c++
2
0.0 0.0 2.0 0.0 1.0 1.0
1.0 0.0 3.0 0.0 2.0 1.0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
1.75
```

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



#### [LeetCode 218. å¤©é™…çº¿é—®é¢˜](https://leetcode-cn.com/problems/the-skyline-problem/)

**é—®é¢˜æè¿°**

> åŸå¸‚çš„å¤©é™…çº¿æ˜¯ä»è¿œå¤„è§‚çœ‹è¯¥åŸå¸‚ä¸­æ‰€æœ‰å»ºç­‘ç‰©å½¢æˆçš„è½®å»“çš„å¤–éƒ¨è½®å»“ã€‚ç»™ä½ æ‰€æœ‰å»ºç­‘ç‰©çš„ä½ç½®å’Œé«˜åº¦ï¼Œè¯·è¿”å›ç”±è¿™äº›å»ºç­‘ç‰©å½¢æˆçš„ å¤©é™…çº¿ ã€‚
>
> æ¯ä¸ªå»ºç­‘ç‰©çš„å‡ ä½•ä¿¡æ¯ç”±æ•°ç»„ `buildings` è¡¨ç¤ºï¼Œå…¶ä¸­ä¸‰å…ƒç»„ `buildings[i] = [lefti, righti, heighti]` è¡¨ç¤ºï¼š
>
> + `lefti` æ˜¯ç¬¬ `i` åº§å»ºç­‘ç‰©å·¦è¾¹ç¼˜çš„ `x` åæ ‡ã€‚
> + `righti` æ˜¯ç¬¬ `i` åº§å»ºç­‘ç‰©å³è¾¹ç¼˜çš„ `x` åæ ‡ã€‚
> + `heighti` æ˜¯ç¬¬ `i` åº§å»ºç­‘ç‰©çš„é«˜åº¦ã€‚
>
> å¤©é™…çº¿ åº”è¯¥è¡¨ç¤ºä¸ºç”± â€œå…³é”®ç‚¹â€ ç»„æˆçš„åˆ—è¡¨ï¼Œæ ¼å¼ `[[x1,y1],[x2,y2],...]` ï¼Œå¹¶æŒ‰ `x` åæ ‡ è¿›è¡Œ æ’åº ã€‚å…³é”®ç‚¹æ˜¯æ°´å¹³çº¿æ®µçš„å·¦ç«¯ç‚¹ã€‚åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªç‚¹æ˜¯æœ€å³ä¾§å»ºç­‘ç‰©çš„ç»ˆç‚¹ï¼Œ`y` åæ ‡å§‹ç»ˆä¸º `0` ï¼Œä»…ç”¨äºæ ‡è®°å¤©é™…çº¿çš„ç»ˆç‚¹ã€‚æ­¤å¤–ï¼Œä»»ä½•ä¸¤ä¸ªç›¸é‚»å»ºç­‘ç‰©ä¹‹é—´çš„åœ°é¢éƒ½åº”è¢«è§†ä¸ºå¤©é™…çº¿è½®å»“çš„ä¸€éƒ¨åˆ†ã€‚
>
> æ³¨æ„ï¼šè¾“å‡ºå¤©é™…çº¿ä¸­ä¸å¾—æœ‰è¿ç»­çš„ç›¸åŒé«˜åº¦çš„æ°´å¹³çº¿ã€‚ä¾‹å¦‚ `[...[2 3], [4 5], [7 5], [11 5], [12 7]...]` æ˜¯ä¸æ­£ç¡®çš„ç­”æ¡ˆï¼›ä¸‰æ¡é«˜åº¦ä¸º `5` çš„çº¿åº”è¯¥åœ¨æœ€ç»ˆè¾“å‡ºä¸­åˆå¹¶ä¸ºä¸€ä¸ªï¼š`[...[2 3], [4 5], [12 7], ...]`

**ç¤ºä¾‹ 1**

![img](img/merged.jpg)

> è¾“å…¥ï¼š`buildings = [[2,9,10],[3,7,15],[5,12,12],[15,20,10],[19,24,8]]`
> è¾“å‡ºï¼š`[[2,10],[3,15],[7,12],[12,0],[15,10],[20,8],[24,0]]`
> è§£é‡Šï¼š
> å›¾ `A` æ˜¾ç¤ºè¾“å…¥çš„æ‰€æœ‰å»ºç­‘ç‰©çš„ä½ç½®å’Œé«˜åº¦ï¼Œ
> å›¾ `B` æ˜¾ç¤ºç”±è¿™äº›å»ºç­‘ç‰©å½¢æˆçš„å¤©é™…çº¿ã€‚å›¾ `B` ä¸­çš„çº¢ç‚¹è¡¨ç¤ºè¾“å‡ºåˆ—è¡¨ä¸­çš„å…³é”®ç‚¹ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`buildings = [[0,2,3],[2,5,3]]`
> è¾“å‡ºï¼š`[[0,3],[5,0]]`

**æç¤º**

> + $1 <= buildings.length <= 10^4$
> + $0 <= left_i < right_i <= 2^{31} - 1$
> + $1 <= height_i <= 2^{31} - 1$
> + $buildings æŒ‰ left_i éé€’å‡æ’åº$

**é¢˜è§£**

> 1. å°†æ¨ªåæ ‡æŒ‰ç…§ä»å°åˆ°å¤§æ’åºï¼Œå¦‚æœæ¨ªåæ ‡ç›¸åŒï¼Œåˆ™åˆ†ä¸‹åˆ—ä¸‰ç§æƒ…å†µï¼š
>
>     + å¦‚æœæ˜¯å·¦ç«¯ç‚¹ï¼Œåˆ™æŒ‰ç…§ä»å¤§åˆ°å°æ’åº
>
>         ![1](img/1.jpg)
>
>     + å¦‚æœæ˜¯å³ç«¯ç‚¹ï¼Œåˆ™æŒ‰ç…§ä»å°åˆ°å¤§æ’åº
>
>         ![2](img/2.jpg)
>
>     + å¦‚æœæ˜¯å·¦å³ç«¯ç‚¹é‡åˆï¼Œåˆ™æŒ‰ç…§å…ˆå¤„ç†å·¦ç«¯ç‚¹ï¼Œå†å¤„ç†å³ç«¯ç‚¹
>
>         ![3](img/3.jpg)
>
> 2. ä½¿ç”¨ `pair` ï¼ˆé»˜è®¤å‡åºï¼‰æ•°ç»„ `point` æ¥å­˜å‚¨æ¯ä¸€ä¸ªç‚¹ï¼Œæ’åºï¼Œç”±äºç¬¬ä¸‰ç§æƒ…å†µçš„å­˜åœ¨ï¼Œæ‰€ä»¥ï¼Œå°†å·¦ç«¯ç‚¹çš„å€¼å­˜å‚¨ä¸ºè´Ÿæ•°ï¼Œä½œç”¨æœ‰äºŒï¼š
>
>     + å½“å·¦å³ç«¯ç‚¹é‡åˆçš„æ—¶å€™ï¼Œå¯ä»¥ä¿è¯çš„æ˜¯å…ˆå¤„ç†å·¦ç«¯ç‚¹ï¼Œå†å¤„ç†å³ç«¯ç‚¹ã€
>     + å¯ä»¥æ ¹æ®æ­£è´Ÿå·ï¼Œåˆ¤æ–­å½“å‰å¤„ç†çš„æ˜¯å·¦ç«¯ç‚¹è¿˜æ˜¯å³ç«¯ç‚¹
>
> 3. éå† `point` æ•°ç»„ï¼Œä½¿ç”¨ `multiset` å­˜å‚¨é«˜åº¦ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š
>
>     + å¦‚æœå½“å‰éå†çš„ç‚¹æ˜¯å·¦ç«¯ç‚¹å¹¶ä¸”å½“å‰ç‚¹å¤§äº `multiset` ä¸­çš„æœ€å¤§å€¼ï¼Œè¯´æ˜é«˜åº¦å‡é«˜ï¼Œä¸€å®šäº§ç”Ÿå…³é”®ç‚¹ï¼Œè®°å½•ç­”æ¡ˆï¼Œå¹¶å°†å½“å‰ç‚¹æ’å…¥ `multiset` ä¸­
>     + å¦‚æœå½“å‰éå†çš„ç‚¹æ˜¯å³ç«¯ç‚¹ `h` ï¼Œå…ˆå°†å³ç«¯ç‚¹ `h` åˆ é™¤ï¼ŒæŸ¥çœ‹æœ€å¤§å€¼ï¼Œè‹¥ `h` å¤§äº `multiset` çš„æœ€å¤§å€¼ï¼Œåˆ™è¯´æ˜ `h` å°±æ˜¯æœ€å¤§å€¼ï¼Œé‚£ä¹ˆé«˜åº¦ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼Œå³é«˜åº¦å˜ä½ï¼Œè®°å½•ç­”æ¡ˆå³å¯
>
> 4. é—®é¢˜è§£ç­”
>
>     + ä¸ºå•¥è¦åˆ†å·¦ç«¯ç‚¹å’Œå³ç«¯ç‚¹å¤„ç†ï¼Œé¢˜ç›®ä¸æ˜¯è¯´æ°´å¹³çº¿æ®µçš„å·¦ç«¯ç‚¹ï¼Ÿ
>
>         ![image-20220118134627011](img/image-20220118134627011.png)
>
>         + å¦‚å›¾ï¼Œç­”æ¡ˆå¹¶ä¸éƒ½æ˜¯åœ¨å·¦ç«¯ç‚¹ï¼Œå…¶ä¸­ä¸€ä¸ªç­”æ¡ˆåœ¨çº¢è‰²çŸ©å½¢çš„å³ç«¯ç‚¹

**ä»£ç **

```c++
class Solution {
public:
    vector<vector<int>> getSkyline(vector<vector<int>>& g) {
        vector<vector<int>> res;
        vector<pair<int, int>> point;
        multiset<int> height;
        for (auto& item : g) {
            point.push_back({item[0], -item[2]});
            point.push_back({item[1], item[2]});
        }
        // å…ˆå°†xè½´åŠ å…¥ç­”æ¡ˆ
        height.insert(0);
        sort(point.begin(), point.end());
        for (auto& p : point) {
            int x = p.first, h = abs(p.second);
            if (p.second < 0) { // å·¦ç«¯ç‚¹
                if (h > *height.rbegin()) res.push_back({x, h});
                height.insert(h);
            }
            else { // å³ç«¯ç‚¹
                height.erase(height.find(h));
                if (h > *height.rbegin()) res.push_back({x, *height.rbegin()});
            }
        }
        return res;
    }
};
```

**æ ‡ç­¾**

`æ‰«æçº¿`



# è´ªå¿ƒ



## æ™®é€šè´ªå¿ƒ

### [LeetCode 376. æ‘†åŠ¨åºåˆ—](https://leetcode-cn.com/problems/wiggle-subsequence/)

**é¢˜ç›®æè¿°**

>   å¦‚æœè¿ç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸º æ‘†åŠ¨åºåˆ— ã€‚ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚ä»…æœ‰ä¸€ä¸ªå…ƒç´ æˆ–è€…å«ä¸¤ä¸ªä¸ç­‰å…ƒç´ çš„åºåˆ—ä¹Ÿè§†ä½œæ‘†åŠ¨åºåˆ—ã€‚
>
>   ä¾‹å¦‚ï¼Œ `[1, 7, 4, 9, 2, 5]` æ˜¯ä¸€ä¸ª æ‘†åŠ¨åºåˆ— ï¼Œå› ä¸ºå·®å€¼ `(6, -3, 5, -7, 3)` æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºç°çš„ã€‚
>
>   ç›¸åï¼Œ`[1, 4, 7, 2, 5]` å’Œ `[1, 7, 4, 5, 5]` ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚
>   å­åºåˆ— å¯ä»¥é€šè¿‡ä»åŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥è·å¾—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŸå§‹é¡ºåºã€‚
>
>   ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œè¿”å› `nums` ä¸­ä½œä¸º æ‘†åŠ¨åºåˆ— çš„ æœ€é•¿å­åºåˆ—çš„é•¿åº¦ ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`nums = [1,7,4,9,2,5]`
>   è¾“å‡ºï¼š`6`
>   è§£é‡Šï¼šæ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º `(6, -3, 5, -7, 3)` ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`nums = [1,17,5,10,13,15,10,5,16,8]`
>   è¾“å‡ºï¼š`7`
>   è§£é‡Šï¼šè¿™ä¸ªåºåˆ—åŒ…å«å‡ ä¸ªé•¿åº¦ä¸º `7` æ‘†åŠ¨åºåˆ—ã€‚
>   å…¶ä¸­ä¸€ä¸ªæ˜¯ `[1, 17, 10, 13, 10, 16, 8]` ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º `(16, -7, 3, -3, 6, -8)` ã€‚

**ç¤ºä¾‹ 3**

>   è¾“å…¥ï¼š`nums = [1,2,3,4,5,6,7,8,9]`
>   è¾“å‡ºï¼š`2`

**æç¤º**

>   +   $1 <= nums.length <= 1000$
>   +   $0 <= nums[i] <= 1000$

**è¿›é˜¶**

>   ä½ èƒ½å¦ç”¨ $O(n)$ æ—¶é—´å¤æ‚åº¦å®Œæˆæ­¤é¢˜?

**æ‰‹å†™ç¨¿**

![3162220](img/3162220.png)

**ä»£ç **

```c++
class Solution {
public:
    int wiggleMaxLength(vector<int>& nums) {
        // åˆ é™¤ã€è¿ç»­é‡å¤ã€‘å…ƒç´ 
        nums.erase(unique(nums.begin(), nums.end()), nums.end());
        if (nums.size() <= 2) return nums.size();
        // å°†é¦–å°¾å…ƒç´ æ·»åŠ 
        int res = 2;
        for (int i = 1; i + 1 < nums.size(); i ++ ) {
            // å¦‚æœå½“å‰å…ƒç´ æ˜¯å±€éƒ¨æœ€å¤§å€¼æˆ–è€…å±€éƒ¨æœ€å°å€¼
            // åºåˆ—çš„é•¿åº¦++
            if (nums[i - 1] < nums[i] && nums[i + 1] < nums[i] || nums[i - 1] > nums[i] && nums[i + 1] > nums[i])
                res ++;
        }
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`è´ªå¿ƒ`

**ç¼åˆæ€ª**



## å­—ç¬¦ä¸²è´ªå¿ƒ

### [LeetCode 316. å»é™¤é‡å¤å­—æ¯](https://leetcode-cn.com/problems/remove-duplicate-letters/)

**é—®é¢˜æè¿°**

> ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² `s` ï¼Œè¯·ä½ å»é™¤å­—ç¬¦ä¸²ä¸­é‡å¤çš„å­—æ¯ï¼Œä½¿å¾—æ¯ä¸ªå­—æ¯åªå‡ºç°ä¸€æ¬¡ã€‚éœ€ä¿è¯ è¿”å›ç»“æœçš„å­—å…¸åºæœ€å°ï¼ˆè¦æ±‚ä¸èƒ½æ‰“ä¹±å…¶ä»–å­—ç¬¦çš„ç›¸å¯¹ä½ç½®ï¼‰ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`s = "bcabc"`
> è¾“å‡ºï¼š`"abc"`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`s = "cbacdcbc"`
> è¾“å‡ºï¼š`"acdb"`

**æç¤º**

> + $1 <= s.length <= 10^4$
> + $s$ ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ
> + æ³¨æ„ï¼šè¯¥é¢˜ä¸ [`1081`](https://leetcode-cn.com/problems/smallest-subsequence-of-distinct-characters) ç›¸åŒ

**æ‰‹å†™ç¨¿**

![2181044](img/2181044.png)

**ä»£ç **

```c++
class Solution {
public:
    string removeDuplicateLetters(string s) {
        string res;
        unordered_map<char, int> idxs;
        unordered_map<char, bool> is_appear;
        // è®°å½•æ¯ä¸ªå­—ç¬¦çš„ä¸‹æ ‡æ‰€åœ¨çš„æœ€åä¸€ä½çš„ä½ç½®
        for (int i = 0; i < s.size(); i ++ ) idxs[s[i]] = i;
        for (int i = 0; i < s.size(); i ++ ) {
            // å¦‚æœå½“å‰å­—ç¬¦å‡ºç°è¿‡ï¼Œåˆ™ç›´æ¥è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯
            if (is_appear[s[i]]) continue;
            // åˆ¤æ–­æ˜¯å¦å¯ä»¥åˆ é™¤å½“å‰å­—ç¬¦
            while (res.size() && res.back() > s[i] && idxs[res.back()] > i) {
                is_appear[res.back()] = false;
                res.pop_back();
            }
            res += s[i];
            is_appear[s[i]] = true;
        }
        return res;
    }
};
```

**æ ‡ç­¾**

`è´ªå¿ƒ`

## åŒºé—´åˆå¹¶

### [AcWing 803. åŒºé—´åˆå¹¶](https://www.acwing.com/problem/content/805/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` ä¸ªåŒºé—´ $[l_i,r_i]$ï¼Œè¦æ±‚åˆå¹¶æ‰€æœ‰æœ‰äº¤é›†çš„åŒºé—´ã€‚
>
>   æ³¨æ„å¦‚æœåœ¨ç«¯ç‚¹å¤„ç›¸äº¤ï¼Œä¹Ÿç®—æœ‰äº¤é›†ã€‚
>
>   è¾“å‡ºåˆå¹¶å®Œæˆåçš„åŒºé—´ä¸ªæ•°ã€‚
>
>   ä¾‹å¦‚ï¼š`[1,3]` å’Œ `[2,6]` å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªåŒºé—´ `[1,6]`ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `n`ã€‚
>
>   æ¥ä¸‹æ¥ `n` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° `l` å’Œ `r`ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºåˆå¹¶åŒºé—´å®Œæˆåçš„åŒºé—´ä¸ªæ•°ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤100000,$
>   +   $âˆ’10^9â‰¤l_iâ‰¤r_iâ‰¤10^9$

**è¾“å…¥æ ·ä¾‹**

```c++
5
1 2
2 4
5 6
7 8
7 9
```

**è¾“å‡ºæ ·ä¾‹**

```c++
3
```

**æ‰‹å†™ç¨¿**

![3160836](img/3160836.png)

**ä»£ç **

```c++
#include <iostream>
#include <algorithm>
using namespace std;
typedef pair<int, int> PII;
const int INF = 0x3f3f3f3f;
vector<PII> segs;
int n;
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ ) {
        int l, r;
        scanf("%d%d", &l, &r);
        segs.push_back({l, r});
    }
    sort(segs.begin(), segs.end());
    int res = 0;
    int L = -INF, R = -INF;
    for (auto& [l, r] : segs)
        if (R < l) {
            res ++;
            L = l, R = r;
        }
        else R = max(R, r);
    cout << res << endl;
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`è´ªå¿ƒ`ã€`æ’åº`

**ç¼åˆæ€ª**



# åˆ†æ²»

## [LeetCode 372. è¶…çº§æ¬¡æ–¹](https://leetcode-cn.com/problems/super-pow/)

**é¢˜ç›®æè¿°**

>   ä½ çš„ä»»åŠ¡æ˜¯è®¡ç®— $a^b$ å¯¹ `1337` å–æ¨¡ï¼Œ`a` æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œ`b` æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ­£æ•´æ•°ä¸”ä¼šä»¥æ•°ç»„å½¢å¼ç»™å‡ºã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`a = 2, b = [3]`
>   è¾“å‡ºï¼š`8`

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`a = 2, b = [1,0]`
>   è¾“å‡ºï¼š`1024`

**ç¤ºä¾‹ 3**

>   è¾“å…¥ï¼š`a = 1, b = [4,3,3,8,5,2]`
>   è¾“å‡ºï¼š`1`

**ç¤ºä¾‹ 4**

>   è¾“å…¥ï¼š`a = 2147483647, b = [2,0,0]`
>   è¾“å‡ºï¼š`1198`

**æç¤º**

>   +   $1 <= a <= 2^{31} - 1$
>   +   $1 <= b.length <= 2000$
>   +   $0 <= b[i] <= 9$
>   +   $b ä¸å«å‰å¯¼ 0$

**æ‰‹å†™ç¨¿**

![361811](img/361811.png)

**ä»£ç **

```c++
const int p = 1337;
class Solution {
public:
    int qmi(int a, int b) {
        // aå…ˆæ¨¡pï¼Œå¦‚æœä¸å…ˆæ¨¡pï¼Œç¬¬10è¡Œa * aä¼šè¶Šç•Œ
        // è®°ä½å…ˆæ¨¡pã€æ¨¡æ¿ï¼ï¼ï¼ã€‘
        a %= p;
        int res = 1;
        while (b) {
            if (b & 1) res = res * a % p;
            a = a * a % p;
            b >>= 1;
        }
        return res;
    }
    int superPow(int a, vector<int>& b) {
        if (b.empty()) return 1;
        // æŠŠæœ€åä¸€ä¸ªæ•°å‰”é™¤ï¼ŒåŒ–å½’ä¸ºåˆ†æ²»çš„å­é—®é¢˜
        int t = b.back(); b.pop_back();
        return qmi(superPow(a, b), 10) * qmi(a, t) % p;
    }
};
```

**æ ‡ç­¾**

`å¿«é€Ÿå¹‚`ã€`åˆ†æ²»`



# æ ˆå’Œé˜Ÿåˆ—

## æ ˆ

### æ™®é€šæ ˆ

#### [LeetCode 232. ç”¨æ ˆå®ç°é˜Ÿåˆ—](https://leetcode-cn.com/problems/implement-queue-using-stacks/)

**é¢˜ç›®æè¿°**

>   è¯·ä½ ä»…ä½¿ç”¨ä¸¤ä¸ªæ ˆå®ç°å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ã€‚é˜Ÿåˆ—åº”å½“æ”¯æŒä¸€èˆ¬é˜Ÿåˆ—æ”¯æŒçš„æ‰€æœ‰æ“ä½œï¼ˆ`push`ã€`pop`ã€`peek`ã€`empty`ï¼‰ï¼š
>
>   å®ç° `MyQueue` ç±»ï¼š
>
>   +   `void push(int x)` å°†å…ƒç´  `x` æ¨åˆ°é˜Ÿåˆ—çš„æœ«å°¾
>   +   `int pop()` ä»é˜Ÿåˆ—çš„å¼€å¤´ç§»é™¤å¹¶è¿”å›å…ƒç´ 
>   +   `int peek()` è¿”å›é˜Ÿåˆ—å¼€å¤´çš„å…ƒç´ 
>   +   `boolean empty()` å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false`
>
>   è¯´æ˜ï¼š
>
>   +   ä½  åªèƒ½ ä½¿ç”¨æ ‡å‡†çš„æ ˆæ“ä½œ â€”â€” ä¹Ÿå°±æ˜¯åªæœ‰ `push to top`, `peek/pop from top`, `size`, å’Œ `is empty` æ“ä½œæ˜¯åˆæ³•çš„ã€‚
>   +   ä½ æ‰€ä½¿ç”¨çš„è¯­è¨€ä¹Ÿè®¸ä¸æ”¯æŒæ ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ `list` æˆ–è€… `deque`ï¼ˆåŒç«¯é˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ ˆï¼Œåªè¦æ˜¯æ ‡å‡†çš„æ ˆæ“ä½œå³å¯ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š
>   `["MyQueue", "push", "push", "peek", "pop", "empty"]`
>   `[[], [1], [2], [], [], []]`
>   è¾“å‡ºï¼š
>   `[null, null, null, 1, 1, false]`
>
>   è§£é‡Šï¼š
>   `MyQueue myQueue = new MyQueue();`
>   `myQueue.push(1); // queue is: [1]`
>   `myQueue.push(2); // queue is: [1, 2] (leftmost is front of the queue)`
>   `myQueue.peek(); // return 1`
>   `myQueue.pop(); // return 1, queue is [2]`
>   `myQueue.empty(); // return false`

**æç¤º**

>   +   $1 <= x <= 9$
>   +   $æœ€å¤šè°ƒç”¨ 100 æ¬¡ pushã€popã€peek å’Œ empty$
>   +   $å‡è®¾æ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰æ•ˆçš„ ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªç©ºçš„é˜Ÿåˆ—ä¸ä¼šè°ƒç”¨ pop æˆ–è€… peek æ“ä½œï¼‰$

**è¿›é˜¶**

>   ä½ èƒ½å¦å®ç°æ¯ä¸ªæ“ä½œå‡æ‘Šæ—¶é—´å¤æ‚åº¦ä¸º `O(1)` çš„é˜Ÿåˆ—ï¼Ÿæ¢å¥è¯è¯´ï¼Œæ‰§è¡Œ `n` ä¸ªæ“ä½œçš„æ€»æ—¶é—´å¤æ‚åº¦ä¸º `O(n) `ï¼Œå³ä½¿å…¶ä¸­ä¸€ä¸ªæ“ä½œå¯èƒ½èŠ±è´¹è¾ƒé•¿æ—¶é—´ã€‚

**æ‰‹å†™ç¨¿**



**ä»£ç **

```c++
class MyQueue {
public:
    stack<int> sk1, sk2;
    MyQueue() {}
    
    void push(int x) {
        sk1.push(x);
        return;
    }
    
    int pop() {
        // ç•™ä¸‹æœ€åä¸€ä¸ªæ•°
        while (sk1.size() > 1) {
            sk2.push(sk1.top());
            sk1.pop();
        }
        // è®°å½•æœ€åä¸€ä¸ªæ•°
        int t = sk1.top();
        // å°†æœ€åä¸€ä¸ªæ•°å¼¹å‡º
        sk1.pop();
        while (sk2.size()) {
            sk1.push(sk2.top());
            sk2.pop();
        }
        return t;
    }
    
    int peek() {
        // ç•™ä¸‹æœ€åä¸€ä¸ªæ•°
        while (sk1.size() > 1) {
            sk2.push(sk1.top());
            sk1.pop();
        }
        // è®°å½•æœ€åä¸€ä¸ªæ•°
        int t = sk1.top();
        while (sk2.size()) {
            sk1.push(sk2.top());
            sk2.pop();
        }
        return t;
    }
    
    bool empty() {
        return sk1.empty();
    }
};

/**
 * Your MyQueue object will be instantiated and called as such:
 * MyQueue* obj = new MyQueue();
 * obj->push(x);
 * int param_2 = obj->pop();
 * int param_3 = obj->peek();
 * bool param_4 = obj->empty();
 */
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ ˆ`

**ç¼åˆæ€ª**



### å•è°ƒæ ˆ

#### [LeetCode 42. æ¥é›¨æ°´](https://leetcode-cn.com/problems/trapping-rain-water/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º `1` çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚ 

**ç¤ºä¾‹ 1**

![img](img/rainwatertrap.png)



>   è¾“å…¥ï¼š`height = [0,1,0,2,1,0,1,3,2,1,2,1]`
>   è¾“å‡ºï¼š`6`
>   è§£é‡Šï¼šä¸Šé¢æ˜¯ç”±æ•°ç»„ `[0,1,0,2,1,0,1,3,2,1,2,1]` è¡¨ç¤ºçš„é«˜åº¦å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¥ `6` ä¸ªå•ä½çš„é›¨æ°´ï¼ˆè“è‰²éƒ¨åˆ†è¡¨ç¤ºé›¨æ°´ï¼‰ã€‚ 

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`height = [4,2,0,3,2,5]`
>   è¾“å‡ºï¼š`9`

**æç¤º**

>   +   $n == height.length$
>   +   $1 <= n <= 2 * 10^4$
>   +   $0 <= height[i] <= 10^5$

**æ‰‹å†™ç¨¿**

![3291955](img/3291955.png)

**ä»£ç **

```c++
class Solution {
public:
    int trap(vector<int>& h) {
        // ç»´æŠ¤ä¸€ä¸ªå•è°ƒä¸‹é™æ ˆ
        stack<int> stk;
        int res = 0;
        for (int i = 0; i < h.size(); i ++ ) {
            // åˆå§‹åŒ–ä¸Šä¸€ä¸ªæ°´æ± çš„é«˜åº¦
            int height = 0;
            while (stk.size() && h[stk.top()] <= h[i]) {
                // æ ˆä¸­å­˜å‚¨çš„æ˜¯ä¸‹æ ‡
                res += (i - stk.top() - 1) * (h[stk.top()] - height);
                // æ›´æ–°é«˜åº¦
                height = h[stk.top()];
                stk.pop();
            }
            // å¦‚æœæ ˆä¸ç©ºï¼Œåˆ™è®¡ç®—ã€æœ€åä¸€ä¸ªæ°´æ± ã€‘çš„æ°´
            // æ‰‹æ¨¡å³å¯
            if (stk.size()) res += (i - stk.top() - 1) * (h[i] - height);
            stk.push(i);
        }
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å•è°ƒæ ˆ`

**ç¼åˆæ€ª**

#### [LeetCode 84. æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢](https://leetcode-cn.com/problems/largest-rectangle-in-histogram/)

**é¢˜ç›®æè¿°**

>   ç»™å®š `n` ä¸ªéè´Ÿæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦ã€‚æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»ï¼Œä¸”å®½åº¦ä¸º `1` ã€‚
>
>   æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­ï¼Œèƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯ã€‚

**ç¤ºä¾‹ 1**

![histogram](img/histogram.jpg)

>   è¾“å…¥ï¼š`heights = [2,1,5,6,2,3]`
>   è¾“å‡ºï¼š`10`
>   è§£é‡Šï¼šæœ€å¤§çš„çŸ©å½¢ä¸ºå›¾ä¸­çº¢è‰²åŒºåŸŸï¼Œé¢ç§¯ä¸º `10`

**ç¤ºä¾‹ 2**

![histogram-1](img/histogram-1.jpg)

>   è¾“å…¥ï¼š `heights = [2,4]`
>   è¾“å‡ºï¼š `4`

**æç¤º**

>   +   $1 <= heights.length <=10^5$
>   +   $0 <= heights[i] <= 10^4$

**æ‰‹å†™ç¨¿**

![3311841](img/3311841.png)

**ä»£ç **

```c++
class Solution {
public:
    int largestRectangleArea(vector<int>& h) {
        int n = h.size();
        vector<int> left(n + 5), right(n + 5);
        stack<int> stk;
        // å¯¹äºå½“å‰æ•°è€Œè¨€ï¼Œå¯»æ‰¾å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å½“å‰æ•°ã€ä¸¥æ ¼å°ã€‘çš„å€¼çš„ã€ä¸‹æ ‡ã€‘
        for (int i = 0; i < n; i ++ ) {
            while (stk.size() && h[stk.top()] >= h[i]) stk.pop();
            if (stk.empty()) left[i] = -1;
            else left[i] = stk.top();
            stk.push(i);
        }
        stk = stack<int>();
        // å¯¹äºå½“å‰æ•°è€Œè¨€ï¼Œå¯»æ‰¾å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å½“å‰æ•°ã€ä¸¥æ ¼å¤§ã€‘çš„å€¼çš„ã€ä¸‹æ ‡ã€‘
        for (int i = n - 1; i >= 0; i -- ) {
            while (stk.size() && h[stk.top()] >= h[i]) stk.pop();
            if (stk.empty()) right[i] = n;
            else right[i] = stk.top();
            stk.push(i);
        }
        int res = 0;
        // ç®—å°±å®Œäº†
        for (int i = 0; i < n; i ++ )
            res = max(res, h[i] * (right[i] - left[i] - 1));
        return res;
    }
};
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å•è°ƒæ ˆ`

**ç¼åˆæ€ª**



## é˜Ÿåˆ—

### å¾ªç¯é˜Ÿåˆ—

#### [LeetCode 622. è®¾è®¡å¾ªç¯é˜Ÿåˆ—](https://leetcode-cn.com/problems/design-circular-queue/)

**é¢˜ç›®æè¿°**

>   è®¾è®¡ä½ çš„å¾ªç¯é˜Ÿåˆ—å®ç°ã€‚ å¾ªç¯é˜Ÿåˆ—æ˜¯ä¸€ç§çº¿æ€§æ•°æ®ç»“æ„ï¼Œå…¶æ“ä½œè¡¨ç°åŸºäº `FIFO`ï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰åŸåˆ™å¹¶ä¸”é˜Ÿå°¾è¢«è¿æ¥åœ¨é˜Ÿé¦–ä¹‹åä»¥å½¢æˆä¸€ä¸ªå¾ªç¯ã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºâ€œç¯å½¢ç¼“å†²å™¨â€ã€‚
>
>   å¾ªç¯é˜Ÿåˆ—çš„ä¸€ä¸ªå¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªé˜Ÿåˆ—ä¹‹å‰ç”¨è¿‡çš„ç©ºé—´ã€‚åœ¨ä¸€ä¸ªæ™®é€šé˜Ÿåˆ—é‡Œï¼Œä¸€æ—¦ä¸€ä¸ªé˜Ÿåˆ—æ»¡äº†ï¼Œæˆ‘ä»¬å°±ä¸èƒ½æ’å…¥ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå³ä½¿åœ¨é˜Ÿåˆ—å‰é¢ä»æœ‰ç©ºé—´ã€‚ä½†æ˜¯ä½¿ç”¨å¾ªç¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬èƒ½ä½¿ç”¨è¿™äº›ç©ºé—´å»å­˜å‚¨æ–°çš„å€¼ã€‚
>
>   ä½ çš„å®ç°åº”è¯¥æ”¯æŒå¦‚ä¸‹æ“ä½œï¼š
>
>   +   `MyCircularQueue(k):` æ„é€ å™¨ï¼Œè®¾ç½®é˜Ÿåˆ—é•¿åº¦ä¸º `k` ã€‚
>   +   `Front:` ä»é˜Ÿé¦–è·å–å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› `-1` ã€‚
>   +   `Rear:` è·å–é˜Ÿå°¾å…ƒç´ ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œè¿”å› `-1` ã€‚
>   +   `enQueue(value):` å‘å¾ªç¯é˜Ÿåˆ—æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæˆåŠŸæ’å…¥åˆ™è¿”å›çœŸã€‚
>   +   `deQueue():` ä»å¾ªç¯é˜Ÿåˆ—ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæˆåŠŸåˆ é™¤åˆ™è¿”å›çœŸã€‚
>   +   `isEmpty():` æ£€æŸ¥å¾ªç¯é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚
>   +   `isFull():` æ£€æŸ¥å¾ªç¯é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ã€‚

**ç¤ºä¾‹**

>   `MyCircularQueue circularQueue = new MyCircularQueue(3);` // è®¾ç½®é•¿åº¦ä¸º `3`
>   `circularQueue.enQueue(1);`  // è¿”å› `true`
>   `circularQueue.enQueue(2);`  // è¿”å› `true`
>   `circularQueue.enQueue(3);`  // è¿”å› `true`
>   `circularQueue.enQueue(4);`  // è¿”å› `false`ï¼Œé˜Ÿåˆ—å·²æ»¡
>   `circularQueue.Rear();`  // è¿”å› `3`
>   `circularQueue.isFull();`  // è¿”å› `true`
>   `circularQueue.deQueue();`  // è¿”å› `true`
>   `circularQueue.enQueue(4);`  // è¿”å› `true`
>   `circularQueue.Rear();`  // è¿”å› `4`

**æç¤º**

>   +   æ‰€æœ‰çš„å€¼éƒ½åœ¨ `0` è‡³ `1000` çš„èŒƒå›´å†…ï¼›
>   +   æ“ä½œæ•°å°†åœ¨ `1` è‡³ `1000` çš„èŒƒå›´å†…ï¼›
>   +   è¯·ä¸è¦ä½¿ç”¨å†…ç½®çš„é˜Ÿåˆ—åº“ã€‚

**æ‰‹å†™ç¨¿**

![491037](img/491037.png)

![img](img/20160402104839540.jpeg)

**ä»£ç **

```c++
class MyCircularQueue {
public:
    int hh = 0, tt = 0;
    vector<int> q;
    MyCircularQueue(int k) {
        // å› ä¸ºttæ‰€åœ¨çš„ä½ç½®, ä¸å­˜å‚¨æ•°å­—, æ•…é•¿åº¦ä¸ºn, åˆ™éœ€è¦å¼€é•¿åº¦ä¸ºn + 1çš„æ•°ç»„
        q.resize(k + 1);
    }
    
    bool enQueue(int value) {
        if (isFull()) return false;
        // æ³¨æ„: è¿™é‡Œä½¿ç”¨tt ++, åŸå› : ttæ‰€æŒ‡çš„ä½ç½®ä¸ºç©º, ä¸å¡«å†™ä»»ä½•æ•°
        q[tt ++ ] = value;
        // è¶Šç•Œ, åˆ™ä»å¤´å¼€å§‹
        if (tt >= q.size()) tt = 0;
        return true;
    }
    
    bool deQueue() {
        if (isEmpty()) return false;
        hh ++;
        // è¶Šç•Œ, åˆ™ä»å¤´å¼€å§‹
        if (hh >= q.size()) hh = 0;
        return true; 
    }
    
    int Front() {
        if (isEmpty()) return -1;
        return q[hh];
    }
    
    int Rear() {
        if (isEmpty()) return -1;
        // æ³¨æ„: tt - 1å¯èƒ½å°äº0, æ•…, éœ€è¦å…ˆâ•q.size(), å†%q.size()
        return q[(tt - 1 + q.size()) % q.size()];
    }
    
    bool isEmpty() {
        return hh == tt;
    }
    
    bool isFull() {
        return (tt + 1) % q.size() == hh;
    }
};

/**
 * Your MyCircularQueue object will be instantiated and called as such:
 * MyCircularQueue* obj = new MyCircularQueue(k);
 * bool param_1 = obj->enQueue(value);
 * bool param_2 = obj->deQueue();
 * int param_3 = obj->Front();
 * int param_4 = obj->Rear();
 * bool param_5 = obj->isEmpty();
 * bool param_6 = obj->isFull();
 */
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å¾ªç¯é˜Ÿåˆ—`

**ç¼åˆæ€ª**



### æ»‘åŠ¨çª—å£ã€åŒç«¯é˜Ÿåˆ—ã€‘

#### [LeetCode 5977. æœ€å°‘äº¤æ¢æ¬¡æ•°æ¥ç»„åˆæ‰€æœ‰çš„ 1 II](https://leetcode-cn.com/problems/minimum-swaps-to-group-all-1s-together-ii/)

**é¢˜ç›®æè¿°**

> äº¤æ¢ å®šä¹‰ä¸ºé€‰ä¸­ä¸€ä¸ªæ•°ç»„ä¸­çš„ä¸¤ä¸ª äº’ä¸ç›¸åŒ çš„ä½ç½®å¹¶äº¤æ¢äºŒè€…çš„å€¼ã€‚
>
> ç¯å½¢ æ•°ç»„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥è®¤ä¸º ç¬¬ä¸€ä¸ª å…ƒç´ å’Œ æœ€åä¸€ä¸ª å…ƒç´  ç›¸é‚» ã€‚
>
> ç»™ä½ ä¸€ä¸ª äºŒè¿›åˆ¶ç¯å½¢ æ•°ç»„ `nums` ï¼Œè¿”å›åœ¨ ä»»æ„ä½ç½® å°†æ•°ç»„ä¸­çš„æ‰€æœ‰ `1` èšé›†åœ¨ä¸€èµ·éœ€è¦çš„æœ€å°‘äº¤æ¢æ¬¡æ•°ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`nums = [0,1,0,1,1,0,0]`
> è¾“å‡ºï¼š`1`
> è§£é‡Šï¼šè¿™é‡Œåˆ—å‡ºä¸€äº›èƒ½å¤Ÿå°†æ‰€æœ‰ 1 èšé›†åœ¨ä¸€èµ·çš„æ–¹æ¡ˆï¼š
> `[0,0,1,1,1,0,0]` äº¤æ¢ `1` æ¬¡ã€‚
> `[0,1,1,1,0,0,0]` äº¤æ¢ `1` æ¬¡ã€‚
> `[1,1,0,0,0,0,1]` äº¤æ¢ `2` æ¬¡ï¼ˆåˆ©ç”¨æ•°ç»„çš„ç¯å½¢ç‰¹æ€§ï¼‰ã€‚
> æ— æ³•åœ¨äº¤æ¢ `0` æ¬¡çš„æƒ…å†µä¸‹å°†æ•°ç»„ä¸­çš„æ‰€æœ‰ `1` èšé›†åœ¨ä¸€èµ·ã€‚
> å› æ­¤ï¼Œéœ€è¦çš„æœ€å°‘äº¤æ¢æ¬¡æ•°ä¸º `1` ã€‚

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`nums = [0,1,1,1,0,0,1,1,0]`
> è¾“å‡ºï¼š`2`
> è§£é‡Šï¼šè¿™é‡Œåˆ—å‡ºä¸€äº›èƒ½å¤Ÿå°†æ‰€æœ‰ `1` èšé›†åœ¨ä¸€èµ·çš„æ–¹æ¡ˆï¼š
> `[1,1,1,0,0,0,0,1,1]` äº¤æ¢ `2` æ¬¡ï¼ˆåˆ©ç”¨æ•°ç»„çš„ç¯å½¢ç‰¹æ€§ï¼‰ã€‚
> `[1,1,1,1,1,0,0,0,0]` äº¤æ¢ `2` æ¬¡ã€‚
> æ— æ³•åœ¨äº¤æ¢ `0` æ¬¡æˆ– `1` æ¬¡çš„æƒ…å†µä¸‹å°†æ•°ç»„ä¸­çš„æ‰€æœ‰ `1` èšé›†åœ¨ä¸€èµ·ã€‚
> å› æ­¤ï¼Œéœ€è¦çš„æœ€å°‘äº¤æ¢æ¬¡æ•°ä¸º `2` ã€‚

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`nums = [1,1,0,0,1]`
> è¾“å‡ºï¼š`0`
> è§£é‡Šï¼šå¾—ç›Šäºæ•°ç»„çš„ç¯å½¢ç‰¹æ€§ï¼Œæ‰€æœ‰çš„ `1` å·²ç»èšé›†åœ¨ä¸€èµ·ã€‚
> å› æ­¤ï¼Œéœ€è¦çš„æœ€å°‘äº¤æ¢æ¬¡æ•°ä¸º `0` ã€‚

**æç¤º**

> $1\;\leq\;nums.length\;\leq\;10^5$
> `nums[i]` ä¸º `0` æˆ–è€… `1`

**é¢˜è§£**

> 1. ç»Ÿè®¡å‡º `1` çš„ä¸ªæ•°ï¼Œä½œä¸ºæ»‘åŠ¨çª—å£çš„å¤§å°
> 2. å°†æ•°ç»„å¤åˆ¶ä¸€éï¼Œç›®çš„æ˜¯æ–­ç¯æˆé“¾
> 3. ç­”æ¡ˆå³ä¸ºçª—å£å†… `0` çš„æœ€å°ä¸ªæ•°

**ä»£ç **

```c++
class Solution {
public:
    int minSwaps(vector<int>& nums) {
        // æ»‘åŠ¨çª—å£
        // ç¬¬ä¸€æ­¥ï¼šç»Ÿè®¡ 1 çš„ä¸ªæ•° ä½œä¸ºçª—å£çš„å¤§å°
        int cnt = 0;
        for (auto& num : nums) cnt += num;
        // ç¬¬äºŒæ­¥ï¼šæ–­ç¯æˆé“¾
        nums.insert(nums.begin(), nums.begin(), nums.end());
        int res = INT_MAX, tmp = 0;
        for (int i = 0, j = 0; i < nums.size(); i ++ ) {
            if (i + 1 > cnt) tmp -= nums[j ++];
            // tmp ç»Ÿè®¡çš„æ˜¯çª—å£å†… 1 çš„ä¸ªæ•°
            tmp += nums[i];
            res = min(res, cnt - tmp);
        }
        return res;
    }
};
```

 **æ ‡ç­¾**

`æ»‘åŠ¨çª—å£`ã€`åŒç«¯é˜Ÿåˆ—`ã€`ç¯`

#### [LeetCode 239. æ»‘åŠ¨çª—å£æœ€å¤§å€¼](https://leetcode-cn.com/problems/sliding-window-maximum/)

**é¢˜ç›®æè¿°**

> ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º `k` çš„æ»‘åŠ¨çª—å£ä»æ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ `k` ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚
>
> è¿”å›æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚

**ç¤ºä¾‹ 1**

> è¾“å…¥ï¼š`nums = [1,3,-1,-3,5,3,6,7], k = 3`
> è¾“å‡ºï¼š`[3,3,5,5,6,7]`
> è§£é‡Šï¼š
> æ»‘åŠ¨çª—å£çš„ä½ç½®                            æœ€å¤§å€¼
>
> ---------------               -----
>
> `[1  3  -1] -3  5  3  6  7       3
> 1 [3  -1  -3] 5  3  6  7       3
> 1  3 [-1  -3  5] 3  6  7       5
> 1  3  -1 [-3  5  3] 6  7       5
> 1  3  -1  -3 [5  3  6] 7       6
> 1  3  -1  -3  5 [3  6  7]      7`

**ç¤ºä¾‹ 2**

> è¾“å…¥ï¼š`nums = [1], k = 1`
> è¾“å‡ºï¼š`[1]`

**ç¤ºä¾‹ 3**

> è¾“å…¥ï¼š`nums = [1,-1], k = 1`
> è¾“å‡ºï¼š`[1,-1]`

**ç¤ºä¾‹ 4**

> è¾“å…¥ï¼š`nums = [9,11], k = 2`
> è¾“å‡ºï¼š`[11]`

**ç¤ºä¾‹ 5**

> è¾“å…¥ï¼š`nums = [4,-2], k = 2`
> è¾“å‡ºï¼š`[4]`

**æç¤º**

> + $1 <= nums.length <= 10^5$
> + $-10^4 <= nums[i] <= 10^4$
> + $1 <= k <= nums.length$

**é¢˜è§£**

> 1. <font style="color: red">**è®°ä½ï¼Œå•è°ƒé˜Ÿåˆ—æ˜¯åŒç«¯é˜Ÿåˆ—å³å¯**</font>

**ä»£ç **

```c++
class Solution {
public:
    vector<int> maxSlidingWindow(vector<int>& g, int k) {
        deque<int> dq;
        vector<int> res;
        for (int i = 0; i < g.size(); i ++ ) {
            if (dq.size() && i - dq.front() + 1 > k) dq.pop_front();
            while (dq.size() && g[i] >= g[dq.back()]) dq.pop_back();
            dq.push_back(i);
            if (i >= k - 1) res.push_back(g[dq.front()]);
        }
        return res;
    }
};
```

**æ ‡ç­¾**

`æ»‘åŠ¨çª—å£`

## end

## end

# å †ä¸“é¢˜

## æ‰‹å†™å †

### [AcWing 839. æ¨¡æ‹Ÿå †](https://www.acwing.com/problem/content/841/)

**é¢˜ç›®æè¿°**

> ç»´æŠ¤ä¸€ä¸ªé›†åˆï¼Œåˆå§‹æ—¶é›†åˆä¸ºç©ºï¼Œæ”¯æŒå¦‚ä¸‹å‡ ç§æ“ä½œï¼š
>
> 1. `I x`ï¼Œæ’å…¥ä¸€ä¸ªæ•° `x`ï¼›
> 2. `PM`ï¼Œè¾“å‡ºå½“å‰é›†åˆä¸­çš„æœ€å°å€¼ï¼›
> 3. `DM`ï¼Œåˆ é™¤å½“å‰é›†åˆä¸­çš„æœ€å°å€¼ï¼ˆæ•°æ®ä¿è¯æ­¤æ—¶çš„æœ€å°å€¼å”¯ä¸€ï¼‰ï¼›
> 4. `D k`ï¼Œåˆ é™¤ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°ï¼›
> 5. `C k x`ï¼Œä¿®æ”¹ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°ï¼Œå°†å…¶å˜ä¸º `x`ï¼›
>
> ç°åœ¨è¦è¿›è¡Œ `N` æ¬¡æ“ä½œï¼Œå¯¹äºæ‰€æœ‰ç¬¬ `2` ä¸ªæ“ä½œï¼Œè¾“å‡ºå½“å‰é›†åˆçš„æœ€å°å€¼ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `N`ã€‚
>
> æ¥ä¸‹æ¥ `N` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ“ä½œæŒ‡ä»¤ï¼Œæ“ä½œæŒ‡ä»¤ä¸º `I x`ï¼Œ`PM`ï¼Œ`DM`ï¼Œ`D k` æˆ– `C k x` ä¸­çš„ä¸€ç§ã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹äºæ¯ä¸ªè¾“å‡ºæŒ‡ä»¤ `PM`ï¼Œè¾“å‡ºä¸€ä¸ªç»“æœï¼Œè¡¨ç¤ºå½“å‰é›†åˆä¸­çš„æœ€å°å€¼ã€‚
>
> æ¯ä¸ªç»“æœå ä¸€è¡Œã€‚

**æ•°æ®èŒƒå›´**

> + $1 â‰¤ N â‰¤ 10^5$
> + $âˆ’10^9 â‰¤ x â‰¤ 10^9$
> + $æ•°æ®ä¿è¯åˆæ³•ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
8
I -10
PM
I -10
D 1
C 2 8
I 6
PM
DM
```

**è¾“å‡ºæ ·ä¾‹**

```c++
-10
6
```

**æ‰‹å†™ç¨¿**

![472119](img/472119.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010;
int n, idx, num;
char op[2];
int ph[N], hp[N], heap[N];
void heap_swap(int a, int b) {
    // æ‰‹å†™ç¨¿è¯´æ˜
    swap(heap[a], heap[b]);
    swap(ph[hp[a]], ph[hp[b]]);
    swap(hp[a], hp[b]);
    return;
}
// æ¨¡æ¿
void up(int u) {
    if (u / 2 && heap[u] < heap[u / 2]) {
        heap_swap(u, u / 2);
        up(u / 2);
    }
    return;
}
// æ¨¡æ¿
void down(int u) {
    int t = u;
    if (u * 2 <= idx && heap[t] > heap[u * 2]) t = u * 2;
    if (u * 2 + 1 <= idx && heap[t] > heap[u * 2 + 1]) t = u * 2 + 1;
    if (t != u) {
        heap_swap(t, u);
        down(t);
    }
    return;
}
int main() {
    scanf("%d", &n);
    for (int i = 0; i < n; i ++ ) {
        scanf("%s", op);
        int k, x;
        if (!strcmp(op, "I")) {
            scanf("%d", &x);
            // å †æ’åºä¸‹æ ‡ä»1å¼€å§‹
            ph[++ num] = ++idx;
            hp[idx] = num;
            heap[idx] = x;
            up(idx);
        }
        else if (!strcmp(op, "PM")) cout << heap[1] << endl;
        else if (!strcmp(op, "DM")) {
            heap_swap(1, idx --);
            down(1);
        }
        else if (!strcmp(op, "D")) {
            scanf("%d", &k);
            // è·å–ç¬¬kä¸ªè¾“å…¥çš„æ•°å­—åœ¨å †ä¸­çš„ä¸‹æ ‡[æŒ‡é’ˆ]
            k = ph[k];
            // åˆ é™¤ç¬¬kä¸ªæ•°å­—
            // åˆ†ä¸¤æ­¥[æ‰‹å†™ç¨¿]
            heap_swap(k, idx --);
            // ç”±äºä¸ç¡®å®šæ–°æ¢æ¥çš„æ•°æ˜¯å¤§æ˜¯å°, å› æ­¤, upä¸€édownä¸€é
            up(k);
            down(k);
        }
        else {
            scanf("%d%d", &k, &x);
            // è·å–ç¬¬kä¸ªè¾“å…¥çš„æ•°å­—åœ¨å †ä¸­çš„ä¸‹æ ‡[æŒ‡é’ˆ]
            k = ph[k];
            // ä¿®æ”¹ç¬¬kä¸ªæ•°å­—
            heap[k] = x;
            // ç”±äºä¸ç¡®å®šæ–°æ¢æ¥çš„æ•°æ˜¯å¤§æ˜¯å°, å› æ­¤, upä¸€édownä¸€é
            up(k);
            down(k);
        }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(nlog_n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å †`ã€`æ‰‹å†™å †`

**ç¼åˆæ€ª**



## å¯¹é¡¶å †

### [LeetCode 295. æ•°æ®æµçš„ä¸­ä½æ•°](https://leetcode-cn.com/problems/find-median-from-data-stream/)

**é¢˜ç›®æè¿°**

> ä¸­ä½æ•°æ˜¯æœ‰åºåˆ—è¡¨ä¸­é—´çš„æ•°ã€‚å¦‚æœåˆ—è¡¨é•¿åº¦æ˜¯å¶æ•°ï¼Œä¸­ä½æ•°åˆ™æ˜¯ä¸­é—´ä¸¤ä¸ªæ•°çš„å¹³å‡å€¼ã€‚
>
> ä¾‹å¦‚ï¼Œ
>
> `[2,3,4]` çš„ä¸­ä½æ•°æ˜¯ `3`
>
> `[2,3]` çš„ä¸­ä½æ•°æ˜¯ `(2 + 3) / 2 = 2.5`
>
> è®¾è®¡ä¸€ä¸ªæ”¯æŒä»¥ä¸‹ä¸¤ç§æ“ä½œçš„æ•°æ®ç»“æ„ï¼š
>
> `void addNum(int num)` - ä»æ•°æ®æµä¸­æ·»åŠ ä¸€ä¸ªæ•´æ•°åˆ°æ•°æ®ç»“æ„ä¸­ã€‚
> `double findMedian()` - è¿”å›ç›®å‰æ‰€æœ‰å…ƒç´ çš„ä¸­ä½æ•°ã€‚

**ç¤ºä¾‹**

> `addNum(1)`
> `addNum(2)`
> `findMedian() -> 1.5`
> `addNum(3) `
> `findMedian() -> 2`

**è¿›é˜¶**

> å¦‚æœæ•°æ®æµä¸­æ‰€æœ‰æ•´æ•°éƒ½åœ¨ `0` åˆ° `100` èŒƒå›´å†…ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ
> å¦‚æœæ•°æ®æµä¸­ `99%` çš„æ•´æ•°éƒ½åœ¨ `0` åˆ° `100` èŒƒå›´å†…ï¼Œä½ å°†å¦‚ä½•ä¼˜åŒ–ä½ çš„ç®—æ³•ï¼Ÿ

**æ‰‹å†™ç¨¿**

![WX20220120-215203@2x](img/WX20220120-215203@2x.png)

**è®°å¿†æŠ€å·§**

> **å¤§æ ¹å †**
>
> > 1. è®°å¿†æŠ€å·§ï¼šå¤§æ ¹å †å³ä¸ºæŠŠ<font style="color:red">**å°äºç­‰äº(`less`)**</font>å½“å‰æ•°çš„æ•°å­—å¾€ä¸‹æŒ‰
> > 2. å®šä¹‰ï¼š`priority_queue<int, vector<int>> q;`
>
> **å°æ ¹å †**
>
> > 1. è®°å¿†æŠ€å·§ï¼šå°æ ¹å †å³ä¸ºæŠŠ<font style="color:red">**å¤§äºç­‰äº(`greater`)**</font>å½“å‰æ•°çš„æ•°å­—å¾€ä¸‹æŒ‰
> > 2. å®šä¹‰ï¼š`priority_queue<int, vector<int>, greater<int>> q;`

**ä»£ç **

```c++
class MedianFinder {
public:
    // å¤§æ ¹å †
    priority_queue<int, vector<int>> left;
    // å°æ ¹å †
    priority_queue<int, vector<int>, greater<int>> right;
    MedianFinder() {}
    
    void addNum(int num) {
        if (left.empty() || num <= left.top()) {
            left.push(num);
            // å·¦è¾¹æ·»åŠ å®Œæ•°æ®ä¹‹åï¼Œå¦‚æœå‡ºç°å·¦è¾¹å…ƒç´ çš„ä¸ªæ•°å¤§äºå³è¾¹å…ƒç´ çš„ä¸ªæ•° + 1
            // å› ä¸ºä¿è¯å·¦è¾¹å…ƒç´ çš„æ•°é‡ç­‰äºå³è¾¹å…ƒç´ çš„æ•°é‡æˆ–è€…ç­‰äºå³è¾¹å…ƒç´ çš„æ•°é‡ + 1
            // åˆ™è¯´æ˜éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè°ƒæ•´å³å¯
            if (left.size() > right.size() + 1) right.push(left.top()), left.pop();
        }
        else {
            right.push(num);
            // åŒç†
            if (right.size() > left.size()) left.push(right.top()), right.pop();
        }
        return;
    }
    
    double findMedian() {
        if (left.size() + right.size() & 1) return left.top();
        return (left.top() + right.top()) / 2.0;
    }
};

/**
 * Your MedianFinder object will be instantiated and called as such:
 * MedianFinder* obj = new MedianFinder();
 * obj->addNum(num);
 * double param_2 = obj->findMedian();
 */
```

**æ ‡ç­¾**

`ä¼˜å…ˆé˜Ÿåˆ—`ã€`å¯¹é¡¶å †`

## äºŒå‰å †

### [AcWing 148. åˆå¹¶æœå­](https://www.acwing.com/problem/content/150/)

**é¢˜ç›®æè¿°**

>   åœ¨ä¸€ä¸ªæœå›­é‡Œï¼Œè¾¾è¾¾å·²ç»å°†æ‰€æœ‰çš„æœå­æ‰“äº†ä¸‹æ¥ï¼Œè€Œä¸”æŒ‰æœå­çš„ä¸åŒç§ç±»åˆ†æˆäº†ä¸åŒçš„å †ã€‚
>
>   è¾¾è¾¾å†³å®šæŠŠæ‰€æœ‰çš„æœå­åˆæˆä¸€å †ã€‚
>
>   æ¯ä¸€æ¬¡åˆå¹¶ï¼Œè¾¾è¾¾å¯ä»¥æŠŠä¸¤å †æœå­åˆå¹¶åˆ°ä¸€èµ·ï¼Œæ¶ˆè€—çš„ä½“åŠ›ç­‰äºä¸¤å †æœå­çš„é‡é‡ä¹‹å’Œã€‚
>
>   å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„æœå­ç»è¿‡ `nâˆ’1` æ¬¡åˆå¹¶ä¹‹åï¼Œå°±åªå‰©ä¸‹ä¸€å †äº†ã€‚
>
>   è¾¾è¾¾åœ¨åˆå¹¶æœå­æ—¶æ€»å…±æ¶ˆè€—çš„ä½“åŠ›ç­‰äºæ¯æ¬¡åˆå¹¶æ‰€è€—ä½“åŠ›ä¹‹å’Œã€‚
>
>   å› ä¸ºè¿˜è¦èŠ±å¤§åŠ›æ°”æŠŠè¿™äº›æœå­æ¬å›å®¶ï¼Œæ‰€ä»¥è¾¾è¾¾åœ¨åˆå¹¶æœå­æ—¶è¦å°½å¯èƒ½åœ°èŠ‚çœä½“åŠ›ã€‚
>
>   å‡å®šæ¯ä¸ªæœå­é‡é‡éƒ½ä¸º `1`ï¼Œå¹¶ä¸”å·²çŸ¥æœå­çš„ç§ç±»æ•°å’Œæ¯ç§æœå­çš„æ•°ç›®ï¼Œä½ çš„ä»»åŠ¡æ˜¯è®¾è®¡å‡ºåˆå¹¶çš„æ¬¡åºæ–¹æ¡ˆï¼Œä½¿è¾¾è¾¾è€—è´¹çš„ä½“åŠ›æœ€å°‘ï¼Œå¹¶è¾“å‡ºè¿™ä¸ªæœ€å°çš„ä½“åŠ›è€—è´¹å€¼ã€‚
>
>   ä¾‹å¦‚æœ‰ `3` ç§æœå­ï¼Œæ•°ç›®ä¾æ¬¡ä¸º `1ï¼Œ2ï¼Œ9`ã€‚
>
>   å¯ä»¥å…ˆå°† `1ã€2` å †åˆå¹¶ï¼Œæ–°å †æ•°ç›®ä¸º `3`ï¼Œè€—è´¹ä½“åŠ›ä¸º `3`ã€‚
>
>   æ¥ç€ï¼Œå°†æ–°å †ä¸åŸå…ˆçš„ç¬¬ä¸‰å †åˆå¹¶ï¼Œåˆå¾—åˆ°æ–°çš„å †ï¼Œæ•°ç›®ä¸º `12`ï¼Œè€—è´¹ä½“åŠ›ä¸º `12`ã€‚
>
>   æ‰€ä»¥è¾¾è¾¾æ€»å…±è€—è´¹ä½“åŠ›`=3+12=15`ã€‚
>
>   å¯ä»¥è¯æ˜ `15` ä¸ºæœ€å°çš„ä½“åŠ›è€—è´¹å€¼ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥åŒ…æ‹¬ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªæ•´æ•° `n`ï¼Œè¡¨ç¤ºæœå­çš„ç§ç±»æ•°ã€‚
>
>   ç¬¬äºŒè¡ŒåŒ…å« `n` ä¸ªæ•´æ•°ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œç¬¬ `i` ä¸ªæ•´æ•° $a_i$ æ˜¯ç¬¬ `i` ç§æœå­çš„æ•°ç›®ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºåŒ…æ‹¬ä¸€è¡Œï¼Œè¿™ä¸€è¡ŒåªåŒ…å«ä¸€ä¸ªæ•´æ•°ï¼Œä¹Ÿå°±æ˜¯æœ€å°çš„ä½“åŠ›è€—è´¹å€¼ã€‚
>
>   è¾“å…¥æ•°æ®ä¿è¯è¿™ä¸ªå€¼å°äº $2^{31}$ã€‚

**æ•°æ®èŒƒå›´**

>   +   $1â‰¤nâ‰¤10000$,
>   +   $1â‰¤a_iâ‰¤20000$

**è¾“å…¥æ ·ä¾‹**

```c++
3 
1 2 9 
```

**è¾“å‡ºæ ·ä¾‹**

```c++
15
```

**æ‰‹å†™ç¨¿**

>   1.   æ¯æ¬¡é€‰æ‹©è€—è´¹ä½“åŠ›æœ€å°çš„ä¸¤ä¸ªæœå­è¿›è¡Œåˆå¹¶å³å¯ï¼Œä½¿ç”¨ `res` è®¡ç®—æ€»çš„è€—è´¹ä½“åŠ›ä¹‹å’Œ
>        +   é€‰æ‹©è€—è´¹ä½“åŠ›æœ€å°çš„ä¸¤ä¸ªæœå­ä½¿ç”¨å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰å³å¯
>        +   æ¯æ¬¡å°†åˆå¹¶å®Œçš„æœå­å†æ¬¡æ”¾è¿›å †é‡Œå³å¯

**ä»£ç **

```c++
#include <iostream>
#include <queue>
using namespace std;
int n;
priority_queue<int, vector<int>, greater<int>> heap;
int main() {
    scanf("%d", &n);
    for (int i = 0, x; i < n; i ++ ) {
        scanf("%d", &x);
        heap.push(x);
    }
    int res = 0;
    while (heap.size() > 1) {
        // é€‰æ‹©è€—è´¹ä½“åŠ›æœ€å°çš„ä¸¤ä¸ªæœå­aå’Œb
        int a = heap.top(); heap.pop();
        int b = heap.top(); heap.pop();
        // å°†æ–°çš„æœå­æ”¾è¿›å †é‡Œé¢
        heap.push(a + b);
        res += a + b;
    }
    cout << res << endl;
    return 0;
}
```

**æ ‡ç­¾**

`äºŒå‰å †`ã€`å“ˆå¤«æ›¼æ ‘`ã€`ä¼˜å…ˆé˜Ÿåˆ—`

## `n` å‰å †

### [AcWing 149. è·é©¬å²è¯—](https://www.acwing.com/problem/content/description/151/)

>   è¿½é€å½±å­çš„äººï¼Œè‡ªå·±å°±æ˜¯å½±å­ã€‚ â€”â€”è·é©¬
>
>   è¾¾è¾¾æœ€è¿‘è¿·ä¸Šäº†æ–‡å­¦ã€‚
>
>   å¥¹å–œæ¬¢åœ¨ä¸€ä¸ªæ…µæ‡’çš„åˆåï¼Œç»†ç»†åœ°å“ä¸Šä¸€æ¯å¡å¸ƒå¥‡è¯ºï¼Œé™é™åœ°é˜…è¯»å¥¹çˆ±ä¸é‡Šæ‰‹çš„ã€Šè·é©¬å²è¯—ã€‹ã€‚
>
>   ä½†æ˜¯ç”±ã€Šå¥¥å¾·èµ›ã€‹å’Œã€Šä¼Šåˆ©äºšç‰¹ã€‹ç»„æˆçš„é¸¿ç¯‡å·¨åˆ¶ã€Šè·é©¬å²è¯—ã€‹å®åœ¨æ˜¯å¤ªé•¿äº†ï¼Œè¾¾è¾¾æƒ³é€šè¿‡ä¸€ç§ç¼–ç æ–¹å¼ä½¿å¾—å®ƒå˜å¾—çŸ­ä¸€äº›ã€‚
>
>   ä¸€éƒ¨ã€Šè·é©¬å²è¯—ã€‹ä¸­æœ‰ `n` ç§ä¸åŒçš„å•è¯ï¼Œä» `1` åˆ° `n` è¿›è¡Œç¼–å·ã€‚å…¶ä¸­ç¬¬ `i` ç§å•è¯å‡ºç°çš„æ€»æ¬¡æ•°ä¸º $w_i$ã€‚
>
>   è¾¾è¾¾æƒ³è¦ç”¨ `k` è¿›åˆ¶ä¸² $s_i$ æ¥æ›¿æ¢ç¬¬ `i` ç§å•è¯ï¼Œä½¿å¾—å…¶æ»¡è¶³å¦‚ä¸‹è¦æ±‚:
>
>   å¯¹äºä»»æ„çš„ $1â‰¤i,jâ‰¤nï¼Œiâ‰ j$ï¼Œéƒ½æœ‰ï¼š$s_i$ ä¸æ˜¯ $s_j$ çš„å‰ç¼€ã€‚
>
>   ç°åœ¨è¾¾è¾¾æƒ³è¦çŸ¥é“ï¼Œå¦‚ä½•é€‰æ‹© $s_i$ï¼Œæ‰èƒ½ä½¿æ›¿æ¢ä»¥åå¾—åˆ°çš„æ–°çš„ã€Šè·é©¬å²è¯—ã€‹é•¿åº¦æœ€å°ã€‚
>
>   åœ¨ç¡®ä¿æ€»é•¿åº¦æœ€å°çš„æƒ…å†µä¸‹ï¼Œè¾¾è¾¾è¿˜æƒ³çŸ¥é“æœ€é•¿çš„ $s_i$ çš„æœ€çŸ­é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ
>
>   ä¸€ä¸ªå­—ç¬¦ä¸²è¢«ç§°ä¸º `k` è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå½“ä¸”ä»…å½“å®ƒçš„æ¯ä¸ªå­—ç¬¦æ˜¯ `0` åˆ° `kâˆ’1` ä¹‹é—´ï¼ˆåŒ…æ‹¬ `0` å’Œ `kâˆ’1`ï¼‰çš„æ•´æ•°ã€‚
>
>   å­—ç¬¦ä¸² `Str1` è¢«ç§°ä¸ºå­—ç¬¦ä¸² `Str2` çš„å‰ç¼€ï¼Œå½“ä¸”ä»…å½“ï¼šå­˜åœ¨ `1â‰¤tâ‰¤m`ï¼Œä½¿å¾— `Str1=Str2[1..t]`ã€‚
>
>   å…¶ä¸­ï¼Œ`m` æ˜¯å­—ç¬¦ä¸² `Str2` çš„é•¿åº¦ï¼Œ`Str2[1..t]` è¡¨ç¤º `Str2` çš„å‰ `t` ä¸ªå­—ç¬¦ç»„æˆçš„å­—ç¬¦ä¸²ã€‚
>
>   **æ³¨æ„**:è¯·ä½¿ç”¨ `64` ä½æ•´æ•°è¿›è¡Œè¾“å…¥è¾“å‡ºã€å‚¨å­˜å’Œè®¡ç®—ã€‚

**è¾“å…¥æ ¼å¼**

>   è¾“å…¥æ–‡ä»¶çš„ç¬¬ `1` è¡ŒåŒ…å« `2` ä¸ªæ­£æ•´æ•° `n,k`ï¼Œä¸­é—´ç”¨å•ä¸ªç©ºæ ¼éš”å¼€ï¼Œè¡¨ç¤ºå…±æœ‰ `n` ç§å•è¯ï¼Œéœ€è¦ä½¿ç”¨ `k` è¿›åˆ¶å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ã€‚
>
>   ç¬¬ `2âˆ¼n+1` è¡Œï¼šç¬¬ `i+1` è¡ŒåŒ…å« `1` ä¸ªéè´Ÿæ•´æ•° $w_i$ï¼Œè¡¨ç¤ºç¬¬ $i$ ç§å•è¯çš„å‡ºç°æ¬¡æ•°ã€‚

**è¾“å‡ºæ ¼å¼**

>   è¾“å‡ºæ–‡ä»¶åŒ…æ‹¬ `2` è¡Œã€‚
>
>   ç¬¬ `1` è¡Œè¾“å‡º `1` ä¸ªæ•´æ•°ï¼Œä¸ºã€Šè·é©¬å²è¯—ã€‹ç»è¿‡é‡æ–°ç¼–ç ä»¥åçš„æœ€çŸ­é•¿åº¦ã€‚
>
>   ç¬¬ `2` è¡Œè¾“å‡º `1` ä¸ªæ•´æ•°ï¼Œä¸ºä¿è¯æœ€çŸ­æ€»é•¿åº¦çš„æƒ…å†µä¸‹ï¼Œæœ€é•¿å­—ç¬¦ä¸² $s_i$ çš„æœ€çŸ­é•¿åº¦ã€‚

**æ•°æ®èŒƒå›´**

>   +   $2â‰¤nâ‰¤100000,$
>   +   $2â‰¤kâ‰¤9$
>   +   $1â‰¤wiâ‰¤10^{12}$

**è¾“å…¥æ ·ä¾‹**

```c++
4 2
1
1
2
2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
12
2
```

**æ‰‹å†™ç¨¿**

>   1.   ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å…ƒç´ ç±»å‹æ˜¯å¤åˆç±»å‹ï¼Œå¦‚ `pair`
>
>        é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’åºè§„åˆ™æ˜¯å…ˆæŒ‰ç…§ `pair` çš„ `first` çš„å±æ€§é™åºæ’åˆ—ï¼Œå¦‚æœ `first` ç›¸ç­‰ï¼Œåˆ™æŒ‰ç…§ `second`å±æ€§é™åºæ’åº
>
>        åŒç†ï¼Œä¼ å…¥`std::greator` åï¼Œæ’åºè§„åˆ™æ˜¯å…ˆæŒ‰ç…§ `pair` çš„ `first` çš„å±æ€§å‡åºæ’åˆ—ï¼Œå¦‚æœ `first` ç›¸ç­‰ï¼Œåˆ™æŒ‰ç…§ `second` å±æ€§å‡åºæ’åˆ—
>
>   2.   å“ˆå¤«æ›¼ç¼–ç å‰ç½®çŸ¥è¯†
>
>        ![381011](img/381011.png)
>
>   3.   æœ¬é¢˜æ­¥éª¤åˆ†æ
>
>        ![381015](img/381015.png)

**ä»£ç **

```c++
#include <iostream>
#include <queue>
using namespace std;
typedef long long LL;
typedef pair<LL, int> PLI;
const int N = 100010;
int n, k;
// å°æ ¹å †
priority_queue<PLI, vector<PLI>, greater<PLI>> heap;
int main() {
    scanf("%d%d", &n, &k);
    for (int i = 0; i < n; i ++ ) {
        LL x;
        scanf("%lld", &x);
        // ç¬¬ä¸€ä¸ªå‚æ•°å­˜å€¼
        // ç¬¬äºŒä¸ªå‚æ•°å­˜é«˜åº¦ã€æ·±åº¦ã€‘
        heap.push({x, 0});
    }
    // å¦‚æœä¸æ»¡è¶³nå‰æ ‘ï¼Œåˆ™å°†å…¶è¡¥æ»¡nå‰æ ‘
    while ((n - k) % (k - 1)) heap.push({0, 0}), n ++;
    // è®°å½•ç­”æ¡ˆ
    LL res = 0;
    while (heap.size() > 1) {
        // è®°å½•kå‰æ ‘åˆå¹¶ä¹‹åçš„å’Œ
        LL sum = 0;
        // è®°å½•æœ€å¤§æ·±åº¦
        int depth = 0;
        for (int i = 0; i < k; i ++ ) {
            auto t = heap.top(); heap.pop();
            sum += t.first;
            // è®°å½•æœ€å¤§æ·±åº¦
            depth = max(depth, t.second);
        }
        // åŠ ä¸Šç­”æ¡ˆ
        res += sum;
        // æ·±åº¦+1ï¼Œå› ä¸ºçˆ¶èŠ‚ç‚¹æ·±åº¦ç­‰äºå­èŠ‚ç‚¹æ·±åº¦+1
        heap.push({sum, depth + 1});
    }
    cout << res << endl << heap.top().second << endl;
    return 0;
}
```

**æ ‡ç­¾**

`nå‰å †`ã€`å°æ ¹å †`ã€`å“ˆå¤«æ›¼æ ‘`ã€`å“ˆå¤«æ›¼ç¼–ç `

# é“¾è¡¨ä¸“é¢˜

## [AcWing 826. å•é“¾è¡¨](https://www.acwing.com/problem/content/828/)

**é¢˜ç›®æè¿°**

>   å®ç°ä¸€ä¸ªå•é“¾è¡¨ï¼Œé“¾è¡¨åˆå§‹ä¸ºç©ºï¼Œæ”¯æŒä¸‰ç§æ“ä½œï¼š
>
>   1.  å‘é“¾è¡¨å¤´æ’å…¥ä¸€ä¸ªæ•°ï¼›
>   2.  åˆ é™¤ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°åé¢çš„æ•°ï¼›
>   3.  åœ¨ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°åæ’å…¥ä¸€ä¸ªæ•°ã€‚
>
>   ç°åœ¨è¦å¯¹è¯¥é“¾è¡¨è¿›è¡Œ `M` æ¬¡æ“ä½œï¼Œè¿›è¡Œå®Œæ‰€æœ‰æ“ä½œåï¼Œä»å¤´åˆ°å°¾è¾“å‡ºæ•´ä¸ªé“¾è¡¨ã€‚
>
>   **æ³¨æ„**:é¢˜ç›®ä¸­ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°å¹¶ä¸æ˜¯æŒ‡å½“å‰é“¾è¡¨çš„ç¬¬ `k` ä¸ªæ•°ã€‚ä¾‹å¦‚æ“ä½œè¿‡ç¨‹ä¸­ä¸€å…±æ’å…¥äº† `n` ä¸ªæ•°ï¼Œåˆ™æŒ‰ç…§æ’å…¥çš„æ—¶é—´é¡ºåºï¼Œè¿™ `n` ä¸ªæ•°ä¾æ¬¡ä¸ºï¼šç¬¬ `1` ä¸ªæ’å…¥çš„æ•°ï¼Œç¬¬ `2` ä¸ªæ’å…¥çš„æ•°ï¼Œâ€¦ç¬¬ `n` ä¸ªæ’å…¥çš„æ•°ã€‚

**è¾“å…¥æ ¼å¼**

>   ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `M`ï¼Œè¡¨ç¤ºæ“ä½œæ¬¡æ•°ã€‚
>
>   æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ“ä½œå‘½ä»¤ï¼Œæ“ä½œå‘½ä»¤å¯èƒ½ä¸ºä»¥ä¸‹å‡ ç§ï¼š
>
>   1.  `H x`ï¼Œè¡¨ç¤ºå‘é“¾è¡¨å¤´æ’å…¥ä¸€ä¸ªæ•° `x`ã€‚
>   2.  `D k`ï¼Œè¡¨ç¤ºåˆ é™¤ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°åé¢çš„æ•°ï¼ˆå½“ `k` ä¸º `0` æ—¶ï¼Œè¡¨ç¤ºåˆ é™¤å¤´ç»“ç‚¹ï¼‰ã€‚
>   3.  `I k x`ï¼Œè¡¨ç¤ºåœ¨ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°åé¢æ’å…¥ä¸€ä¸ªæ•° `x`ï¼ˆæ­¤æ“ä½œä¸­ `k` å‡å¤§äº `0`ï¼‰ã€‚

**è¾“å‡ºæ ¼å¼**

>   å…±ä¸€è¡Œï¼Œå°†æ•´ä¸ªé“¾è¡¨ä»å¤´åˆ°å°¾è¾“å‡ºã€‚

**æ•°æ®èŒƒå›´**

>   +   $1 â‰¤ M â‰¤ 100000$
>   +   $æ‰€æœ‰æ“ä½œä¿è¯åˆæ³•ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
10
H 9
I 1 1
D 1
D 0
H 6
I 3 6
I 4 5
I 4 5
I 3 4
D 6
```

**è¾“å‡ºæ ·ä¾‹**

```c++
6 4 6 5
```

**æ‰‹å†™ç¨¿**



**ä»£ç **



**æ—¶é—´å¤æ‚åº¦**



**ç©ºé—´å¤æ‚åº¦**



**æ ‡ç­¾**



**ç¼åˆæ€ª**



## [AcWing 827. åŒé“¾è¡¨](https://www.acwing.com/problem/content/829/)

**é¢˜ç›®æè¿°**

> å®ç°ä¸€ä¸ªåŒé“¾è¡¨ï¼ŒåŒé“¾è¡¨åˆå§‹ä¸ºç©ºï¼Œæ”¯æŒ `5` ç§æ“ä½œï¼š
>
> 1. åœ¨æœ€å·¦ä¾§æ’å…¥ä¸€ä¸ªæ•°ï¼›
> 2. åœ¨æœ€å³ä¾§æ’å…¥ä¸€ä¸ªæ•°ï¼›
> 3. å°†ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°åˆ é™¤ï¼›
> 4. åœ¨ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°å·¦ä¾§æ’å…¥ä¸€ä¸ªæ•°ï¼›
> 5. åœ¨ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°å³ä¾§æ’å…¥ä¸€ä¸ªæ•°
>
> ç°åœ¨è¦å¯¹è¯¥é“¾è¡¨è¿›è¡Œ `M` æ¬¡æ“ä½œï¼Œè¿›è¡Œå®Œæ‰€æœ‰æ“ä½œåï¼Œä»å·¦åˆ°å³è¾“å‡ºæ•´ä¸ªé“¾è¡¨ã€‚
>
> **æ³¨æ„**:é¢˜ç›®ä¸­ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°å¹¶ä¸æ˜¯æŒ‡å½“å‰é“¾è¡¨çš„ç¬¬ `k` ä¸ªæ•°ã€‚ä¾‹å¦‚æ“ä½œè¿‡ç¨‹ä¸­ä¸€å…±æ’å…¥äº† `n` ä¸ªæ•°ï¼Œåˆ™æŒ‰ç…§æ’å…¥çš„æ—¶é—´é¡ºåºï¼Œè¿™ `n` ä¸ªæ•°ä¾æ¬¡ä¸ºï¼šç¬¬ `1` ä¸ªæ’å…¥çš„æ•°ï¼Œç¬¬ `2` ä¸ªæ’å…¥çš„æ•°ï¼Œâ€¦ç¬¬ `n` ä¸ªæ’å…¥çš„æ•°ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° `M`ï¼Œè¡¨ç¤ºæ“ä½œæ¬¡æ•°ã€‚
>
> æ¥ä¸‹æ¥ `M` è¡Œï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ“ä½œå‘½ä»¤ï¼Œæ“ä½œå‘½ä»¤å¯èƒ½ä¸ºä»¥ä¸‹å‡ ç§ï¼š
>
> 1. `L x`ï¼Œè¡¨ç¤ºåœ¨é“¾è¡¨çš„æœ€å·¦ç«¯æ’å…¥æ•° `x`ã€‚
> 2. `R x`ï¼Œè¡¨ç¤ºåœ¨é“¾è¡¨çš„æœ€å³ç«¯æ’å…¥æ•° `x`ã€‚
> 3. `D k`ï¼Œè¡¨ç¤ºå°†ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°åˆ é™¤ã€‚
> 4. `IL k x`ï¼Œè¡¨ç¤ºåœ¨ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°å·¦ä¾§æ’å…¥ä¸€ä¸ªæ•°ã€‚
> 5. `IR k x`ï¼Œè¡¨ç¤ºåœ¨ç¬¬ `k` ä¸ªæ’å…¥çš„æ•°å³ä¾§æ’å…¥ä¸€ä¸ªæ•°ã€‚

**è¾“å‡ºæ ¼å¼**

> å…±ä¸€è¡Œï¼Œå°†æ•´ä¸ªé“¾è¡¨ä»å·¦åˆ°å³è¾“å‡ºã€‚

**æ•°æ®èŒƒå›´**

> + $1â‰¤Mâ‰¤100000$
> + $æ‰€æœ‰æ“ä½œä¿è¯åˆæ³•ã€‚$

**è¾“å…¥æ ·ä¾‹**

```c++
10
R 7
D 1
L 3
IL 2 10
D 3
IL 2 7
L 8
R 9
IL 4 7
IR 2 2
```

**è¾“å‡ºæ ·ä¾‹**

```c++
8 7 7 3 2 9
```

**æ‰‹å†™ç¨¿**

![451439](img/451439.png)

**ä»£ç **

```c++
#include <iostream>
#include <cstring>
using namespace std;
const int N = 100010;
int n, idx;
char op[2];
int l[N], r[N], e[N];
// æ‰‹å†™ç¨¿è¯´æ˜
void init() {
    r[0] = 1, l[1] = 0;
    idx = 2;
    return;
}
// æ‰‹å†™ç¨¿è¯´æ˜
void insert(int k, int x) {
    e[idx] = x;
    r[idx] = r[k];
    l[r[k]] = idx;
    l[idx] = k;
    r[k] = idx ++;
    return;
}
// æ‰‹å†™ç¨¿è¯´æ˜
void remove(int k) {
    r[l[k]] = r[k];
    l[r[k]] = l[k];
    return;
}
int main() {
    scanf("%d", &n);
    // åˆå§‹åŒ–
    init();
    while (n -- ) {
        scanf("%s", op);
        int k, x;
        if (!strcmp(op, "L")) {
            scanf("%d", &x);
            insert(0, x);
        }
        else if (!strcmp(op, "R")) {
            scanf("%d", &x);
            insert(l[1], x);
        }
        else if (!strcmp(op, "D")) {
            scanf("%d", &k);
            // æ³¨æ„: ä¸‹æ ‡ä»2å¼€å§‹, å› æ­¤, ç¬¬kä¸ªæ•°çš„æŒ‡é’ˆ[ä¸‹æ ‡]ä¸ºk + 1
            remove(k + 1);
        }
        else if (!strcmp(op, "IL")) {
            scanf("%d%d", &k, &x);
            // æ³¨æ„: ä¸‹æ ‡ä»2å¼€å§‹, å› æ­¤, ç¬¬kä¸ªæ•°çš„æŒ‡é’ˆ[ä¸‹æ ‡]ä¸ºk + 1
            insert(l[k + 1], x);
        }
        else {
            scanf("%d%d", &k, &x);
            // æ³¨æ„: ä¸‹æ ‡ä»2å¼€å§‹, å› æ­¤, ç¬¬kä¸ªæ•°çš„æŒ‡é’ˆ[ä¸‹æ ‡]ä¸ºk + 1
            insert(k + 1, x);
        }
    }
    for (int i = r[0]; i != 1; i = r[i]) cout << e[i] << " ";
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`æ•°ç»„æ¨¡æ‹ŸåŒé“¾è¡¨`

**ç¼åˆæ€ª**

## [SDUT 2054. åŒå‘é“¾è¡¨](https://acm.sdut.edu.cn/onlinejudge3/problems/2054)

**é—®é¢˜æè¿°**

> å­¦ä¼šäº†å•å‘é“¾è¡¨ï¼Œæˆ‘ä»¬åˆå¤šäº†ä¸€ç§è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼Œå•é“¾è¡¨åˆ©ç”¨ä¸€ä¸ªæŒ‡é’ˆå°±èƒ½åœ¨å†…å­˜ä¸­æ‰¾åˆ°ä¸‹ä¸€ä¸ªä½ç½®ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸ä¼šè½»æ˜“æ–­è£‚çš„é“¾ã€‚ä½†å•é“¾è¡¨æœ‰ä¸€ä¸ªå¼±ç‚¹â€”â€”ä¸èƒ½å›æŒ‡ã€‚æ¯”å¦‚åœ¨é“¾è¡¨ä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹A,Bï¼Œä»–ä»¬çš„å…³ç³»æ˜¯Bæ˜¯Açš„åç»§ï¼ŒAæŒ‡å‘äº†Bï¼Œä¾¿èƒ½è½»æ˜“ç»Aæ‰¾åˆ°B,ä½†ä»Bå´ä¸èƒ½æ‰¾åˆ°Aã€‚ä¸€ä¸ªç®€å•çš„æƒ³æ³•ä¾¿èƒ½è½»æ˜“è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å»ºç«‹åŒå‘é“¾è¡¨ã€‚åœ¨åŒå‘é“¾è¡¨ä¸­ï¼ŒAæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†èŠ‚ç‚¹Bï¼ŒåŒæ—¶ï¼ŒBåˆæœ‰ä¸€ä¸ªæŒ‡å‘Açš„æŒ‡é’ˆã€‚è¿™æ ·ä¸ä»…èƒ½ä»é“¾è¡¨å¤´èŠ‚ç‚¹çš„ä½ç½®éå†æ•´ä¸ªé“¾è¡¨æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¹Ÿèƒ½ä»é“¾è¡¨å°¾èŠ‚ç‚¹å¼€å§‹éå†æ‰€æœ‰èŠ‚ç‚¹ã€‚å¯¹äºç»™å®šçš„ä¸€åˆ—æ•°æ®ï¼ŒæŒ‰ç…§ç»™å®šçš„é¡ºåºå»ºç«‹åŒå‘é“¾è¡¨ï¼ŒæŒ‰ç…§å…³é”®å­—æ‰¾åˆ°ç›¸åº”èŠ‚ç‚¹ï¼Œè¾“å‡ºæ­¤èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹å…³é”®å­—åŠåç»§èŠ‚ç‚¹å…³é”®å­—ã€‚

**è¾“å…¥æ ¼å¼**

> ç¬¬ä¸€è¡Œä¸¤ä¸ªæ­£æ•´æ•°nï¼ˆä»£è¡¨èŠ‚ç‚¹ä¸ªæ•°ï¼‰ï¼Œmï¼ˆä»£è¡¨è¦æ‰¾çš„å…³é”®å­—çš„ä¸ªæ•°ï¼‰ã€‚ç¬¬äºŒè¡Œæ˜¯nä¸ªæ•°ï¼ˆnä¸ªæ•°æ²¡æœ‰é‡å¤ï¼‰ï¼Œåˆ©ç”¨è¿™nä¸ªæ•°å»ºç«‹åŒå‘é“¾è¡¨ã€‚æ¥ä¸‹æ¥æœ‰mä¸ªå…³é”®å­—ï¼Œæ¯ä¸ªå ä¸€è¡Œã€‚

**è¾“å‡ºæ ¼å¼**

> å¯¹ç»™å®šçš„æ¯ä¸ªå…³é”®å­—ï¼Œè¾“å‡ºæ­¤å…³é”®å­—å‰é©±èŠ‚ç‚¹å…³é”®å­—å’Œåç»§èŠ‚ç‚¹å…³é”®å­—ã€‚å¦‚æœç»™å®šçš„å…³é”®å­—æ²¡æœ‰å‰é©±æˆ–è€…åç»§ï¼Œåˆ™ä¸è¾“å‡ºã€‚
> æ³¨æ„ï¼šæ¯ä¸ªç»™å®šå…³é”®å­—çš„è¾“å‡ºå ä¸€è¡Œã€‚ä¸€è¡Œè¾“å‡ºçš„æ•°æ®ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ï¼Œè¡Œé¦–ã€è¡Œæœ«æ— ç©ºæ ¼ã€‚

**è¾“å…¥æ ·ä¾‹**

```c++
10 3
1 2 3 4 5 6 7 8 9 0
3
5
0
```

**è¾“å‡ºæ ·ä¾‹**

```c++
2 4
4 6
9
```

**æ‰‹å†™ç¨¿**

![460926](img/460926.png)

**ä»£ç **

```c++
#include <iostream>
using namespace std;
// å®šä¹‰ç»“æ„ä½“
struct DNode {
    int val;
    DNode *left, *right;
    DNode (int _val) : val(_val), left(NULL), right(NULL){}
}*L, *R;
int n, m;
// æ‰‹å†™ç¨¿
void init() {
    L = new DNode(-1);
    R = new DNode(-1);
    L -> right = R;
    R -> left = L;
    return;
}
// æ‰‹å†™ç¨¿
void insert(int x) {
    DNode *p = new DNode(x);
    p -> right = R;
    p -> left = R -> left;
    R -> left -> right = p;
    R -> left = p;
    return;
}
int main() {
    scanf("%d%d",&n, &m);
    init();
    for (int i = 0, x; i < n; i ++ ) {
        scanf("%d", &x);
        insert(x);
    }
    while (m -- ) {
        int x;
        scanf("%d", &x);
        for (DNode *p = L -> right; p != R; p = p -> right)
            if (p -> val == x) {
                if (p -> left != L) cout << p -> left -> val;
                if (p -> right != R) {
                  	// æ³¨æ„æ ¼å¼[ä¸¤ç§ç‰¹æ®Šæƒ…å†µ]:
                  	// 1. åªæœ‰å‰ç¼€
                  	// 2. åªæœ‰åç¼€
                    if (p -> left != L)
                        cout << " ";
                    cout << p -> right -> val;
                }
                cout << endl;
                break;
            }
    }
    return 0;
}
```

**æ—¶é—´å¤æ‚åº¦**

$O(m)$

**ç©ºé—´å¤æ‚åº¦**

$O(m)$

**æ ‡ç­¾**

`åŒå‘é“¾è¡¨`

**ç¼åˆæ€ª**



## [LeetCode 328. å¥‡å¶é“¾è¡¨](https://leetcode-cn.com/problems/odd-even-linked-list/)

**é¢˜ç›®æè¿°**

> ç»™å®šå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ `head` ï¼Œå°†æ‰€æœ‰ç´¢å¼•ä¸ºå¥‡æ•°çš„èŠ‚ç‚¹å’Œç´¢å¼•ä¸ºå¶æ•°çš„èŠ‚ç‚¹åˆ†åˆ«ç»„åˆåœ¨ä¸€èµ·ï¼Œç„¶åè¿”å›é‡æ–°æ’åºçš„åˆ—è¡¨ã€‚
>
> ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ç´¢å¼•è¢«è®¤ä¸ºæ˜¯ å¥‡æ•° ï¼Œ ç¬¬äºŒä¸ªèŠ‚ç‚¹çš„ç´¢å¼•ä¸º å¶æ•° ï¼Œä»¥æ­¤ç±»æ¨ã€‚
>
> è¯·æ³¨æ„ï¼Œå¶æ•°ç»„å’Œå¥‡æ•°ç»„å†…éƒ¨çš„ç›¸å¯¹é¡ºåºåº”è¯¥ä¸è¾“å…¥æ—¶ä¿æŒä¸€è‡´ã€‚
>
> ä½ å¿…é¡»åœ¨ `O(1)` çš„é¢å¤–ç©ºé—´å¤æ‚åº¦å’Œ `O(n)` çš„æ—¶é—´å¤æ‚åº¦ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**ç¤ºä¾‹ 1**

![img](img/oddeven-linked-list.jpg)

> è¾“å…¥: `head = [1,2,3,4,5]`
> è¾“å‡º: `[1,3,5,2,4]`

**ç¤ºä¾‹ 2**

![img](img/oddeven2-linked-list.jpg)

> è¾“å…¥: `head = [2,1,3,5,6,4,7]`
> è¾“å‡º: `[2,3,6,7,1,5,4]`

**æç¤º**

> + $n ==  é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°$
> + $0 <= n <= 10^4$
> + $-10^6 <= Node.val <= 10^6$

**æ‰‹å†™ç¨¿**

![312202](img/312202.png)

**ä»£ç **

```c++
/**
 * Definition for singly-linked list.
 * struct ListNode {
 *     int val;
 *     ListNode *next;
 *     ListNode() : val(0), next(nullptr) {}
 *     ListNode(int x) : val(x), next(nullptr) {}
 *     ListNode(int x, ListNode *next) : val(x), next(next) {}
 * };
 */
class Solution {
public:
    ListNode* oddEvenList(ListNode* p) {
        // oddæ˜¯å¥‡æ•°é“¾è¡¨ï¼Œevenæ˜¯å¶æ•°é“¾è¡¨
        auto odd = new ListNode(-1), even = new ListNode(-1);
        ListNode *a = odd, *b = even;
        while (p) {
            auto q = p -> next;
            p -> next = a -> next;
            a = a -> next = p;
            if (!q) break;
            auto r = q -> next;
            q -> next = b -> next;
            b = b -> next = q;
            p = r;
        }
        a -> next = even -> next;
        return odd -> next;
    }
};
```

**æ ‡ç­¾**

`é“¾è¡¨`

# è®¾è®¡ç±»ä¸“é¢˜

## [LeetCode 341. æ‰å¹³åŒ–åµŒå¥—åˆ—è¡¨è¿­ä»£å™¨](https://leetcode-cn.com/problems/flatten-nested-list-iterator/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªåµŒå¥—çš„æ•´æ•°åˆ—è¡¨ `nestedList` ã€‚æ¯ä¸ªå…ƒç´ è¦ä¹ˆæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼›è¯¥åˆ—è¡¨çš„å…ƒç´ ä¹Ÿå¯èƒ½æ˜¯æ•´æ•°æˆ–è€…æ˜¯å…¶ä»–åˆ—è¡¨ã€‚è¯·ä½ å®ç°ä¸€ä¸ªè¿­ä»£å™¨å°†å…¶æ‰å¹³åŒ–ï¼Œä½¿ä¹‹èƒ½å¤Ÿéå†è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰æ•´æ•°ã€‚
>
>   å®ç°æ‰å¹³è¿­ä»£å™¨ç±» `NestedIterator` ï¼š
>
>   +   `NestedIterator(List<NestedInteger> nestedList)` ç”¨åµŒå¥—åˆ—è¡¨ `nestedList` åˆå§‹åŒ–è¿­ä»£å™¨ã€‚
>   +   `int next()` è¿”å›åµŒå¥—åˆ—è¡¨çš„ä¸‹ä¸€ä¸ªæ•´æ•°ã€‚
>   +   `boolean hasNext()` å¦‚æœä»ç„¶å­˜åœ¨å¾…è¿­ä»£çš„æ•´æ•°ï¼Œè¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
>       ä½ çš„ä»£ç å°†ä¼šç”¨ä¸‹è¿°ä¼ªä»£ç æ£€æµ‹ï¼š
>
>   ```c++
>   initialize iterator with nestedList
>   res = []
>   while iterator.hasNext()
>       append iterator.next() to the end of res
>   return res
>   ```
>
>
>   å¦‚æœ `res` ä¸é¢„æœŸçš„æ‰å¹³åŒ–åˆ—è¡¨åŒ¹é…ï¼Œé‚£ä¹ˆä½ çš„ä»£ç å°†ä¼šè¢«åˆ¤ä¸ºæ­£ç¡®ã€‚

**ç¤ºä¾‹ 1**

>   è¾“å…¥ï¼š`nestedList = [[1,1],2,[1,1]]`
>   è¾“å‡ºï¼š`[1,1,2,1,1]`
>   è§£é‡Šï¼šé€šè¿‡é‡å¤è°ƒç”¨ `next` ç›´åˆ° `hasNext` è¿”å› `false`ï¼Œ`next` è¿”å›çš„å…ƒç´ çš„é¡ºåºåº”è¯¥æ˜¯: `[1,1,2,1,1]`ã€‚

**ç¤ºä¾‹ 2**

>   è¾“å…¥ï¼š`nestedList = [1,[4,[6]]]`
>   è¾“å‡ºï¼š`[1,4,6]`
>   è§£é‡Šï¼šé€šè¿‡é‡å¤è°ƒç”¨ `next` ç›´åˆ° `hasNext` è¿”å› `false`ï¼Œ`next` è¿”å›çš„å…ƒç´ çš„é¡ºåºåº”è¯¥æ˜¯: `[1,4,6]`ã€‚

**æç¤º**

>   +   $1 <= nestedList.length <= 500$
>   +   $åµŒå¥—åˆ—è¡¨ä¸­çš„æ•´æ•°å€¼åœ¨èŒƒå›´ [-106, 106] å†…$

**æ‰‹å†™ç¨¿**

![331157](img/331157.png)

**ä»£ç ä¸€ï¼šæ ‘çš„éå†ã€é€’å½’å†™æ³•ã€‘**

```c++
/**
 * // This is the interface that allows for creating nested lists.
 * // You should not implement it, or speculate about its implementation
 * class NestedInteger {
 *   public:
 *     // Return true if this NestedInteger holds a single integer, rather than a nested list.
 *     bool isInteger() const;
 *
 *     // Return the single integer that this NestedInteger holds, if it holds a single integer
 *     // The result is undefined if this NestedInteger holds a nested list
 *     int getInteger() const;
 *
 *     // Return the nested list that this NestedInteger holds, if it holds a nested list
 *     // The result is undefined if this NestedInteger holds a single integer
 *     const vector<NestedInteger> &getList() const;
 * };
 */

class NestedIterator {
public:
    vector<int> q;
    int k;
    void dfs(NestedInteger& u) {
        // å¦‚æœæ˜¯å¶å­ç»“ç‚¹
        if (u.isInteger()) q.push_back(u.getInteger());
        // éå†æ ¹èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹
        else for (auto& u1 : u.getList()) dfs(u1);
        return;
    }
    NestedIterator(vector<NestedInteger> &nestedList) {
        k = 0;
        for (auto& u : nestedList) dfs(u);
    }
    
    int next() {
        return q[k ++];
    }
    
    bool hasNext() {
        return k < q.size();
    }
};

/**
 * Your NestedIterator object will be instantiated and called as such:
 * NestedIterator i(nestedList);
 * while (i.hasNext()) cout << i.next();
 */
```

**ä»£ç äºŒï¼šè¿­ä»£**

```c++
/**
 * // This is the interface that allows for creating nested lists.
 * // You should not implement it, or speculate about its implementation
 * class NestedInteger {
 *   public:
 *     // Return true if this NestedInteger holds a single integer, rather than a nested list.
 *     bool isInteger() const;
 *
 *     // Return the single integer that this NestedInteger holds, if it holds a single integer
 *     // The result is undefined if this NestedInteger holds a nested list
 *     int getInteger() const;
 *
 *     // Return the nested list that this NestedInteger holds, if it holds a nested list
 *     // The result is undefined if this NestedInteger holds a single integer
 *     const vector<NestedInteger> &getList() const;
 * };
 */

class NestedIterator {
public:
    stack<NestedInteger> stk;
    NestedIterator(vector<NestedInteger> &nestedList) {
        for (int i = nestedList.size() - 1; i >= 0; i -- ) 
            stk.push(nestedList[i]);
    }
    
    int next() {
        int k = stk.top().getInteger(); stk.pop();
        return k;
    }
    
    bool hasNext() {
        while (stk.size()) {
            auto cur = stk.top();
            if (cur.isInteger()) return true;
            stk.pop();
            for (int i = cur.getList().size() - 1; i >= 0; i -- ) stk.push(cur.getList()[i]);
        }
        return false;
    }
};

/**
 * Your NestedIterator object will be instantiated and called as such:
 * NestedIterator i(nestedList);
 * while (i.hasNext()) cout << i.next();
 */
```

**æ ‡ç­¾**

`è®¾è®¡æ•°æ®ç»“æ„`ã€`é€’å½’`ã€`è¿­ä»£å™¨`

**ç¼åˆæ€ª**

[LeetCode 385. è¿·ä½ è¯­æ³•åˆ†æå™¨](#LeetCode 385. è¿·ä½ è¯­æ³•åˆ†æå™¨)

## [LeetCode 380. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ ](https://leetcode-cn.com/problems/insert-delete-getrandom-o1/)

**é¢˜ç›®æè¿°**

>   å®ç° `RandomizedSet` ç±»ï¼š
>
>   +   `RandomizedSet()` åˆå§‹åŒ– `RandomizedSet` å¯¹è±¡
>   +   `bool insert(int val)` å½“å…ƒç´  `val` ä¸å­˜åœ¨æ—¶ï¼Œå‘é›†åˆä¸­æ’å…¥è¯¥é¡¹ï¼Œå¹¶è¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
>   +   `bool remove(int val)` å½“å…ƒç´  `val` å­˜åœ¨æ—¶ï¼Œä»é›†åˆä¸­ç§»é™¤è¯¥é¡¹ï¼Œå¹¶è¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
>   +   `int getRandom()` éšæœºè¿”å›ç°æœ‰é›†åˆä¸­çš„ä¸€é¡¹ï¼ˆæµ‹è¯•ç”¨ä¾‹ä¿è¯è°ƒç”¨æ­¤æ–¹æ³•æ—¶é›†åˆä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚æ¯ä¸ªå…ƒç´ åº”è¯¥æœ‰ ç›¸åŒçš„æ¦‚ç‡ è¢«è¿”å›ã€‚
>
>   ä½ å¿…é¡»å®ç°ç±»çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶æ»¡è¶³æ¯ä¸ªå‡½æ•°çš„ å¹³å‡ æ—¶é—´å¤æ‚åº¦ä¸º `O(1)` ã€‚

**ç¤ºä¾‹**

>   è¾“å…¥
>   `["RandomizedSet", "insert", "remove", "insert", "getRandom", "remove", "insert", "getRandom"]
>   [[], [1], [2], [2], [], [1], [2], []]`
>   è¾“å‡º
>   `[null, true, false, true, 2, true, false, 2]`
>
>   è§£é‡Š
>   `RandomizedSet randomizedSet = new RandomizedSet();`
>   `randomizedSet.insert(1);` // å‘é›†åˆä¸­æ’å…¥ `1` ã€‚è¿”å› `true` è¡¨ç¤º `1` è¢«æˆåŠŸåœ°æ’å…¥ã€‚
>   `randomizedSet.remove(2);` // è¿”å› `false` ï¼Œè¡¨ç¤ºé›†åˆä¸­ä¸å­˜åœ¨ `2` ã€‚
>   `randomizedSet.insert(2);` // å‘é›†åˆä¸­æ’å…¥ `2` ã€‚è¿”å› `true` ã€‚é›†åˆç°åœ¨åŒ…å« `[1,2]` ã€‚
>   `randomizedSet.getRandom();` // `getRandom` åº”éšæœºè¿”å› `1` æˆ– `2` ã€‚
>   `randomizedSet.remove(1);` // ä»é›†åˆä¸­ç§»é™¤ `1` ï¼Œè¿”å› `true` ã€‚é›†åˆç°åœ¨åŒ…å« `[2]` ã€‚
>   `randomizedSet.insert(2);` // `2` å·²åœ¨é›†åˆä¸­ï¼Œæ‰€ä»¥è¿”å› `false` ã€‚
>   `randomizedSet.getRandom();` // ç”±äº `2` æ˜¯é›†åˆä¸­å”¯ä¸€çš„æ•°å­—ï¼Œ`getRandom` æ€»æ˜¯è¿”å› `2` ã€‚

**æç¤º**

>   +   $-2^{31} <= val <= 2^{31} - 1$
>   +   $æœ€å¤šè°ƒç”¨ insertã€remove å’Œ getRandom å‡½æ•° 2 * 10^5 æ¬¡$
>   +   $åœ¨è°ƒç”¨ getRandom æ–¹æ³•æ—¶ï¼Œæ•°æ®ç»“æ„ä¸­ è‡³å°‘å­˜åœ¨ä¸€ä¸ª å…ƒç´ ã€‚$

**æ‰‹å†™ç¨¿**

![3171612](img/3171612.png)

**ä»£ç **

```c++
class RandomizedSet {
public:
    vector<int> g;
    unordered_map<int, int> hash;
    RandomizedSet() {}
    
    bool insert(int x) {
        if (hash.count(x) == 0) {
            hash[x] = g.size();
            g.push_back(x);
            return true;
        }
        return false;
    }
    
    bool remove(int x) {
        if (hash.count(x)) {
            // è·å–å½“å‰å…ƒç´ xçš„ä¸‹æ ‡
            int idx = hash[x];
            // åœ¨å“ˆå¸Œè¡¨ä¸­äº¤æ¢æ•°ç»„ä¸­å½“å‰å…ƒç´ çš„ä¸‹æ ‡å’Œæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡
            swap(hash[x], hash[g.back()]);
            // åœ¨æ•°ç»„ä¸­äº¤æ¢å½“å‰å…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ 
            swap(g[idx], g.back());
            // åœ¨æ•°ç»„ä¸­å°†æœ€åä¸€ä¸ªå…ƒç´ åˆ é™¤
            g.pop_back();
            // åœ¨å“ˆå¸Œè¡¨ä¸­å°†æœ€åä¸€ä¸ªå…ƒç´ å¯¹åº”çš„ä¸‹æ ‡åˆ é™¤
            hash.erase(x);
            return true;
        }
        return false;
    }
    
    int getRandom() {
        // è¿”å›éšæœºå€¼å³å¯
        return g[rand() % g.size()];
    }
};

/**
 * Your RandomizedSet object will be instantiated and called as such:
 * RandomizedSet* obj = new RandomizedSet();
 * bool param_1 = obj->insert(val);
 * bool param_2 = obj->remove(val);
 * int param_3 = obj->getRandom();
 */
```

**æ—¶é—´å¤æ‚åº¦**

$O(1)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`å“ˆå¸Œè¡¨`

**ç¼åˆæ€ª**

## [LeetCode 382. é“¾è¡¨éšæœºèŠ‚ç‚¹](https://leetcode-cn.com/problems/linked-list-random-node/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªå•é“¾è¡¨ï¼Œéšæœºé€‰æ‹©é“¾è¡¨çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›ç›¸åº”çš„èŠ‚ç‚¹å€¼ã€‚æ¯ä¸ªèŠ‚ç‚¹ è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸€æ · ã€‚
>
>   å®ç° `Solution` ç±»ï¼š
>
>   +   `Solution(ListNode head)` ä½¿ç”¨æ•´æ•°æ•°ç»„åˆå§‹åŒ–å¯¹è±¡ã€‚
>   +   `int getRandom()` ä»é“¾è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿”å›è¯¥èŠ‚ç‚¹çš„å€¼ã€‚é“¾è¡¨ä¸­æ‰€æœ‰èŠ‚ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡ç›¸ç­‰ã€‚

**ç¤ºä¾‹**

>   è¾“å…¥
>   `["Solution", "getRandom", "getRandom", "getRandom", "getRandom", "getRandom"]
>   [[[1, 2, 3]], [], [], [], [], []]`
>   è¾“å‡º
>   `[null, 1, 3, 2, 2, 3]`
>
>   è§£é‡Š
>   `Solution solution = new Solution([1, 2, 3]);`
>   `solution.getRandom();` // è¿”å› `1`
>   `solution.getRandom();` // è¿”å› `3`
>   `solution.getRandom();` // è¿”å› `2`
>   `solution.getRandom();` // è¿”å› `2`
>   `solution.getRandom();` // è¿”å› `3`
>   // `getRandom()` æ–¹æ³•åº”éšæœºè¿”å› `1`ã€`2`ã€`3`ä¸­çš„ä¸€ä¸ªï¼Œæ¯ä¸ªå…ƒç´ è¢«è¿”å›çš„æ¦‚ç‡ç›¸ç­‰ã€‚

**æç¤º**

>   +   $é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ [1, 10^4] å†…$
>   +   $-10^4 <= Node.val <= 10^4$
>   +   $è‡³å¤šè°ƒç”¨ getRandom æ–¹æ³• 10^4 æ¬¡$

**è¿›é˜¶**

>   å¦‚æœé“¾è¡¨éå¸¸å¤§ä¸”é•¿åº¦æœªçŸ¥ï¼Œè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ
>   ä½ èƒ½å¦åœ¨ä¸ä½¿ç”¨é¢å¤–ç©ºé—´çš„æƒ…å†µä¸‹è§£å†³æ­¤é—®é¢˜ï¼Ÿ

**æ‰‹å†™ç¨¿**

![3171956](img/3171956.png)

**ä»£ç **

```c++
/**
 * Definition for singly-linked list.
 * struct ListNode {
 *     int val;
 *     ListNode *next;
 *     ListNode() : val(0), next(nullptr) {}
 *     ListNode(int x) : val(x), next(nullptr) {}
 *     ListNode(int x, ListNode *next) : val(x), next(next) {}
 * };
 */
class Solution {
public:
    ListNode* h;
    Solution(ListNode* head) {
        h = head;
    }
    
    int getRandom() {
        int c = -1, n = 0;
        for (auto p = h; p; p = p -> next) {
            // å…ƒç´ çš„ä¸ªæ•°
            n ++;
            // éšæœºé€‰æ‹©æŸä¸ªå…ƒç´ 1/n
            if (rand() % n == 0) c = p -> val;
        }
        return c;
    }
};

/**
 * Your Solution object will be instantiated and called as such:
 * Solution* obj = new Solution(head);
 * int param_1 = obj->getRandom();
 */
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(1)$

**æ ‡ç­¾**

`è“„æ°´æ± æŠ½æ ·ç®—æ³•`

**ç¼åˆæ€ª**

## [LeetCode 384. æ‰“ä¹±æ•°ç»„](https://leetcode-cn.com/problems/shuffle-an-array/)

**é¢˜ç›®æè¿°**

>   ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œè®¾è®¡ç®—æ³•æ¥æ‰“ä¹±ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„æ•°ç»„ã€‚æ‰“ä¹±åï¼Œæ•°ç»„çš„æ‰€æœ‰æ’åˆ—åº”è¯¥æ˜¯ ç­‰å¯èƒ½ çš„ã€‚
>
>   å®ç° `Solution class`:
>
>   +   `Solution(int[] nums)` ä½¿ç”¨æ•´æ•°æ•°ç»„ `nums` åˆå§‹åŒ–å¯¹è±¡
>   +   `int[] reset()` é‡è®¾æ•°ç»„åˆ°å®ƒçš„åˆå§‹çŠ¶æ€å¹¶è¿”å›
>   +   `int[] shuffle()` è¿”å›æ•°ç»„éšæœºæ‰“ä¹±åçš„ç»“æœ

**ç¤ºä¾‹ 1**

>   è¾“å…¥
>   `["Solution", "shuffle", "reset", "shuffle"]
>   [[[1, 2, 3]], [], [], []]`
>   è¾“å‡º
>   `[null, [3, 1, 2], [1, 2, 3], [1, 3, 2]]`
>
>   è§£é‡Š
>   `Solution solution = new Solution([1, 2, 3]);`
>   `solution.shuffle();`    // æ‰“ä¹±æ•°ç»„ `[1,2,3]` å¹¶è¿”å›ç»“æœã€‚ä»»ä½• `[1,2,3]`çš„æ’åˆ—è¿”å›çš„æ¦‚ç‡åº”è¯¥ç›¸åŒã€‚ä¾‹å¦‚ï¼Œè¿”å› `[3, 1, 2]`
>   `solution.reset();`      // é‡è®¾æ•°ç»„åˆ°å®ƒçš„åˆå§‹çŠ¶æ€ `[1, 2, 3]` ã€‚è¿”å› `[1, 2, 3]`
>   `solution.shuffle();`    // éšæœºè¿”å›æ•°ç»„ `[1, 2, 3]` æ‰“ä¹±åçš„ç»“æœã€‚ä¾‹å¦‚ï¼Œè¿”å› `[1, 3, 2]`

**æç¤º**

>   +   $1 <= nums.length <= 200$
>   +   $-10^6 <= nums[i] <= 10^6$
>   +   $nums ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯ å”¯ä¸€çš„$
>   +   $æœ€å¤šå¯ä»¥è°ƒç”¨ 5 * 10^4 æ¬¡ reset å’Œ shuffle$

**æ‰‹å†™ç¨¿**

![3172043](img/3172043.png)

**ä»£ç **

```c++
class Solution {
public:
    vector<int> a, b;
    Solution(vector<int>& nums) {
        a = nums;
    }
    
    vector<int> reset() {
        return a;
    }
    
    vector<int> shuffle() {
        b = a;
        int n = a.size();
        for (int i = 0; i < n; i ++ )
            // äº¤æ¢ç¬¬iå¼ å’Œç¬¬i~nå¼ 
            swap(b[i], b[i + rand() % (n - i)]);
        return b;
    }
};

/**
 * Your Solution object will be instantiated and called as such:
 * Solution* obj = new Solution(nums);
 * vector<int> param_1 = obj->reset();
 * vector<int> param_2 = obj->shuffle();
 */
```

**æ—¶é—´å¤æ‚åº¦**

$O(n)$

**ç©ºé—´å¤æ‚åº¦**

$O(n)$

**æ ‡ç­¾**

`æ´—ç‰Œç®—æ³•`

**ç¼åˆæ€ª**

## [LeetCode 146. LRU ç¼“å­˜](https://leetcode-cn.com/problems/lru-cache/)

**é¢˜ç›®æè¿°**

>   è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³  `LRU` (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜ çº¦æŸçš„æ•°æ®ç»“æ„ã€‚
>   å®ç° `LRUCache` ç±»ï¼š
>
>   +   `LRUCache(int capacity)` ä»¥ æ­£æ•´æ•° ä½œä¸ºå®¹é‡ `capacity` åˆå§‹åŒ– `LRU` ç¼“å­˜
>   +   `int get(int key)` å¦‚æœå…³é”®å­— `key` å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› `-1` ã€‚
>   +   `void put(int key, int value)` å¦‚æœå…³é”®å­— key å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ `value` ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„ `key-value` ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡ `capacity` ï¼Œåˆ™åº”è¯¥ é€å‡º æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚
>
>   å‡½æ•° `get` å’Œ `put` å¿…é¡»ä»¥ `O(1)` çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚

**ç¤ºä¾‹**

>   è¾“å…¥
>   `["LRUCache", "put", "put", "get", "put", "get", "put", "get", "get", "get"]
>   [[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]`
>   è¾“å‡º
>   `[null, null, null, 1, null, -1, null, -1, 3, 4]`
>
>   è§£é‡Š
>   `LRUCache lRUCache = new LRUCache(2);`
>   `lRUCache.put(1, 1);` // ç¼“å­˜æ˜¯ `{1=1}`
>   `lRUCache.put(2, 2);` // ç¼“å­˜æ˜¯ `{1=1, 2=2}`
>   `lRUCache.get(1);`    // è¿”å› `1`
>   `lRUCache.put(3, 3);` // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— `2` ä½œåºŸï¼Œç¼“å­˜æ˜¯ `{1=1, 3=3}`
>   `lRUCache.get(2);`    // è¿”å› `-1` (æœªæ‰¾åˆ°)
>   `lRUCache.put(4, 4);` // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— `1` ä½œåºŸï¼Œç¼“å­˜æ˜¯ `{4=4, 3=3}`
>   `lRUCache.get(1);`    // è¿”å› `-1` (æœªæ‰¾åˆ°)
>   `lRUCache.get(3);`    // è¿”å› `3`
>   `lRUCache.get(4);`    // è¿”å› `4`

**æç¤º**

>   +   $1 <= capacity <= 3000$
>   +   $0 <= key <= 10000$
>   +   $0 <= value <= 10^5$
>   +   $æœ€å¤šè°ƒç”¨ 2 * 10^5 æ¬¡ get å’Œ put$

**æ‰‹å†™ç¨¿**

> 1. æ‰‹å†™ç¨¿åœ¨åŒé“¾è¡¨

**ä»£ç **

```c++
class LRUCache {
public:
    struct DNode {
        int key, val;
        DNode *left, *right;
        DNode(int _key, int _val) : key(_key), val(_val), left(NULL), right(NULL){}
    }*L, *R;
    int capacity;
    unordered_map<int, DNode*> hash; // key -> pointer
    // åˆå§‹åŒ–
    void init() {
        L = new DNode({-1, -1});
        R = new DNode({-1, -1});
        L -> right = R;
        R -> left = L;
        return;
    }
    // åœ¨pèŠ‚ç‚¹ä¹‹åæ’å…¥pointerèŠ‚ç‚¹
    void insert(DNode* p, DNode* pointer) {
        pointer -> right = p -> right;
        pointer -> left = p;
        p -> right -> left = pointer;
        p -> right = pointer;
        return;
    }
    // å°†pointerèŠ‚ç‚¹åˆ é™¤
    void remove(DNode* pointer) {
        pointer -> left -> right = pointer -> right;
        pointer -> right -> left = pointer -> left;
        return;
    }
    LRUCache(int _capacity) {
      	// åŒå‘é“¾è¡¨å°¾éƒ¨æ’å…¥
      	// å¤´éƒ¨åˆ é™¤
        capacity = _capacity;
        init();
    }
    
    int get(int key) {
        if (hash.count(key)) {
            // è·å–keyæ‰€æŒ‡å‘çš„æŒ‡é’ˆ
            auto pointer = hash[key];
            // å°†pointeræŒ‡å‘çš„èŠ‚ç‚¹åˆ é™¤
            remove(pointer);
            // æ’å…¥åˆ°å°¾éƒ¨
            insert(R -> left, pointer);
            // è¿”å›å€¼
            return pointer -> val;
        }
        return -1;
    }
    
    void put(int key, int value) {
        // å¦‚æœkeyå­˜åœ¨
        if (hash.count(key)) {
            auto pointer = hash[key];
            pointer -> val = value;
            // åˆ é™¤
            remove(pointer);
            // æ’å…¥å°¾éƒ¨
            insert(R -> left, pointer);
        }
        else {
            if (hash.size() >= capacity) { // åˆ é™¤å¤´èŠ‚ç‚¹
                // è·å–å€¼
                int key = L -> right -> key;
                // åˆ é™¤é¦–å…ƒèŠ‚ç‚¹
                remove(L -> right);
                // å°†keyä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤
                hash.erase(hash.find(key));
            }
            // æ–°å»ºèŠ‚ç‚¹
            hash[key] = new DNode({key, value});
            // æ’å…¥å°¾éƒ¨
            insert(R -> left, hash[key]);
        }
        return;
    }
};

/**
 * Your LRUCache object will be instantiated and called as such:
 * LRUCache* obj = new LRUCache(capacity);
 * int param_1 = obj->get(key);
 * obj->put(key,value);
 */
```

**æ—¶é—´å¤æ‚åº¦**

$O(1)$

**ç©ºé—´å¤æ‚åº¦**

$O(n), næ˜¯èŠ‚ç‚¹çš„ä¸ªæ•°$

**æ ‡ç­¾**

`åŒå‘é“¾è¡¨`

**ç¼åˆæ€ª**

[SDUT 2054. åŒå‘é“¾è¡¨](#SDUT 2054. åŒå‘é“¾è¡¨)

## end

# é™„å½•



## å¸¸ç”¨å˜é‡

### æ¬¡æ•°

>   `tms`

### æ£€æŸ¥

>   `check()`

### è¡Œ

>   `row`

### åˆ—

>   `col`

## å¸¸è§é”™è¯¯

### å˜é‡åå†²çª

>   1.   `friend` ä¸èƒ½åœ¨å…¨å±€ä½¿ç”¨, å±€éƒ¨ä½¿ç”¨å¯ä»¥
>   2.   

## è¿ç®—ç¬¦ä¼˜å…ˆçº§

### `C++` è¿ç®—ç¬¦ä¼˜å…ˆçº§

![361108](img/361108.png)

### End